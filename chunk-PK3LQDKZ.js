import{a as te,b as ie,c as oe,d as ne,e as re,f as ae}from"./chunk-KVR4RYIJ.js";import"./chunk-OF4NWUCZ.js";import{b as Z}from"./chunk-6SBMUNL6.js";import{a as Q,f as X,g as Y}from"./chunk-36ZEBUIF.js";import"./chunk-5WHZVVNO.js";import"./chunk-XV2LRFPF.js";import{b as ee}from"./chunk-O6HHRXJW.js";import"./chunk-KH7BRNI5.js";import"./chunk-7RLVC7KT.js";import"./chunk-6N2ZAFKI.js";import{b as j,g as F,h as N,i as U,j as L,k as P,p as q,s as W,t as B,u as z}from"./chunk-YMHN4OAJ.js";import{a as D}from"./chunk-KXRI7F4O.js";import{a as m}from"./chunk-457AHRSD.js";import{a as G,b as H,d as $,g as J,k as K}from"./chunk-ZTYB7S4H.js";import{c as b}from"./chunk-G24K2AOA.js";import{a as O}from"./chunk-YPKKVN63.js";import{h as _}from"./chunk-ZQ4W7CNR.js";import"./chunk-3VSBFCFV.js";import{a as k,c as A}from"./chunk-EMIR7HSH.js";import{f as T}from"./chunk-AYWYMZFO.js";import{h as y}from"./chunk-RDHEKL6H.js";import{$b as R,Ba as g,Db as C,Ec as a,Yb as c,Zb as n,_b as r,gd as x,hc as h,ka as I,lb as d,mc as p,pa as l,pc as M,qb as v,va as f,wa as u,xb as S,zc as E}from"./chunk-QG3GL7MT.js";var le=(()=>{let i=class i{constructor(){this.httpClient=l(T),this.authService=l(b)}sendConfirmationCode(t){let e=this.authService.getCurrentUserContext(),o=t?"Basic "+btoa(t.username+":"+t.password):`Bearer ${e.accessToken}`;return this.httpClient.post(D.journeyApi+"/sendEmailCode",{},{headers:{Authorization:o}})}verifyConfirmationCode(t){let e=this.authService.getCurrentUserContext();return this.httpClient.post(D.journeyApi+"/verifyEmailCode",{code:t},{headers:{Authorization:`Bearer ${e.accessToken}`}})}};i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=I({token:i,factory:i.\u0275fac,providedIn:"root"});let s=i;return s})();function pe(s,i){s&1&&(n(0,"p",16),a(1," Code invalid. Please enter a valid code. "),r())}function Ce(s,i){s&1&&(n(0,"p",17),a(1," Code has been sent successfully to the registered email. If you haven't received it, click Send again after 60 seconds. "),r())}var de=(()=>{let i=class i{constructor(){this.destroyRef=l(g),this.emailConfirmationCodeService=l(le),this.loginService=l(ee),this.authService=l(b),this.dialogRef=l(te),this.credential=l(ie),this.isCodeSent=x(!1),this.canSendCode=x(!0),this.isCodeValid=x(!0)}confirmCode(t,e){this.isCodeValid.set(!0),t.validity.valid?this.verifyCode(e,t):this.isCodeValid.set(!1)}verifyCode(t,e){t.disabled=!0,this.credential?this.verifyCodeInUnauthenticatedContext(e,t):this.verifyCodeInAuthenticatedContext(e,t)}verifyCodeInUnauthenticatedContext(t,e){e.disabled=!0,this.loginService.mfa(t.value,"EMAIL_ADDRESS",this.credential).pipe(m(this.destroyRef)).subscribe({next:o=>{this.authService.getUserContextForSuccessfulLogin(o),this.onVerificationSuccess(e)},error:o=>this.onVerificationError(o,e)})}verifyCodeInAuthenticatedContext(t,e){this.emailConfirmationCodeService.verifyConfirmationCode(t.value).pipe(m(this.destroyRef)).subscribe({next:o=>this.onVerificationSuccess(e),error:o=>this.onVerificationError(o,e)})}onVerificationSuccess(t){t.disabled=!0,console.log("code verified successfully"),this.dialogRef.close(!0)}onVerificationError(t,e){console.log(t),this.isCodeValid.set(!1),e.disabled=!1}sendCode(){this.canSendCode.set(!1),this.emailConfirmationCodeService.sendConfirmationCode(this.credential).pipe(m(this.destroyRef)).subscribe({next:t=>this.onSentSuccess(),error:t=>this.onSentError(t)})}onSentError(t){console.log(t),this.canSendCode.set(!0)}onSentSuccess(){this.isCodeSent.set(!0),setTimeout(()=>this.canSendCode.set(!0),1e3*60),console.log("Code has been sent successfully to register email")}};i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=S({type:i,selectors:[["app-email-code-verification"]],inputs:{isCodeSent:[1,"isCodeSent"],canSendCode:[1,"canSendCode"],isCodeValid:[1,"isCodeValid"]},outputs:{isCodeSent:"isCodeSentChange",canSendCode:"canSendCodeChange",isCodeValid:"isCodeValidChange"},decls:34,vars:3,consts:[["codeForm","ngForm"],["confirmationCode",""],["confirmButton",""],[3,"submit"],[1,"bg-gradient-to-r","from-blue-500","to-blue-700","text-white","text-xl","font-semibold","!p-4","rounded-t-lg"],[1,"text-primary"],[1,"list-decimal","list-inside","text-base","mb-4"],[1,"px-1","rounded-sm","font-bold","italic","text-sm"],["appearance","fill",1,"w-full"],["matInput","","type","text","inputmode","numeric","id","confirmationCode","name","confirmationCode","required","","pattern","[0-9]{6,6}","maxlength","6","ngModel","","autocomplete","off",1,""],["class","text-red-500 text-sm text-center mt-2",4,"ngIf"],[1,"flex","gap-2","mt-6","justify-center"],["mat-raised-button","","type","button","mat-dialog-close","false"],["mat-raised-button","","type","button",3,"click","disabled"],["mat-raised-button","","type","submit"],["class","text-green-600 text-sm font-bold mt-4",4,"ngIf"],[1,"text-red-500","text-sm","text-center","mt-2"],[1,"text-green-600","text-sm","font-bold","mt-4"]],template:function(e,o){if(e&1){let w=h();n(0,"form",3,0),p("submit",function(){f(w);let me=E(23),fe=E(31);return u(o.confirmCode(me,fe))}),n(2,"mat-card")(3,"mat-card-header",4)(4,"mat-card-title"),a(5,"Email Code Confirmation Required"),r()(),n(6,"mat-card-content",5)(7,"p"),a(8,"To complete verification, please follow below steps:"),r(),n(9,"ol",6)(10,"li"),a(11,"Click the "),n(12,"code",7),a(13,"Send"),r(),a(14," button to receive a verification code in your registered email. "),r(),n(15,"li"),a(16,"Check your email for the verification code."),r(),n(17,"li"),a(18,'Enter the code in the field below and click "Confirm" to complete the verification.'),r()(),n(19,"mat-form-field",8)(20,"mat-label"),a(21,"Code"),r(),R(22,"input",9,1),r(),C(24,pe,2,0,"p",10),n(25,"div",11)(26,"button",12),a(27,"Cancel"),r(),n(28,"button",13),p("click",function(){return f(w),u(o.sendCode())}),a(29,"Send"),r(),n(30,"button",14,2),a(32,"Confirm"),r()(),C(33,Ce,2,0,"p",15),r()()()}e&2&&(d(24),c("ngIf",!o.isCodeValid()),d(4),c("disabled",!o.canSendCode()),d(5),c("ngIf",o.isCodeSent()))},dependencies:[re,ne,z,P,j,F,N,q,W,B,L,U,y,_,Y,X,Q,K,G,$,J,H,Z],encapsulation:2,changeDetection:0});let s=i;return s})();function he(s,i){if(s&1){let V=h();n(0,"div",5)(1,"button",6),p("click",function(){f(V);let e=M();return u(e.continueWithTotpVerification())}),a(2," Using Mobile Authenticator "),n(3,"mat-icon",7),a(4,"screen_lock_portrait"),r()()()}}function ge(s,i){if(s&1){let V=h();n(0,"div",5)(1,"button",6),p("click",function(){f(V);let e=M();return u(e.continueWithEmailCodeVerification())}),a(2," Using Email Code "),n(3,"mat-icon",7),a(4,"mail_lock"),r()()()}}var Ye=(()=>{let i=class i{constructor(t,e,o){this.router=t,this.dialog=e,this.activatedRoute=o,this.destroyRef=l(g),this.mfaOptions=this.router.getCurrentNavigation()?.extras?.state}continueWithTotpVerification(){this.dialog.open(ae,{data:this.mfaOptions.credential,disableClose:!0}).afterClosed().pipe(m(this.destroyRef)).subscribe(e=>this.onCloseCallback(e))}continueWithEmailCodeVerification(){this.dialog.open(de,{data:this.mfaOptions.credential,disableClose:!0}).afterClosed().pipe(m(this.destroyRef)).subscribe(e=>this.onCloseCallback(e))}onCloseCallback(t){if(t===!0){let e=this.activatedRoute.snapshot.queryParams.redirectUrl??"/home";this.router.navigateByUrl(e).then(console.log)}}};i.\u0275fac=function(e){return new(e||i)(v(A),v(oe),v(k))},i.\u0275cmp=S({type:i,selectors:[["app-display-mfa-options"]],decls:7,vars:2,consts:[[1,"container","mx-auto","h-full","w-full","mt-4"],[1,"flex","flex-col","items-center","justify-center","gap-2"],[1,"p-2"],[1,"text-lg","font-bold","text-primary"],["class","w-full px-4 text-center",4,"ngIf"],[1,"w-full","px-4","text-center"],["mat-flat-button","","type","button",1,"flex","items-center","justify-center","md:w-1/2","w-full","p-3","text-sm","font-bold","rounded-full",3,"click"],[1,"ml-2"]],template:function(e,o){e&1&&(n(0,"section",0)(1,"div",1)(2,"div",2)(3,"h5",3),a(4," Select Multi-factor Authentication Type to verify your identity "),r()(),C(5,he,5,0,"div",4)(6,ge,5,0,"div",4),r()()),e&2&&(d(5),c("ngIf",o.mfaOptions==null||o.mfaOptions.options==null?null:o.mfaOptions.options.includes("TOTP")),d(),c("ngIf",o.mfaOptions==null||o.mfaOptions.options==null?null:o.mfaOptions.options.includes("EMAIL_ADDRESS")))},dependencies:[O,_,y],styles:[".mfa-option[_ngcontent-%COMP%]{width:80%;height:3rem}"],changeDetection:0});let s=i;return s})();export{Ye as DisplayMfaOptionsComponent};
