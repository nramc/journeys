import{a as j}from"./chunk-BUVV6ZCF.js";import{a as I,b as A,d as T,g as F}from"./chunk-5EL7MSHJ.js";import{a as c}from"./chunk-3WFRGX76.js";import{b as V,c as f}from"./chunk-DO4LYDKO.js";import{a as k}from"./chunk-SDUBNLRQ.js";import{c as U}from"./chunk-5XB5PZR3.js";import{r as M}from"./chunk-4NTYDSMY.js";import{Eb as m,Ha as p,Ia as h,Lb as w,Nb as u,Pa as y,Wb as s,Xb as i,Yb as x,ac as b,fc as C,na as R,pb as l,qc as v,rc as o,ta as a,xa as g,yc as E}from"./chunk-7FH2CJX7.js";function q(d,n){d&1&&(s(0,"div",13),o(1," Code invalid. Please enter valid code. "),i())}var K=(()=>{let n=class n{constructor(){this.destroyRef=a(y),this.myAccountService=a(j),this.loginService=a(V),this.authService=a(f),this.dialogRef=a(I),this.credential=a(A),this.isCodeInvalid=m(!1)}confirmCode(e){e.validity.valid?this.credential?this.verifyCodeInUnauthenticatedContext(e.value,this.credential):this.verifyCodeInAuthenticatedContext(e.value):console.log("Code invalid")}verifyCodeInUnauthenticatedContext(e,t){this.loginService.mfa(e,"TOTP",t).pipe(c(this.destroyRef)).subscribe({next:r=>{this.authService.getUserContextForSuccessfulLogin(r),this.dialogRef.close(!0)},error:r=>this.onError(r)})}verifyCodeInAuthenticatedContext(e){this.myAccountService.verifyTotpCode(e).pipe(c(this.destroyRef)).subscribe({next:t=>this.onSuccess(t),error:t=>this.onError(t)})}onSuccess(e){e.success?(console.log("success"),this.dialogRef.close(!0)):this.isCodeInvalid.set(!0)}onError(e){console.log(e),this.isCodeInvalid.set(!0)}};n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=g({type:n,selectors:[["app-totp-code-verification"]],inputs:{isCodeInvalid:[1,"isCodeInvalid"]},outputs:{isCodeInvalid:"isCodeInvalidChange"},standalone:!0,features:[E],decls:20,vars:1,consts:[["confirmationCode",""],[1,"card"],[1,"card-header","bg-primary","text-light"],[1,"card-body"],[1,"card-title","text-primary"],[1,"card-text"],[1,"input-group"],[1,"input-group-text"],["type","text","required","","pattern","[0-9]{6,6}","maxlength","6","min","6","autocomplete","off",1,"form-control"],["class","form-text text-danger text-center",4,"ngIf"],[1,"d-inline-flex","gap-2","mt-4"],["mat-dialog-close","false",1,"btn","btn-outline-danger"],[1,"btn","btn-primary",3,"click"],[1,"form-text","text-danger","text-center"]],template:function(t,r){if(t&1){let S=b();s(0,"div",1)(1,"div",2),o(2," Two-Factor Authentication "),i(),s(3,"div",3)(4,"div",4),o(5,"TOTP Code Verification"),i(),s(6,"div",5)(7,"p"),o(8,"Your security is our top priority. To ensure your account remains protected, please complete the two-factor authentication process by entering the 6-digit code from your authenticator app."),i(),s(9,"div",6)(10,"span",7),o(11,"Code"),i(),x(12,"input",8,0),i(),w(14,q,2,0,"div",9),i(),s(15,"div",10)(16,"button",11),o(17,"Cancel"),i(),s(18,"button",12),C("click",function(){p(S);let _=v(13);return h(r.confirmCode(_))}),o(19,"Confirm"),i()()()()}t&2&&(l(14),u("ngIf",r.isCodeInvalid()))},dependencies:[T,M]});let d=n;return d})();var O=(()=>{let n=class n{constructor(){this.httpClient=a(U),this.authService=a(f)}sendConfirmationCode(e){let t=this.authService.getCurrentUserContext(),r=e?"Basic "+btoa(e.username+":"+e.password):`Bearer ${t.accessToken}`;return this.httpClient.post(k.journeyApi+"/sendEmailCode",{},{headers:{Authorization:r}})}verifyConfirmationCode(e){let t=this.authService.getCurrentUserContext();return this.httpClient.post(k.journeyApi+"/verifyEmailCode",{code:e},{headers:{Authorization:`Bearer ${t.accessToken}`}})}};n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=R({token:n,factory:n.\u0275fac,providedIn:"root"});let d=n;return d})();var me=(()=>{let n=class n{constructor(){this.destroyRef=a(y),this.emailConfirmationCodeService=a(O),this.loginService=a(V),this.authService=a(f),this.dialogRef=a(I),this.credential=a(A),this.isCodeSent=m(!1),this.canSendCode=m(!0),this.isCodeValid=m(!0)}confirmCode(e,t){this.isCodeValid.set(!0),e.validity.valid?(t.disabled=!0,this.credential?this.verifyCodeInUnauthenticatedContext(e,t):this.verifyCodeInAuthenticatedContext(e,t)):(this.isCodeValid.set(!1),console.log("invalid code"))}verifyCodeInUnauthenticatedContext(e,t){this.loginService.mfa(e.value,"EMAIL_ADDRESS",this.credential).pipe(c(this.destroyRef)).subscribe({next:r=>{this.authService.getUserContextForSuccessfulLogin(r),this.onVerificationSuccess(t)},error:r=>this.onVerificationError(r,t)})}verifyCodeInAuthenticatedContext(e,t){this.emailConfirmationCodeService.verifyConfirmationCode(e.value).pipe(c(this.destroyRef)).subscribe({next:r=>this.onVerificationSuccess(t),error:r=>this.onVerificationError(r,t)})}onVerificationSuccess(e){e.disabled=!0,console.log("code verified successfully"),this.dialogRef.close(!0)}onVerificationError(e,t){console.log(e),this.isCodeValid.set(!1),t.disabled=!1}sendCode(){this.canSendCode.set(!1),this.emailConfirmationCodeService.sendConfirmationCode(this.credential).pipe(c(this.destroyRef)).subscribe({next:e=>this.onSentSuccess(),error:e=>this.onSentError(e)})}onSentError(e){console.log(e),this.canSendCode.set(!0)}onSentSuccess(){this.isCodeSent.set(!0),setTimeout(()=>this.canSendCode.set(!0),1e3*60),console.log("Code has been sent successfully to register email")}};n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=g({type:n,selectors:[["app-email-code-verification"]],inputs:{isCodeSent:[1,"isCodeSent"],canSendCode:[1,"canSendCode"],isCodeValid:[1,"isCodeValid"]},outputs:{isCodeSent:"isCodeSentChange",canSendCode:"canSendCodeChange",isCodeValid:"isCodeValidChange"},standalone:!0,features:[E],decls:35,vars:3,consts:[["confirmationCode",""],["confirmButton",""],[1,"card"],[1,"card-header","bg-primary","text-light"],[1,"card-body"],[1,"card-text"],[1,"input-group"],[1,"input-group-text"],["type","text","required","","pattern","[0-9]{6,6}","maxlength","6","min","6","autocomplete","off",1,"form-control"],[1,"form-text","text-danger","text-center",3,"hidden"],[1,"d-inline-flex","gap-2","mt-4"],["mat-dialog-close","false",1,"btn","btn-outline-danger"],["cdkFocusInitial","",1,"btn","btn-primary",3,"click","disabled"],[1,"btn","btn-primary",3,"click"],[1,"mt-2"],[1,"text-success","small","fw-bold",3,"hidden"]],template:function(t,r){if(t&1){let S=b();s(0,"div",2)(1,"div",3),o(2," Email Code Confirmation Required "),i(),s(3,"div",4)(4,"div",5)(5,"p"),o(6,"To complete verification, please follow these steps:"),i(),s(7,"ol")(8,"li"),o(9,"Click the "),s(10,"code"),o(11,"Send"),i(),o(12," button to receive a verification code in your registered email "),i(),s(13,"li"),o(14,"Check your email for the verification code"),i(),s(15,"li"),o(16,'Enter the code in the field below and click "Confirm" to complete the verification'),i()(),s(17,"div",6)(18,"span",7),o(19,"Code"),i(),x(20,"input",8,0),i(),s(22,"div",9),o(23," Code invalid. Please enter valid code. "),i()(),s(24,"div",10)(25,"button",11),o(26,"Cancel"),i(),s(27,"button",12),C("click",function(){return p(S),h(r.sendCode())}),o(28,"Send "),i(),s(29,"button",13,1),C("click",function(){p(S);let _=v(21),P=v(30);return h(r.confirmCode(_,P))}),o(31,"Confirm"),i()(),s(32,"div",14)(33,"p",15),o(34,"Code has been sent successfully to register email. If you haven't received, click Sent button again after 60 seconds."),i()()()()}t&2&&(l(22),u("hidden",r.isCodeValid()),l(5),u("disabled",!r.canSendCode()),l(6),u("hidden",!r.isCodeSent()))},dependencies:[F,T]});let d=n;return d})();export{K as a,me as b};
