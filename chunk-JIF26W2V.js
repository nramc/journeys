import{a as p}from"./chunk-THLS4DYU.js";import{c as j}from"./chunk-AAVN2GU7.js";import{x as v}from"./chunk-SWPVFP3X.js";import{$ as g,ca as h,ha as y,ma as m,t as x}from"./chunk-LCXKQEMN.js";function A(e){let t="==".slice(0,(4-e.length%4)%4),r=e.replace(/-/g,"+").replace(/_/g,"/")+t,n=atob(r),i=new ArrayBuffer(n.length),c=new Uint8Array(i);for(let d=0;d<n.length;d++)c[d]=n.charCodeAt(d);return i}function I(e){let t=new Uint8Array(e),r="";for(let c of t)r+=String.fromCharCode(c);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}var o="copy",l="convert";function f(e,t,r){if(t===o)return r;if(t===l)return e(r);if(t instanceof Array)return r.map(n=>f(e,t[0],n));if(t instanceof Object){let n={};for(let[i,c]of Object.entries(t)){if(c.derive){let d=c.derive(r);d!==void 0&&(r[i]=d)}if(!(i in r)){if(c.required)throw new Error(`Missing key: ${i}`);continue}if(r[i]==null){n[i]=null;continue}n[i]=f(e,c.schema,r[i])}return n}}function b(e,t){return{required:!0,schema:e,derive:t}}function a(e){return{required:!0,schema:e}}function s(e){return{required:!1,schema:e}}var R={type:a(o),id:a(l),transports:s(o)},T={appid:s(o),appidExclude:s(o),credProps:s(o)},B={appid:s(o),appidExclude:s(o),credProps:s(o)},O={publicKey:a({rp:a(o),user:a({id:a(l),name:a(o),displayName:a(o)}),challenge:a(l),pubKeyCredParams:a(o),timeout:s(o),excludeCredentials:s([R]),authenticatorSelection:s(o),attestation:s(o),extensions:s(T)}),signal:s(o)},V={type:a(o),id:a(o),rawId:a(l),authenticatorAttachment:s(o),response:a({clientDataJSON:a(l),attestationObject:a(l),transports:b(o,e=>{var t;return((t=e.getTransports)==null?void 0:t.call(e))||[]})}),clientExtensionResults:b(B,e=>e.getClientExtensionResults())},J={mediation:s(o),publicKey:a({challenge:a(l),timeout:s(o),rpId:s(o),allowCredentials:s([R]),userVerification:s(o),extensions:s(T)}),signal:s(o)},q={type:a(o),id:a(o),rawId:a(l),authenticatorAttachment:s(o),response:a({clientDataJSON:a(l),authenticatorData:a(l),signature:a(l),userHandle:a(l)}),clientExtensionResults:b(B,e=>e.getClientExtensionResults())};function N(e){return f(A,O,e)}function K(e){return f(I,V,e)}async function E(e){let t=await navigator.credentials.create(N(e));return K(t)}function P(e){return f(A,J,e)}function z(e){return f(I,q,e)}async function D(e){let t=await navigator.credentials.get(P(e));return z(t)}var u=[];for(let e=0;e<256;++e)u.push((e+256).toString(16).slice(1));function $(e,t=0){return(u[e[t+0]]+u[e[t+1]]+u[e[t+2]]+u[e[t+3]]+"-"+u[e[t+4]]+u[e[t+5]]+"-"+u[e[t+6]]+u[e[t+7]]+"-"+u[e[t+8]]+u[e[t+9]]+"-"+u[e[t+10]]+u[e[t+11]]+u[e[t+12]]+u[e[t+13]]+u[e[t+14]]+u[e[t+15]]).toLowerCase()}var w,H=new Uint8Array(16);function C(){if(!w){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");w=crypto.getRandomValues.bind(crypto)}return w(H)}var F=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),S={randomUUID:F};function L(e,t,r){e=e||{};let n=e.random??e.rng?.()??C();if(n.length<16)throw new Error("Random bytes length must be >= 16");if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,t){if(r=r||0,r<0||r+16>t.length)throw new RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`);for(let i=0;i<16;++i)t[r+i]=n[i];return t}return $(n)}function W(e,t,r){return S.randomUUID&&!t&&!e?S.randomUUID():L(e,t,r)}var U=W;var k=(()=>{class e{constructor(){this.http=m(v),this.authService=m(j)}list(){let n={headers:{Authorization:`Bearer ${this.authService.getCurrentUserContext().accessToken}`}};return this.http.get(`${p.journeyBaseUrl}/webauthn/credentials`,n).pipe(h(i=>console.log("Credentials retrieved:",i)))}remove(r){let i={headers:{Authorization:`Bearer ${this.authService.getCurrentUserContext().accessToken}`},params:{credentialId:r}};return this.http.delete(`${p.journeyBaseUrl}/webauthn/credentials`,i).pipe(h(c=>console.log("Credential removed:",c)))}register(){let n={headers:{Authorization:`Bearer ${this.authService.getCurrentUserContext().accessToken}`}};return this.http.post(`${p.journeyBaseUrl}/webauthn/register/start`,{flowID:U()},n).pipe(h(i=>console.log("Credential options received:",i)),g(i=>x(E(i)).pipe(h(c=>console.log("Attestation object:",c)),g(c=>this.http.post(`${p.journeyBaseUrl}/webauthn/register/finish`,c,n)))))}login(r){return this.http.post(`${p.journeyBaseUrl}/webauthn/authenticate/start`,{username:r},{params:{username:r}}).pipe(h(n=>console.log("Authentication options received:",n)),g(n=>x(D(n))),h(n=>console.log("Assertion object:",n)),g(n=>this.http.post(`${p.journeyBaseUrl}/webauthn/authenticate/finish`,n)))}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275prov=y({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var ye=(()=>{class e{constructor(){this.httpClient=m(v),this.passkeyService=m(k)}login(r){return this.httpClient.post(p.journeyApi+"/login",{username:r.username,password:r.password},{headers:{Authorization:"Basic "+btoa(r.username+":"+r.password),"Content-Type":"application/json"}})}mfa(r,n,i){return this.httpClient.post(p.journeyApi+"/mfa",{type:n,value:r},{headers:{Authorization:"Basic "+btoa(i.username+":"+i.password),"Content-Type":"application/json"}})}loginAsGuest(){return this.httpClient.post(p.journeyApi+"/guestLogin",{username:Math.random().toString(36)},{headers:{"Content-Type":"application/json"}})}loginWithPasskey(r){return this.passkeyService.login(r)}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275prov=y({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();export{k as a,ye as b};
