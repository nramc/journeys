import{a as z}from"./chunk-TBFZGPPR.js";import"./chunk-YGHMYHO4.js";import{b as A}from"./chunk-SNVCUL6N.js";import{a as j}from"./chunk-LDRZWZFG.js";import"./chunk-JA4JGXDI.js";import"./chunk-NWXFWB74.js";import{c as q,h as G,i as T,j as k,k as O,l as D,t as R,w as W,y as B}from"./chunk-6OHNXZFP.js";import"./chunk-BZBETYD3.js";import{b as V}from"./chunk-R6MPEOK3.js";import"./chunk-A2N4MVAO.js";import{e as U,g as N,h as I}from"./chunk-EGCIWAOK.js";import"./chunk-HLWHUVVB.js";import{A as M,k as P}from"./chunk-T74QBNJG.js";import{Ac as F,Da as g,Ea as p,Hb as v,Mb as d,Xb as e,Yb as r,Zb as C,bc as E,gc as S,kb as x,ob as l,qa as u,sa as w,sc as f,tc as a,wc as b,xc as _,yb as L,yc as y}from"./chunk-VRY62XD3.js";function J(s,h){s&1&&(e(0,"div"),a(1,"Username is required."),r())}function Y(s,h){s&1&&(e(0,"div"),a(1,"Username must be at most 50 characters long."),r())}function H(s,h){s&1&&(e(0,"div"),a(1,"Password is required."),r())}function K(s,h){s&1&&(e(0,"div"),a(1,"Password must be at most 50 characters long."),r())}var le=(()=>{class s{constructor(){this.SIGNUP_PAGE_INFO=A,this.forgotPasswordAssistanceUrl="https://github.com/nramc/journeys/issues/new?assignees=&labels=bug&projects=&template=bug-report-form.yml&title=%5BBug%5D%3A+",this.authService=u(V),this.loginService=u(j),this.router=u(N),this.activatedRoute=u(U),this.notificationService=u(z),this.form=L({username:"",password:""})}login(n){n.valid&&this.loginService.login(this.form()).subscribe({next:t=>this.onLoginSuccess(this.form(),t),error:t=>{n.resetForm(),this.onLoginFailed(t)}})}onLoginSuccess(n,t){if(t.additionalFactorRequired){let o={credential:n,options:t.securityAttributes};this.router.navigate(["mfa"],{queryParams:this.activatedRoute.snapshot.queryParams,state:o}).then(console.log)}else{let o=this.authService.getUserContextForSuccessfulLogin(t);this.onLogOnSuccess(o)}}onLoginFailed(n){console.error(n),this.notificationService.showError("Login failed. "+n.message)}onLogOnSuccess(n){this.notificationService.showSuccess("Login successful!");let t=this.activatedRoute.snapshot.queryParams.redirectUrl??"/home";this.router.navigateByUrl(t).then(console.log)}loginAsGuest(){this.loginService.loginAsGuest().subscribe({next:n=>{let t=this.authService.getUserContextForSuccessfulLogin(n);this.onLogOnSuccess(t)},error:n=>this.onLoginFailed(n)})}static{this.\u0275fac=function(t){return new(t||s)}}static{this.\u0275cmp=w({type:s,selectors:[["app-login"]],standalone:!0,features:[F],decls:39,vars:11,consts:[["loginForm","ngForm"],["username","ngModel"],["password","ngModel"],[1,"container","h-100","mt-3","mt-md-0"],[1,"row","d-flex","justify-content-center","align-items-center","h-100","m-auto"],[1,"col-12","col-md-6","mt-sm-0"],[1,"card","login-card","border","border-2","border-primary","border-opacity-50",2,"border-radius","1rem"],[1,"card-body","p-5","text-center"],["ngSrc","assets/icon/security/user-profile.png","alt","Journey","width","120","height","120","priority",""],[3,"ngSubmit"],[1,"fw-bold","mb-2","text-primary"],[1,"text-primary","mb-5"],[1,"form-outline","mb-2"],["type","email","id","username","name","username","required","","placeholder","Username","autofocus","","autocomplete","username","maxlength","50",1,"form-control","form-control-lg",3,"ngModelChange","ngModel"],["for","username",1,"form-label","small"],["tabindex","-1",1,"ms-2",3,"routerLink"],[1,"form-text","text-danger",3,"hidden"],[4,"ngIf"],[1,"form-outline","mb-4"],["type","password","id","password","name","password","required","","maxlength","50","placeholder","Password","autocomplete","current-password",1,"form-control","form-control-lg",3,"ngModelChange","ngModel"],["for","password",1,"form-label","small"],["target","_blank","tabindex","-1",1,"ms-2",3,"href"],[1,"d-flex","flex-column","gap-1"],["type","submit",1,"btn","btn-primary","btn-lg",3,"disabled"],[1,"text-dark"],["type","button",1,"btn","btn-success","btn-lg",3,"click"]],template:function(t,o){if(t&1){let c=E();e(0,"div",3)(1,"div",4)(2,"div",5)(3,"div",6)(4,"div",7),C(5,"img",8),e(6,"form",9,0),S("ngSubmit",function(){g(c);let i=f(7);return p(o.login(i))}),e(8,"h2",10),a(9,"Login"),r(),e(10,"p",11),a(11,"Please Identify Yourself.!"),r(),e(12,"div",12)(13,"input",13,1),y("ngModelChange",function(i){return g(c),_(o.form().username,i)||(o.form().username=i),p(i)}),r(),e(15,"label",14),a(16,"Don't have an account? "),e(17,"a",15),a(18,"Sign Up"),r()(),e(19,"div",16),v(20,J,2,0,"div",17)(21,Y,2,0,"div",17),r()(),e(22,"div",18)(23,"input",19,2),y("ngModelChange",function(i){return g(c),_(o.form().password,i)||(o.form().password=i),p(i)}),r(),e(25,"label",20),a(26,"Forgot Password? "),e(27,"a",21),a(28,"Contact Us"),r()(),e(29,"div",16),v(30,H,2,0,"div",17)(31,K,2,0,"div",17),r()(),e(32,"div",22)(33,"button",23),a(34,"Submit "),r(),e(35,"small",24),a(36,"or"),r(),e(37,"button",25),S("click",function(){return g(c),p(o.loginAsGuest())}),a(38,"Explore as Guest"),r()()()()()()()()}if(t&2){let c=f(7),m=f(14),i=f(24);l(13),b("ngModel",o.form().username),l(4),d("routerLink",o.SIGNUP_PAGE_INFO.path),l(2),d("hidden",m.valid||m.pristine),l(),d("ngIf",m.errors==null?null:m.errors.required),l(),d("ngIf",m.errors==null?null:m.errors.maxlength),l(2),b("ngModel",o.form().password),l(4),d("href",o.forgotPasswordAssistanceUrl,x),l(2),d("hidden",i.valid||i.pristine),l(),d("ngIf",i.errors==null?null:i.errors.required),l(),d("ngIf",i.errors==null?null:i.errors.maxlength),l(2),d("disabled",!c.form.valid||c.submitted)}},dependencies:[B,D,q,G,T,R,W,O,k,P,I,M],encapsulation:2,changeDetection:0})}}return s})();export{le as LoginComponent};
