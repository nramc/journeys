import{a as $}from"./chunk-IPPV37HB.js";import{a as A}from"./chunk-ZXPU4FUU.js";import{a as Y}from"./chunk-JTLKT5PD.js";import{b as U}from"./chunk-YFHJRQYX.js";import{b as Z}from"./chunk-XQY4PQGK.js";import"./chunk-KH7BRNI5.js";import"./chunk-CFUYXJ76.js";import"./chunk-L6DJFSIC.js";import{b as O,g as j,h as W,i as B,j as D,k as R,p as z,s as J,u as H}from"./chunk-WYEMPCIW.js";import"./chunk-4H6KTJAK.js";import{c as T}from"./chunk-DNEPPB4M.js";import{c as K}from"./chunk-UJZZXKND.js";import{a as q,b as G}from"./chunk-3SCI6QDE.js";import{h as Q,k as X}from"./chunk-DPXNYG4I.js";import"./chunk-TS6BF4HD.js";import{a as F,c as V,d as N}from"./chunk-G3CP2NQH.js";import"./chunk-CGJVCASA.js";import{h as P,y as I}from"./chunk-T257ZYH5.js";import{Bc as w,Cb as v,Cc as b,Dc as L,Ea as C,Wb as d,Xb as e,Yb as t,Zb as _,bc as M,gb as k,gc as y,ic as S,kb as m,oa as f,sc as g,ua as x,va as h,wb as E,xc as o}from"./chunk-BQWC7YH4.js";function ee(n,l){n&1&&(e(0,"div",27),_(1,"mat-spinner"),t())}function te(n,l){n&1&&(e(0,"div"),o(1,"Username is required."),t())}function ie(n,l){n&1&&(e(0,"div"),o(1,"Max 50 characters."),t())}function ne(n,l){if(n&1&&(e(0,"div",28),v(1,te,2,0,"div",29)(2,ie,2,0,"div",29),t()),n&2){S();let u=g(20);m(),d("ngIf",u.errors==null?null:u.errors.required),m(),d("ngIf",u.errors==null?null:u.errors.maxlength)}}function re(n,l){n&1&&(e(0,"div"),o(1,"Password is required."),t())}function oe(n,l){n&1&&(e(0,"div"),o(1,"Max 50 characters."),t())}function ae(n,l){if(n&1&&(e(0,"div",28),v(1,re,2,0,"div",29)(2,oe,2,0,"div",29),t()),n&2){S();let u=g(29);m(),d("ngIf",u.errors==null?null:u.errors.required),m(),d("ngIf",u.errors==null?null:u.errors.maxlength)}}var ke=(()=>{let l=class l{constructor(){this.SIGNUP_PAGE_INFO=U,this.forgotPasswordAssistanceUrl="https://github.com/nramc/journeys/issues/new?assignees=&labels=bug&projects=&template=bug-report-form.yml&title=%5BBug%5D%3A+",this.authService=f(K),this.loginService=f(Z),this.router=f(V),this.activatedRoute=f(F),this.notificationService=f($),this.isServiceAvailable=T(f(Y).getVersion(),{initialValue:null}),this.form=C({username:"",password:""})}login(a){a.valid&&this.loginService.login(this.form()).subscribe({next:i=>this.onLoginSuccess(this.form(),i),error:i=>{a.resetForm(),this.onLoginFailed(i)}})}onLoginSuccess(a,i){if(i.additionalFactorRequired){let r={credential:a,options:i.securityAttributes};this.router.navigate(["mfa"],{queryParams:this.activatedRoute.snapshot.queryParams,state:r}).then(console.log)}else{let r=this.authService.getUserContextForSuccessfulLogin(i);this.onLogOnSuccess(r)}}onLoginFailed(a){console.error(a),this.notificationService.showError("Login failed. "+a.message)}onLogOnSuccess(a){this.notificationService.showSuccess("Login successful!");let i=this.activatedRoute.snapshot.queryParams.redirectUrl??"/home";this.router.navigateByUrl(i).then(console.log)}loginAsGuest(){this.loginService.loginAsGuest().subscribe({next:a=>{let i=this.authService.getUserContextForSuccessfulLogin(a);this.onLogOnSuccess(i)},error:a=>this.onLoginFailed(a)})}loginWithPasskey(a){this.loginService.loginWithPasskey(a).subscribe({next:i=>{let r=this.authService.getUserContextForSuccessfulLogin(i);this.onLogOnSuccess(r)},error:i=>this.onLoginFailed(i)})}};l.\u0275fac=function(i){return new(i||l)},l.\u0275cmp=E({type:l,selectors:[["app-login"]],decls:42,vars:7,consts:[["loginForm","ngForm"],["username","ngModel"],["password","ngModel"],[1,"flex","min-h-full","flex-col","justify-center","px-6","py-12","lg:px-8"],["class","mask-with-spinner",4,"ngIf"],[1,"sm:mx-auto","sm:w-full","sm:max-w-sm"],["ngSrc","assets/logo/journey-logo-64x64.png","alt","Journey","height","64","width","64",1,"mx-auto","h-10","w-auto"],[1,"text-primary","text-center","text-2xl/9","font-bold","tracking-tight"],[1,"mt-10","sm:mx-auto","sm:w-full","sm:max-w-sm"],[1,"flex","flex-col","gap-5",3,"ngSubmit"],["mat-flat-button","","type","button",1,"w-full","flex","items-center","justify-center","gap-2","px-4","py-2","rounded-xl","text-sm","font-semibold","bg-gray-100","hover:bg-gray-200","dark:bg-gray-800","dark:hover:bg-gray-700","border","border-gray-300","transition",3,"click"],[1,"text-xl"],[1,"space-y-1.5"],[1,"flex","items-center","justify-between"],["for","username",1,"text-sm","font-medium"],["tabindex","-1",1,"text-xs","text-primary","font-semibold","hover:underline",3,"routerLink"],["type","email","name","username","id","username","required","","placeholder","you@example.com","autocomplete","username webauthn","maxlength","50",1,"w-full","rounded-md","bg-white","px-3","py-2","text-sm","text-gray-900","outline","outline-1","outline-gray-300","placeholder:text-gray-400","focus:outline-2","focus:outline-indigo-600","dark:bg-gray-900","dark:text-white",3,"ngModelChange","ngModel"],["class","text-sm text-danger",4,"ngIf"],["for","password",1,"text-sm","font-medium"],["target","_blank","tabindex","-1",1,"text-xs","text-primary","font-semibold","hover:underline",3,"href"],["type","password","name","password","id","password","required","","placeholder","\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022","autocomplete","current-password webauthn","maxlength","50",1,"w-full","rounded-md","bg-white","px-3","py-2","text-sm","text-gray-900","outline","outline-1","outline-gray-300","placeholder:text-gray-400","focus:outline-2","focus:outline-indigo-600","dark:bg-gray-900","dark:text-white",3,"ngModelChange","ngModel"],[1,"flex","flex-col","items-center","gap-2","text-center","pt-2"],["mat-flat-button","","type","submit","color","primary",1,"w-full","font-semibold"],[1,"text-gray-500","dark:text-gray-400"],["mat-stroked-button","","type","button",1,"w-full","flex","items-center","justify-center","gap-2","rounded-xl","px-4","py-2","text-sm","font-medium","border","border-indigo-400","text-indigo-600","hover:bg-indigo-50","dark:border-indigo-500","dark:text-indigo-300","dark:hover:bg-indigo-900","transition",3,"click"],[1,"text-lg"],[1,"ml-2","text-xs","text-green-600","font-semibold"],[1,"mask-with-spinner"],[1,"text-sm","text-danger"],[4,"ngIf"]],template:function(i,r){if(i&1){let c=M();e(0,"div",3),v(1,ee,2,0,"div",4),e(2,"div",5),_(3,"img",6),e(4,"h2",7),o(5,"Sign in to your account"),t()(),e(6,"div",8)(7,"form",9,0),y("ngSubmit",function(){x(c);let s=g(8);return h(r.login(s))}),e(9,"button",10),y("click",function(){x(c);let s=g(20);return h(r.loginWithPasskey(s.value))}),e(10,"mat-icon",11),o(11,"fingerprint"),t(),o(12," Sign in with Passkey "),t(),e(13,"div",12)(14,"div",13)(15,"label",14),o(16,"Email address"),t(),e(17,"a",15),o(18," Don\u2019t have an account? "),t()(),e(19,"input",16,1),L("ngModelChange",function(s){return x(c),b(r.form().username,s)||(r.form().username=s),h(s)}),t(),v(21,ne,3,2,"div",17),t(),e(22,"div",12)(23,"div",13)(24,"label",18),o(25,"Password"),t(),e(26,"a",19),o(27," Forgot Password? "),t()(),e(28,"input",20,2),L("ngModelChange",function(s){return x(c),b(r.form().password,s)||(r.form().password=s),h(s)}),t(),v(30,ae,3,2,"div",17),t(),e(31,"div",21)(32,"button",22),o(33," Sign In "),t(),e(34,"small",23),o(35,"or"),t(),e(36,"button",24),y("click",function(){return x(c),h(r.loginAsGuest())}),e(37,"mat-icon",25),o(38,"travel_explore"),t(),o(39," Explore as Guest "),e(40,"span",26),o(41,"No signup needed"),t()()()()()()}if(i&2){let c=g(8),p=g(20),s=g(29);m(),d("ngIf",!r.isServiceAvailable()),m(16),d("routerLink",r.SIGNUP_PAGE_INFO.path),m(2),w("ngModel",r.form().username),m(2),d("ngIf",p.invalid&&(p.dirty||c.submitted)),m(5),d("href",r.forgotPasswordAssistanceUrl,k),m(2),w("ngModel",r.form().password),m(2),d("ngIf",s.invalid&&(s.dirty||c.submitted))}},dependencies:[H,R,O,j,W,z,J,D,B,P,N,I,A,X,Q,G,q],styles:[".mask-with-spinner[_ngcontent-%COMP%]{position:absolute;height:100%;width:100%;background-color:#3459e61a;display:flex;justify-content:center;align-items:center;z-index:1000}"],changeDetection:0});let n=l;return n})();export{ke as LoginComponent};
