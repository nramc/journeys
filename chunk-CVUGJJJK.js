import{a as ie,b as oe,c as ne,d as re,e as ae,f as se}from"./chunk-HONCSXTA.js";import"./chunk-SGN5FG3U.js";import{b as ee}from"./chunk-JCCFFJDZ.js";import{a as X,f as Y,g as Z}from"./chunk-PENU2ILB.js";import"./chunk-FUZ4TJP2.js";import"./chunk-FX36Y7UL.js";import{b as te}from"./chunk-YN4QZLLP.js";import"./chunk-KH7BRNI5.js";import"./chunk-7P2D32DG.js";import"./chunk-UEKSEAKI.js";import{b as U,g as N,h as j,i as L,j as P,k as q,p as W,s as B,t as z,u as G}from"./chunk-ZGWQIMTM.js";import{a as D}from"./chunk-EEB6IKHS.js";import{a as c}from"./chunk-72VAWV5W.js";import{a as H,b as $,d as J,g as K,k as Q}from"./chunk-CCTRDJZS.js";import{c as v}from"./chunk-SYBZF2IS.js";import{a as F}from"./chunk-ZK5S6KYK.js";import{h as b}from"./chunk-MRMD44T2.js";import"./chunk-NKEHJOBB.js";import{a as I,c as O}from"./chunk-XZ3MMUVH.js";import{f as A}from"./chunk-CNCGA24G.js";import{h as k}from"./chunk-7THCFVEZ.js";import{$b as T,Ba as C,Db as y,Ec as a,Tb as _,Ub as V,Yb as g,Zb as n,_b as r,gd as S,hc as p,ka as R,lb as d,mc as u,pa as l,pc as M,va as m,wa as f,xb as h,zc as E}from"./chunk-NVJCHQYR.js";var de=(()=>{let i=class i{constructor(){this.httpClient=l(A),this.authService=l(v)}sendConfirmationCode(t){let e=this.authService.getCurrentUserContext(),o=t?"Basic "+btoa(t.username+":"+t.password):`Bearer ${e.accessToken}`;return this.httpClient.post(D.journeyApi+"/sendEmailCode",{},{headers:{Authorization:o}})}verifyConfirmationCode(t){let e=this.authService.getCurrentUserContext();return this.httpClient.post(D.journeyApi+"/verifyEmailCode",{code:t},{headers:{Authorization:`Bearer ${e.accessToken}`}})}};i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=R({token:i,factory:i.\u0275fac,providedIn:"root"});let s=i;return s})();function pe(s,i){s&1&&(n(0,"p",16),a(1," Code invalid. Please enter a valid code. "),r())}function Ce(s,i){s&1&&(n(0,"p",17),a(1," Code has been sent successfully to the registered email. If you haven't received it, click Send again after 60 seconds. "),r())}var ce=(()=>{let i=class i{constructor(){this.destroyRef=l(C),this.emailConfirmationCodeService=l(de),this.loginService=l(te),this.authService=l(v),this.dialogRef=l(ie),this.credential=l(oe),this.isCodeSent=S(!1),this.canSendCode=S(!0),this.isCodeValid=S(!0)}confirmCode(t,e){this.isCodeValid.set(!0),t.validity.valid?this.verifyCode(e,t):this.isCodeValid.set(!1)}verifyCode(t,e){t.disabled=!0,this.credential?this.verifyCodeInUnauthenticatedContext(e,t):this.verifyCodeInAuthenticatedContext(e,t)}verifyCodeInUnauthenticatedContext(t,e){e.disabled=!0,this.loginService.mfa(t.value,"EMAIL_ADDRESS",this.credential).pipe(c(this.destroyRef)).subscribe({next:o=>{this.authService.getUserContextForSuccessfulLogin(o),this.onVerificationSuccess(e)},error:o=>this.onVerificationError(o,e)})}verifyCodeInAuthenticatedContext(t,e){this.emailConfirmationCodeService.verifyConfirmationCode(t.value).pipe(c(this.destroyRef)).subscribe({next:o=>this.onVerificationSuccess(e),error:o=>this.onVerificationError(o,e)})}onVerificationSuccess(t){t.disabled=!0,console.log("code verified successfully"),this.dialogRef.close(!0)}onVerificationError(t,e){console.log(t),this.isCodeValid.set(!1),e.disabled=!1}sendCode(){this.canSendCode.set(!1),this.emailConfirmationCodeService.sendConfirmationCode(this.credential).pipe(c(this.destroyRef)).subscribe({next:t=>this.onSentSuccess(),error:t=>this.onSentError(t)})}onSentError(t){console.log(t),this.canSendCode.set(!0)}onSentSuccess(){this.isCodeSent.set(!0),setTimeout(()=>this.canSendCode.set(!0),1e3*60),console.log("Code has been sent successfully to register email")}};i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=h({type:i,selectors:[["app-email-code-verification"]],inputs:{isCodeSent:[1,"isCodeSent"],canSendCode:[1,"canSendCode"],isCodeValid:[1,"isCodeValid"]},outputs:{isCodeSent:"isCodeSentChange",canSendCode:"canSendCodeChange",isCodeValid:"isCodeValidChange"},decls:34,vars:3,consts:[["codeForm","ngForm"],["confirmationCode",""],["confirmButton",""],[3,"submit"],[1,"bg-gradient-to-r","from-blue-500","to-blue-700","text-white","text-xl","font-semibold","!p-4","rounded-t-lg"],[1,"text-primary"],[1,"list-decimal","list-inside","text-base","mb-4"],[1,"px-1","rounded-sm","font-bold","italic","text-sm"],["appearance","fill",1,"w-full"],["matInput","","type","text","inputmode","numeric","id","confirmationCode","name","confirmationCode","required","","pattern","[0-9]{6,6}","maxlength","6","ngModel","","autocomplete","off",1,""],["class","text-red-500 text-sm text-center mt-2",4,"ngIf"],[1,"flex","gap-2","mt-6","justify-center"],["mat-raised-button","","type","button","mat-dialog-close","false"],["mat-raised-button","","type","button",3,"click","disabled"],["mat-raised-button","","type","submit"],["class","text-green-600 text-sm font-bold mt-4",4,"ngIf"],[1,"text-red-500","text-sm","text-center","mt-2"],[1,"text-green-600","text-sm","font-bold","mt-4"]],template:function(e,o){if(e&1){let w=p();n(0,"form",3,0),u("submit",function(){m(w);let fe=E(23),ue=E(31);return f(o.confirmCode(fe,ue))}),n(2,"mat-card")(3,"mat-card-header",4)(4,"mat-card-title"),a(5,"Email Code Confirmation Required"),r()(),n(6,"mat-card-content",5)(7,"p"),a(8,"To complete verification, please follow below steps:"),r(),n(9,"ol",6)(10,"li"),a(11,"Click the "),n(12,"code",7),a(13,"Send"),r(),a(14," button to receive a verification code in your registered email. "),r(),n(15,"li"),a(16,"Check your email for the verification code."),r(),n(17,"li"),a(18,'Enter the code in the field below and click "Confirm" to complete the verification.'),r()(),n(19,"mat-form-field",8)(20,"mat-label"),a(21,"Code"),r(),T(22,"input",9,1),r(),y(24,pe,2,0,"p",10),n(25,"div",11)(26,"button",12),a(27,"Cancel"),r(),n(28,"button",13),u("click",function(){return m(w),f(o.sendCode())}),a(29,"Send"),r(),n(30,"button",14,2),a(32,"Confirm"),r()(),y(33,Ce,2,0,"p",15),r()()()}e&2&&(d(24),g("ngIf",!o.isCodeValid()),d(4),g("disabled",!o.canSendCode()),d(5),g("ngIf",o.isCodeSent()))},dependencies:[ae,re,G,q,U,N,j,W,B,z,P,L,k,b,Z,Y,X,Q,H,J,K,$,ee],encapsulation:2,changeDetection:0});let s=i;return s})();function he(s,i){if(s&1){let x=p();n(0,"div",4)(1,"button",5),u("click",function(){m(x);let e=M();return f(e.continueWithTotpVerification())}),a(2," Using Mobile Authenticator "),n(3,"mat-icon",6),a(4,"screen_lock_portrait"),r()()()}}function ge(s,i){if(s&1){let x=p();n(0,"div",4)(1,"button",5),u("click",function(){m(x);let e=M();return f(e.continueWithEmailCodeVerification())}),a(2," Using Email Code "),n(3,"mat-icon",6),a(4,"mail_lock"),r()()()}}var Ze=(()=>{let i=class i{constructor(){this.router=l(O),this.dialog=l(ne),this.activatedRoute=l(I),this.destroyRef=l(C),this.mfaOptions=this.router.getCurrentNavigation()?.extras?.state}continueWithTotpVerification(){this.dialog.open(se,{data:this.mfaOptions.credential,disableClose:!0}).afterClosed().pipe(c(this.destroyRef)).subscribe(e=>this.onCloseCallback(e))}continueWithEmailCodeVerification(){this.dialog.open(ce,{data:this.mfaOptions.credential,disableClose:!0}).afterClosed().pipe(c(this.destroyRef)).subscribe(e=>this.onCloseCallback(e))}onCloseCallback(t){if(t===!0){let e=this.activatedRoute.snapshot.queryParams.redirectUrl??"/home";this.router.navigateByUrl(e).then(console.log)}}};i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=h({type:i,selectors:[["app-display-mfa-options"]],decls:7,vars:2,consts:[[1,"container","mx-auto","h-full","w-full","mt-4"],[1,"flex","flex-col","items-center","justify-center","gap-2"],[1,"p-2"],[1,"text-lg","font-bold","text-primary"],[1,"w-full","px-4","text-center"],["mat-flat-button","","type","button",1,"flex","items-center","justify-center","md:w-1/2","w-full","p-3","text-sm","font-bold","rounded-full",3,"click"],[1,"ml-2"]],template:function(e,o){e&1&&(n(0,"section",0)(1,"div",1)(2,"div",2)(3,"h5",3),a(4," Select Multi-factor Authentication Type to verify your identity "),r()(),_(5,he,5,0,"div",4),_(6,ge,5,0,"div",4),r()()),e&2&&(d(5),V(!(o.mfaOptions==null||o.mfaOptions.options==null)&&o.mfaOptions.options.includes("TOTP")?5:-1),d(),V(!(o.mfaOptions==null||o.mfaOptions.options==null)&&o.mfaOptions.options.includes("EMAIL_ADDRESS")?6:-1))},dependencies:[F,b],styles:[".mfa-option[_ngcontent-%COMP%]{width:80%;height:3rem}"],changeDetection:0});let s=i;return s})();export{Ze as DisplayMfaOptionsComponent};
