import{a as w}from"./chunk-KH7BRNI5.js";import{a as p}from"./chunk-ZC4UKG3K.js";import{c as b}from"./chunk-UJZZXKND.js";import{f as v}from"./chunk-CGJVCASA.js";import{ca as m,fa as h,ja as g,oa as d,t as y}from"./chunk-BQWC7YH4.js";function j(e){let t="==".slice(0,(4-e.length%4)%4),c=e.replace(/-/g,"+").replace(/_/g,"/")+t,i=atob(c),r=new ArrayBuffer(i.length),s=new Uint8Array(r);for(let u=0;u<i.length;u++)s[u]=i.charCodeAt(u);return r}function x(e){let t=new Uint8Array(e),c="";for(let s of t)c+=String.fromCharCode(s);return btoa(c).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}var n="copy",l="convert";function f(e,t,c){if(t===n)return c;if(t===l)return e(c);if(t instanceof Array)return c.map(i=>f(e,t[0],i));if(t instanceof Object){let i={};for(let[r,s]of Object.entries(t)){if(s.derive){let u=s.derive(c);u!==void 0&&(c[r]=u)}if(!(r in c)){if(s.required)throw new Error(`Missing key: ${r}`);continue}if(c[r]==null){i[r]=null;continue}i[r]=f(e,s.schema,c[r])}return i}}function C(e,t){return{required:!0,schema:e,derive:t}}function o(e){return{required:!0,schema:e}}function a(e){return{required:!1,schema:e}}var A={type:o(n),id:o(l),transports:a(n)},S={appid:a(n),appidExclude:a(n),credProps:a(n)},B={appid:a(n),appidExclude:a(n),credProps:a(n)},U={publicKey:o({rp:o(n),user:o({id:o(l),name:o(n),displayName:o(n)}),challenge:o(l),pubKeyCredParams:o(n),timeout:a(n),excludeCredentials:a([A]),authenticatorSelection:a(n),attestation:a(n),extensions:a(S)}),signal:a(n)},k={type:o(n),id:o(n),rawId:o(l),authenticatorAttachment:a(n),response:o({clientDataJSON:o(l),attestationObject:o(l),transports:C(n,e=>{var t;return((t=e.getTransports)==null?void 0:t.call(e))||[]})}),clientExtensionResults:C(B,e=>e.getClientExtensionResults())},R={mediation:a(n),publicKey:o({challenge:o(l),timeout:a(n),rpId:a(n),allowCredentials:a([A]),userVerification:a(n),extensions:a(S)}),signal:a(n)},$={type:o(n),id:o(n),rawId:o(l),authenticatorAttachment:a(n),response:o({clientDataJSON:o(l),authenticatorData:o(l),signature:o(l),userHandle:o(l)}),clientExtensionResults:C(B,e=>e.getClientExtensionResults())};function E(e){return f(j,U,e)}function J(e){return f(x,k,e)}async function I(e){let t=await navigator.credentials.create(E(e));return J(t)}function q(e){return f(j,R,e)}function K(e){return f(x,$,e)}async function O(e){let t=await navigator.credentials.get(q(e));return K(t)}var T=(()=>{let t=class t{constructor(){this.http=d(v),this.authService=d(b)}list(){let r={headers:{Authorization:`Bearer ${this.authService.getCurrentUserContext().accessToken}`}};return this.http.get(`${p.journeyBaseUrl}/webauthn/credentials`,r).pipe(h(s=>console.log("Credentials retrieved:",s)))}remove(i){let s={headers:{Authorization:`Bearer ${this.authService.getCurrentUserContext().accessToken}`},params:{credentialId:i}};return this.http.delete(`${p.journeyBaseUrl}/webauthn/credentials`,s).pipe(h(u=>console.log("Credential removed:",u)))}register(){let r={headers:{Authorization:`Bearer ${this.authService.getCurrentUserContext().accessToken}`}};return this.http.post(`${p.journeyBaseUrl}/webauthn/register/start`,{flowID:w()},r).pipe(h(s=>console.log("Credential options received:",s)),m(s=>y(I(s)).pipe(h(u=>console.log("Attestation object:",u)),m(u=>this.http.post(`${p.journeyBaseUrl}/webauthn/register/finish`,u,r)))))}login(i){return this.http.post(`${p.journeyBaseUrl}/webauthn/authenticate/start`,{username:i},{params:{username:i}}).pipe(h(r=>console.log("Authentication options received:",r)),m(r=>y(O(r))),h(r=>console.log("Assertion object:",r)),m(r=>this.http.post(`${p.journeyBaseUrl}/webauthn/authenticate/finish`,r)))}};t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=g({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();var _=(()=>{let t=class t{constructor(){this.httpClient=d(v),this.passkeyService=d(T)}login(i){return this.httpClient.post(p.journeyApi+"/login",{username:i.username,password:i.password},{headers:{Authorization:"Basic "+btoa(i.username+":"+i.password),"Content-Type":"application/json"}})}mfa(i,r,s){return this.httpClient.post(p.journeyApi+"/mfa",{type:r,value:i},{headers:{Authorization:"Basic "+btoa(s.username+":"+s.password),"Content-Type":"application/json"}})}loginAsGuest(){return this.httpClient.post(p.journeyApi+"/guestLogin",{username:Math.random().toString(36)},{headers:{"Content-Type":"application/json"}})}loginWithPasskey(i){return this.passkeyService.login(i)}};t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=g({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();export{T as a,_ as b};
