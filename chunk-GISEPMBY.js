import{c as g}from"./chunk-ARLEKDS5.js";import{oa as i,q as p,ta as l,z as a}from"./chunk-TO7D4NWA.js";var m={name:"journey",version:"0.15.1",scripts:{ng:"ng",start:"ng serve --configuration development",build:"ng build",watch:"ng build --watch --configuration development",test:"ng test","ci:build":"ng build","ci:test":"ng test --no-watch --no-progress --browsers=ChromeHeadless","ci:deploy":"ng deploy --base-href=/journeys/ --dir=dist/journey/browser --build-target=journey:build:production"},private:!0,dependencies:{"@angular/animations":"^18.0.2","@angular/cdk":"^18.0.2","@angular/common":"^18.0.2","@angular/compiler":"^18.0.2","@angular/core":"^18.0.2","@angular/forms":"^18.0.2","@angular/material":"^18.0.2","@angular/platform-browser":"^18.0.2","@angular/platform-browser-dynamic":"^18.0.2","@angular/router":"^18.0.2","@cloudinary/ng":"^2.0.2","@cloudinary/url-gen":"^1.18.0","@ng-bootstrap/ng-bootstrap":"^15.1.2","@popperjs/core":"^2.11.8","@types/geojson":"^7946.0.13",bootstrap:"^5.3.2","bootstrap-icons":"^1.11.1",bootswatch:"^5.3.2","file-saver":"^2.0.5","highlight.js":"^11.9.0",jszip:"^3.10.1",leaflet:"^1.9.4",marked:"^12.0.2","ng-gallery":"^11.0.0","ngx-markdown":"^18.0.0",rxjs:"~7.8.0",tslib:"^2.3.0",typings:"^2.1.1","zone.js":"~0.14.2"},devDependencies:{"@angular-devkit/build-angular":"^18.0.3","@angular/cli":"^18.0.3","@angular/compiler-cli":"^18.0.2","@angular/localize":"^18.0.2","@types/file-saver":"^2.0.7","@types/jasmine":"~4.3.6","@types/leaflet":"^1.9.7","angular-cli-ghpages":"^2.0.0","jasmine-core":"~4.6.0",karma:"~6.4.0","karma-chrome-launcher":"~3.2.0","karma-coverage":"~2.2.0","karma-jasmine":"~5.1.0","karma-jasmine-html-reporter":"~2.1.0",typescript:"~5.4.5"}};var u={production:!0,journeyApi:"https://journey-api-nxm5.onrender.com/rest",cloudName:"journeytogether",cloudinaryPreset:"journey-prod",cloudinarySingleImgPreset:"journey-prod-single",cloudBaseDir:"journey/journey-prod",version:m.version,stage:"prod"};var n=class{constructor(r="",h=!1,e=[],t="",s=new Date){this.name=r,this.isAuthenticated=h,this.roles=e,this.accessToken=t,this.expiredAt=s}};var c=(()=>{let r=class r{static saveUserContextInLocalStorage(e){e&&localStorage.setItem(r.USER_CONTEXT_KEY,JSON.stringify(e))}static getUserContextFromLocalStorage(){let e=localStorage.getItem(r.USER_CONTEXT_KEY);if(e){let t=JSON.parse(e);if(Date.now()<Date.parse(t.expiredAt)){let s=new n(t.name,t.isAuthenticated,t.roles,t.accessToken,new Date(Date.parse(t.expiredAt)));return console.log("Local auth context found and valid.",s),s}else r.removeUserContextFromLocalStorage(),console.log("Local auth context found, but not valid. Thus removed from local storage.")}}static removeUserContextFromLocalStorage(){localStorage.removeItem(r.USER_CONTEXT_KEY)}};r.USER_CONTEXT_KEY="_auth";let o=r;return o})();var d=(()=>{let r=class r{constructor(e){this.httpClient=e}login(e,t){return this.httpClient.post(u.journeyApi+"/login",{username:e,password:t},{headers:{Authorization:"Basic "+btoa(e+":"+t),"Content-Type":"application/json"}})}loginAsGuest(){return this.httpClient.post(u.journeyApi+"/guestLogin",{username:Math.random().toString(36)},{headers:{"Content-Type":"application/json"}})}};r.\u0275fac=function(t){return new(t||r)(l(g))},r.\u0275prov=i({token:r,factory:r.\u0275fac,providedIn:"root"});let o=r;return o})();var E=(()=>{let r=class r{constructor(e){this.loginService=e,this.user=new n,this.user$=new p(new n);let t=c.getUserContextFromLocalStorage();t&&this.setUserContext(t)}getCurrentUserContext(){return this.user}hasRole(e=[]){return this.getCurrentUserContext().roles.some(t=>e.indexOf(t)!=-1)}isUserAuthenticatedAsObservable(){return this.user$.pipe(a(e=>e.isAuthenticated))}getUserContext(){return this.user$}login(e,t){return this.loginService.login(e,t).pipe(a(s=>this.onLoginSuccessCallback(s)))}loginAsGuest(){return this.loginService.loginAsGuest().pipe(a(e=>this.onLoginSuccessCallback(e)))}logout(){c.removeUserContextFromLocalStorage(),this.setUserContext(new n)}onLoginSuccessCallback(e){let t=new n(e.name,!0,e.authorities,e.token,e.expiredAt);return c.saveUserContextInLocalStorage(t),this.setUserContext(t),t}setUserContext(e){this.user$.next(e),this.user=e}};r.\u0275fac=function(t){return new(t||r)(l(d))},r.\u0275prov=i({token:r,factory:r.\u0275fac,providedIn:"root"});let o=r;return o})();export{u as a,E as b};
