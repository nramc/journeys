import{a as Z,b as ee,c as te,d as ie,e as oe,f as ne}from"./chunk-7TMY5JFT.js";import"./chunk-3SF5BADC.js";import{b as X}from"./chunk-M74F7FOJ.js";import{a as J,f as K,g as Q}from"./chunk-YC3KMESZ.js";import"./chunk-XOGMMBEO.js";import"./chunk-XGCQEQWX.js";import{b as Y}from"./chunk-JIF26W2V.js";import"./chunk-2NNL6LPC.js";import"./chunk-7B2XB3GF.js";import{b as O,g as I,h as F,i as U,j,k as N,p as L,s as P,t as q,u as W}from"./chunk-CY4KTKAJ.js";import{a as V}from"./chunk-THLS4DYU.js";import{a as d}from"./chunk-D22SR3MY.js";import{a as B,b as z,d as G,g as H,k as $}from"./chunk-K76EUE7G.js";import{c as v}from"./chunk-AAVN2GU7.js";import{a as A}from"./chunk-OMGPJQVT.js";import{h as b}from"./chunk-AXFFOUUB.js";import"./chunk-GSBQVZFY.js";import{a as T,c as k}from"./chunk-YZBIOJLP.js";import{x as R}from"./chunk-SWPVFP3X.js";import{Bc as a,Qb as f,Rb as u,Vb as D,Wb as n,Xb as r,Yb as w,bd as S,ec as C,ha as M,jb as l,jc as p,ma as s,mc as x,sa as c,ta as m,wc as _,ya as h,yb as g}from"./chunk-LCXKQEMN.js";var ae=(()=>{class o{constructor(){this.httpClient=s(R),this.authService=s(v)}sendConfirmationCode(e){let t=this.authService.getCurrentUserContext(),i=e?"Basic "+btoa(e.username+":"+e.password):`Bearer ${t.accessToken}`;return this.httpClient.post(V.journeyApi+"/sendEmailCode",{},{headers:{Authorization:i}})}verifyConfirmationCode(e){let t=this.authService.getCurrentUserContext();return this.httpClient.post(V.journeyApi+"/verifyEmailCode",{code:e},{headers:{Authorization:`Bearer ${t.accessToken}`}})}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275prov=M({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();function me(o,y){o&1&&(n(0,"p",10),a(1," Code invalid. Please enter a valid code. "),r())}function fe(o,y){o&1&&(n(0,"p",15),a(1," Code has been sent successfully to the registered email. If you haven't received it, click Send again after 60 seconds. "),r())}var se=(()=>{class o{constructor(){this.destroyRef=s(h),this.emailConfirmationCodeService=s(ae),this.loginService=s(Y),this.authService=s(v),this.dialogRef=s(Z),this.credential=s(ee),this.isCodeSent=S(!1),this.canSendCode=S(!0),this.isCodeValid=S(!0)}confirmCode(e,t){this.isCodeValid.set(!0),e.validity.valid?this.verifyCode(t,e):this.isCodeValid.set(!1)}verifyCode(e,t){e.disabled=!0,this.credential?this.verifyCodeInUnauthenticatedContext(t,e):this.verifyCodeInAuthenticatedContext(t,e)}verifyCodeInUnauthenticatedContext(e,t){t.disabled=!0,this.loginService.mfa(e.value,"EMAIL_ADDRESS",this.credential).pipe(d(this.destroyRef)).subscribe({next:i=>{this.authService.getUserContextForSuccessfulLogin(i),this.onVerificationSuccess(t)},error:i=>this.onVerificationError(i,t)})}verifyCodeInAuthenticatedContext(e,t){this.emailConfirmationCodeService.verifyConfirmationCode(e.value).pipe(d(this.destroyRef)).subscribe({next:i=>this.onVerificationSuccess(t),error:i=>this.onVerificationError(i,t)})}onVerificationSuccess(e){e.disabled=!0,console.log("code verified successfully"),this.dialogRef.close(!0)}onVerificationError(e,t){console.log(e),this.isCodeValid.set(!1),t.disabled=!1}sendCode(){this.canSendCode.set(!1),this.emailConfirmationCodeService.sendConfirmationCode(this.credential).pipe(d(this.destroyRef)).subscribe({next:e=>this.onSentSuccess(),error:e=>this.onSentError(e)})}onSentError(e){console.log(e),this.canSendCode.set(!0)}onSentSuccess(){this.isCodeSent.set(!0),setTimeout(()=>this.canSendCode.set(!0),1e3*60),console.log("Code has been sent successfully to register email")}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=g({type:o,selectors:[["app-email-code-verification"]],inputs:{isCodeSent:[1,"isCodeSent"],canSendCode:[1,"canSendCode"],isCodeValid:[1,"isCodeValid"]},outputs:{isCodeSent:"isCodeSentChange",canSendCode:"canSendCodeChange",isCodeValid:"isCodeValidChange"},decls:34,vars:3,consts:[["codeForm","ngForm"],["confirmationCode",""],["confirmButton",""],[3,"submit"],[1,"bg-gradient-to-r","from-blue-500","to-blue-700","text-white","text-xl","font-semibold","!p-4","rounded-t-lg"],[1,"text-primary"],[1,"list-decimal","list-inside","text-base","mb-4"],[1,"px-1","rounded-sm","font-bold","italic","text-sm"],["appearance","fill",1,"w-full"],["matInput","","type","text","inputmode","numeric","id","confirmationCode","name","confirmationCode","required","","pattern","[0-9]{6,6}","maxlength","6","ngModel","","autocomplete","off",1,""],[1,"text-red-500","text-sm","text-center","mt-2"],[1,"flex","gap-2","mt-6","justify-center"],["mat-raised-button","","type","button","mat-dialog-close","false"],["mat-raised-button","","type","button",3,"click","disabled"],["mat-raised-button","","type","submit"],[1,"text-green-600","text-sm","font-bold","mt-4"]],template:function(t,i){if(t&1){let E=C();n(0,"form",3,0),p("submit",function(){c(E);let de=_(23),ce=_(31);return m(i.confirmCode(de,ce))}),n(2,"mat-card")(3,"mat-card-header",4)(4,"mat-card-title"),a(5,"Email Code Confirmation Required"),r()(),n(6,"mat-card-content",5)(7,"p"),a(8,"To complete verification, please follow below steps:"),r(),n(9,"ol",6)(10,"li"),a(11,"Click the "),n(12,"code",7),a(13,"Send"),r(),a(14," button to receive a verification code in your registered email. "),r(),n(15,"li"),a(16,"Check your email for the verification code."),r(),n(17,"li"),a(18,'Enter the code in the field below and click "Confirm" to complete the verification.'),r()(),n(19,"mat-form-field",8)(20,"mat-label"),a(21,"Code"),r(),w(22,"input",9,1),r(),f(24,me,2,0,"p",10),n(25,"div",11)(26,"button",12),a(27,"Cancel"),r(),n(28,"button",13),p("click",function(){return c(E),m(i.sendCode())}),a(29,"Send"),r(),n(30,"button",14,2),a(32,"Confirm"),r()(),f(33,fe,2,0,"p",15),r()()()}t&2&&(l(24),u(i.isCodeValid()?-1:24),l(4),D("disabled",!i.canSendCode()),l(5),u(i.isCodeSent()?33:-1))},dependencies:[oe,ie,W,N,O,I,F,L,P,q,j,U,b,Q,K,J,$,B,G,H,z,X],encapsulation:2,changeDetection:0})}}return o})();function ue(o,y){if(o&1){let e=C();n(0,"div",4)(1,"button",5),p("click",function(){c(e);let i=x();return m(i.continueWithTotpVerification())}),a(2," Using Mobile Authenticator "),n(3,"mat-icon",6),a(4,"screen_lock_portrait"),r()()()}}function pe(o,y){if(o&1){let e=C();n(0,"div",4)(1,"button",5),p("click",function(){c(e);let i=x();return m(i.continueWithEmailCodeVerification())}),a(2," Using Email Code "),n(3,"mat-icon",6),a(4,"mail_lock"),r()()()}}var Ke=(()=>{class o{constructor(){this.router=s(k),this.dialog=s(te),this.activatedRoute=s(T),this.destroyRef=s(h),this.mfaOptions=this.router.getCurrentNavigation()?.extras?.state}continueWithTotpVerification(){this.dialog.open(ne,{data:this.mfaOptions.credential,disableClose:!0}).afterClosed().pipe(d(this.destroyRef)).subscribe(t=>this.onCloseCallback(t))}continueWithEmailCodeVerification(){this.dialog.open(se,{data:this.mfaOptions.credential,disableClose:!0}).afterClosed().pipe(d(this.destroyRef)).subscribe(t=>this.onCloseCallback(t))}onCloseCallback(e){if(e===!0){let t=this.activatedRoute.snapshot.queryParams.redirectUrl??"/home";this.router.navigateByUrl(t).then(console.log)}}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=g({type:o,selectors:[["app-display-mfa-options"]],decls:7,vars:2,consts:[[1,"container","mx-auto","h-full","w-full","mt-4"],[1,"flex","flex-col","items-center","justify-center","gap-2"],[1,"p-2"],[1,"text-lg","font-bold","text-primary"],[1,"w-full","px-4","text-center"],["mat-flat-button","","type","button",1,"flex","items-center","justify-center","md:w-1/2","w-full","p-3","text-sm","font-bold","rounded-full",3,"click"],[1,"ml-2"]],template:function(t,i){t&1&&(n(0,"section",0)(1,"div",1)(2,"div",2)(3,"h5",3),a(4," Select Multi-factor Authentication Type to verify your identity "),r()(),f(5,ue,5,0,"div",4),f(6,pe,5,0,"div",4),r()()),t&2&&(l(5),u(!(i.mfaOptions==null||i.mfaOptions.options==null)&&i.mfaOptions.options.includes("TOTP")?5:-1),l(),u(!(i.mfaOptions==null||i.mfaOptions.options==null)&&i.mfaOptions.options.includes("EMAIL_ADDRESS")?6:-1))},dependencies:[A,b],styles:[".mfa-option[_ngcontent-%COMP%]{width:80%;height:3rem}"],changeDetection:0})}}return o})();export{Ke as DisplayMfaOptionsComponent};
