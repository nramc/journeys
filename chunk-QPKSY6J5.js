import{a as Z}from"./chunk-ECHAQOMZ.js";import"./chunk-7RWCIHFI.js";import{a as N}from"./chunk-7YMUPFY7.js";import{a as X}from"./chunk-BHMLK2LM.js";import{b as T}from"./chunk-YFHJRQYX.js";import{b as Y}from"./chunk-D6SCPQOY.js";import"./chunk-KH7BRNI5.js";import"./chunk-G2XCZ2PW.js";import"./chunk-XPXHN4H2.js";import{b as G,g as O,h as j,i as W,j as B,k as D,p as R,s as z,u as J}from"./chunk-HOVHNPYJ.js";import"./chunk-GAGEA73Y.js";import{c as A}from"./chunk-GAIKH4HI.js";import{c as H}from"./chunk-VV73E6E4.js";import{a as U,b as q}from"./chunk-PVMFBNKV.js";import{h as K,l as Q}from"./chunk-KNCR4J2L.js";import"./chunk-YKZB3ZSJ.js";import{a as I,c as F,d as V}from"./chunk-LJI5HHNX.js";import"./chunk-BOPRD3ZI.js";import{i as M,z as P}from"./chunk-KZQRB74Z.js";import{Aa as x,Dc as u,Ec as a,Gb as k,Ic as S,Jc as w,Kc as b,Mb as h,Qa as L,Xb as m,fc as t,gc as i,hc as y,lc as E,ob as C,pa as g,qc as v,sb as l,sc as _,za as f}from"./chunk-UJMVXANJ.js";function $(n,p){n&1&&(t(0,"div",27),y(1,"mat-spinner"),i())}function ee(n,p){n&1&&(t(0,"div"),a(1,"Username is required."),i())}function te(n,p){n&1&&(t(0,"div"),a(1,"Max 50 characters."),i())}function ie(n,p){if(n&1&&(t(0,"div",28),h(1,ee,2,0,"div",29)(2,te,2,0,"div",29),i()),n&2){_();let e=u(20);l(),m("ngIf",e.errors==null?null:e.errors.required),l(),m("ngIf",e.errors==null?null:e.errors.maxlength)}}function ne(n,p){n&1&&(t(0,"div"),a(1,"Password is required."),i())}function re(n,p){n&1&&(t(0,"div"),a(1,"Max 50 characters."),i())}function oe(n,p){if(n&1&&(t(0,"div",28),h(1,ne,2,0,"div",29)(2,re,2,0,"div",29),i()),n&2){_();let e=u(29);l(),m("ngIf",e.errors==null?null:e.errors.required),l(),m("ngIf",e.errors==null?null:e.errors.maxlength)}}var Ce=(()=>{class n{constructor(){this.SIGNUP_PAGE_INFO=T,this.forgotPasswordAssistanceUrl="https://github.com/nramc/journeys/issues/new?assignees=&labels=bug&projects=&template=bug-report-form.yml&title=%5BBug%5D%3A+",this.authService=g(H),this.loginService=g(Y),this.router=g(F),this.activatedRoute=g(I),this.notificationService=g(Z),this.isServiceAvailable=A(g(X).getVersion(),{initialValue:null}),this.form=L({username:"",password:""})}login(e){e.valid&&this.loginService.login(this.form()).subscribe({next:r=>this.onLoginSuccess(this.form(),r),error:r=>{e.resetForm(),this.onLoginFailed(r)}})}onLoginSuccess(e,r){if(r.additionalFactorRequired){let o={credential:e,options:r.securityAttributes};this.router.navigate(["mfa"],{queryParams:this.activatedRoute.snapshot.queryParams,state:o}).then(console.log)}else{let o=this.authService.getUserContextForSuccessfulLogin(r);this.onLogOnSuccess(o)}}onLoginFailed(e){console.error(e),this.notificationService.showError("Login failed. "+e.message)}onLogOnSuccess(e){this.notificationService.showSuccess("Login successful!");let r=this.activatedRoute.snapshot.queryParams.redirectUrl??"/home";this.router.navigateByUrl(r).then(console.log)}loginAsGuest(){this.loginService.loginAsGuest().subscribe({next:e=>{let r=this.authService.getUserContextForSuccessfulLogin(e);this.onLogOnSuccess(r)},error:e=>this.onLoginFailed(e)})}loginWithPasskey(e){this.loginService.loginWithPasskey(e).subscribe({next:r=>{let o=this.authService.getUserContextForSuccessfulLogin(r);this.onLogOnSuccess(o)},error:r=>this.onLoginFailed(r)})}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=k({type:n,selectors:[["app-login"]],decls:42,vars:7,consts:[["loginForm","ngForm"],["username","ngModel"],["password","ngModel"],[1,"flex","min-h-full","flex-col","justify-center","px-6","py-12","lg:px-8"],["class","mask-with-spinner",4,"ngIf"],[1,"sm:mx-auto","sm:w-full","sm:max-w-sm"],["ngSrc","assets/logo/journey-logo-64x64.png","alt","Journey","height","64","width","64",1,"mx-auto","h-10","w-auto"],[1,"text-primary","text-center","text-2xl/9","font-bold","tracking-tight"],[1,"mt-10","sm:mx-auto","sm:w-full","sm:max-w-sm"],[1,"flex","flex-col","gap-5",3,"ngSubmit"],["mat-flat-button","","type","button",1,"w-full","flex","items-center","justify-center","gap-2","px-4","py-2","rounded-xl","text-sm","font-semibold","bg-gray-100","hover:bg-gray-200","dark:bg-gray-800","dark:hover:bg-gray-700","border","border-gray-300","transition",3,"click"],[1,"text-xl"],[1,"space-y-1.5"],[1,"flex","items-center","justify-between"],["for","username",1,"text-sm","font-medium"],["tabindex","-1",1,"text-xs","text-primary","font-semibold","hover:underline",3,"routerLink"],["type","email","name","username","id","username","required","","placeholder","you@example.com","autocomplete","username webauthn","maxlength","50",1,"w-full","rounded-md","bg-white","px-3","py-2","text-sm","text-gray-900","outline","outline-1","outline-gray-300","placeholder:text-gray-400","focus:outline-2","focus:outline-indigo-600","dark:bg-gray-900","dark:text-white",3,"ngModelChange","ngModel"],["class","text-sm text-danger",4,"ngIf"],["for","password",1,"text-sm","font-medium"],["target","_blank","tabindex","-1",1,"text-xs","text-primary","font-semibold","hover:underline",3,"href"],["type","password","name","password","id","password","required","","placeholder","\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022","autocomplete","current-password webauthn","maxlength","50",1,"w-full","rounded-md","bg-white","px-3","py-2","text-sm","text-gray-900","outline","outline-1","outline-gray-300","placeholder:text-gray-400","focus:outline-2","focus:outline-indigo-600","dark:bg-gray-900","dark:text-white",3,"ngModelChange","ngModel"],[1,"flex","flex-col","items-center","gap-2","text-center","pt-2"],["mat-flat-button","","type","submit","color","primary",1,"w-full","font-semibold"],[1,"text-gray-500","dark:text-gray-400"],["mat-stroked-button","","type","button",1,"w-full","flex","items-center","justify-center","gap-2","rounded-xl","px-4","py-2","text-sm","font-medium","border","border-indigo-400","text-indigo-600","hover:bg-indigo-50","dark:border-indigo-500","dark:text-indigo-300","dark:hover:bg-indigo-900","transition",3,"click"],[1,"text-lg"],[1,"ml-2","text-xs","text-green-600","font-semibold"],[1,"mask-with-spinner"],[1,"text-sm","text-danger"],[4,"ngIf"]],template:function(r,o){if(r&1){let d=E();t(0,"div",3),h(1,$,2,0,"div",4),t(2,"div",5),y(3,"img",6),t(4,"h2",7),a(5,"Sign in to your account"),i()(),t(6,"div",8)(7,"form",9,0),v("ngSubmit",function(){f(d);let s=u(8);return x(o.login(s))}),t(9,"button",10),v("click",function(){f(d);let s=u(20);return x(o.loginWithPasskey(s.value))}),t(10,"mat-icon",11),a(11,"fingerprint"),i(),a(12," Sign in with Passkey "),i(),t(13,"div",12)(14,"div",13)(15,"label",14),a(16,"Email address"),i(),t(17,"a",15),a(18," Don\u2019t have an account? "),i()(),t(19,"input",16,1),b("ngModelChange",function(s){return f(d),w(o.form().username,s)||(o.form().username=s),x(s)}),i(),h(21,ie,3,2,"div",17),i(),t(22,"div",12)(23,"div",13)(24,"label",18),a(25,"Password"),i(),t(26,"a",19),a(27," Forgot Password? "),i()(),t(28,"input",20,2),b("ngModelChange",function(s){return f(d),w(o.form().password,s)||(o.form().password=s),x(s)}),i(),h(30,oe,3,2,"div",17),i(),t(31,"div",21)(32,"button",22),a(33," Sign In "),i(),t(34,"small",23),a(35,"or"),i(),t(36,"button",24),v("click",function(){return f(d),x(o.loginAsGuest())}),t(37,"mat-icon",25),a(38,"travel_explore"),i(),a(39," Explore as Guest "),t(40,"span",26),a(41,"No signup needed"),i()()()()()()}if(r&2){let d=u(8),c=u(20),s=u(29);l(),m("ngIf",!o.isServiceAvailable()),l(16),m("routerLink",o.SIGNUP_PAGE_INFO.path),l(2),S("ngModel",o.form().username),l(2),m("ngIf",c.invalid&&(c.dirty||d.submitted)),l(5),m("href",o.forgotPasswordAssistanceUrl,C),l(2),S("ngModel",o.form().password),l(2),m("ngIf",s.invalid&&(s.dirty||d.submitted))}},dependencies:[J,D,G,O,j,R,z,B,W,M,V,P,N,Q,K,q,U],styles:[".mask-with-spinner[_ngcontent-%COMP%]{position:absolute;height:100%;width:100%;background-color:#3459e61a;display:flex;justify-content:center;align-items:center;z-index:1000}"],changeDetection:0})}}return n})();export{Ce as LoginComponent};
