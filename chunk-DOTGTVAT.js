import{a as i0}from"./chunk-PRWC5KKV.js";import{a as o0,b as a0}from"./chunk-V7VXL4BU.js";import{a as n0,b as r0}from"./chunk-OZRZB2NL.js";import{a as s0}from"./chunk-KH7BRNI5.js";import{a as Fh}from"./chunk-V7KP7MMP.js";import{a as t0,b as xm}from"./chunk-EB64ZGMI.js";import{Ab as Xy,Bc as Jy,Cc as Qy,Gb as ep,I as Wy,Ma as gm,Na as il,Oa as Qd,Xb as tp,a as ai,b as Po,d as fm,e as Jd,ed as e0,f as Ec,fc as ym,gc as vm,hc as ip,kc as Yy,pa as mm,sb as Hy,xb as Ky,zb as _m}from"./chunk-6YGVGKRS.js";var Ru=Jd((np,l0)=>{"use strict";(function(s,i){typeof np=="object"&&typeof l0<"u"?i(np):typeof define=="function"&&define.amd?define(["exports"],i):(s=typeof globalThis<"u"?globalThis:s||self,i(s.leaflet={}))})(np,function(s){"use strict";var i="1.9.4";function l(c){var g,T,A,F;for(T=1,A=arguments.length;T<A;T++){F=arguments[T];for(g in F)c[g]=F[g]}return c}var m=Object.create||function(){function c(){}return function(g){return c.prototype=g,new c}}();function f(c,g){var T=Array.prototype.slice;if(c.bind)return c.bind.apply(c,T.call(arguments,1));var A=T.call(arguments,2);return function(){return c.apply(g,A.length?A.concat(T.call(arguments)):arguments)}}var a=0;function P(c){return"_leaflet_id"in c||(c._leaflet_id=++a),c._leaflet_id}function E(c,g,T){var A,F,J,xe;return xe=function(){A=!1,F&&(J.apply(T,F),F=!1)},J=function(){A?F=arguments:(c.apply(T,arguments),setTimeout(xe,g),A=!0)},J}function O(c,g,T){var A=g[1],F=g[0],J=A-F;return c===A&&T?c:((c-F)%J+J)%J+F}function B(){return!1}function W(c,g){if(g===!1)return c;var T=Math.pow(10,g===void 0?6:g);return Math.round(c*T)/T}function V(c){return c.trim?c.trim():c.replace(/^\s+|\s+$/g,"")}function he(c){return V(c).split(/\s+/)}function ue(c,g){Object.prototype.hasOwnProperty.call(c,"options")||(c.options=c.options?m(c.options):{});for(var T in g)c.options[T]=g[T];return c.options}function be(c,g,T){var A=[];for(var F in c)A.push(encodeURIComponent(T?F.toUpperCase():F)+"="+encodeURIComponent(c[F]));return(!g||g.indexOf("?")===-1?"?":"&")+A.join("&")}var ze=/\{ *([\w_ -]+) *\}/g;function Xe(c,g){return c.replace(ze,function(T,A){var F=g[A];if(F===void 0)throw new Error("No value provided for variable "+T);return typeof F=="function"&&(F=F(g)),F})}var Ve=Array.isArray||function(c){return Object.prototype.toString.call(c)==="[object Array]"};function Se(c,g){for(var T=0;T<c.length;T++)if(c[T]===g)return T;return-1}var nt="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function pt(c){return window["webkit"+c]||window["moz"+c]||window["ms"+c]}var Pt=0;function kt(c){var g=+new Date,T=Math.max(0,16-(g-Pt));return Pt=g+T,window.setTimeout(c,T)}var It=window.requestAnimationFrame||pt("RequestAnimationFrame")||kt,Q=window.cancelAnimationFrame||pt("CancelAnimationFrame")||pt("CancelRequestAnimationFrame")||function(c){window.clearTimeout(c)};function re(c,g,T){if(T&&It===kt)c.call(g);else return It.call(window,f(c,g))}function ce(c){c&&Q.call(window,c)}var Ie={__proto__:null,extend:l,create:m,bind:f,get lastId(){return a},stamp:P,throttle:E,wrapNum:O,falseFn:B,formatNum:W,trim:V,splitWords:he,setOptions:ue,getParamString:be,template:Xe,isArray:Ve,indexOf:Se,emptyImageUrl:nt,requestFn:It,cancelFn:Q,requestAnimFrame:re,cancelAnimFrame:ce};function de(){}de.extend=function(c){var g=function(){ue(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},T=g.__super__=this.prototype,A=m(T);A.constructor=g,g.prototype=A;for(var F in this)Object.prototype.hasOwnProperty.call(this,F)&&F!=="prototype"&&F!=="__super__"&&(g[F]=this[F]);return c.statics&&l(g,c.statics),c.includes&&(Oe(c.includes),l.apply(null,[A].concat(c.includes))),l(A,c),delete A.statics,delete A.includes,A.options&&(A.options=T.options?m(T.options):{},l(A.options,c.options)),A._initHooks=[],A.callInitHooks=function(){if(!this._initHooksCalled){T.callInitHooks&&T.callInitHooks.call(this),this._initHooksCalled=!0;for(var J=0,xe=A._initHooks.length;J<xe;J++)A._initHooks[J].call(this)}},g},de.include=function(c){var g=this.prototype.options;return l(this.prototype,c),c.options&&(this.prototype.options=g,this.mergeOptions(c.options)),this},de.mergeOptions=function(c){return l(this.prototype.options,c),this},de.addInitHook=function(c){var g=Array.prototype.slice.call(arguments,1),T=typeof c=="function"?c:function(){this[c].apply(this,g)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(T),this};function Oe(c){if(!(typeof L>"u"||!L||!L.Mixin)){c=Ve(c)?c:[c];for(var g=0;g<c.length;g++)c[g]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var Ae={on:function(c,g,T){if(typeof c=="object")for(var A in c)this._on(A,c[A],g);else{c=he(c);for(var F=0,J=c.length;F<J;F++)this._on(c[F],g,T)}return this},off:function(c,g,T){if(!arguments.length)delete this._events;else if(typeof c=="object")for(var A in c)this._off(A,c[A],g);else{c=he(c);for(var F=arguments.length===1,J=0,xe=c.length;J<xe;J++)F?this._off(c[J]):this._off(c[J],g,T)}return this},_on:function(c,g,T,A){if(typeof g!="function"){console.warn("wrong listener type: "+typeof g);return}if(this._listens(c,g,T)===!1){T===this&&(T=void 0);var F={fn:g,ctx:T};A&&(F.once=!0),this._events=this._events||{},this._events[c]=this._events[c]||[],this._events[c].push(F)}},_off:function(c,g,T){var A,F,J;if(this._events&&(A=this._events[c],!!A)){if(arguments.length===1){if(this._firingCount)for(F=0,J=A.length;F<J;F++)A[F].fn=B;delete this._events[c];return}if(typeof g!="function"){console.warn("wrong listener type: "+typeof g);return}var xe=this._listens(c,g,T);if(xe!==!1){var je=A[xe];this._firingCount&&(je.fn=B,this._events[c]=A=A.slice()),A.splice(xe,1)}}},fire:function(c,g,T){if(!this.listens(c,T))return this;var A=l({},g,{type:c,target:this,sourceTarget:g&&g.sourceTarget||this});if(this._events){var F=this._events[c];if(F){this._firingCount=this._firingCount+1||1;for(var J=0,xe=F.length;J<xe;J++){var je=F[J],Je=je.fn;je.once&&this.off(c,Je,je.ctx),Je.call(je.ctx||this,A)}this._firingCount--}}return T&&this._propagateEvent(A),this},listens:function(c,g,T,A){typeof c!="string"&&console.warn('"string" type argument expected');var F=g;typeof g!="function"&&(A=!!g,F=void 0,T=void 0);var J=this._events&&this._events[c];if(J&&J.length&&this._listens(c,F,T)!==!1)return!0;if(A){for(var xe in this._eventParents)if(this._eventParents[xe].listens(c,g,T,A))return!0}return!1},_listens:function(c,g,T){if(!this._events)return!1;var A=this._events[c]||[];if(!g)return!!A.length;T===this&&(T=void 0);for(var F=0,J=A.length;F<J;F++)if(A[F].fn===g&&A[F].ctx===T)return F;return!1},once:function(c,g,T){if(typeof c=="object")for(var A in c)this._on(A,c[A],g,!0);else{c=he(c);for(var F=0,J=c.length;F<J;F++)this._on(c[F],g,T,!0)}return this},addEventParent:function(c){return this._eventParents=this._eventParents||{},this._eventParents[P(c)]=c,this},removeEventParent:function(c){return this._eventParents&&delete this._eventParents[P(c)],this},_propagateEvent:function(c){for(var g in this._eventParents)this._eventParents[g].fire(c.type,l({layer:c.target,propagatedFrom:c.target},c),!0)}};Ae.addEventListener=Ae.on,Ae.removeEventListener=Ae.clearAllEventListeners=Ae.off,Ae.addOneTimeEventListener=Ae.once,Ae.fireEvent=Ae.fire,Ae.hasEventListeners=Ae.listens;var Ce=de.extend(Ae);function ge(c,g,T){this.x=T?Math.round(c):c,this.y=T?Math.round(g):g}var Fe=Math.trunc||function(c){return c>0?Math.floor(c):Math.ceil(c)};ge.prototype={clone:function(){return new ge(this.x,this.y)},add:function(c){return this.clone()._add(Ee(c))},_add:function(c){return this.x+=c.x,this.y+=c.y,this},subtract:function(c){return this.clone()._subtract(Ee(c))},_subtract:function(c){return this.x-=c.x,this.y-=c.y,this},divideBy:function(c){return this.clone()._divideBy(c)},_divideBy:function(c){return this.x/=c,this.y/=c,this},multiplyBy:function(c){return this.clone()._multiplyBy(c)},_multiplyBy:function(c){return this.x*=c,this.y*=c,this},scaleBy:function(c){return new ge(this.x*c.x,this.y*c.y)},unscaleBy:function(c){return new ge(this.x/c.x,this.y/c.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=Fe(this.x),this.y=Fe(this.y),this},distanceTo:function(c){c=Ee(c);var g=c.x-this.x,T=c.y-this.y;return Math.sqrt(g*g+T*T)},equals:function(c){return c=Ee(c),c.x===this.x&&c.y===this.y},contains:function(c){return c=Ee(c),Math.abs(c.x)<=Math.abs(this.x)&&Math.abs(c.y)<=Math.abs(this.y)},toString:function(){return"Point("+W(this.x)+", "+W(this.y)+")"}};function Ee(c,g,T){return c instanceof ge?c:Ve(c)?new ge(c[0],c[1]):c==null?c:typeof c=="object"&&"x"in c&&"y"in c?new ge(c.x,c.y):new ge(c,g,T)}function qe(c,g){if(c)for(var T=g?[c,g]:c,A=0,F=T.length;A<F;A++)this.extend(T[A])}qe.prototype={extend:function(c){var g,T;if(!c)return this;if(c instanceof ge||typeof c[0]=="number"||"x"in c)g=T=Ee(c);else if(c=xt(c),g=c.min,T=c.max,!g||!T)return this;return!this.min&&!this.max?(this.min=g.clone(),this.max=T.clone()):(this.min.x=Math.min(g.x,this.min.x),this.max.x=Math.max(T.x,this.max.x),this.min.y=Math.min(g.y,this.min.y),this.max.y=Math.max(T.y,this.max.y)),this},getCenter:function(c){return Ee((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,c)},getBottomLeft:function(){return Ee(this.min.x,this.max.y)},getTopRight:function(){return Ee(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(c){var g,T;return typeof c[0]=="number"||c instanceof ge?c=Ee(c):c=xt(c),c instanceof qe?(g=c.min,T=c.max):g=T=c,g.x>=this.min.x&&T.x<=this.max.x&&g.y>=this.min.y&&T.y<=this.max.y},intersects:function(c){c=xt(c);var g=this.min,T=this.max,A=c.min,F=c.max,J=F.x>=g.x&&A.x<=T.x,xe=F.y>=g.y&&A.y<=T.y;return J&&xe},overlaps:function(c){c=xt(c);var g=this.min,T=this.max,A=c.min,F=c.max,J=F.x>g.x&&A.x<T.x,xe=F.y>g.y&&A.y<T.y;return J&&xe},isValid:function(){return!!(this.min&&this.max)},pad:function(c){var g=this.min,T=this.max,A=Math.abs(g.x-T.x)*c,F=Math.abs(g.y-T.y)*c;return xt(Ee(g.x-A,g.y-F),Ee(T.x+A,T.y+F))},equals:function(c){return c?(c=xt(c),this.min.equals(c.getTopLeft())&&this.max.equals(c.getBottomRight())):!1}};function xt(c,g){return!c||c instanceof qe?c:new qe(c,g)}function Tt(c,g){if(c)for(var T=g?[c,g]:c,A=0,F=T.length;A<F;A++)this.extend(T[A])}Tt.prototype={extend:function(c){var g=this._southWest,T=this._northEast,A,F;if(c instanceof St)A=c,F=c;else if(c instanceof Tt){if(A=c._southWest,F=c._northEast,!A||!F)return this}else return c?this.extend(zt(c)||Et(c)):this;return!g&&!T?(this._southWest=new St(A.lat,A.lng),this._northEast=new St(F.lat,F.lng)):(g.lat=Math.min(A.lat,g.lat),g.lng=Math.min(A.lng,g.lng),T.lat=Math.max(F.lat,T.lat),T.lng=Math.max(F.lng,T.lng)),this},pad:function(c){var g=this._southWest,T=this._northEast,A=Math.abs(g.lat-T.lat)*c,F=Math.abs(g.lng-T.lng)*c;return new Tt(new St(g.lat-A,g.lng-F),new St(T.lat+A,T.lng+F))},getCenter:function(){return new St((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new St(this.getNorth(),this.getWest())},getSouthEast:function(){return new St(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(c){typeof c[0]=="number"||c instanceof St||"lat"in c?c=zt(c):c=Et(c);var g=this._southWest,T=this._northEast,A,F;return c instanceof Tt?(A=c.getSouthWest(),F=c.getNorthEast()):A=F=c,A.lat>=g.lat&&F.lat<=T.lat&&A.lng>=g.lng&&F.lng<=T.lng},intersects:function(c){c=Et(c);var g=this._southWest,T=this._northEast,A=c.getSouthWest(),F=c.getNorthEast(),J=F.lat>=g.lat&&A.lat<=T.lat,xe=F.lng>=g.lng&&A.lng<=T.lng;return J&&xe},overlaps:function(c){c=Et(c);var g=this._southWest,T=this._northEast,A=c.getSouthWest(),F=c.getNorthEast(),J=F.lat>g.lat&&A.lat<T.lat,xe=F.lng>g.lng&&A.lng<T.lng;return J&&xe},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(c,g){return c?(c=Et(c),this._southWest.equals(c.getSouthWest(),g)&&this._northEast.equals(c.getNorthEast(),g)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function Et(c,g){return c instanceof Tt?c:new Tt(c,g)}function St(c,g,T){if(isNaN(c)||isNaN(g))throw new Error("Invalid LatLng object: ("+c+", "+g+")");this.lat=+c,this.lng=+g,T!==void 0&&(this.alt=+T)}St.prototype={equals:function(c,g){if(!c)return!1;c=zt(c);var T=Math.max(Math.abs(this.lat-c.lat),Math.abs(this.lng-c.lng));return T<=(g===void 0?1e-9:g)},toString:function(c){return"LatLng("+W(this.lat,c)+", "+W(this.lng,c)+")"},distanceTo:function(c){return Qt.distance(this,zt(c))},wrap:function(){return Qt.wrapLatLng(this)},toBounds:function(c){var g=180*c/40075017,T=g/Math.cos(Math.PI/180*this.lat);return Et([this.lat-g,this.lng-T],[this.lat+g,this.lng+T])},clone:function(){return new St(this.lat,this.lng,this.alt)}};function zt(c,g,T){return c instanceof St?c:Ve(c)&&typeof c[0]!="object"?c.length===3?new St(c[0],c[1],c[2]):c.length===2?new St(c[0],c[1]):null:c==null?c:typeof c=="object"&&"lat"in c?new St(c.lat,"lng"in c?c.lng:c.lon,c.alt):g===void 0?null:new St(c,g,T)}var Ft={latLngToPoint:function(c,g){var T=this.projection.project(c),A=this.scale(g);return this.transformation._transform(T,A)},pointToLatLng:function(c,g){var T=this.scale(g),A=this.transformation.untransform(c,T);return this.projection.unproject(A)},project:function(c){return this.projection.project(c)},unproject:function(c){return this.projection.unproject(c)},scale:function(c){return 256*Math.pow(2,c)},zoom:function(c){return Math.log(c/256)/Math.LN2},getProjectedBounds:function(c){if(this.infinite)return null;var g=this.projection.bounds,T=this.scale(c),A=this.transformation.transform(g.min,T),F=this.transformation.transform(g.max,T);return new qe(A,F)},infinite:!1,wrapLatLng:function(c){var g=this.wrapLng?O(c.lng,this.wrapLng,!0):c.lng,T=this.wrapLat?O(c.lat,this.wrapLat,!0):c.lat,A=c.alt;return new St(T,g,A)},wrapLatLngBounds:function(c){var g=c.getCenter(),T=this.wrapLatLng(g),A=g.lat-T.lat,F=g.lng-T.lng;if(A===0&&F===0)return c;var J=c.getSouthWest(),xe=c.getNorthEast(),je=new St(J.lat-A,J.lng-F),Je=new St(xe.lat-A,xe.lng-F);return new Tt(je,Je)}},Qt=l({},Ft,{wrapLng:[-180,180],R:6371e3,distance:function(c,g){var T=Math.PI/180,A=c.lat*T,F=g.lat*T,J=Math.sin((g.lat-c.lat)*T/2),xe=Math.sin((g.lng-c.lng)*T/2),je=J*J+Math.cos(A)*Math.cos(F)*xe*xe,Je=2*Math.atan2(Math.sqrt(je),Math.sqrt(1-je));return this.R*Je}}),Vi=6378137,Jn={R:Vi,MAX_LATITUDE:85.0511287798,project:function(c){var g=Math.PI/180,T=this.MAX_LATITUDE,A=Math.max(Math.min(T,c.lat),-T),F=Math.sin(A*g);return new ge(this.R*c.lng*g,this.R*Math.log((1+F)/(1-F))/2)},unproject:function(c){var g=180/Math.PI;return new St((2*Math.atan(Math.exp(c.y/this.R))-Math.PI/2)*g,c.x*g/this.R)},bounds:function(){var c=Vi*Math.PI;return new qe([-c,-c],[c,c])}()};function hn(c,g,T,A){if(Ve(c)){this._a=c[0],this._b=c[1],this._c=c[2],this._d=c[3];return}this._a=c,this._b=g,this._c=T,this._d=A}hn.prototype={transform:function(c,g){return this._transform(c.clone(),g)},_transform:function(c,g){return g=g||1,c.x=g*(this._a*c.x+this._b),c.y=g*(this._c*c.y+this._d),c},untransform:function(c,g){return g=g||1,new ge((c.x/g-this._b)/this._a,(c.y/g-this._d)/this._c)}};function Yi(c,g,T,A){return new hn(c,g,T,A)}var Ri=l({},Qt,{code:"EPSG:3857",projection:Jn,transformation:function(){var c=.5/(Math.PI*Jn.R);return Yi(c,.5,-c,.5)}()}),_i=l({},Ri,{code:"EPSG:900913"});function Ui(c){return document.createElementNS("http://www.w3.org/2000/svg",c)}function Zi(c,g){var T="",A,F,J,xe,je,Je;for(A=0,J=c.length;A<J;A++){for(je=c[A],F=0,xe=je.length;F<xe;F++)Je=je[F],T+=(F?"L":"M")+Je.x+" "+Je.y;T+=g?ft.svg?"z":"x":""}return T||"M0 0"}var ui=document.documentElement.style,to="ActiveXObject"in window,Io=to&&!document.addEventListener,jn="msLaunchUri"in navigator&&!("documentMode"in document),Pr=ri("webkit"),mo=ri("android"),io=ri("android 2")||ri("android 3"),no=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),Jo=mo&&ri("Google")&&no<537&&!("AudioNode"in window),ni=!!window.opera,Gi=!jn&&ri("chrome"),Ot=ri("gecko")&&!Pr&&!ni&&!to,qr=!Gi&&ri("safari"),Tn=ri("phantom"),Ti="OTransition"in ui,dn=navigator.platform.indexOf("Win")===0,An=to&&"transition"in ui,Rn="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!io,Re="MozPerspective"in ui,X=!window.L_DISABLE_3D&&(An||Rn||Re)&&!Ti&&!Tn,Y=typeof orientation<"u"||ri("mobile"),te=Y&&Pr,me=Y&&Rn,Te=!window.PointerEvent&&window.MSPointerEvent,ie=!!(window.PointerEvent||Te),Ne="ontouchstart"in window||!!window.TouchEvent,ke=!window.L_NO_TOUCH&&(Ne||ie),Be=Y&&ni,Ze=Y&&Ot,De=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,at=function(){var c=!1;try{var g=Object.defineProperty({},"passive",{get:function(){c=!0}});window.addEventListener("testPassiveEventSupport",B,g),window.removeEventListener("testPassiveEventSupport",B,g)}catch{}return c}(),mt=function(){return!!document.createElement("canvas").getContext}(),yt=!!(document.createElementNS&&Ui("svg").createSVGRect),Dt=!!yt&&function(){var c=document.createElement("div");return c.innerHTML="<svg/>",(c.firstChild&&c.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"}(),Yt=!yt&&function(){try{var c=document.createElement("div");c.innerHTML='<v:shape adj="1"/>';var g=c.firstChild;return g.style.behavior="url(#default#VML)",g&&typeof g.adj=="object"}catch{return!1}}(),Gt=navigator.platform.indexOf("Mac")===0,Ye=navigator.platform.indexOf("Linux")===0;function ri(c){return navigator.userAgent.toLowerCase().indexOf(c)>=0}var ft={ie:to,ielt9:Io,edge:jn,webkit:Pr,android:mo,android23:io,androidStock:Jo,opera:ni,chrome:Gi,gecko:Ot,safari:qr,phantom:Tn,opera12:Ti,win:dn,ie3d:An,webkit3d:Rn,gecko3d:Re,any3d:X,mobile:Y,mobileWebkit:te,mobileWebkit3d:me,msPointer:Te,pointer:ie,touch:ke,touchNative:Ne,mobileOpera:Be,mobileGecko:Ze,retina:De,passiveEvents:at,canvas:mt,svg:yt,vml:Yt,inlineSvg:Dt,mac:Gt,linux:Ye},Si=ft.msPointer?"MSPointerDown":"pointerdown",Zt=ft.msPointer?"MSPointerMove":"pointermove",ot=ft.msPointer?"MSPointerUp":"pointerup",Nt=ft.msPointer?"MSPointerCancel":"pointercancel",Kt={touchstart:Si,touchmove:Zt,touchend:ot,touchcancel:Nt},Hi={touchstart:zi,touchmove:rn,touchend:rn,touchcancel:rn},$i={},Qn=!1;function ei(c,g,T){return g==="touchstart"&&nn(),Hi[g]?(T=Hi[g].bind(this,T),c.addEventListener(Kt[g],T,!1),T):(console.warn("wrong event specified:",g),B)}function Qo(c,g,T){if(!Kt[g]){console.warn("wrong event specified:",g);return}c.removeEventListener(Kt[g],T,!1)}function We(c){$i[c.pointerId]=c}function Pi(c){$i[c.pointerId]&&($i[c.pointerId]=c)}function tn(c){delete $i[c.pointerId]}function nn(){Qn||(document.addEventListener(Si,We,!0),document.addEventListener(Zt,Pi,!0),document.addEventListener(ot,tn,!0),document.addEventListener(Nt,tn,!0),Qn=!0)}function rn(c,g){if(g.pointerType!==(g.MSPOINTER_TYPE_MOUSE||"mouse")){g.touches=[];for(var T in $i)g.touches.push($i[T]);g.changedTouches=[g],c(g)}}function zi(c,g){g.MSPOINTER_TYPE_TOUCH&&g.pointerType===g.MSPOINTER_TYPE_TOUCH&&Bt(g),rn(c,g)}function on(c){var g={},T,A;for(A in c)T=c[A],g[A]=T&&T.bind?T.bind(c):T;return c=g,g.type="dblclick",g.detail=2,g.isTrusted=!1,g._simulated=!0,g}var qt=200;function ro(c,g){c.addEventListener("dblclick",g);var T=0,A;function F(J){if(J.detail!==1){A=J.detail;return}if(!(J.pointerType==="mouse"||J.sourceCapabilities&&!J.sourceCapabilities.firesTouchEvents)){var xe=ti(J);if(!(xe.some(function(Je){return Je instanceof HTMLLabelElement&&Je.attributes.for})&&!xe.some(function(Je){return Je instanceof HTMLInputElement||Je instanceof HTMLSelectElement}))){var je=Date.now();je-T<=qt?(A++,A===2&&g(on(J))):A=1,T=je}}}return c.addEventListener("click",F),{dblclick:g,simDblclick:F}}function Dn(c,g){c.removeEventListener("dblclick",g.dblclick),c.removeEventListener("click",g.simDblclick)}var Eo=es(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),kn=es(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),Dr=kn==="webkitTransition"||kn==="OTransition"?kn+"End":"transitionend";function Lo(c){return typeof c=="string"?document.getElementById(c):c}function Ao(c,g){var T=c.style[g]||c.currentStyle&&c.currentStyle[g];if((!T||T==="auto")&&document.defaultView){var A=document.defaultView.getComputedStyle(c,null);T=A?A[g]:null}return T==="auto"?null:T}function yi(c,g,T){var A=document.createElement(c);return A.className=g||"",T&&T.appendChild(A),A}function Ai(c){var g=c.parentNode;g&&g.removeChild(c)}function mn(c){for(;c.firstChild;)c.removeChild(c.firstChild)}function Ya(c){var g=c.parentNode;g&&g.lastChild!==c&&g.appendChild(c)}function Ja(c){var g=c.parentNode;g&&g.firstChild!==c&&g.insertBefore(c,g.firstChild)}function Kl(c,g){if(c.classList!==void 0)return c.classList.contains(g);var T=Qa(c);return T.length>0&&new RegExp("(^|\\s)"+g+"(\\s|$)").test(T)}function hi(c,g){if(c.classList!==void 0)for(var T=he(g),A=0,F=T.length;A<F;A++)c.classList.add(T[A]);else if(!Kl(c,g)){var J=Qa(c);ko(c,(J?J+" ":"")+g)}}function pn(c,g){c.classList!==void 0?c.classList.remove(g):ko(c,V((" "+Qa(c)+" ").replace(" "+g+" "," ")))}function ko(c,g){c.className.baseVal===void 0?c.className=g:c.className.baseVal=g}function Qa(c){return c.correspondingElement&&(c=c.correspondingElement),c.className.baseVal===void 0?c.className:c.className.baseVal}function Br(c,g){"opacity"in c.style?c.style.opacity=g:"filter"in c.style&&va(c,g)}function va(c,g){var T=!1,A="DXImageTransform.Microsoft.Alpha";try{T=c.filters.item(A)}catch{if(g===1)return}g=Math.round(g*100),T?(T.Enabled=g!==100,T.Opacity=g):c.style.filter+=" progid:"+A+"(opacity="+g+")"}function es(c){for(var g=document.documentElement.style,T=0;T<c.length;T++)if(c[T]in g)return c[T];return!1}function xa(c,g,T){var A=g||new ge(0,0);c.style[Eo]=(ft.ie3d?"translate("+A.x+"px,"+A.y+"px)":"translate3d("+A.x+"px,"+A.y+"px,0)")+(T?" scale("+T+")":"")}function an(c,g){c._leaflet_pos=g,ft.any3d?xa(c,g):(c.style.left=g.x+"px",c.style.top=g.y+"px")}function oo(c){return c._leaflet_pos||new ge(0,0)}var ba,Bn,vi;if("onselectstart"in document)ba=function(){Ut(window,"selectstart",Bt)},Bn=function(){Di(window,"selectstart",Bt)};else{var go=es(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);ba=function(){if(go){var c=document.documentElement.style;vi=c[go],c[go]="none"}},Bn=function(){go&&(document.documentElement.style[go]=vi,vi=void 0)}}function er(){Ut(window,"dragstart",Bt)}function zo(){Di(window,"dragstart",Bt)}var di,wa;function Ta(c){for(;c.tabIndex===-1;)c=c.parentNode;c.style&&(Ro(),di=c,wa=c.style.outlineStyle,c.style.outlineStyle="none",Ut(window,"keydown",Ro))}function Ro(){di&&(di.style.outlineStyle=wa,di=void 0,wa=void 0,Di(window,"keydown",Ro))}function yr(c){do c=c.parentNode;while((!c.offsetWidth||!c.offsetHeight)&&c!==document.body);return c}function On(c){var g=c.getBoundingClientRect();return{x:g.width/c.offsetWidth||1,y:g.height/c.offsetHeight||1,boundingClientRect:g}}var Sn={__proto__:null,TRANSFORM:Eo,TRANSITION:kn,TRANSITION_END:Dr,get:Lo,getStyle:Ao,create:yi,remove:Ai,empty:mn,toFront:Ya,toBack:Ja,hasClass:Kl,addClass:hi,removeClass:pn,setClass:ko,getClass:Qa,setOpacity:Br,testProp:es,setTransform:xa,setPosition:an,getPosition:oo,get disableTextSelection(){return ba},get enableTextSelection(){return Bn},disableImageDrag:er,enableImageDrag:zo,preventOutline:Ta,restoreOutline:Ro,getSizedParentNode:yr,getScale:On};function Ut(c,g,T,A){if(g&&typeof g=="object")for(var F in g)cr(c,F,g[F],T);else{g=he(g);for(var J=0,xe=g.length;J<xe;J++)cr(c,g[J],T,A)}return this}var Ei="_leaflet_events";function Di(c,g,T,A){if(arguments.length===1)lr(c),delete c[Ei];else if(g&&typeof g=="object")for(var F in g)Sa(c,F,g[F],T);else if(g=he(g),arguments.length===2)lr(c,function(je){return Se(g,je)!==-1});else for(var J=0,xe=g.length;J<xe;J++)Sa(c,g[J],T,A);return this}function lr(c,g){for(var T in c[Ei]){var A=T.split(/\d/)[0];(!g||g(A))&&Sa(c,A,null,null,T)}}var vr={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function cr(c,g,T,A){var F=g+P(T)+(A?"_"+P(A):"");if(c[Ei]&&c[Ei][F])return this;var J=function(je){return T.call(A||c,je||window.event)},xe=J;!ft.touchNative&&ft.pointer&&g.indexOf("touch")===0?J=ei(c,g,J):ft.touch&&g==="dblclick"?J=ro(c,J):"addEventListener"in c?g==="touchstart"||g==="touchmove"||g==="wheel"||g==="mousewheel"?c.addEventListener(vr[g]||g,J,ft.passiveEvents?{passive:!1}:!1):g==="mouseenter"||g==="mouseleave"?(J=function(je){je=je||window.event,Rs(c,je)&&xe(je)},c.addEventListener(vr[g],J,!1)):c.addEventListener(g,xe,!1):c.attachEvent("on"+g,J),c[Ei]=c[Ei]||{},c[Ei][F]=J}function Sa(c,g,T,A,F){F=F||g+P(T)+(A?"_"+P(A):"");var J=c[Ei]&&c[Ei][F];if(!J)return this;!ft.touchNative&&ft.pointer&&g.indexOf("touch")===0?Qo(c,g,J):ft.touch&&g==="dblclick"?Dn(c,J):"removeEventListener"in c?c.removeEventListener(vr[g]||g,J,!1):c.detachEvent("on"+g,J),c[Ei][F]=null}function Li(c){return c.stopPropagation?c.stopPropagation():c.originalEvent?c.originalEvent._stopped=!0:c.cancelBubble=!0,this}function Ji(c){return cr(c,"wheel",Li),this}function si(c){return Ut(c,"mousedown touchstart dblclick contextmenu",Li),c._leaflet_disable_click=!0,this}function Bt(c){return c.preventDefault?c.preventDefault():c.returnValue=!1,this}function Wr(c){return Bt(c),Li(c),this}function ti(c){if(c.composedPath)return c.composedPath();for(var g=[],T=c.target;T;)g.push(T),T=T.parentNode;return g}function zs(c,g){if(!g)return new ge(c.clientX,c.clientY);var T=On(g),A=T.boundingClientRect;return new ge((c.clientX-A.left)/T.x-g.clientLeft,(c.clientY-A.top)/T.y-g.clientTop)}var ur=ft.linux&&ft.chrome?window.devicePixelRatio:ft.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function fl(c){return ft.edge?c.wheelDeltaY/2:c.deltaY&&c.deltaMode===0?-c.deltaY/ur:c.deltaY&&c.deltaMode===1?-c.deltaY*20:c.deltaY&&c.deltaMode===2?-c.deltaY*60:c.deltaX||c.deltaZ?0:c.wheelDelta?(c.wheelDeltaY||c.wheelDelta)/2:c.detail&&Math.abs(c.detail)<32765?-c.detail*20:c.detail?c.detail/-32765*60:0}function Rs(c,g){var T=g.relatedTarget;if(!T)return!0;try{for(;T&&T!==c;)T=T.parentNode}catch{return!1}return T!==c}var Ds={__proto__:null,on:Ut,off:Di,stopPropagation:Li,disableScrollPropagation:Ji,disableClickPropagation:si,preventDefault:Bt,stop:Wr,getPropagationPath:ti,getMousePosition:zs,getWheelDelta:fl,isExternalTarget:Rs,addListener:Ut,removeListener:Di},Pa=Ce.extend({run:function(c,g,T,A){this.stop(),this._el=c,this._inProgress=!0,this._duration=T||.25,this._easeOutPower=1/Math.max(A||.5,.2),this._startPos=oo(c),this._offset=g.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=re(this._animate,this),this._step()},_step:function(c){var g=+new Date-this._startTime,T=this._duration*1e3;g<T?this._runFrame(this._easeOut(g/T),c):(this._runFrame(1),this._complete())},_runFrame:function(c,g){var T=this._startPos.add(this._offset.multiplyBy(c));g&&T._round(),an(this._el,T),this.fire("step")},_complete:function(){ce(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(c){return 1-Math.pow(1-c,this._easeOutPower)}}),xi=Ce.extend({options:{crs:Ri,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(c,g){g=ue(this,g),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(c),this._initLayout(),this._onResize=f(this._onResize,this),this._initEvents(),g.maxBounds&&this.setMaxBounds(g.maxBounds),g.zoom!==void 0&&(this._zoom=this._limitZoom(g.zoom)),g.center&&g.zoom!==void 0&&this.setView(zt(g.center),g.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=kn&&ft.any3d&&!ft.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),Ut(this._proxy,Dr,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(c,g,T){if(g=g===void 0?this._zoom:this._limitZoom(g),c=this._limitCenter(zt(c),g,this.options.maxBounds),T=T||{},this._stop(),this._loaded&&!T.reset&&T!==!0){T.animate!==void 0&&(T.zoom=l({animate:T.animate},T.zoom),T.pan=l({animate:T.animate,duration:T.duration},T.pan));var A=this._zoom!==g?this._tryAnimatedZoom&&this._tryAnimatedZoom(c,g,T.zoom):this._tryAnimatedPan(c,T.pan);if(A)return clearTimeout(this._sizeTimer),this}return this._resetView(c,g,T.pan&&T.pan.noMoveStart),this},setZoom:function(c,g){return this._loaded?this.setView(this.getCenter(),c,{zoom:g}):(this._zoom=c,this)},zoomIn:function(c,g){return c=c||(ft.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+c,g)},zoomOut:function(c,g){return c=c||(ft.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-c,g)},setZoomAround:function(c,g,T){var A=this.getZoomScale(g),F=this.getSize().divideBy(2),J=c instanceof ge?c:this.latLngToContainerPoint(c),xe=J.subtract(F).multiplyBy(1-1/A),je=this.containerPointToLatLng(F.add(xe));return this.setView(je,g,{zoom:T})},_getBoundsCenterZoom:function(c,g){g=g||{},c=c.getBounds?c.getBounds():Et(c);var T=Ee(g.paddingTopLeft||g.padding||[0,0]),A=Ee(g.paddingBottomRight||g.padding||[0,0]),F=this.getBoundsZoom(c,!1,T.add(A));if(F=typeof g.maxZoom=="number"?Math.min(g.maxZoom,F):F,F===1/0)return{center:c.getCenter(),zoom:F};var J=A.subtract(T).divideBy(2),xe=this.project(c.getSouthWest(),F),je=this.project(c.getNorthEast(),F),Je=this.unproject(xe.add(je).divideBy(2).add(J),F);return{center:Je,zoom:F}},fitBounds:function(c,g){if(c=Et(c),!c.isValid())throw new Error("Bounds are not valid.");var T=this._getBoundsCenterZoom(c,g);return this.setView(T.center,T.zoom,g)},fitWorld:function(c){return this.fitBounds([[-90,-180],[90,180]],c)},panTo:function(c,g){return this.setView(c,this._zoom,{pan:g})},panBy:function(c,g){if(c=Ee(c).round(),g=g||{},!c.x&&!c.y)return this.fire("moveend");if(g.animate!==!0&&!this.getSize().contains(c))return this._resetView(this.unproject(this.project(this.getCenter()).add(c)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new Pa,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),g.noMoveStart||this.fire("movestart"),g.animate!==!1){hi(this._mapPane,"leaflet-pan-anim");var T=this._getMapPanePos().subtract(c).round();this._panAnim.run(this._mapPane,T,g.duration||.25,g.easeLinearity)}else this._rawPanBy(c),this.fire("move").fire("moveend");return this},flyTo:function(c,g,T){if(T=T||{},T.animate===!1||!ft.any3d)return this.setView(c,g,T);this._stop();var A=this.project(this.getCenter()),F=this.project(c),J=this.getSize(),xe=this._zoom;c=zt(c),g=g===void 0?xe:g;var je=Math.max(J.x,J.y),Je=je*this.getZoomScale(xe,g),ut=F.distanceTo(A)||1,Mt=1.42,Xt=Mt*Mt;function pi(gn){var ra=gn?-1:1,dc=gn?Je:je,cu=Je*Je-je*je+ra*Xt*Xt*ut*ut,uu=2*dc*Xt*ut,Tl=cu/uu,Oa=Math.sqrt(Tl*Tl+1)-Tl,gs=Oa<1e-9?-18:Math.log(Oa);return gs}function Zn(gn){return(Math.exp(gn)-Math.exp(-gn))/2}function Pn(gn){return(Math.exp(gn)+Math.exp(-gn))/2}function jr(gn){return Zn(gn)/Pn(gn)}var Vn=pi(0);function qi(gn){return je*(Pn(Vn)/Pn(Vn+Mt*gn))}function na(gn){return je*(Pn(Vn)*jr(Vn+Mt*gn)-Zn(Vn))/Xt}function $r(gn){return 1-Math.pow(1-gn,1.5)}var uc=Date.now(),ms=(pi(1)-Vn)/Mt,hc=T.duration?1e3*T.duration:1e3*ms*.8;function so(){var gn=(Date.now()-uc)/hc,ra=$r(gn)*ms;gn<=1?(this._flyToFrame=re(so,this),this._move(this.unproject(A.add(F.subtract(A).multiplyBy(na(ra)/ut)),xe),this.getScaleZoom(je/qi(ra),xe),{flyTo:!0})):this._move(c,g)._moveEnd(!0)}return this._moveStart(!0,T.noMoveStart),so.call(this),this},flyToBounds:function(c,g){var T=this._getBoundsCenterZoom(c,g);return this.flyTo(T.center,T.zoom,g)},setMaxBounds:function(c){return c=Et(c),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),c.isValid()?(this.options.maxBounds=c,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(c){var g=this.options.minZoom;return this.options.minZoom=c,this._loaded&&g!==c&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(c):this},setMaxZoom:function(c){var g=this.options.maxZoom;return this.options.maxZoom=c,this._loaded&&g!==c&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(c):this},panInsideBounds:function(c,g){this._enforcingBounds=!0;var T=this.getCenter(),A=this._limitCenter(T,this._zoom,Et(c));return T.equals(A)||this.panTo(A,g),this._enforcingBounds=!1,this},panInside:function(c,g){g=g||{};var T=Ee(g.paddingTopLeft||g.padding||[0,0]),A=Ee(g.paddingBottomRight||g.padding||[0,0]),F=this.project(this.getCenter()),J=this.project(c),xe=this.getPixelBounds(),je=xt([xe.min.add(T),xe.max.subtract(A)]),Je=je.getSize();if(!je.contains(J)){this._enforcingBounds=!0;var ut=J.subtract(je.getCenter()),Mt=je.extend(J).getSize().subtract(Je);F.x+=ut.x<0?-Mt.x:Mt.x,F.y+=ut.y<0?-Mt.y:Mt.y,this.panTo(this.unproject(F),g),this._enforcingBounds=!1}return this},invalidateSize:function(c){if(!this._loaded)return this;c=l({animate:!1,pan:!0},c===!0?{animate:!0}:c);var g=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var T=this.getSize(),A=g.divideBy(2).round(),F=T.divideBy(2).round(),J=A.subtract(F);return!J.x&&!J.y?this:(c.animate&&c.pan?this.panBy(J):(c.pan&&this._rawPanBy(J),this.fire("move"),c.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(f(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:g,newSize:T}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(c){if(c=this._locateOptions=l({timeout:1e4,watch:!1},c),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var g=f(this._handleGeolocationResponse,this),T=f(this._handleGeolocationError,this);return c.watch?this._locationWatchId=navigator.geolocation.watchPosition(g,T,c):navigator.geolocation.getCurrentPosition(g,T,c),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(c){if(this._container._leaflet_id){var g=c.code,T=c.message||(g===1?"permission denied":g===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:g,message:"Geolocation error: "+T+"."})}},_handleGeolocationResponse:function(c){if(this._container._leaflet_id){var g=c.coords.latitude,T=c.coords.longitude,A=new St(g,T),F=A.toBounds(c.coords.accuracy*2),J=this._locateOptions;if(J.setView){var xe=this.getBoundsZoom(F);this.setView(A,J.maxZoom?Math.min(xe,J.maxZoom):xe)}var je={latlng:A,bounds:F,timestamp:c.timestamp};for(var Je in c.coords)typeof c.coords[Je]=="number"&&(je[Je]=c.coords[Je]);this.fire("locationfound",je)}},addHandler:function(c,g){if(!g)return this;var T=this[c]=new g(this);return this._handlers.push(T),this.options[c]&&T.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),Ai(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(ce(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var c;for(c in this._layers)this._layers[c].remove();for(c in this._panes)Ai(this._panes[c]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(c,g){var T="leaflet-pane"+(c?" leaflet-"+c.replace("Pane","")+"-pane":""),A=yi("div",T,g||this._mapPane);return c&&(this._panes[c]=A),A},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var c=this.getPixelBounds(),g=this.unproject(c.getBottomLeft()),T=this.unproject(c.getTopRight());return new Tt(g,T)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(c,g,T){c=Et(c),T=Ee(T||[0,0]);var A=this.getZoom()||0,F=this.getMinZoom(),J=this.getMaxZoom(),xe=c.getNorthWest(),je=c.getSouthEast(),Je=this.getSize().subtract(T),ut=xt(this.project(je,A),this.project(xe,A)).getSize(),Mt=ft.any3d?this.options.zoomSnap:1,Xt=Je.x/ut.x,pi=Je.y/ut.y,Zn=g?Math.max(Xt,pi):Math.min(Xt,pi);return A=this.getScaleZoom(Zn,A),Mt&&(A=Math.round(A/(Mt/100))*(Mt/100),A=g?Math.ceil(A/Mt)*Mt:Math.floor(A/Mt)*Mt),Math.max(F,Math.min(J,A))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new ge(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(c,g){var T=this._getTopLeftPoint(c,g);return new qe(T,T.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(c){return this.options.crs.getProjectedBounds(c===void 0?this.getZoom():c)},getPane:function(c){return typeof c=="string"?this._panes[c]:c},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(c,g){var T=this.options.crs;return g=g===void 0?this._zoom:g,T.scale(c)/T.scale(g)},getScaleZoom:function(c,g){var T=this.options.crs;g=g===void 0?this._zoom:g;var A=T.zoom(c*T.scale(g));return isNaN(A)?1/0:A},project:function(c,g){return g=g===void 0?this._zoom:g,this.options.crs.latLngToPoint(zt(c),g)},unproject:function(c,g){return g=g===void 0?this._zoom:g,this.options.crs.pointToLatLng(Ee(c),g)},layerPointToLatLng:function(c){var g=Ee(c).add(this.getPixelOrigin());return this.unproject(g)},latLngToLayerPoint:function(c){var g=this.project(zt(c))._round();return g._subtract(this.getPixelOrigin())},wrapLatLng:function(c){return this.options.crs.wrapLatLng(zt(c))},wrapLatLngBounds:function(c){return this.options.crs.wrapLatLngBounds(Et(c))},distance:function(c,g){return this.options.crs.distance(zt(c),zt(g))},containerPointToLayerPoint:function(c){return Ee(c).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(c){return Ee(c).add(this._getMapPanePos())},containerPointToLatLng:function(c){var g=this.containerPointToLayerPoint(Ee(c));return this.layerPointToLatLng(g)},latLngToContainerPoint:function(c){return this.layerPointToContainerPoint(this.latLngToLayerPoint(zt(c)))},mouseEventToContainerPoint:function(c){return zs(c,this._container)},mouseEventToLayerPoint:function(c){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(c))},mouseEventToLatLng:function(c){return this.layerPointToLatLng(this.mouseEventToLayerPoint(c))},_initContainer:function(c){var g=this._container=Lo(c);if(g){if(g._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");Ut(g,"scroll",this._onScroll,this),this._containerId=P(g)},_initLayout:function(){var c=this._container;this._fadeAnimated=this.options.fadeAnimation&&ft.any3d,hi(c,"leaflet-container"+(ft.touch?" leaflet-touch":"")+(ft.retina?" leaflet-retina":"")+(ft.ielt9?" leaflet-oldie":"")+(ft.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var g=Ao(c,"position");g!=="absolute"&&g!=="relative"&&g!=="fixed"&&g!=="sticky"&&(c.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var c=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),an(this._mapPane,new ge(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(hi(c.markerPane,"leaflet-zoom-hide"),hi(c.shadowPane,"leaflet-zoom-hide"))},_resetView:function(c,g,T){an(this._mapPane,new ge(0,0));var A=!this._loaded;this._loaded=!0,g=this._limitZoom(g),this.fire("viewprereset");var F=this._zoom!==g;this._moveStart(F,T)._move(c,g)._moveEnd(F),this.fire("viewreset"),A&&this.fire("load")},_moveStart:function(c,g){return c&&this.fire("zoomstart"),g||this.fire("movestart"),this},_move:function(c,g,T,A){g===void 0&&(g=this._zoom);var F=this._zoom!==g;return this._zoom=g,this._lastCenter=c,this._pixelOrigin=this._getNewPixelOrigin(c),A?T&&T.pinch&&this.fire("zoom",T):((F||T&&T.pinch)&&this.fire("zoom",T),this.fire("move",T)),this},_moveEnd:function(c){return c&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return ce(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(c){an(this._mapPane,this._getMapPanePos().subtract(c))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(c){this._targets={},this._targets[P(this._container)]=this;var g=c?Di:Ut;g(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&g(window,"resize",this._onResize,this),ft.any3d&&this.options.transform3DLimit&&(c?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){ce(this._resizeRequest),this._resizeRequest=re(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var c=this._getMapPanePos();Math.max(Math.abs(c.x),Math.abs(c.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(c,g){for(var T=[],A,F=g==="mouseout"||g==="mouseover",J=c.target||c.srcElement,xe=!1;J;){if(A=this._targets[P(J)],A&&(g==="click"||g==="preclick")&&this._draggableMoved(A)){xe=!0;break}if(A&&A.listens(g,!0)&&(F&&!Rs(J,c)||(T.push(A),F))||J===this._container)break;J=J.parentNode}return!T.length&&!xe&&!F&&this.listens(g,!0)&&(T=[this]),T},_isClickDisabled:function(c){for(;c&&c!==this._container;){if(c._leaflet_disable_click)return!0;c=c.parentNode}},_handleDOMEvent:function(c){var g=c.target||c.srcElement;if(!(!this._loaded||g._leaflet_disable_events||c.type==="click"&&this._isClickDisabled(g))){var T=c.type;T==="mousedown"&&Ta(g),this._fireDOMEvent(c,T)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(c,g,T){if(c.type==="click"){var A=l({},c);A.type="preclick",this._fireDOMEvent(A,A.type,T)}var F=this._findEventTargets(c,g);if(T){for(var J=[],xe=0;xe<T.length;xe++)T[xe].listens(g,!0)&&J.push(T[xe]);F=J.concat(F)}if(F.length){g==="contextmenu"&&Bt(c);var je=F[0],Je={originalEvent:c};if(c.type!=="keypress"&&c.type!=="keydown"&&c.type!=="keyup"){var ut=je.getLatLng&&(!je._radius||je._radius<=10);Je.containerPoint=ut?this.latLngToContainerPoint(je.getLatLng()):this.mouseEventToContainerPoint(c),Je.layerPoint=this.containerPointToLayerPoint(Je.containerPoint),Je.latlng=ut?je.getLatLng():this.layerPointToLatLng(Je.layerPoint)}for(xe=0;xe<F.length;xe++)if(F[xe].fire(g,Je,!0),Je.originalEvent._stopped||F[xe].options.bubblingMouseEvents===!1&&Se(this._mouseEvents,g)!==-1)return}},_draggableMoved:function(c){return c=c.dragging&&c.dragging.enabled()?c:this,c.dragging&&c.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var c=0,g=this._handlers.length;c<g;c++)this._handlers[c].disable()},whenReady:function(c,g){return this._loaded?c.call(g||this,{target:this}):this.on("load",c,g),this},_getMapPanePos:function(){return oo(this._mapPane)||new ge(0,0)},_moved:function(){var c=this._getMapPanePos();return c&&!c.equals([0,0])},_getTopLeftPoint:function(c,g){var T=c&&g!==void 0?this._getNewPixelOrigin(c,g):this.getPixelOrigin();return T.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(c,g){var T=this.getSize()._divideBy(2);return this.project(c,g)._subtract(T)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(c,g,T){var A=this._getNewPixelOrigin(T,g);return this.project(c,g)._subtract(A)},_latLngBoundsToNewLayerBounds:function(c,g,T){var A=this._getNewPixelOrigin(T,g);return xt([this.project(c.getSouthWest(),g)._subtract(A),this.project(c.getNorthWest(),g)._subtract(A),this.project(c.getSouthEast(),g)._subtract(A),this.project(c.getNorthEast(),g)._subtract(A)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(c){return this.latLngToLayerPoint(c).subtract(this._getCenterLayerPoint())},_limitCenter:function(c,g,T){if(!T)return c;var A=this.project(c,g),F=this.getSize().divideBy(2),J=new qe(A.subtract(F),A.add(F)),xe=this._getBoundsOffset(J,T,g);return Math.abs(xe.x)<=1&&Math.abs(xe.y)<=1?c:this.unproject(A.add(xe),g)},_limitOffset:function(c,g){if(!g)return c;var T=this.getPixelBounds(),A=new qe(T.min.add(c),T.max.add(c));return c.add(this._getBoundsOffset(A,g))},_getBoundsOffset:function(c,g,T){var A=xt(this.project(g.getNorthEast(),T),this.project(g.getSouthWest(),T)),F=A.min.subtract(c.min),J=A.max.subtract(c.max),xe=this._rebound(F.x,-J.x),je=this._rebound(F.y,-J.y);return new ge(xe,je)},_rebound:function(c,g){return c+g>0?Math.round(c-g)/2:Math.max(0,Math.ceil(c))-Math.max(0,Math.floor(g))},_limitZoom:function(c){var g=this.getMinZoom(),T=this.getMaxZoom(),A=ft.any3d?this.options.zoomSnap:1;return A&&(c=Math.round(c/A)*A),Math.max(g,Math.min(T,c))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){pn(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(c,g){var T=this._getCenterOffset(c)._trunc();return(g&&g.animate)!==!0&&!this.getSize().contains(T)?!1:(this.panBy(T,g),!0)},_createAnimProxy:function(){var c=this._proxy=yi("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(c),this.on("zoomanim",function(g){var T=Eo,A=this._proxy.style[T];xa(this._proxy,this.project(g.center,g.zoom),this.getZoomScale(g.zoom,1)),A===this._proxy.style[T]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){Ai(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var c=this.getCenter(),g=this.getZoom();xa(this._proxy,this.project(c,g),this.getZoomScale(g,1))},_catchTransitionEnd:function(c){this._animatingZoom&&c.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(c,g,T){if(this._animatingZoom)return!0;if(T=T||{},!this._zoomAnimated||T.animate===!1||this._nothingToAnimate()||Math.abs(g-this._zoom)>this.options.zoomAnimationThreshold)return!1;var A=this.getZoomScale(g),F=this._getCenterOffset(c)._divideBy(1-1/A);return T.animate!==!0&&!this.getSize().contains(F)?!1:(re(function(){this._moveStart(!0,T.noMoveStart||!1)._animateZoom(c,g,!0)},this),!0)},_animateZoom:function(c,g,T,A){this._mapPane&&(T&&(this._animatingZoom=!0,this._animateToCenter=c,this._animateToZoom=g,hi(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:c,zoom:g,noUpdate:A}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(f(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&pn(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function Xl(c,g){return new xi(c,g)}var Mr=de.extend({options:{position:"topright"},initialize:function(c){ue(this,c)},getPosition:function(){return this.options.position},setPosition:function(c){var g=this._map;return g&&g.removeControl(this),this.options.position=c,g&&g.addControl(this),this},getContainer:function(){return this._container},addTo:function(c){this.remove(),this._map=c;var g=this._container=this.onAdd(c),T=this.getPosition(),A=c._controlCorners[T];return hi(g,"leaflet-control"),T.indexOf("bottom")!==-1?A.insertBefore(g,A.firstChild):A.appendChild(g),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(Ai(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(c){this._map&&c&&c.screenX>0&&c.screenY>0&&this._map.getContainer().focus()}}),Do=function(c){return new Mr(c)};xi.include({addControl:function(c){return c.addTo(this),this},removeControl:function(c){return c.remove(),this},_initControlPos:function(){var c=this._controlCorners={},g="leaflet-",T=this._controlContainer=yi("div",g+"control-container",this._container);function A(F,J){var xe=g+F+" "+g+J;c[F+J]=yi("div",xe,T)}A("top","left"),A("top","right"),A("bottom","left"),A("bottom","right")},_clearControlPos:function(){for(var c in this._controlCorners)Ai(this._controlCorners[c]);Ai(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var ea=Mr.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(c,g,T,A){return T<A?-1:A<T?1:0}},initialize:function(c,g,T){ue(this,T),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var A in c)this._addLayer(c[A],A);for(A in g)this._addLayer(g[A],A,!0)},onAdd:function(c){this._initLayout(),this._update(),this._map=c,c.on("zoomend",this._checkDisabledLayers,this);for(var g=0;g<this._layers.length;g++)this._layers[g].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(c){return Mr.prototype.addTo.call(this,c),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var c=0;c<this._layers.length;c++)this._layers[c].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(c,g){return this._addLayer(c,g),this._map?this._update():this},addOverlay:function(c,g){return this._addLayer(c,g,!0),this._map?this._update():this},removeLayer:function(c){c.off("add remove",this._onLayerChange,this);var g=this._getLayer(P(c));return g&&this._layers.splice(this._layers.indexOf(g),1),this._map?this._update():this},expand:function(){hi(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var c=this._map.getSize().y-(this._container.offsetTop+50);return c<this._section.clientHeight?(hi(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=c+"px"):pn(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return pn(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var c="leaflet-control-layers",g=this._container=yi("div",c),T=this.options.collapsed;g.setAttribute("aria-haspopup",!0),si(g),Ji(g);var A=this._section=yi("section",c+"-list");T&&(this._map.on("click",this.collapse,this),Ut(g,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var F=this._layersLink=yi("a",c+"-toggle",g);F.href="#",F.title="Layers",F.setAttribute("role","button"),Ut(F,{keydown:function(J){J.keyCode===13&&this._expandSafely()},click:function(J){Bt(J),this._expandSafely()}},this),T||this.expand(),this._baseLayersList=yi("div",c+"-base",A),this._separator=yi("div",c+"-separator",A),this._overlaysList=yi("div",c+"-overlays",A),g.appendChild(A)},_getLayer:function(c){for(var g=0;g<this._layers.length;g++)if(this._layers[g]&&P(this._layers[g].layer)===c)return this._layers[g]},_addLayer:function(c,g,T){this._map&&c.on("add remove",this._onLayerChange,this),this._layers.push({layer:c,name:g,overlay:T}),this.options.sortLayers&&this._layers.sort(f(function(A,F){return this.options.sortFunction(A.layer,F.layer,A.name,F.name)},this)),this.options.autoZIndex&&c.setZIndex&&(this._lastZIndex++,c.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;mn(this._baseLayersList),mn(this._overlaysList),this._layerControlInputs=[];var c,g,T,A,F=0;for(T=0;T<this._layers.length;T++)A=this._layers[T],this._addItem(A),g=g||A.overlay,c=c||!A.overlay,F+=A.overlay?0:1;return this.options.hideSingleBase&&(c=c&&F>1,this._baseLayersList.style.display=c?"":"none"),this._separator.style.display=g&&c?"":"none",this},_onLayerChange:function(c){this._handlingClick||this._update();var g=this._getLayer(P(c.target)),T=g.overlay?c.type==="add"?"overlayadd":"overlayremove":c.type==="add"?"baselayerchange":null;T&&this._map.fire(T,g)},_createRadioElement:function(c,g){var T='<input type="radio" class="leaflet-control-layers-selector" name="'+c+'"'+(g?' checked="checked"':"")+"/>",A=document.createElement("div");return A.innerHTML=T,A.firstChild},_addItem:function(c){var g=document.createElement("label"),T=this._map.hasLayer(c.layer),A;c.overlay?(A=document.createElement("input"),A.type="checkbox",A.className="leaflet-control-layers-selector",A.defaultChecked=T):A=this._createRadioElement("leaflet-base-layers_"+P(this),T),this._layerControlInputs.push(A),A.layerId=P(c.layer),Ut(A,"click",this._onInputClick,this);var F=document.createElement("span");F.innerHTML=" "+c.name;var J=document.createElement("span");g.appendChild(J),J.appendChild(A),J.appendChild(F);var xe=c.overlay?this._overlaysList:this._baseLayersList;return xe.appendChild(g),this._checkDisabledLayers(),g},_onInputClick:function(){if(!this._preventClick){var c=this._layerControlInputs,g,T,A=[],F=[];this._handlingClick=!0;for(var J=c.length-1;J>=0;J--)g=c[J],T=this._getLayer(g.layerId).layer,g.checked?A.push(T):g.checked||F.push(T);for(J=0;J<F.length;J++)this._map.hasLayer(F[J])&&this._map.removeLayer(F[J]);for(J=0;J<A.length;J++)this._map.hasLayer(A[J])||this._map.addLayer(A[J]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var c=this._layerControlInputs,g,T,A=this._map.getZoom(),F=c.length-1;F>=0;F--)g=c[F],T=this._getLayer(g.layerId).layer,g.disabled=T.options.minZoom!==void 0&&A<T.options.minZoom||T.options.maxZoom!==void 0&&A>T.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var c=this._section;this._preventClick=!0,Ut(c,"click",Bt),this.expand();var g=this;setTimeout(function(){Di(c,"click",Bt),g._preventClick=!1})}}),$n=function(c,g,T){return new ea(c,g,T)},Bo=Mr.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(c){var g="leaflet-control-zoom",T=yi("div",g+" leaflet-bar"),A=this.options;return this._zoomInButton=this._createButton(A.zoomInText,A.zoomInTitle,g+"-in",T,this._zoomIn),this._zoomOutButton=this._createButton(A.zoomOutText,A.zoomOutTitle,g+"-out",T,this._zoomOut),this._updateDisabled(),c.on("zoomend zoomlevelschange",this._updateDisabled,this),T},onRemove:function(c){c.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(c){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(c.shiftKey?3:1))},_zoomOut:function(c){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(c.shiftKey?3:1))},_createButton:function(c,g,T,A,F){var J=yi("a",T,A);return J.innerHTML=c,J.href="#",J.title=g,J.setAttribute("role","button"),J.setAttribute("aria-label",g),si(J),Ut(J,"click",Wr),Ut(J,"click",F,this),Ut(J,"click",this._refocusOnMap,this),J},_updateDisabled:function(){var c=this._map,g="leaflet-disabled";pn(this._zoomInButton,g),pn(this._zoomOutButton,g),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||c._zoom===c.getMinZoom())&&(hi(this._zoomOutButton,g),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||c._zoom===c.getMaxZoom())&&(hi(this._zoomInButton,g),this._zoomInButton.setAttribute("aria-disabled","true"))}});xi.mergeOptions({zoomControl:!0}),xi.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new Bo,this.addControl(this.zoomControl))});var Bs=function(c){return new Bo(c)},Oo=Mr.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(c){var g="leaflet-control-scale",T=yi("div",g),A=this.options;return this._addScales(A,g+"-line",T),c.on(A.updateWhenIdle?"moveend":"move",this._update,this),c.whenReady(this._update,this),T},onRemove:function(c){c.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(c,g,T){c.metric&&(this._mScale=yi("div",g,T)),c.imperial&&(this._iScale=yi("div",g,T))},_update:function(){var c=this._map,g=c.getSize().y/2,T=c.distance(c.containerPointToLatLng([0,g]),c.containerPointToLatLng([this.options.maxWidth,g]));this._updateScales(T)},_updateScales:function(c){this.options.metric&&c&&this._updateMetric(c),this.options.imperial&&c&&this._updateImperial(c)},_updateMetric:function(c){var g=this._getRoundNum(c),T=g<1e3?g+" m":g/1e3+" km";this._updateScale(this._mScale,T,g/c)},_updateImperial:function(c){var g=c*3.2808399,T,A,F;g>5280?(T=g/5280,A=this._getRoundNum(T),this._updateScale(this._iScale,A+" mi",A/T)):(F=this._getRoundNum(g),this._updateScale(this._iScale,F+" ft",F/g))},_updateScale:function(c,g,T){c.style.width=Math.round(this.options.maxWidth*T)+"px",c.innerHTML=g},_getRoundNum:function(c){var g=Math.pow(10,(Math.floor(c)+"").length-1),T=c/g;return T=T>=10?10:T>=5?5:T>=3?3:T>=2?2:1,g*T}}),Un=function(c){return new Oo(c)},ml='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',ts=Mr.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(ft.inlineSvg?ml+" ":"")+"Leaflet</a>"},initialize:function(c){ue(this,c),this._attributions={}},onAdd:function(c){c.attributionControl=this,this._container=yi("div","leaflet-control-attribution"),si(this._container);for(var g in c._layers)c._layers[g].getAttribution&&this.addAttribution(c._layers[g].getAttribution());return this._update(),c.on("layeradd",this._addAttribution,this),this._container},onRemove:function(c){c.off("layeradd",this._addAttribution,this)},_addAttribution:function(c){c.layer.getAttribution&&(this.addAttribution(c.layer.getAttribution()),c.layer.once("remove",function(){this.removeAttribution(c.layer.getAttribution())},this))},setPrefix:function(c){return this.options.prefix=c,this._update(),this},addAttribution:function(c){return c?(this._attributions[c]||(this._attributions[c]=0),this._attributions[c]++,this._update(),this):this},removeAttribution:function(c){return c?(this._attributions[c]&&(this._attributions[c]--,this._update()),this):this},_update:function(){if(this._map){var c=[];for(var g in this._attributions)this._attributions[g]&&c.push(g);var T=[];this.options.prefix&&T.push(this.options.prefix),c.length&&T.push(c.join(", ")),this._container.innerHTML=T.join(' <span aria-hidden="true">|</span> ')}}});xi.mergeOptions({attributionControl:!0}),xi.addInitHook(function(){this.options.attributionControl&&new ts().addTo(this)});var Wc=function(c){return new ts(c)};Mr.Layers=ea,Mr.Zoom=Bo,Mr.Scale=Oo,Mr.Attribution=ts,Do.layers=$n,Do.zoom=Bs,Do.scale=Un,Do.attribution=Wc;var _o=de.extend({initialize:function(c){this._map=c},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});_o.addTo=function(c,g){return c.addHandler(g,this),this};var hr={Events:Ae},is=ft.touch?"touchstart mousedown":"mousedown",tr=Ce.extend({options:{clickTolerance:3},initialize:function(c,g,T,A){ue(this,A),this._element=c,this._dragStartTarget=g||c,this._preventOutline=T},enable:function(){this._enabled||(Ut(this._dragStartTarget,is,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(tr._dragging===this&&this.finishDrag(!0),Di(this._dragStartTarget,is,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(c){if(this._enabled&&(this._moved=!1,!Kl(this._element,"leaflet-zoom-anim"))){if(c.touches&&c.touches.length!==1){tr._dragging===this&&this.finishDrag();return}if(!(tr._dragging||c.shiftKey||c.which!==1&&c.button!==1&&!c.touches)&&(tr._dragging=this,this._preventOutline&&Ta(this._element),er(),ba(),!this._moving)){this.fire("down");var g=c.touches?c.touches[0]:c,T=yr(this._element);this._startPoint=new ge(g.clientX,g.clientY),this._startPos=oo(this._element),this._parentScale=On(T);var A=c.type==="mousedown";Ut(document,A?"mousemove":"touchmove",this._onMove,this),Ut(document,A?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(c){if(this._enabled){if(c.touches&&c.touches.length>1){this._moved=!0;return}var g=c.touches&&c.touches.length===1?c.touches[0]:c,T=new ge(g.clientX,g.clientY)._subtract(this._startPoint);!T.x&&!T.y||Math.abs(T.x)+Math.abs(T.y)<this.options.clickTolerance||(T.x/=this._parentScale.x,T.y/=this._parentScale.y,Bt(c),this._moved||(this.fire("dragstart"),this._moved=!0,hi(document.body,"leaflet-dragging"),this._lastTarget=c.target||c.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),hi(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(T),this._moving=!0,this._lastEvent=c,this._updatePosition())}},_updatePosition:function(){var c={originalEvent:this._lastEvent};this.fire("predrag",c),an(this._element,this._newPos),this.fire("drag",c)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(c){pn(document.body,"leaflet-dragging"),this._lastTarget&&(pn(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),Di(document,"mousemove touchmove",this._onMove,this),Di(document,"mouseup touchend touchcancel",this._onUp,this),zo(),Bn();var g=this._moved&&this._moving;this._moving=!1,tr._dragging=!1,g&&this.fire("dragend",{noInertia:c,distance:this._newPos.distanceTo(this._startPos)})}});function ta(c,g,T){var A,F=[1,4,2,8],J,xe,je,Je,ut,Mt,Xt,pi;for(J=0,Mt=c.length;J<Mt;J++)c[J]._code=yo(c[J],g);for(je=0;je<4;je++){for(Xt=F[je],A=[],J=0,Mt=c.length,xe=Mt-1;J<Mt;xe=J++)Je=c[J],ut=c[xe],Je._code&Xt?ut._code&Xt||(pi=Ia(ut,Je,Xt,g,T),pi._code=yo(pi,g),A.push(pi)):(ut._code&Xt&&(pi=Ia(ut,Je,Xt,g,T),pi._code=yo(pi,g),A.push(pi)),A.push(Je));c=A}return c}function ns(c,g){var T,A,F,J,xe,je,Je,ut,Mt;if(!c||c.length===0)throw new Error("latlngs not passed");Or(c)||(console.warn("latlngs are not flat! Only the first ring will be used"),c=c[0]);var Xt=zt([0,0]),pi=Et(c),Zn=pi.getNorthWest().distanceTo(pi.getSouthWest())*pi.getNorthEast().distanceTo(pi.getNorthWest());Zn<1700&&(Xt=Cr(c));var Pn=c.length,jr=[];for(T=0;T<Pn;T++){var Vn=zt(c[T]);jr.push(g.project(zt([Vn.lat-Xt.lat,Vn.lng-Xt.lng])))}for(je=Je=ut=0,T=0,A=Pn-1;T<Pn;A=T++)F=jr[T],J=jr[A],xe=F.y*J.x-J.y*F.x,Je+=(F.x+J.x)*xe,ut+=(F.y+J.y)*xe,je+=xe*3;je===0?Mt=jr[0]:Mt=[Je/je,ut/je];var qi=g.unproject(Ee(Mt));return zt([qi.lat+Xt.lat,qi.lng+Xt.lng])}function Cr(c){for(var g=0,T=0,A=0,F=0;F<c.length;F++){var J=zt(c[F]);g+=J.lat,T+=J.lng,A++}return zt([g/A,T/A])}var Ma={__proto__:null,clipPolygon:ta,polygonCenter:ns,centroid:Cr};function Os(c,g){if(!g||!c.length)return c.slice();var T=g*g;return c=th(c,T),c=eh(c,T),c}function Hc(c,g,T){return Math.sqrt(Ir(c,g,T,!0))}function Yl(c,g,T){return Ir(c,g,T)}function eh(c,g){var T=c.length,A=typeof Uint8Array<"u"?Uint8Array:Array,F=new A(T);F[0]=F[T-1]=1,Jl(c,F,g,0,T-1);var J,xe=[];for(J=0;J<T;J++)F[J]&&xe.push(c[J]);return xe}function Jl(c,g,T,A,F){var J=0,xe,je,Je;for(je=A+1;je<=F-1;je++)Je=Ir(c[je],c[A],c[F],!0),Je>J&&(xe=je,J=Je);J>T&&(g[xe]=1,Jl(c,g,T,A,xe),Jl(c,g,T,xe,F))}function th(c,g){for(var T=[c[0]],A=1,F=0,J=c.length;A<J;A++)gl(c[A],c[F])>g&&(T.push(c[A]),F=A);return F<J-1&&T.push(c[J-1]),T}var Fs;function Ca(c,g,T,A,F){var J=A?Fs:yo(c,T),xe=yo(g,T),je,Je,ut;for(Fs=xe;;){if(!(J|xe))return[c,g];if(J&xe)return!1;je=J||xe,Je=Ia(c,g,je,T,F),ut=yo(Je,T),je===J?(c=Je,J=ut):(g=Je,xe=ut)}}function Ia(c,g,T,A,F){var J=g.x-c.x,xe=g.y-c.y,je=A.min,Je=A.max,ut,Mt;return T&8?(ut=c.x+J*(Je.y-c.y)/xe,Mt=Je.y):T&4?(ut=c.x+J*(je.y-c.y)/xe,Mt=je.y):T&2?(ut=Je.x,Mt=c.y+xe*(Je.x-c.x)/J):T&1&&(ut=je.x,Mt=c.y+xe*(je.x-c.x)/J),new ge(ut,Mt,F)}function yo(c,g){var T=0;return c.x<g.min.x?T|=1:c.x>g.max.x&&(T|=2),c.y<g.min.y?T|=4:c.y>g.max.y&&(T|=8),T}function gl(c,g){var T=g.x-c.x,A=g.y-c.y;return T*T+A*A}function Ir(c,g,T,A){var F=g.x,J=g.y,xe=T.x-F,je=T.y-J,Je=xe*xe+je*je,ut;return Je>0&&(ut=((c.x-F)*xe+(c.y-J)*je)/Je,ut>1?(F=T.x,J=T.y):ut>0&&(F+=xe*ut,J+=je*ut)),xe=c.x-F,je=c.y-J,A?xe*xe+je*je:new ge(F,J)}function Or(c){return!Ve(c[0])||typeof c[0][0]!="object"&&typeof c[0][0]<"u"}function _l(c){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),Or(c)}function rs(c,g){var T,A,F,J,xe,je,Je,ut;if(!c||c.length===0)throw new Error("latlngs not passed");Or(c)||(console.warn("latlngs are not flat! Only the first ring will be used"),c=c[0]);var Mt=zt([0,0]),Xt=Et(c),pi=Xt.getNorthWest().distanceTo(Xt.getSouthWest())*Xt.getNorthEast().distanceTo(Xt.getNorthWest());pi<1700&&(Mt=Cr(c));var Zn=c.length,Pn=[];for(T=0;T<Zn;T++){var jr=zt(c[T]);Pn.push(g.project(zt([jr.lat-Mt.lat,jr.lng-Mt.lng])))}for(T=0,A=0;T<Zn-1;T++)A+=Pn[T].distanceTo(Pn[T+1])/2;if(A===0)ut=Pn[0];else for(T=0,J=0;T<Zn-1;T++)if(xe=Pn[T],je=Pn[T+1],F=xe.distanceTo(je),J+=F,J>A){Je=(J-A)/F,ut=[je.x-Je*(je.x-xe.x),je.y-Je*(je.y-xe.y)];break}var Vn=g.unproject(Ee(ut));return zt([Vn.lat+Mt.lat,Vn.lng+Mt.lng])}var Ns={__proto__:null,simplify:Os,pointToSegmentDistance:Hc,closestPointOnSegment:Yl,clipSegment:Ca,_getEdgeIntersection:Ia,_getBitCode:yo,_sqClosestPointOnSegment:Ir,isFlat:Or,_flat:_l,polylineCenter:rs},Ql={project:function(c){return new ge(c.lng,c.lat)},unproject:function(c){return new St(c.y,c.x)},bounds:new qe([-180,-90],[180,90])},os={R:6378137,R_MINOR:6356752314245179e-9,bounds:new qe([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(c){var g=Math.PI/180,T=this.R,A=c.lat*g,F=this.R_MINOR/T,J=Math.sqrt(1-F*F),xe=J*Math.sin(A),je=Math.tan(Math.PI/4-A/2)/Math.pow((1-xe)/(1+xe),J/2);return A=-T*Math.log(Math.max(je,1e-10)),new ge(c.lng*g*T,A)},unproject:function(c){for(var g=180/Math.PI,T=this.R,A=this.R_MINOR/T,F=Math.sqrt(1-A*A),J=Math.exp(-c.y/T),xe=Math.PI/2-2*Math.atan(J),je=0,Je=.1,ut;je<15&&Math.abs(Je)>1e-7;je++)ut=F*Math.sin(xe),ut=Math.pow((1-ut)/(1+ut),F/2),Je=Math.PI/2-2*Math.atan(J*ut)-xe,xe+=Je;return new St(xe*g,c.x*g/T)}},Kc={__proto__:null,LonLat:Ql,Mercator:os,SphericalMercator:Jn},Ea=l({},Qt,{code:"EPSG:3395",projection:os,transformation:function(){var c=.5/(Math.PI*os.R);return Yi(c,.5,-c,.5)}()}),ec=l({},Qt,{code:"EPSG:4326",projection:Ql,transformation:Yi(1/180,1,-1/180,.5)}),Xc=l({},Ft,{projection:Ql,transformation:Yi(1,0,-1,0),scale:function(c){return Math.pow(2,c)},zoom:function(c){return Math.log(c)/Math.LN2},distance:function(c,g){var T=g.lng-c.lng,A=g.lat-c.lat;return Math.sqrt(T*T+A*A)},infinite:!0});Ft.Earth=Qt,Ft.EPSG3395=Ea,Ft.EPSG3857=Ri,Ft.EPSG900913=_i,Ft.EPSG4326=ec,Ft.Simple=Xc;var ao=Ce.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(c){return c.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(c){return c&&c.removeLayer(this),this},getPane:function(c){return this._map.getPane(c?this.options[c]||c:this.options.pane)},addInteractiveTarget:function(c){return this._map._targets[P(c)]=this,this},removeInteractiveTarget:function(c){return delete this._map._targets[P(c)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(c){var g=c.target;if(g.hasLayer(this)){if(this._map=g,this._zoomAnimated=g._zoomAnimated,this.getEvents){var T=this.getEvents();g.on(T,this),this.once("remove",function(){g.off(T,this)},this)}this.onAdd(g),this.fire("add"),g.fire("layeradd",{layer:this})}}});xi.include({addLayer:function(c){if(!c._layerAdd)throw new Error("The provided object is not a Layer.");var g=P(c);return this._layers[g]?this:(this._layers[g]=c,c._mapToAdd=this,c.beforeAdd&&c.beforeAdd(this),this.whenReady(c._layerAdd,c),this)},removeLayer:function(c){var g=P(c);return this._layers[g]?(this._loaded&&c.onRemove(this),delete this._layers[g],this._loaded&&(this.fire("layerremove",{layer:c}),c.fire("remove")),c._map=c._mapToAdd=null,this):this},hasLayer:function(c){return P(c)in this._layers},eachLayer:function(c,g){for(var T in this._layers)c.call(g,this._layers[T]);return this},_addLayers:function(c){c=c?Ve(c)?c:[c]:[];for(var g=0,T=c.length;g<T;g++)this.addLayer(c[g])},_addZoomLimit:function(c){(!isNaN(c.options.maxZoom)||!isNaN(c.options.minZoom))&&(this._zoomBoundLayers[P(c)]=c,this._updateZoomLevels())},_removeZoomLimit:function(c){var g=P(c);this._zoomBoundLayers[g]&&(delete this._zoomBoundLayers[g],this._updateZoomLevels())},_updateZoomLevels:function(){var c=1/0,g=-1/0,T=this._getZoomSpan();for(var A in this._zoomBoundLayers){var F=this._zoomBoundLayers[A].options;c=F.minZoom===void 0?c:Math.min(c,F.minZoom),g=F.maxZoom===void 0?g:Math.max(g,F.maxZoom)}this._layersMaxZoom=g===-1/0?void 0:g,this._layersMinZoom=c===1/0?void 0:c,T!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var La=ao.extend({initialize:function(c,g){ue(this,g),this._layers={};var T,A;if(c)for(T=0,A=c.length;T<A;T++)this.addLayer(c[T])},addLayer:function(c){var g=this.getLayerId(c);return this._layers[g]=c,this._map&&this._map.addLayer(c),this},removeLayer:function(c){var g=c in this._layers?c:this.getLayerId(c);return this._map&&this._layers[g]&&this._map.removeLayer(this._layers[g]),delete this._layers[g],this},hasLayer:function(c){var g=typeof c=="number"?c:this.getLayerId(c);return g in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(c){var g=Array.prototype.slice.call(arguments,1),T,A;for(T in this._layers)A=this._layers[T],A[c]&&A[c].apply(A,g);return this},onAdd:function(c){this.eachLayer(c.addLayer,c)},onRemove:function(c){this.eachLayer(c.removeLayer,c)},eachLayer:function(c,g){for(var T in this._layers)c.call(g,this._layers[T]);return this},getLayer:function(c){return this._layers[c]},getLayers:function(){var c=[];return this.eachLayer(c.push,c),c},setZIndex:function(c){return this.invoke("setZIndex",c)},getLayerId:function(c){return P(c)}}),js=function(c,g){return new La(c,g)},vo=La.extend({addLayer:function(c){return this.hasLayer(c)?this:(c.addEventParent(this),La.prototype.addLayer.call(this,c),this.fire("layeradd",{layer:c}))},removeLayer:function(c){return this.hasLayer(c)?(c in this._layers&&(c=this._layers[c]),c.removeEventParent(this),La.prototype.removeLayer.call(this,c),this.fire("layerremove",{layer:c})):this},setStyle:function(c){return this.invoke("setStyle",c)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var c=new Tt;for(var g in this._layers){var T=this._layers[g];c.extend(T.getBounds?T.getBounds():T.getLatLng())}return c}}),Yc=function(c,g){return new vo(c,g)},Aa=de.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(c){ue(this,c)},createIcon:function(c){return this._createIcon("icon",c)},createShadow:function(c){return this._createIcon("shadow",c)},_createIcon:function(c,g){var T=this._getIconUrl(c);if(!T){if(c==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var A=this._createImg(T,g&&g.tagName==="IMG"?g:null);return this._setIconStyles(A,c),(this.options.crossOrigin||this.options.crossOrigin==="")&&(A.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),A},_setIconStyles:function(c,g){var T=this.options,A=T[g+"Size"];typeof A=="number"&&(A=[A,A]);var F=Ee(A),J=Ee(g==="shadow"&&T.shadowAnchor||T.iconAnchor||F&&F.divideBy(2,!0));c.className="leaflet-marker-"+g+" "+(T.className||""),J&&(c.style.marginLeft=-J.x+"px",c.style.marginTop=-J.y+"px"),F&&(c.style.width=F.x+"px",c.style.height=F.y+"px")},_createImg:function(c,g){return g=g||document.createElement("img"),g.src=c,g},_getIconUrl:function(c){return ft.retina&&this.options[c+"RetinaUrl"]||this.options[c+"Url"]}});function tc(c){return new Aa(c)}var Hr=Aa.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(c){return typeof Hr.imagePath!="string"&&(Hr.imagePath=this._detectIconPath()),(this.options.imagePath||Hr.imagePath)+Aa.prototype._getIconUrl.call(this,c)},_stripUrl:function(c){var g=function(T,A,F){var J=A.exec(T);return J&&J[F]};return c=g(c,/^url\((['"])?(.+)\1\)$/,2),c&&g(c,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var c=yi("div","leaflet-default-icon-path",document.body),g=Ao(c,"background-image")||Ao(c,"backgroundImage");if(document.body.removeChild(c),g=this._stripUrl(g),g)return g;var T=document.querySelector('link[href$="leaflet.css"]');return T?T.href.substring(0,T.href.length-11-1):""}}),ic=_o.extend({initialize:function(c){this._marker=c},addHooks:function(){var c=this._marker._icon;this._draggable||(this._draggable=new tr(c,c,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),hi(c,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&pn(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(c){var g=this._marker,T=g._map,A=this._marker.options.autoPanSpeed,F=this._marker.options.autoPanPadding,J=oo(g._icon),xe=T.getPixelBounds(),je=T.getPixelOrigin(),Je=xt(xe.min._subtract(je).add(F),xe.max._subtract(je).subtract(F));if(!Je.contains(J)){var ut=Ee((Math.max(Je.max.x,J.x)-Je.max.x)/(xe.max.x-Je.max.x)-(Math.min(Je.min.x,J.x)-Je.min.x)/(xe.min.x-Je.min.x),(Math.max(Je.max.y,J.y)-Je.max.y)/(xe.max.y-Je.max.y)-(Math.min(Je.min.y,J.y)-Je.min.y)/(xe.min.y-Je.min.y)).multiplyBy(A);T.panBy(ut,{animate:!1}),this._draggable._newPos._add(ut),this._draggable._startPos._add(ut),an(g._icon,this._draggable._newPos),this._onDrag(c),this._panRequest=re(this._adjustPan.bind(this,c))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(c){this._marker.options.autoPan&&(ce(this._panRequest),this._panRequest=re(this._adjustPan.bind(this,c)))},_onDrag:function(c){var g=this._marker,T=g._shadow,A=oo(g._icon),F=g._map.layerPointToLatLng(A);T&&an(T,A),g._latlng=F,c.latlng=F,c.oldLatLng=this._oldLatLng,g.fire("move",c).fire("drag",c)},_onDragEnd:function(c){ce(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",c)}}),$s=ao.extend({options:{icon:new Hr,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(c,g){ue(this,g),this._latlng=zt(c)},onAdd:function(c){this._zoomAnimated=this._zoomAnimated&&c.options.markerZoomAnimation,this._zoomAnimated&&c.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(c){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&c.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(c){var g=this._latlng;return this._latlng=zt(c),this.update(),this.fire("move",{oldLatLng:g,latlng:this._latlng})},setZIndexOffset:function(c){return this.options.zIndexOffset=c,this.update()},getIcon:function(){return this.options.icon},setIcon:function(c){return this.options.icon=c,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var c=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(c)}return this},_initIcon:function(){var c=this.options,g="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),T=c.icon.createIcon(this._icon),A=!1;T!==this._icon&&(this._icon&&this._removeIcon(),A=!0,c.title&&(T.title=c.title),T.tagName==="IMG"&&(T.alt=c.alt||"")),hi(T,g),c.keyboard&&(T.tabIndex="0",T.setAttribute("role","button")),this._icon=T,c.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Ut(T,"focus",this._panOnFocus,this);var F=c.icon.createShadow(this._shadow),J=!1;F!==this._shadow&&(this._removeShadow(),J=!0),F&&(hi(F,g),F.alt=""),this._shadow=F,c.opacity<1&&this._updateOpacity(),A&&this.getPane().appendChild(this._icon),this._initInteraction(),F&&J&&this.getPane(c.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Di(this._icon,"focus",this._panOnFocus,this),Ai(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&Ai(this._shadow),this._shadow=null},_setPos:function(c){this._icon&&an(this._icon,c),this._shadow&&an(this._shadow,c),this._zIndex=c.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(c){this._icon&&(this._icon.style.zIndex=this._zIndex+c)},_animateZoom:function(c){var g=this._map._latLngToNewLayerPoint(this._latlng,c.zoom,c.center).round();this._setPos(g)},_initInteraction:function(){if(this.options.interactive&&(hi(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),ic)){var c=this.options.draggable;this.dragging&&(c=this.dragging.enabled(),this.dragging.disable()),this.dragging=new ic(this),c&&this.dragging.enable()}},setOpacity:function(c){return this.options.opacity=c,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var c=this.options.opacity;this._icon&&Br(this._icon,c),this._shadow&&Br(this._shadow,c)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var c=this._map;if(c){var g=this.options.icon.options,T=g.iconSize?Ee(g.iconSize):Ee(0,0),A=g.iconAnchor?Ee(g.iconAnchor):Ee(0,0);c.panInside(this._latlng,{paddingTopLeft:A,paddingBottomRight:T.subtract(A)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function as(c,g){return new $s(c,g)}var Fo=ao.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(c){this._renderer=c.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(c){return ue(this,c),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&c&&Object.prototype.hasOwnProperty.call(c,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),ka=Fo.extend({options:{fill:!0,radius:10},initialize:function(c,g){ue(this,g),this._latlng=zt(c),this._radius=this.options.radius},setLatLng:function(c){var g=this._latlng;return this._latlng=zt(c),this.redraw(),this.fire("move",{oldLatLng:g,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(c){return this.options.radius=this._radius=c,this.redraw()},getRadius:function(){return this._radius},setStyle:function(c){var g=c&&c.radius||this._radius;return Fo.prototype.setStyle.call(this,c),this.setRadius(g),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var c=this._radius,g=this._radiusY||c,T=this._clickTolerance(),A=[c+T,g+T];this._pxBounds=new qe(this._point.subtract(A),this._point.add(A))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(c){return c.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function ih(c,g){return new ka(c,g)}var nc=ka.extend({initialize:function(c,g,T){if(typeof g=="number"&&(g=l({},T,{radius:g})),ue(this,g),this._latlng=zt(c),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(c){return this._mRadius=c,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var c=[this._radius,this._radiusY||this._radius];return new Tt(this._map.layerPointToLatLng(this._point.subtract(c)),this._map.layerPointToLatLng(this._point.add(c)))},setStyle:Fo.prototype.setStyle,_project:function(){var c=this._latlng.lng,g=this._latlng.lat,T=this._map,A=T.options.crs;if(A.distance===Qt.distance){var F=Math.PI/180,J=this._mRadius/Qt.R/F,xe=T.project([g+J,c]),je=T.project([g-J,c]),Je=xe.add(je).divideBy(2),ut=T.unproject(Je).lat,Mt=Math.acos((Math.cos(J*F)-Math.sin(g*F)*Math.sin(ut*F))/(Math.cos(g*F)*Math.cos(ut*F)))/F;(isNaN(Mt)||Mt===0)&&(Mt=J/Math.cos(Math.PI/180*g)),this._point=Je.subtract(T.getPixelOrigin()),this._radius=isNaN(Mt)?0:Je.x-T.project([ut,c-Mt]).x,this._radiusY=Je.y-xe.y}else{var Xt=A.unproject(A.project(this._latlng).subtract([this._mRadius,0]));this._point=T.latLngToLayerPoint(this._latlng),this._radius=this._point.x-T.latLngToLayerPoint(Xt).x}this._updateBounds()}});function rc(c,g,T){return new nc(c,g,T)}var xo=Fo.extend({options:{smoothFactor:1,noClip:!1},initialize:function(c,g){ue(this,g),this._setLatLngs(c)},getLatLngs:function(){return this._latlngs},setLatLngs:function(c){return this._setLatLngs(c),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(c){for(var g=1/0,T=null,A=Ir,F,J,xe=0,je=this._parts.length;xe<je;xe++)for(var Je=this._parts[xe],ut=1,Mt=Je.length;ut<Mt;ut++){F=Je[ut-1],J=Je[ut];var Xt=A(c,F,J,!0);Xt<g&&(g=Xt,T=A(c,F,J))}return T&&(T.distance=Math.sqrt(g)),T},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return rs(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(c,g){return g=g||this._defaultShape(),c=zt(c),g.push(c),this._bounds.extend(c),this.redraw()},_setLatLngs:function(c){this._bounds=new Tt,this._latlngs=this._convertLatLngs(c)},_defaultShape:function(){return Or(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(c){for(var g=[],T=Or(c),A=0,F=c.length;A<F;A++)T?(g[A]=zt(c[A]),this._bounds.extend(g[A])):g[A]=this._convertLatLngs(c[A]);return g},_project:function(){var c=new qe;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,c),this._bounds.isValid()&&c.isValid()&&(this._rawPxBounds=c,this._updateBounds())},_updateBounds:function(){var c=this._clickTolerance(),g=new ge(c,c);this._rawPxBounds&&(this._pxBounds=new qe([this._rawPxBounds.min.subtract(g),this._rawPxBounds.max.add(g)]))},_projectLatlngs:function(c,g,T){var A=c[0]instanceof St,F=c.length,J,xe;if(A){for(xe=[],J=0;J<F;J++)xe[J]=this._map.latLngToLayerPoint(c[J]),T.extend(xe[J]);g.push(xe)}else for(J=0;J<F;J++)this._projectLatlngs(c[J],g,T)},_clipPoints:function(){var c=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(c))){if(this.options.noClip){this._parts=this._rings;return}var g=this._parts,T,A,F,J,xe,je,Je;for(T=0,F=0,J=this._rings.length;T<J;T++)for(Je=this._rings[T],A=0,xe=Je.length;A<xe-1;A++)je=Ca(Je[A],Je[A+1],c,A,!0),je&&(g[F]=g[F]||[],g[F].push(je[0]),(je[1]!==Je[A+1]||A===xe-2)&&(g[F].push(je[1]),F++))}},_simplifyPoints:function(){for(var c=this._parts,g=this.options.smoothFactor,T=0,A=c.length;T<A;T++)c[T]=Os(c[T],g)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(c,g){var T,A,F,J,xe,je,Je=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(c))return!1;for(T=0,J=this._parts.length;T<J;T++)for(je=this._parts[T],A=0,xe=je.length,F=xe-1;A<xe;F=A++)if(!(!g&&A===0)&&Hc(c,je[F],je[A])<=Je)return!0;return!1}});function Jc(c,g){return new xo(c,g)}xo._flat=_l;var ia=xo.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return ns(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(c){var g=xo.prototype._convertLatLngs.call(this,c),T=g.length;return T>=2&&g[0]instanceof St&&g[0].equals(g[T-1])&&g.pop(),g},_setLatLngs:function(c){xo.prototype._setLatLngs.call(this,c),Or(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return Or(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var c=this._renderer._bounds,g=this.options.weight,T=new ge(g,g);if(c=new qe(c.min.subtract(T),c.max.add(T)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(c))){if(this.options.noClip){this._parts=this._rings;return}for(var A=0,F=this._rings.length,J;A<F;A++)J=ta(this._rings[A],c,!0),J.length&&this._parts.push(J)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(c){var g=!1,T,A,F,J,xe,je,Je,ut;if(!this._pxBounds||!this._pxBounds.contains(c))return!1;for(J=0,Je=this._parts.length;J<Je;J++)for(T=this._parts[J],xe=0,ut=T.length,je=ut-1;xe<ut;je=xe++)A=T[xe],F=T[je],A.y>c.y!=F.y>c.y&&c.x<(F.x-A.x)*(c.y-A.y)/(F.y-A.y)+A.x&&(g=!g);return g||xo.prototype._containsPoint.call(this,c,!0)}});function Qc(c,g){return new ia(c,g)}var oi=vo.extend({initialize:function(c,g){ue(this,g),this._layers={},c&&this.addData(c)},addData:function(c){var g=Ve(c)?c:c.features,T,A,F;if(g){for(T=0,A=g.length;T<A;T++)F=g[T],(F.geometries||F.geometry||F.features||F.coordinates)&&this.addData(F);return this}var J=this.options;if(J.filter&&!J.filter(c))return this;var xe=Kr(c,J);return xe?(xe.feature=cs(c),xe.defaultOptions=xe.options,this.resetStyle(xe),J.onEachFeature&&J.onEachFeature(c,xe),this.addLayer(xe)):this},resetStyle:function(c){return c===void 0?this.eachLayer(this.resetStyle,this):(c.options=l({},c.defaultOptions),this._setLayerStyle(c,this.options.style),this)},setStyle:function(c){return this.eachLayer(function(g){this._setLayerStyle(g,c)},this)},_setLayerStyle:function(c,g){c.setStyle&&(typeof g=="function"&&(g=g(c.feature)),c.setStyle(g))}});function Kr(c,g){var T=c.type==="Feature"?c.geometry:c,A=T?T.coordinates:null,F=[],J=g&&g.pointToLayer,xe=g&&g.coordsToLatLng||Us,je,Je,ut,Mt;if(!A&&!T)return null;switch(T.type){case"Point":return je=xe(A),yl(J,c,je,g);case"MultiPoint":for(ut=0,Mt=A.length;ut<Mt;ut++)je=xe(A[ut]),F.push(yl(J,c,je,g));return new vo(F);case"LineString":case"MultiLineString":return Je=ss(A,T.type==="LineString"?0:1,xe),new xo(Je,g);case"Polygon":case"MultiPolygon":return Je=ss(A,T.type==="Polygon"?1:2,xe),new ia(Je,g);case"GeometryCollection":for(ut=0,Mt=T.geometries.length;ut<Mt;ut++){var Xt=Kr({geometry:T.geometries[ut],type:"Feature",properties:c.properties},g);Xt&&F.push(Xt)}return new vo(F);case"FeatureCollection":for(ut=0,Mt=T.features.length;ut<Mt;ut++){var pi=Kr(T.features[ut],g);pi&&F.push(pi)}return new vo(F);default:throw new Error("Invalid GeoJSON object.")}}function yl(c,g,T,A){return c?c(g,T):new $s(T,A&&A.markersInheritOptions&&A)}function Us(c){return new St(c[1],c[0],c[2])}function ss(c,g,T){for(var A=[],F=0,J=c.length,xe;F<J;F++)xe=g?ss(c[F],g-1,T):(T||Us)(c[F]),A.push(xe);return A}function vl(c,g){return c=zt(c),c.alt!==void 0?[W(c.lng,g),W(c.lat,g),W(c.alt,g)]:[W(c.lng,g),W(c.lat,g)]}function ls(c,g,T,A){for(var F=[],J=0,xe=c.length;J<xe;J++)F.push(g?ls(c[J],Or(c[J])?0:g-1,T,A):vl(c[J],A));return!g&&T&&F.length>0&&F.push(F[0].slice()),F}function Xr(c,g){return c.feature?l({},c.feature,{geometry:g}):cs(g)}function cs(c){return c.type==="Feature"||c.type==="FeatureCollection"?c:{type:"Feature",properties:{},geometry:c}}var oc={toGeoJSON:function(c){return Xr(this,{type:"Point",coordinates:vl(this.getLatLng(),c)})}};$s.include(oc),nc.include(oc),ka.include(oc),xo.include({toGeoJSON:function(c){var g=!Or(this._latlngs),T=ls(this._latlngs,g?1:0,!1,c);return Xr(this,{type:(g?"Multi":"")+"LineString",coordinates:T})}}),ia.include({toGeoJSON:function(c){var g=!Or(this._latlngs),T=g&&!Or(this._latlngs[0]),A=ls(this._latlngs,T?2:g?1:0,!0,c);return g||(A=[A]),Xr(this,{type:(T?"Multi":"")+"Polygon",coordinates:A})}}),La.include({toMultiPoint:function(c){var g=[];return this.eachLayer(function(T){g.push(T.toGeoJSON(c).geometry.coordinates)}),Xr(this,{type:"MultiPoint",coordinates:g})},toGeoJSON:function(c){var g=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(g==="MultiPoint")return this.toMultiPoint(c);var T=g==="GeometryCollection",A=[];return this.eachLayer(function(F){if(F.toGeoJSON){var J=F.toGeoJSON(c);if(T)A.push(J.geometry);else{var xe=cs(J);xe.type==="FeatureCollection"?A.push.apply(A,xe.features):A.push(xe)}}}),T?Xr(this,{geometries:A,type:"GeometryCollection"}):{type:"FeatureCollection",features:A}}});function eu(c,g){return new oi(c,g)}var nh=eu,xl=ao.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(c,g,T){this._url=c,this._bounds=Et(g),ue(this,T)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(hi(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){Ai(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(c){return this.options.opacity=c,this._image&&this._updateOpacity(),this},setStyle:function(c){return c.opacity&&this.setOpacity(c.opacity),this},bringToFront:function(){return this._map&&Ya(this._image),this},bringToBack:function(){return this._map&&Ja(this._image),this},setUrl:function(c){return this._url=c,this._image&&(this._image.src=c),this},setBounds:function(c){return this._bounds=Et(c),this._map&&this._reset(),this},getEvents:function(){var c={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(c.zoomanim=this._animateZoom),c},setZIndex:function(c){return this.options.zIndex=c,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var c=this._url.tagName==="IMG",g=this._image=c?this._url:yi("img");if(hi(g,"leaflet-image-layer"),this._zoomAnimated&&hi(g,"leaflet-zoom-animated"),this.options.className&&hi(g,this.options.className),g.onselectstart=B,g.onmousemove=B,g.onload=f(this.fire,this,"load"),g.onerror=f(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(g.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),c){this._url=g.src;return}g.src=this._url,g.alt=this.options.alt},_animateZoom:function(c){var g=this._map.getZoomScale(c.zoom),T=this._map._latLngBoundsToNewLayerBounds(this._bounds,c.zoom,c.center).min;xa(this._image,T,g)},_reset:function(){var c=this._image,g=new qe(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),T=g.getSize();an(c,g.min),c.style.width=T.x+"px",c.style.height=T.y+"px"},_updateOpacity:function(){Br(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var c=this.options.errorOverlayUrl;c&&this._url!==c&&(this._url=c,this._image.src=c)},getCenter:function(){return this._bounds.getCenter()}}),tu=function(c,g,T){return new xl(c,g,T)},iu=xl.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var c=this._url.tagName==="VIDEO",g=this._image=c?this._url:yi("video");if(hi(g,"leaflet-image-layer"),this._zoomAnimated&&hi(g,"leaflet-zoom-animated"),this.options.className&&hi(g,this.options.className),g.onselectstart=B,g.onmousemove=B,g.onloadeddata=f(this.fire,this,"load"),c){for(var T=g.getElementsByTagName("source"),A=[],F=0;F<T.length;F++)A.push(T[F].src);this._url=T.length>0?A:[g.src];return}Ve(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(g.style,"objectFit")&&(g.style.objectFit="fill"),g.autoplay=!!this.options.autoplay,g.loop=!!this.options.loop,g.muted=!!this.options.muted,g.playsInline=!!this.options.playsInline;for(var J=0;J<this._url.length;J++){var xe=yi("source");xe.src=this._url[J],g.appendChild(xe)}}});function nu(c,g,T){return new iu(c,g,T)}var Zs=xl.extend({_initImage:function(){var c=this._image=this._url;hi(c,"leaflet-image-layer"),this._zoomAnimated&&hi(c,"leaflet-zoom-animated"),this.options.className&&hi(c,this.options.className),c.onselectstart=B,c.onmousemove=B}});function bl(c,g,T){return new Zs(c,g,T)}var Fr=ao.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(c,g){c&&(c instanceof St||Ve(c))?(this._latlng=zt(c),ue(this,g)):(ue(this,c),this._source=g),this.options.content&&(this._content=this.options.content)},openOn:function(c){return c=arguments.length?c:this._source._map,c.hasLayer(this)||c.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(c){return this._map?this.close():(arguments.length?this._source=c:c=this._source,this._prepareOpen(),this.openOn(c._map)),this},onAdd:function(c){this._zoomAnimated=c._zoomAnimated,this._container||this._initLayout(),c._fadeAnimated&&Br(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),c._fadeAnimated&&Br(this._container,1),this.bringToFront(),this.options.interactive&&(hi(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(c){c._fadeAnimated?(Br(this._container,0),this._removeTimeout=setTimeout(f(Ai,void 0,this._container),200)):Ai(this._container),this.options.interactive&&(pn(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(c){return this._latlng=zt(c),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(c){return this._content=c,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var c={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(c.zoomanim=this._animateZoom),c},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&Ya(this._container),this},bringToBack:function(){return this._map&&Ja(this._container),this},_prepareOpen:function(c){var g=this._source;if(!g._map)return!1;if(g instanceof vo){g=null;var T=this._source._layers;for(var A in T)if(T[A]._map){g=T[A];break}if(!g)return!1;this._source=g}if(!c)if(g.getCenter)c=g.getCenter();else if(g.getLatLng)c=g.getLatLng();else if(g.getBounds)c=g.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(c),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var c=this._contentNode,g=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof g=="string")c.innerHTML=g;else{for(;c.hasChildNodes();)c.removeChild(c.firstChild);c.appendChild(g)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var c=this._map.latLngToLayerPoint(this._latlng),g=Ee(this.options.offset),T=this._getAnchor();this._zoomAnimated?an(this._container,c.add(T)):g=g.add(c).add(T);var A=this._containerBottom=-g.y,F=this._containerLeft=-Math.round(this._containerWidth/2)+g.x;this._container.style.bottom=A+"px",this._container.style.left=F+"px"}},_getAnchor:function(){return[0,0]}});xi.include({_initOverlay:function(c,g,T,A){var F=g;return F instanceof c||(F=new c(A).setContent(g)),T&&F.setLatLng(T),F}}),ao.include({_initOverlay:function(c,g,T,A){var F=T;return F instanceof c?(ue(F,A),F._source=this):(F=g&&!A?g:new c(A,this),F.setContent(T)),F}});var us=Fr.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(c){return c=arguments.length?c:this._source._map,!c.hasLayer(this)&&c._popup&&c._popup.options.autoClose&&c.removeLayer(c._popup),c._popup=this,Fr.prototype.openOn.call(this,c)},onAdd:function(c){Fr.prototype.onAdd.call(this,c),c.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof Fo||this._source.on("preclick",Li))},onRemove:function(c){Fr.prototype.onRemove.call(this,c),c.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof Fo||this._source.off("preclick",Li))},getEvents:function(){var c=Fr.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(c.preclick=this.close),this.options.keepInView&&(c.moveend=this._adjustPan),c},_initLayout:function(){var c="leaflet-popup",g=this._container=yi("div",c+" "+(this.options.className||"")+" leaflet-zoom-animated"),T=this._wrapper=yi("div",c+"-content-wrapper",g);if(this._contentNode=yi("div",c+"-content",T),si(g),Ji(this._contentNode),Ut(g,"contextmenu",Li),this._tipContainer=yi("div",c+"-tip-container",g),this._tip=yi("div",c+"-tip",this._tipContainer),this.options.closeButton){var A=this._closeButton=yi("a",c+"-close-button",g);A.setAttribute("role","button"),A.setAttribute("aria-label","Close popup"),A.href="#close",A.innerHTML='<span aria-hidden="true">&#215;</span>',Ut(A,"click",function(F){Bt(F),this.close()},this)}},_updateLayout:function(){var c=this._contentNode,g=c.style;g.width="",g.whiteSpace="nowrap";var T=c.offsetWidth;T=Math.min(T,this.options.maxWidth),T=Math.max(T,this.options.minWidth),g.width=T+1+"px",g.whiteSpace="",g.height="";var A=c.offsetHeight,F=this.options.maxHeight,J="leaflet-popup-scrolled";F&&A>F?(g.height=F+"px",hi(c,J)):pn(c,J),this._containerWidth=this._container.offsetWidth},_animateZoom:function(c){var g=this._map._latLngToNewLayerPoint(this._latlng,c.zoom,c.center),T=this._getAnchor();an(this._container,g.add(T))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var c=this._map,g=parseInt(Ao(this._container,"marginBottom"),10)||0,T=this._container.offsetHeight+g,A=this._containerWidth,F=new ge(this._containerLeft,-T-this._containerBottom);F._add(oo(this._container));var J=c.layerPointToContainerPoint(F),xe=Ee(this.options.autoPanPadding),je=Ee(this.options.autoPanPaddingTopLeft||xe),Je=Ee(this.options.autoPanPaddingBottomRight||xe),ut=c.getSize(),Mt=0,Xt=0;J.x+A+Je.x>ut.x&&(Mt=J.x+A-ut.x+Je.x),J.x-Mt-je.x<0&&(Mt=J.x-je.x),J.y+T+Je.y>ut.y&&(Xt=J.y+T-ut.y+Je.y),J.y-Xt-je.y<0&&(Xt=J.y-je.y),(Mt||Xt)&&(this.options.keepInView&&(this._autopanning=!0),c.fire("autopanstart").panBy([Mt,Xt]))}},_getAnchor:function(){return Ee(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),za=function(c,g){return new us(c,g)};xi.mergeOptions({closePopupOnClick:!0}),xi.include({openPopup:function(c,g,T){return this._initOverlay(us,c,g,T).openOn(this),this},closePopup:function(c){return c=arguments.length?c:this._popup,c&&c.close(),this}}),ao.include({bindPopup:function(c,g){return this._popup=this._initOverlay(us,this._popup,c,g),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(c){return this._popup&&(this instanceof vo||(this._popup._source=this),this._popup._prepareOpen(c||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(c){return this._popup&&this._popup.setContent(c),this},getPopup:function(){return this._popup},_openPopup:function(c){if(!(!this._popup||!this._map)){Wr(c);var g=c.layer||c.target;if(this._popup._source===g&&!(g instanceof Fo)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(c.latlng);return}this._popup._source=g,this.openPopup(c.latlng)}},_movePopup:function(c){this._popup.setLatLng(c.latlng)},_onKeyPress:function(c){c.originalEvent.keyCode===13&&this._openPopup(c)}});var Ra=Fr.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(c){Fr.prototype.onAdd.call(this,c),this.setOpacity(this.options.opacity),c.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(c){Fr.prototype.onRemove.call(this,c),c.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var c=Fr.prototype.getEvents.call(this);return this.options.permanent||(c.preclick=this.close),c},_initLayout:function(){var c="leaflet-tooltip",g=c+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=yi("div",g),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+P(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(c){var g,T,A=this._map,F=this._container,J=A.latLngToContainerPoint(A.getCenter()),xe=A.layerPointToContainerPoint(c),je=this.options.direction,Je=F.offsetWidth,ut=F.offsetHeight,Mt=Ee(this.options.offset),Xt=this._getAnchor();je==="top"?(g=Je/2,T=ut):je==="bottom"?(g=Je/2,T=0):je==="center"?(g=Je/2,T=ut/2):je==="right"?(g=0,T=ut/2):je==="left"?(g=Je,T=ut/2):xe.x<J.x?(je="right",g=0,T=ut/2):(je="left",g=Je+(Mt.x+Xt.x)*2,T=ut/2),c=c.subtract(Ee(g,T,!0)).add(Mt).add(Xt),pn(F,"leaflet-tooltip-right"),pn(F,"leaflet-tooltip-left"),pn(F,"leaflet-tooltip-top"),pn(F,"leaflet-tooltip-bottom"),hi(F,"leaflet-tooltip-"+je),an(F,c)},_updatePosition:function(){var c=this._map.latLngToLayerPoint(this._latlng);this._setPosition(c)},setOpacity:function(c){this.options.opacity=c,this._container&&Br(this._container,c)},_animateZoom:function(c){var g=this._map._latLngToNewLayerPoint(this._latlng,c.zoom,c.center);this._setPosition(g)},_getAnchor:function(){return Ee(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),hs=function(c,g){return new Ra(c,g)};xi.include({openTooltip:function(c,g,T){return this._initOverlay(Ra,c,g,T).openOn(this),this},closeTooltip:function(c){return c.close(),this}}),ao.include({bindTooltip:function(c,g){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(Ra,this._tooltip,c,g),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(c){if(!(!c&&this._tooltipHandlersAdded)){var g=c?"off":"on",T={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?T.add=this._openTooltip:(T.mouseover=this._openTooltip,T.mouseout=this.closeTooltip,T.click=this._openTooltip,this._map?this._addFocusListeners():T.add=this._addFocusListeners),this._tooltip.options.sticky&&(T.mousemove=this._moveTooltip),this[g](T),this._tooltipHandlersAdded=!c}},openTooltip:function(c){return this._tooltip&&(this instanceof vo||(this._tooltip._source=this),this._tooltip._prepareOpen(c)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(c){return this._tooltip&&this._tooltip.setContent(c),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(c){var g=typeof c.getElement=="function"&&c.getElement();g&&(Ut(g,"focus",function(){this._tooltip._source=c,this.openTooltip()},this),Ut(g,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(c){var g=typeof c.getElement=="function"&&c.getElement();g&&g.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(c){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var g=this;this._map.once("moveend",function(){g._openOnceFlag=!1,g._openTooltip(c)});return}this._tooltip._source=c.layer||c.target,this.openTooltip(this._tooltip.options.sticky?c.latlng:void 0)}},_moveTooltip:function(c){var g=c.latlng,T,A;this._tooltip.options.sticky&&c.originalEvent&&(T=this._map.mouseEventToContainerPoint(c.originalEvent),A=this._map.containerPointToLayerPoint(T),g=this._map.layerPointToLatLng(A)),this._tooltip.setLatLng(g)}});var Nr=Aa.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(c){var g=c&&c.tagName==="DIV"?c:document.createElement("div"),T=this.options;if(T.html instanceof Element?(mn(g),g.appendChild(T.html)):g.innerHTML=T.html!==!1?T.html:"",T.bgPos){var A=Ee(T.bgPos);g.style.backgroundPosition=-A.x+"px "+-A.y+"px"}return this._setIconStyles(g,"icon"),g},createShadow:function(){return null}});function ru(c){return new Nr(c)}Aa.Default=Hr;var ds=ao.extend({options:{tileSize:256,opacity:1,updateWhenIdle:ft.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(c){ue(this,c)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(c){c._addZoomLimit(this)},onRemove:function(c){this._removeAllTiles(),Ai(this._container),c._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(Ya(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(Ja(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(c){return this.options.opacity=c,this._updateOpacity(),this},setZIndex:function(c){return this.options.zIndex=c,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var c=this._clampZoom(this._map.getZoom());c!==this._tileZoom&&(this._tileZoom=c,this._updateLevels()),this._update()}return this},getEvents:function(){var c={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=E(this._onMoveEnd,this.options.updateInterval,this)),c.move=this._onMove),this._zoomAnimated&&(c.zoomanim=this._animateZoom),c},createTile:function(){return document.createElement("div")},getTileSize:function(){var c=this.options.tileSize;return c instanceof ge?c:new ge(c,c)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(c){for(var g=this.getPane().children,T=-c(-1/0,1/0),A=0,F=g.length,J;A<F;A++)J=g[A].style.zIndex,g[A]!==this._container&&J&&(T=c(T,+J));isFinite(T)&&(this.options.zIndex=T+c(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!ft.ielt9){Br(this._container,this.options.opacity);var c=+new Date,g=!1,T=!1;for(var A in this._tiles){var F=this._tiles[A];if(!(!F.current||!F.loaded)){var J=Math.min(1,(c-F.loaded)/200);Br(F.el,J),J<1?g=!0:(F.active?T=!0:this._onOpaqueTile(F),F.active=!0)}}T&&!this._noPrune&&this._pruneTiles(),g&&(ce(this._fadeFrame),this._fadeFrame=re(this._updateOpacity,this))}},_onOpaqueTile:B,_initContainer:function(){this._container||(this._container=yi("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var c=this._tileZoom,g=this.options.maxZoom;if(c!==void 0){for(var T in this._levels)T=Number(T),this._levels[T].el.children.length||T===c?(this._levels[T].el.style.zIndex=g-Math.abs(c-T),this._onUpdateLevel(T)):(Ai(this._levels[T].el),this._removeTilesAtZoom(T),this._onRemoveLevel(T),delete this._levels[T]);var A=this._levels[c],F=this._map;return A||(A=this._levels[c]={},A.el=yi("div","leaflet-tile-container leaflet-zoom-animated",this._container),A.el.style.zIndex=g,A.origin=F.project(F.unproject(F.getPixelOrigin()),c).round(),A.zoom=c,this._setZoomTransform(A,F.getCenter(),F.getZoom()),B(A.el.offsetWidth),this._onCreateLevel(A)),this._level=A,A}},_onUpdateLevel:B,_onRemoveLevel:B,_onCreateLevel:B,_pruneTiles:function(){if(this._map){var c,g,T=this._map.getZoom();if(T>this.options.maxZoom||T<this.options.minZoom){this._removeAllTiles();return}for(c in this._tiles)g=this._tiles[c],g.retain=g.current;for(c in this._tiles)if(g=this._tiles[c],g.current&&!g.active){var A=g.coords;this._retainParent(A.x,A.y,A.z,A.z-5)||this._retainChildren(A.x,A.y,A.z,A.z+2)}for(c in this._tiles)this._tiles[c].retain||this._removeTile(c)}},_removeTilesAtZoom:function(c){for(var g in this._tiles)this._tiles[g].coords.z===c&&this._removeTile(g)},_removeAllTiles:function(){for(var c in this._tiles)this._removeTile(c)},_invalidateAll:function(){for(var c in this._levels)Ai(this._levels[c].el),this._onRemoveLevel(Number(c)),delete this._levels[c];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(c,g,T,A){var F=Math.floor(c/2),J=Math.floor(g/2),xe=T-1,je=new ge(+F,+J);je.z=+xe;var Je=this._tileCoordsToKey(je),ut=this._tiles[Je];return ut&&ut.active?(ut.retain=!0,!0):(ut&&ut.loaded&&(ut.retain=!0),xe>A?this._retainParent(F,J,xe,A):!1)},_retainChildren:function(c,g,T,A){for(var F=2*c;F<2*c+2;F++)for(var J=2*g;J<2*g+2;J++){var xe=new ge(F,J);xe.z=T+1;var je=this._tileCoordsToKey(xe),Je=this._tiles[je];if(Je&&Je.active){Je.retain=!0;continue}else Je&&Je.loaded&&(Je.retain=!0);T+1<A&&this._retainChildren(F,J,T+1,A)}},_resetView:function(c){var g=c&&(c.pinch||c.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),g,g)},_animateZoom:function(c){this._setView(c.center,c.zoom,!0,c.noUpdate)},_clampZoom:function(c){var g=this.options;return g.minNativeZoom!==void 0&&c<g.minNativeZoom?g.minNativeZoom:g.maxNativeZoom!==void 0&&g.maxNativeZoom<c?g.maxNativeZoom:c},_setView:function(c,g,T,A){var F=Math.round(g);this.options.maxZoom!==void 0&&F>this.options.maxZoom||this.options.minZoom!==void 0&&F<this.options.minZoom?F=void 0:F=this._clampZoom(F);var J=this.options.updateWhenZooming&&F!==this._tileZoom;(!A||J)&&(this._tileZoom=F,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),F!==void 0&&this._update(c),T||this._pruneTiles(),this._noPrune=!!T),this._setZoomTransforms(c,g)},_setZoomTransforms:function(c,g){for(var T in this._levels)this._setZoomTransform(this._levels[T],c,g)},_setZoomTransform:function(c,g,T){var A=this._map.getZoomScale(T,c.zoom),F=c.origin.multiplyBy(A).subtract(this._map._getNewPixelOrigin(g,T)).round();ft.any3d?xa(c.el,F,A):an(c.el,F)},_resetGrid:function(){var c=this._map,g=c.options.crs,T=this._tileSize=this.getTileSize(),A=this._tileZoom,F=this._map.getPixelWorldBounds(this._tileZoom);F&&(this._globalTileRange=this._pxBoundsToTileRange(F)),this._wrapX=g.wrapLng&&!this.options.noWrap&&[Math.floor(c.project([0,g.wrapLng[0]],A).x/T.x),Math.ceil(c.project([0,g.wrapLng[1]],A).x/T.y)],this._wrapY=g.wrapLat&&!this.options.noWrap&&[Math.floor(c.project([g.wrapLat[0],0],A).y/T.x),Math.ceil(c.project([g.wrapLat[1],0],A).y/T.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(c){var g=this._map,T=g._animatingZoom?Math.max(g._animateToZoom,g.getZoom()):g.getZoom(),A=g.getZoomScale(T,this._tileZoom),F=g.project(c,this._tileZoom).floor(),J=g.getSize().divideBy(A*2);return new qe(F.subtract(J),F.add(J))},_update:function(c){var g=this._map;if(g){var T=this._clampZoom(g.getZoom());if(c===void 0&&(c=g.getCenter()),this._tileZoom!==void 0){var A=this._getTiledPixelBounds(c),F=this._pxBoundsToTileRange(A),J=F.getCenter(),xe=[],je=this.options.keepBuffer,Je=new qe(F.getBottomLeft().subtract([je,-je]),F.getTopRight().add([je,-je]));if(!(isFinite(F.min.x)&&isFinite(F.min.y)&&isFinite(F.max.x)&&isFinite(F.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var ut in this._tiles){var Mt=this._tiles[ut].coords;(Mt.z!==this._tileZoom||!Je.contains(new ge(Mt.x,Mt.y)))&&(this._tiles[ut].current=!1)}if(Math.abs(T-this._tileZoom)>1){this._setView(c,T);return}for(var Xt=F.min.y;Xt<=F.max.y;Xt++)for(var pi=F.min.x;pi<=F.max.x;pi++){var Zn=new ge(pi,Xt);if(Zn.z=this._tileZoom,!!this._isValidTile(Zn)){var Pn=this._tiles[this._tileCoordsToKey(Zn)];Pn?Pn.current=!0:xe.push(Zn)}}if(xe.sort(function(Vn,qi){return Vn.distanceTo(J)-qi.distanceTo(J)}),xe.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var jr=document.createDocumentFragment();for(pi=0;pi<xe.length;pi++)this._addTile(xe[pi],jr);this._level.el.appendChild(jr)}}}},_isValidTile:function(c){var g=this._map.options.crs;if(!g.infinite){var T=this._globalTileRange;if(!g.wrapLng&&(c.x<T.min.x||c.x>T.max.x)||!g.wrapLat&&(c.y<T.min.y||c.y>T.max.y))return!1}if(!this.options.bounds)return!0;var A=this._tileCoordsToBounds(c);return Et(this.options.bounds).overlaps(A)},_keyToBounds:function(c){return this._tileCoordsToBounds(this._keyToTileCoords(c))},_tileCoordsToNwSe:function(c){var g=this._map,T=this.getTileSize(),A=c.scaleBy(T),F=A.add(T),J=g.unproject(A,c.z),xe=g.unproject(F,c.z);return[J,xe]},_tileCoordsToBounds:function(c){var g=this._tileCoordsToNwSe(c),T=new Tt(g[0],g[1]);return this.options.noWrap||(T=this._map.wrapLatLngBounds(T)),T},_tileCoordsToKey:function(c){return c.x+":"+c.y+":"+c.z},_keyToTileCoords:function(c){var g=c.split(":"),T=new ge(+g[0],+g[1]);return T.z=+g[2],T},_removeTile:function(c){var g=this._tiles[c];g&&(Ai(g.el),delete this._tiles[c],this.fire("tileunload",{tile:g.el,coords:this._keyToTileCoords(c)}))},_initTile:function(c){hi(c,"leaflet-tile");var g=this.getTileSize();c.style.width=g.x+"px",c.style.height=g.y+"px",c.onselectstart=B,c.onmousemove=B,ft.ielt9&&this.options.opacity<1&&Br(c,this.options.opacity)},_addTile:function(c,g){var T=this._getTilePos(c),A=this._tileCoordsToKey(c),F=this.createTile(this._wrapCoords(c),f(this._tileReady,this,c));this._initTile(F),this.createTile.length<2&&re(f(this._tileReady,this,c,null,F)),an(F,T),this._tiles[A]={el:F,coords:c,current:!0},g.appendChild(F),this.fire("tileloadstart",{tile:F,coords:c})},_tileReady:function(c,g,T){g&&this.fire("tileerror",{error:g,tile:T,coords:c});var A=this._tileCoordsToKey(c);T=this._tiles[A],T&&(T.loaded=+new Date,this._map._fadeAnimated?(Br(T.el,0),ce(this._fadeFrame),this._fadeFrame=re(this._updateOpacity,this)):(T.active=!0,this._pruneTiles()),g||(hi(T.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:T.el,coords:c})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),ft.ielt9||!this._map._fadeAnimated?re(this._pruneTiles,this):setTimeout(f(this._pruneTiles,this),250)))},_getTilePos:function(c){return c.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(c){var g=new ge(this._wrapX?O(c.x,this._wrapX):c.x,this._wrapY?O(c.y,this._wrapY):c.y);return g.z=c.z,g},_pxBoundsToTileRange:function(c){var g=this.getTileSize();return new qe(c.min.unscaleBy(g).floor(),c.max.unscaleBy(g).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var c in this._tiles)if(!this._tiles[c].loaded)return!1;return!0}});function ac(c){return new ds(c)}var Yr=ds.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(c,g){this._url=c,g=ue(this,g),g.detectRetina&&ft.retina&&g.maxZoom>0?(g.tileSize=Math.floor(g.tileSize/2),g.zoomReverse?(g.zoomOffset--,g.minZoom=Math.min(g.maxZoom,g.minZoom+1)):(g.zoomOffset++,g.maxZoom=Math.max(g.minZoom,g.maxZoom-1)),g.minZoom=Math.max(0,g.minZoom)):g.zoomReverse?g.minZoom=Math.min(g.maxZoom,g.minZoom):g.maxZoom=Math.max(g.minZoom,g.maxZoom),typeof g.subdomains=="string"&&(g.subdomains=g.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(c,g){return this._url===c&&g===void 0&&(g=!0),this._url=c,g||this.redraw(),this},createTile:function(c,g){var T=document.createElement("img");return Ut(T,"load",f(this._tileOnLoad,this,g,T)),Ut(T,"error",f(this._tileOnError,this,g,T)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(T.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(T.referrerPolicy=this.options.referrerPolicy),T.alt="",T.src=this.getTileUrl(c),T},getTileUrl:function(c){var g={r:ft.retina?"@2x":"",s:this._getSubdomain(c),x:c.x,y:c.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var T=this._globalTileRange.max.y-c.y;this.options.tms&&(g.y=T),g["-y"]=T}return Xe(this._url,l(g,this.options))},_tileOnLoad:function(c,g){ft.ielt9?setTimeout(f(c,this,null,g),0):c(null,g)},_tileOnError:function(c,g,T){var A=this.options.errorTileUrl;A&&g.getAttribute("src")!==A&&(g.src=A),c(T,g)},_onTileRemove:function(c){c.tile.onload=null},_getZoomForUrl:function(){var c=this._tileZoom,g=this.options.maxZoom,T=this.options.zoomReverse,A=this.options.zoomOffset;return T&&(c=g-c),c+A},_getSubdomain:function(c){var g=Math.abs(c.x+c.y)%this.options.subdomains.length;return this.options.subdomains[g]},_abortLoading:function(){var c,g;for(c in this._tiles)if(this._tiles[c].coords.z!==this._tileZoom&&(g=this._tiles[c].el,g.onload=B,g.onerror=B,!g.complete)){g.src=nt;var T=this._tiles[c].coords;Ai(g),delete this._tiles[c],this.fire("tileabort",{tile:g,coords:T})}},_removeTile:function(c){var g=this._tiles[c];if(g)return g.el.setAttribute("src",nt),ds.prototype._removeTile.call(this,c)},_tileReady:function(c,g,T){if(!(!this._map||T&&T.getAttribute("src")===nt))return ds.prototype._tileReady.call(this,c,g,T)}});function Vs(c,g){return new Yr(c,g)}var Gs=Yr.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(c,g){this._url=c;var T=l({},this.defaultWmsParams);for(var A in g)A in this.options||(T[A]=g[A]);g=ue(this,g);var F=g.detectRetina&&ft.retina?2:1,J=this.getTileSize();T.width=J.x*F,T.height=J.y*F,this.wmsParams=T},onAdd:function(c){this._crs=this.options.crs||c.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var g=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[g]=this._crs.code,Yr.prototype.onAdd.call(this,c)},getTileUrl:function(c){var g=this._tileCoordsToNwSe(c),T=this._crs,A=xt(T.project(g[0]),T.project(g[1])),F=A.min,J=A.max,xe=(this._wmsVersion>=1.3&&this._crs===ec?[F.y,F.x,J.y,J.x]:[F.x,F.y,J.x,J.y]).join(","),je=Yr.prototype.getTileUrl.call(this,c);return je+be(this.wmsParams,je,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+xe},setParams:function(c,g){return l(this.wmsParams,c),g||this.redraw(),this}});function qs(c,g){return new Gs(c,g)}Yr.WMS=Gs,Vs.wms=qs;var Jr=ao.extend({options:{padding:.1},initialize:function(c){ue(this,c),P(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),hi(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var c={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(c.zoomanim=this._onAnimZoom),c},_onAnimZoom:function(c){this._updateTransform(c.center,c.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(c,g){var T=this._map.getZoomScale(g,this._zoom),A=this._map.getSize().multiplyBy(.5+this.options.padding),F=this._map.project(this._center,g),J=A.multiplyBy(-T).add(F).subtract(this._map._getNewPixelOrigin(c,g));ft.any3d?xa(this._container,J,T):an(this._container,J)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var c in this._layers)this._layers[c]._reset()},_onZoomEnd:function(){for(var c in this._layers)this._layers[c]._project()},_updatePaths:function(){for(var c in this._layers)this._layers[c]._update()},_update:function(){var c=this.options.padding,g=this._map.getSize(),T=this._map.containerPointToLayerPoint(g.multiplyBy(-c)).round();this._bounds=new qe(T,T.add(g.multiplyBy(1+c*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Ws=Jr.extend({options:{tolerance:0},getEvents:function(){var c=Jr.prototype.getEvents.call(this);return c.viewprereset=this._onViewPreReset,c},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){Jr.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var c=this._container=document.createElement("canvas");Ut(c,"mousemove",this._onMouseMove,this),Ut(c,"click dblclick mousedown mouseup contextmenu",this._onClick,this),Ut(c,"mouseout",this._handleMouseOut,this),c._leaflet_disable_events=!0,this._ctx=c.getContext("2d")},_destroyContainer:function(){ce(this._redrawRequest),delete this._ctx,Ai(this._container),Di(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var c;this._redrawBounds=null;for(var g in this._layers)c=this._layers[g],c._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Jr.prototype._update.call(this);var c=this._bounds,g=this._container,T=c.getSize(),A=ft.retina?2:1;an(g,c.min),g.width=A*T.x,g.height=A*T.y,g.style.width=T.x+"px",g.style.height=T.y+"px",ft.retina&&this._ctx.scale(2,2),this._ctx.translate(-c.min.x,-c.min.y),this.fire("update")}},_reset:function(){Jr.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(c){this._updateDashArray(c),this._layers[P(c)]=c;var g=c._order={layer:c,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=g),this._drawLast=g,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(c){this._requestRedraw(c)},_removePath:function(c){var g=c._order,T=g.next,A=g.prev;T?T.prev=A:this._drawLast=A,A?A.next=T:this._drawFirst=T,delete c._order,delete this._layers[P(c)],this._requestRedraw(c)},_updatePath:function(c){this._extendRedrawBounds(c),c._project(),c._update(),this._requestRedraw(c)},_updateStyle:function(c){this._updateDashArray(c),this._requestRedraw(c)},_updateDashArray:function(c){if(typeof c.options.dashArray=="string"){var g=c.options.dashArray.split(/[, ]+/),T=[],A,F;for(F=0;F<g.length;F++){if(A=Number(g[F]),isNaN(A))return;T.push(A)}c.options._dashArray=T}else c.options._dashArray=c.options.dashArray},_requestRedraw:function(c){this._map&&(this._extendRedrawBounds(c),this._redrawRequest=this._redrawRequest||re(this._redraw,this))},_extendRedrawBounds:function(c){if(c._pxBounds){var g=(c.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new qe,this._redrawBounds.extend(c._pxBounds.min.subtract([g,g])),this._redrawBounds.extend(c._pxBounds.max.add([g,g]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var c=this._redrawBounds;if(c){var g=c.getSize();this._ctx.clearRect(c.min.x,c.min.y,g.x,g.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var c,g=this._redrawBounds;if(this._ctx.save(),g){var T=g.getSize();this._ctx.beginPath(),this._ctx.rect(g.min.x,g.min.y,T.x,T.y),this._ctx.clip()}this._drawing=!0;for(var A=this._drawFirst;A;A=A.next)c=A.layer,(!g||c._pxBounds&&c._pxBounds.intersects(g))&&c._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(c,g){if(this._drawing){var T,A,F,J,xe=c._parts,je=xe.length,Je=this._ctx;if(je){for(Je.beginPath(),T=0;T<je;T++){for(A=0,F=xe[T].length;A<F;A++)J=xe[T][A],Je[A?"lineTo":"moveTo"](J.x,J.y);g&&Je.closePath()}this._fillStroke(Je,c)}}},_updateCircle:function(c){if(!(!this._drawing||c._empty())){var g=c._point,T=this._ctx,A=Math.max(Math.round(c._radius),1),F=(Math.max(Math.round(c._radiusY),1)||A)/A;F!==1&&(T.save(),T.scale(1,F)),T.beginPath(),T.arc(g.x,g.y/F,A,0,Math.PI*2,!1),F!==1&&T.restore(),this._fillStroke(T,c)}},_fillStroke:function(c,g){var T=g.options;T.fill&&(c.globalAlpha=T.fillOpacity,c.fillStyle=T.fillColor||T.color,c.fill(T.fillRule||"evenodd")),T.stroke&&T.weight!==0&&(c.setLineDash&&c.setLineDash(g.options&&g.options._dashArray||[]),c.globalAlpha=T.opacity,c.lineWidth=T.weight,c.strokeStyle=T.color,c.lineCap=T.lineCap,c.lineJoin=T.lineJoin,c.stroke())},_onClick:function(c){for(var g=this._map.mouseEventToLayerPoint(c),T,A,F=this._drawFirst;F;F=F.next)T=F.layer,T.options.interactive&&T._containsPoint(g)&&(!(c.type==="click"||c.type==="preclick")||!this._map._draggableMoved(T))&&(A=T);this._fireEvent(A?[A]:!1,c)},_onMouseMove:function(c){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var g=this._map.mouseEventToLayerPoint(c);this._handleMouseHover(c,g)}},_handleMouseOut:function(c){var g=this._hoveredLayer;g&&(pn(this._container,"leaflet-interactive"),this._fireEvent([g],c,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(c,g){if(!this._mouseHoverThrottled){for(var T,A,F=this._drawFirst;F;F=F.next)T=F.layer,T.options.interactive&&T._containsPoint(g)&&(A=T);A!==this._hoveredLayer&&(this._handleMouseOut(c),A&&(hi(this._container,"leaflet-interactive"),this._fireEvent([A],c,"mouseover"),this._hoveredLayer=A)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,c),this._mouseHoverThrottled=!0,setTimeout(f(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(c,g,T){this._map._fireDOMEvent(g,T||g.type,c)},_bringToFront:function(c){var g=c._order;if(g){var T=g.next,A=g.prev;if(T)T.prev=A;else return;A?A.next=T:T&&(this._drawFirst=T),g.prev=this._drawLast,this._drawLast.next=g,g.next=null,this._drawLast=g,this._requestRedraw(c)}},_bringToBack:function(c){var g=c._order;if(g){var T=g.next,A=g.prev;if(A)A.next=T;else return;T?T.prev=A:A&&(this._drawLast=A),g.prev=null,g.next=this._drawFirst,this._drawFirst.prev=g,this._drawFirst=g,this._requestRedraw(c)}}});function Da(c){return ft.canvas?new Ws(c):null}var bo=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(c){return document.createElement("<lvml:"+c+' class="lvml">')}}catch{}return function(c){return document.createElement("<"+c+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),ou={_initContainer:function(){this._container=yi("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(Jr.prototype._update.call(this),this.fire("update"))},_initPath:function(c){var g=c._container=bo("shape");hi(g,"leaflet-vml-shape "+(this.options.className||"")),g.coordsize="1 1",c._path=bo("path"),g.appendChild(c._path),this._updateStyle(c),this._layers[P(c)]=c},_addPath:function(c){var g=c._container;this._container.appendChild(g),c.options.interactive&&c.addInteractiveTarget(g)},_removePath:function(c){var g=c._container;Ai(g),c.removeInteractiveTarget(g),delete this._layers[P(c)]},_updateStyle:function(c){var g=c._stroke,T=c._fill,A=c.options,F=c._container;F.stroked=!!A.stroke,F.filled=!!A.fill,A.stroke?(g||(g=c._stroke=bo("stroke")),F.appendChild(g),g.weight=A.weight+"px",g.color=A.color,g.opacity=A.opacity,A.dashArray?g.dashStyle=Ve(A.dashArray)?A.dashArray.join(" "):A.dashArray.replace(/( *, *)/g," "):g.dashStyle="",g.endcap=A.lineCap.replace("butt","flat"),g.joinstyle=A.lineJoin):g&&(F.removeChild(g),c._stroke=null),A.fill?(T||(T=c._fill=bo("fill")),F.appendChild(T),T.color=A.fillColor||A.color,T.opacity=A.fillOpacity):T&&(F.removeChild(T),c._fill=null)},_updateCircle:function(c){var g=c._point.round(),T=Math.round(c._radius),A=Math.round(c._radiusY||T);this._setPath(c,c._empty()?"M0 0":"AL "+g.x+","+g.y+" "+T+","+A+" 0,"+65535*360)},_setPath:function(c,g){c._path.v=g},_bringToFront:function(c){Ya(c._container)},_bringToBack:function(c){Ja(c._container)}},Ba=ft.vml?bo:Ui,ii=Jr.extend({_initContainer:function(){this._container=Ba("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=Ba("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){Ai(this._container),Di(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Jr.prototype._update.call(this);var c=this._bounds,g=c.getSize(),T=this._container;(!this._svgSize||!this._svgSize.equals(g))&&(this._svgSize=g,T.setAttribute("width",g.x),T.setAttribute("height",g.y)),an(T,c.min),T.setAttribute("viewBox",[c.min.x,c.min.y,g.x,g.y].join(" ")),this.fire("update")}},_initPath:function(c){var g=c._path=Ba("path");c.options.className&&hi(g,c.options.className),c.options.interactive&&hi(g,"leaflet-interactive"),this._updateStyle(c),this._layers[P(c)]=c},_addPath:function(c){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(c._path),c.addInteractiveTarget(c._path)},_removePath:function(c){Ai(c._path),c.removeInteractiveTarget(c._path),delete this._layers[P(c)]},_updatePath:function(c){c._project(),c._update()},_updateStyle:function(c){var g=c._path,T=c.options;g&&(T.stroke?(g.setAttribute("stroke",T.color),g.setAttribute("stroke-opacity",T.opacity),g.setAttribute("stroke-width",T.weight),g.setAttribute("stroke-linecap",T.lineCap),g.setAttribute("stroke-linejoin",T.lineJoin),T.dashArray?g.setAttribute("stroke-dasharray",T.dashArray):g.removeAttribute("stroke-dasharray"),T.dashOffset?g.setAttribute("stroke-dashoffset",T.dashOffset):g.removeAttribute("stroke-dashoffset")):g.setAttribute("stroke","none"),T.fill?(g.setAttribute("fill",T.fillColor||T.color),g.setAttribute("fill-opacity",T.fillOpacity),g.setAttribute("fill-rule",T.fillRule||"evenodd")):g.setAttribute("fill","none"))},_updatePoly:function(c,g){this._setPath(c,Zi(c._parts,g))},_updateCircle:function(c){var g=c._point,T=Math.max(Math.round(c._radius),1),A=Math.max(Math.round(c._radiusY),1)||T,F="a"+T+","+A+" 0 1,0 ",J=c._empty()?"M0 0":"M"+(g.x-T)+","+g.y+F+T*2+",0 "+F+-T*2+",0 ";this._setPath(c,J)},_setPath:function(c,g){c._path.setAttribute("d",g)},_bringToFront:function(c){Ya(c._path)},_bringToBack:function(c){Ja(c._path)}});ft.vml&&ii.include(ou);function Hs(c){return ft.svg||ft.vml?new ii(c):null}xi.include({getRenderer:function(c){var g=c.options.renderer||this._getPaneRenderer(c.options.pane)||this.options.renderer||this._renderer;return g||(g=this._renderer=this._createRenderer()),this.hasLayer(g)||this.addLayer(g),g},_getPaneRenderer:function(c){if(c==="overlayPane"||c===void 0)return!1;var g=this._paneRenderers[c];return g===void 0&&(g=this._createRenderer({pane:c}),this._paneRenderers[c]=g),g},_createRenderer:function(c){return this.options.preferCanvas&&Da(c)||Hs(c)}});var Ks=ia.extend({initialize:function(c,g){ia.prototype.initialize.call(this,this._boundsToLatLngs(c),g)},setBounds:function(c){return this.setLatLngs(this._boundsToLatLngs(c))},_boundsToLatLngs:function(c){return c=Et(c),[c.getSouthWest(),c.getNorthWest(),c.getNorthEast(),c.getSouthEast()]}});function sc(c,g){return new Ks(c,g)}ii.create=Ba,ii.pointsToPath=Zi,oi.geometryToLayer=Kr,oi.coordsToLatLng=Us,oi.coordsToLatLngs=ss,oi.latLngToCoords=vl,oi.latLngsToCoords=ls,oi.getFeature=Xr,oi.asFeature=cs,xi.mergeOptions({boxZoom:!0});var ps=_o.extend({initialize:function(c){this._map=c,this._container=c._container,this._pane=c._panes.overlayPane,this._resetStateTimeout=0,c.on("unload",this._destroy,this)},addHooks:function(){Ut(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){Di(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){Ai(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(c){if(!c.shiftKey||c.which!==1&&c.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),ba(),er(),this._startPoint=this._map.mouseEventToContainerPoint(c),Ut(document,{contextmenu:Wr,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(c){this._moved||(this._moved=!0,this._box=yi("div","leaflet-zoom-box",this._container),hi(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(c);var g=new qe(this._point,this._startPoint),T=g.getSize();an(this._box,g.min),this._box.style.width=T.x+"px",this._box.style.height=T.y+"px"},_finish:function(){this._moved&&(Ai(this._box),pn(this._container,"leaflet-crosshair")),Bn(),zo(),Di(document,{contextmenu:Wr,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(c){if(!(c.which!==1&&c.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(f(this._resetState,this),0);var g=new Tt(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(g).fire("boxzoomend",{boxZoomBounds:g})}},_onKeyDown:function(c){c.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});xi.addInitHook("addHandler","boxZoom",ps),xi.mergeOptions({doubleClickZoom:!0});var au=_o.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(c){var g=this._map,T=g.getZoom(),A=g.options.zoomDelta,F=c.originalEvent.shiftKey?T-A:T+A;g.options.doubleClickZoom==="center"?g.setZoom(F):g.setZoomAround(c.containerPoint,F)}});xi.addInitHook("addHandler","doubleClickZoom",au),xi.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var su=_o.extend({addHooks:function(){if(!this._draggable){var c=this._map;this._draggable=new tr(c._mapPane,c._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),c.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),c.on("zoomend",this._onZoomEnd,this),c.whenReady(this._onZoomEnd,this))}hi(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){pn(this._map._container,"leaflet-grab"),pn(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var c=this._map;if(c._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var g=Et(this._map.options.maxBounds);this._offsetLimit=xt(this._map.latLngToContainerPoint(g.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(g.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;c.fire("movestart").fire("dragstart"),c.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(c){if(this._map.options.inertia){var g=this._lastTime=+new Date,T=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(T),this._times.push(g),this._prunePositions(g)}this._map.fire("move",c).fire("drag",c)},_prunePositions:function(c){for(;this._positions.length>1&&c-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var c=this._map.getSize().divideBy(2),g=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=g.subtract(c).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(c,g){return c-(c-g)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var c=this._draggable._newPos.subtract(this._draggable._startPos),g=this._offsetLimit;c.x<g.min.x&&(c.x=this._viscousLimit(c.x,g.min.x)),c.y<g.min.y&&(c.y=this._viscousLimit(c.y,g.min.y)),c.x>g.max.x&&(c.x=this._viscousLimit(c.x,g.max.x)),c.y>g.max.y&&(c.y=this._viscousLimit(c.y,g.max.y)),this._draggable._newPos=this._draggable._startPos.add(c)}},_onPreDragWrap:function(){var c=this._worldWidth,g=Math.round(c/2),T=this._initialWorldOffset,A=this._draggable._newPos.x,F=(A-g+T)%c+g-T,J=(A+g+T)%c-g-T,xe=Math.abs(F+T)<Math.abs(J+T)?F:J;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=xe},_onDragEnd:function(c){var g=this._map,T=g.options,A=!T.inertia||c.noInertia||this._times.length<2;if(g.fire("dragend",c),A)g.fire("moveend");else{this._prunePositions(+new Date);var F=this._lastPos.subtract(this._positions[0]),J=(this._lastTime-this._times[0])/1e3,xe=T.easeLinearity,je=F.multiplyBy(xe/J),Je=je.distanceTo([0,0]),ut=Math.min(T.inertiaMaxSpeed,Je),Mt=je.multiplyBy(ut/Je),Xt=ut/(T.inertiaDeceleration*xe),pi=Mt.multiplyBy(-Xt/2).round();!pi.x&&!pi.y?g.fire("moveend"):(pi=g._limitOffset(pi,g.options.maxBounds),re(function(){g.panBy(pi,{duration:Xt,easeLinearity:xe,noMoveStart:!0,animate:!0})}))}}});xi.addInitHook("addHandler","dragging",su),xi.mergeOptions({keyboard:!0,keyboardPanDelta:80});var lc=_o.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(c){this._map=c,this._setPanDelta(c.options.keyboardPanDelta),this._setZoomDelta(c.options.zoomDelta)},addHooks:function(){var c=this._map._container;c.tabIndex<=0&&(c.tabIndex="0"),Ut(c,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),Di(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var c=document.body,g=document.documentElement,T=c.scrollTop||g.scrollTop,A=c.scrollLeft||g.scrollLeft;this._map._container.focus(),window.scrollTo(A,T)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(c){var g=this._panKeys={},T=this.keyCodes,A,F;for(A=0,F=T.left.length;A<F;A++)g[T.left[A]]=[-1*c,0];for(A=0,F=T.right.length;A<F;A++)g[T.right[A]]=[c,0];for(A=0,F=T.down.length;A<F;A++)g[T.down[A]]=[0,c];for(A=0,F=T.up.length;A<F;A++)g[T.up[A]]=[0,-1*c]},_setZoomDelta:function(c){var g=this._zoomKeys={},T=this.keyCodes,A,F;for(A=0,F=T.zoomIn.length;A<F;A++)g[T.zoomIn[A]]=c;for(A=0,F=T.zoomOut.length;A<F;A++)g[T.zoomOut[A]]=-c},_addHooks:function(){Ut(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){Di(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(c){if(!(c.altKey||c.ctrlKey||c.metaKey)){var g=c.keyCode,T=this._map,A;if(g in this._panKeys){if(!T._panAnim||!T._panAnim._inProgress)if(A=this._panKeys[g],c.shiftKey&&(A=Ee(A).multiplyBy(3)),T.options.maxBounds&&(A=T._limitOffset(Ee(A),T.options.maxBounds)),T.options.worldCopyJump){var F=T.wrapLatLng(T.unproject(T.project(T.getCenter()).add(A)));T.panTo(F)}else T.panBy(A)}else if(g in this._zoomKeys)T.setZoom(T.getZoom()+(c.shiftKey?3:1)*this._zoomKeys[g]);else if(g===27&&T._popup&&T._popup.options.closeOnEscapeKey)T.closePopup();else return;Wr(c)}}});xi.addInitHook("addHandler","keyboard",lc),xi.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var lu=_o.extend({addHooks:function(){Ut(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){Di(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(c){var g=fl(c),T=this._map.options.wheelDebounceTime;this._delta+=g,this._lastMousePos=this._map.mouseEventToContainerPoint(c),this._startTime||(this._startTime=+new Date);var A=Math.max(T-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(f(this._performZoom,this),A),Wr(c)},_performZoom:function(){var c=this._map,g=c.getZoom(),T=this._map.options.zoomSnap||0;c._stop();var A=this._delta/(this._map.options.wheelPxPerZoomLevel*4),F=4*Math.log(2/(1+Math.exp(-Math.abs(A))))/Math.LN2,J=T?Math.ceil(F/T)*T:F,xe=c._limitZoom(g+(this._delta>0?J:-J))-g;this._delta=0,this._startTime=null,xe&&(c.options.scrollWheelZoom==="center"?c.setZoom(g+xe):c.setZoomAround(this._lastMousePos,g+xe))}});xi.addInitHook("addHandler","scrollWheelZoom",lu);var wl=600;xi.mergeOptions({tapHold:ft.touchNative&&ft.safari&&ft.mobile,tapTolerance:15});var fs=_o.extend({addHooks:function(){Ut(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){Di(this._map._container,"touchstart",this._onDown,this)},_onDown:function(c){if(clearTimeout(this._holdTimeout),c.touches.length===1){var g=c.touches[0];this._startPos=this._newPos=new ge(g.clientX,g.clientY),this._holdTimeout=setTimeout(f(function(){this._cancel(),this._isTapValid()&&(Ut(document,"touchend",Bt),Ut(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",g))},this),wl),Ut(document,"touchend touchcancel contextmenu",this._cancel,this),Ut(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function c(){Di(document,"touchend",Bt),Di(document,"touchend touchcancel",c)},_cancel:function(){clearTimeout(this._holdTimeout),Di(document,"touchend touchcancel contextmenu",this._cancel,this),Di(document,"touchmove",this._onMove,this)},_onMove:function(c){var g=c.touches[0];this._newPos=new ge(g.clientX,g.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(c,g){var T=new MouseEvent(c,{bubbles:!0,cancelable:!0,view:window,screenX:g.screenX,screenY:g.screenY,clientX:g.clientX,clientY:g.clientY});T._simulated=!0,g.target.dispatchEvent(T)}});xi.addInitHook("addHandler","tapHold",fs),xi.mergeOptions({touchZoom:ft.touch,bounceAtZoomLimits:!0});var Xs=_o.extend({addHooks:function(){hi(this._map._container,"leaflet-touch-zoom"),Ut(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){pn(this._map._container,"leaflet-touch-zoom"),Di(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(c){var g=this._map;if(!(!c.touches||c.touches.length!==2||g._animatingZoom||this._zooming)){var T=g.mouseEventToContainerPoint(c.touches[0]),A=g.mouseEventToContainerPoint(c.touches[1]);this._centerPoint=g.getSize()._divideBy(2),this._startLatLng=g.containerPointToLatLng(this._centerPoint),g.options.touchZoom!=="center"&&(this._pinchStartLatLng=g.containerPointToLatLng(T.add(A)._divideBy(2))),this._startDist=T.distanceTo(A),this._startZoom=g.getZoom(),this._moved=!1,this._zooming=!0,g._stop(),Ut(document,"touchmove",this._onTouchMove,this),Ut(document,"touchend touchcancel",this._onTouchEnd,this),Bt(c)}},_onTouchMove:function(c){if(!(!c.touches||c.touches.length!==2||!this._zooming)){var g=this._map,T=g.mouseEventToContainerPoint(c.touches[0]),A=g.mouseEventToContainerPoint(c.touches[1]),F=T.distanceTo(A)/this._startDist;if(this._zoom=g.getScaleZoom(F,this._startZoom),!g.options.bounceAtZoomLimits&&(this._zoom<g.getMinZoom()&&F<1||this._zoom>g.getMaxZoom()&&F>1)&&(this._zoom=g._limitZoom(this._zoom)),g.options.touchZoom==="center"){if(this._center=this._startLatLng,F===1)return}else{var J=T._add(A)._divideBy(2)._subtract(this._centerPoint);if(F===1&&J.x===0&&J.y===0)return;this._center=g.unproject(g.project(this._pinchStartLatLng,this._zoom).subtract(J),this._zoom)}this._moved||(g._moveStart(!0,!1),this._moved=!0),ce(this._animRequest);var xe=f(g._move,g,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=re(xe,this,!0),Bt(c)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,ce(this._animRequest),Di(document,"touchmove",this._onTouchMove,this),Di(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});xi.addInitHook("addHandler","touchZoom",Xs),xi.BoxZoom=ps,xi.DoubleClickZoom=au,xi.Drag=su,xi.Keyboard=lc,xi.ScrollWheelZoom=lu,xi.TapHold=fs,xi.TouchZoom=Xs,s.Bounds=qe,s.Browser=ft,s.CRS=Ft,s.Canvas=Ws,s.Circle=nc,s.CircleMarker=ka,s.Class=de,s.Control=Mr,s.DivIcon=Nr,s.DivOverlay=Fr,s.DomEvent=Ds,s.DomUtil=Sn,s.Draggable=tr,s.Evented=Ce,s.FeatureGroup=vo,s.GeoJSON=oi,s.GridLayer=ds,s.Handler=_o,s.Icon=Aa,s.ImageOverlay=xl,s.LatLng=St,s.LatLngBounds=Tt,s.Layer=ao,s.LayerGroup=La,s.LineUtil=Ns,s.Map=xi,s.Marker=$s,s.Mixin=hr,s.Path=Fo,s.Point=ge,s.PolyUtil=Ma,s.Polygon=ia,s.Polyline=xo,s.Popup=us,s.PosAnimation=Pa,s.Projection=Kc,s.Rectangle=Ks,s.Renderer=Jr,s.SVG=ii,s.SVGOverlay=Zs,s.TileLayer=Yr,s.Tooltip=Ra,s.Transformation=hn,s.Util=Ie,s.VideoOverlay=iu,s.bind=f,s.bounds=xt,s.canvas=Da,s.circle=rc,s.circleMarker=ih,s.control=Do,s.divIcon=ru,s.extend=l,s.featureGroup=Yc,s.geoJSON=eu,s.geoJson=nh,s.gridLayer=ac,s.icon=tc,s.imageOverlay=tu,s.latLng=zt,s.latLngBounds=Et,s.layerGroup=js,s.map=Xl,s.marker=as,s.point=Ee,s.polygon=Qc,s.polyline=Jc,s.popup=za,s.rectangle=sc,s.setOptions=ue,s.stamp=P,s.svg=Hs,s.svgOverlay=bl,s.tileLayer=Vs,s.tooltip=hs,s.transformation=Yi,s.version=i,s.videoOverlay=nu;var cc=window.L;s.noConflict=function(){return window.L=cc,this},window.L=s})});var u0=Jd((c0,rp)=>{"use strict";(function(s,i){typeof define=="function"&&define.amd?define("leafletFullScreen",["leaflet"],i):typeof rp=="object"&&rp.exports?rp.exports=i(Ru()):i(s.L)})(typeof self<"u"?self:c0,s=>{"use strict";if(typeof document>"u")return console.warn('"window.document" is undefined; leaflet.fullscreen requires this object to access the DOM'),!1;let i=(()=>{let f=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"]],a=f[0],P={};for(let E of f)if(E[1]in document){for(let O=0;O<E.length;O++)P[a[O]]=E[O];return P}return!1})(),l={change:i.fullscreenchange,error:i.fullscreenerror},m={request(f,a){return new Promise((P,E)=>{let O=function(){this.off("change",O),P()}.bind(this);this.on("change",O),f=f||document.documentElement;let B=f[i.requestFullscreen](a);B instanceof Promise&&B.then(O).catch(E)})},exit(){return new Promise((f,a)=>{if(!this.isFullscreen){f();return}let P=function(){this.off("change",P),f()}.bind(this);this.on("change",P);let E=document[i.exitFullscreen]();E instanceof Promise&&E.then(P).catch(a)})},on(f,a){let P=l[f];P&&document.addEventListener(P,a,!1)},off(f,a){let P=l[f];P&&document.removeEventListener(P,a,!1)},nativeAPI:i};return Object.defineProperties(m,{isFullscreen:{get(){return!!document[i.fullscreenElement]}},isEnabled:{enumerable:!0,get(){return!!document[i.fullscreenEnabled]}}}),s.Control.FullScreen=s.Control.extend({options:{position:"topleft",title:"Full Screen",titleCancel:"Exit Full Screen",forceSeparateButton:!1,forcePseudoFullscreen:!1,fullscreenElement:!1},_screenfull:m,onAdd(f){let a="leaflet-control-zoom-fullscreen",P,E="";return f.zoomControl&&!this.options.forceSeparateButton?P=f.zoomControl._container:P=s.DomUtil.create("div","leaflet-bar"),this.options.content?E=this.options.content:a+=" leaflet-fullscreen-icon",this._createButton(this.options.title,a,E,P,this.toggleFullScreen,this),this._map.fullscreenControl=this,this._map.on("enterFullscreen exitFullscreen",this._toggleState,this),P},onRemove(){s.DomEvent.off(this.link,"click",s.DomEvent.stop).off(this.link,"click",this.toggleFullScreen,this),this._screenfull.isEnabled&&(s.DomEvent.off(this._container,this._screenfull.nativeAPI.fullscreenchange,s.DomEvent.stop).off(this._container,this._screenfull.nativeAPI.fullscreenchange,this._handleFullscreenChange,this),s.DomEvent.off(document,this._screenfull.nativeAPI.fullscreenchange,s.DomEvent.stop).off(document,this._screenfull.nativeAPI.fullscreenchange,this._handleFullscreenChange,this))},_createButton(f,a,P,E,O,B){return this.link=s.DomUtil.create("a",a,E),this.link.href="#",this.link.title=f,this.link.innerHTML=P,this.link.setAttribute("role","button"),this.link.setAttribute("aria-label",f),L.DomEvent.disableClickPropagation(E),s.DomEvent.on(this.link,"click",s.DomEvent.stop).on(this.link,"click",O,B),this._screenfull.isEnabled&&(s.DomEvent.on(E,this._screenfull.nativeAPI.fullscreenchange,s.DomEvent.stop).on(E,this._screenfull.nativeAPI.fullscreenchange,this._handleFullscreenChange,B),s.DomEvent.on(document,this._screenfull.nativeAPI.fullscreenchange,s.DomEvent.stop).on(document,this._screenfull.nativeAPI.fullscreenchange,this._handleFullscreenChange,B)),this.link},toggleFullScreen(){let f=this._map;f._exitFired=!1,f._isFullscreen?(this._screenfull.isEnabled&&!this.options.forcePseudoFullscreen?this._screenfull.exit().then(()=>f.invalidateSize()):(s.DomUtil.removeClass(this.options.fullscreenElement?this.options.fullscreenElement:f._container,"leaflet-pseudo-fullscreen"),f.invalidateSize()),f.fire("exitFullscreen"),f._exitFired=!0,f._isFullscreen=!1):(this._screenfull.isEnabled&&!this.options.forcePseudoFullscreen?this._screenfull.request(this.options.fullscreenElement?this.options.fullscreenElement:f._container).then(()=>f.invalidateSize()):(s.DomUtil.addClass(this.options.fullscreenElement?this.options.fullscreenElement:f._container,"leaflet-pseudo-fullscreen"),f.invalidateSize()),f.fire("enterFullscreen"),f._isFullscreen=!0)},_toggleState(){this.link.title=this._map._isFullscreen?this.options.title:this.options.titleCancel,this._map._isFullscreen?L.DomUtil.removeClass(this.link,"leaflet-fullscreen-on"):L.DomUtil.addClass(this.link,"leaflet-fullscreen-on")},_handleFullscreenChange(f){let a=this._map;f.target===a.getContainer()&&!this._screenfull.isFullscreen&&!a._exitFired&&(this._screenfull.exit().then(()=>a.invalidateSize()),a.fire("exitFullscreen"),a._exitFired=!0,a._isFullscreen=!1)}}),s.Map.include({toggleFullscreen(){this.fullscreenControl.toggleFullScreen()}}),s.Map.addInitHook(function(){this.options.fullscreenControl&&this.addControl(s.control.fullscreen(this.options.fullscreenControlOptions))}),s.control.fullscreen=function(f){return new s.Control.FullScreen(f)},{leaflet:s}})});var d0=Jd((bm,wm)=>{"use strict";(function(s,i){typeof bm=="object"&&typeof wm<"u"?wm.exports=i():typeof define=="function"&&define.amd?define(i):(s=typeof globalThis<"u"?globalThis:s||self,s.maplibregl=i())})(bm,function(){"use strict";var s={},i={};function l(f,a,P){if(i[f]=P,f==="index"){var E="var sharedModule = {}; ("+i.shared+")(sharedModule); ("+i.worker+")(sharedModule);",O={};return i.shared(O),i.index(s,O),typeof window<"u"&&s.setWorkerUrl(window.URL.createObjectURL(new Blob([E],{type:"text/javascript"}))),s}}l("shared",["exports"],function(f){"use strict";function a(o,t,r,u){return new(r||(r=Promise))(function(p,v){function x(I){try{M(u.next(I))}catch(z){v(z)}}function w(I){try{M(u.throw(I))}catch(z){v(z)}}function M(I){var z;I.done?p(I.value):(z=I.value,z instanceof r?z:new r(function(D){D(z)})).then(x,w)}M((u=u.apply(o,t||[])).next())})}function P(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var E,O;function B(){if(O)return E;function o(t,r){this.x=t,this.y=r}return O=1,E=o,o.prototype={clone:function(){return new o(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,r){return this.clone()._rotateAround(t,r)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var r=t.x-this.x,u=t.y-this.y;return r*r+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,r){return Math.atan2(this.x*r-this.y*t,this.x*t+this.y*r)},_matMult:function(t){var r=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=r,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var r=Math.cos(t),u=Math.sin(t),p=u*this.x+r*this.y;return this.x=r*this.x-u*this.y,this.y=p,this},_rotateAround:function(t,r){var u=Math.cos(t),p=Math.sin(t),v=r.y+p*(this.x-r.x)+u*(this.y-r.y);return this.x=r.x+u*(this.x-r.x)-p*(this.y-r.y),this.y=v,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},o.convert=function(t){return t instanceof o?t:Array.isArray(t)?new o(t[0],t[1]):t},E}typeof SuppressedError=="function"&&SuppressedError;var W,V,he=P(B()),ue=function(){if(V)return W;function o(t,r,u,p){this.cx=3*t,this.bx=3*(u-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(p-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=u,this.p2y=p}return V=1,W=o,o.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,r){if(r===void 0&&(r=1e-6),t<0)return 0;if(t>1)return 1;for(var u=t,p=0;p<8;p++){var v=this.sampleCurveX(u)-t;if(Math.abs(v)<r)return u;var x=this.sampleCurveDerivativeX(u);if(Math.abs(x)<1e-6)break;u-=v/x}var w=0,M=1;for(u=t,p=0;p<20&&(v=this.sampleCurveX(u),!(Math.abs(v-t)<r));p++)t>v?w=u:M=u,u=.5*(M-w)+w;return u},solve:function(t,r){return this.sampleCurveY(this.solveCurveX(t,r))}},W}(),be=P(ue);let ze,Xe;function Ve(){return ze==null&&(ze=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),ze}function Se(){if(Xe==null&&(Xe=!1,Ve())){let t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let u=0;u<5*5;u++){let p=4*u;t.fillStyle=`rgb(${p},${p+1},${p+2})`,t.fillRect(u%5,Math.floor(u/5),1,1)}let r=t.getImageData(0,0,5,5).data;for(let u=0;u<5*5*4;u++)if(u%4!=3&&r[u]!==u){Xe=!0;break}}}return Xe||!1}var nt=1e-6,pt=typeof Float32Array<"u"?Float32Array:Array;function Pt(){var o=new pt(9);return pt!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[5]=0,o[6]=0,o[7]=0),o[0]=1,o[4]=1,o[8]=1,o}function kt(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function It(){var o=new pt(3);return pt!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o}function Q(o){return Math.hypot(o[0],o[1],o[2])}function re(o,t,r){var u=new pt(3);return u[0]=o,u[1]=t,u[2]=r,u}Math.hypot||(Math.hypot=function(){for(var o=0,t=arguments.length;t--;)o+=arguments[t]*arguments[t];return Math.sqrt(o)});var ce,Ie=Q;function de(o,t,r){var u=t[0],p=t[1],v=t[2],x=t[3];return o[0]=r[0]*u+r[4]*p+r[8]*v+r[12]*x,o[1]=r[1]*u+r[5]*p+r[9]*v+r[13]*x,o[2]=r[2]*u+r[6]*p+r[10]*v+r[14]*x,o[3]=r[3]*u+r[7]*p+r[11]*v+r[15]*x,o}function Oe(){var o=new pt(4);return pt!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o[3]=1,o}function Ae(){var o=new pt(2);return pt!=Float32Array&&(o[0]=0,o[1]=0),o}function Ce(o,t){var r=new pt(2);return r[0]=o,r[1]=t,r}It(),ce=new pt(4),pt!=Float32Array&&(ce[0]=0,ce[1]=0,ce[2]=0,ce[3]=0),It(),re(1,0,0),re(0,1,0),Oe(),Oe(),Pt(),Ae();let ge=8192;function Fe(o,t,r){return t*(ge/(o.tileSize*Math.pow(2,r-o.tileID.overscaledZ)))}function Ee(o,t){return(o%t+t)%t}function qe(o,t,r){return o*(1-r)+t*r}function xt(o){if(o<=0)return 0;if(o>=1)return 1;let t=o*o,r=t*o;return 4*(o<.5?r:3*(o-t)+r-.75)}function Tt(o,t,r,u){let p=new be(o,t,r,u);return v=>p.solve(v)}let Et=Tt(.25,.1,.25,1);function St(o,t,r){return Math.min(r,Math.max(t,o))}function zt(o,t,r){let u=r-t,p=((o-t)%u+u)%u+t;return p===t?r:p}function Ft(o,...t){for(let r of t)for(let u in r)o[u]=r[u];return o}let Qt=1;function Vi(o,t,r){let u={};for(let p in o)u[p]=t.call(this,o[p],p,o);return u}function Jn(o,t,r){let u={};for(let p in o)t.call(this,o[p],p,o)&&(u[p]=o[p]);return u}function hn(o){return Array.isArray(o)?o.map(hn):typeof o=="object"&&o?Vi(o,hn):o}let Yi={};function Ri(o){Yi[o]||(typeof console<"u"&&console.warn(o),Yi[o]=!0)}function _i(o,t,r){return(r.y-o.y)*(t.x-o.x)>(t.y-o.y)*(r.x-o.x)}function Ui(o){return typeof WorkerGlobalScope<"u"&&o!==void 0&&o instanceof WorkerGlobalScope}let Zi=null;function ui(o){return typeof ImageBitmap<"u"&&o instanceof ImageBitmap}let to="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Io(o,t,r,u,p){return a(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");let v=new VideoFrame(o,{timestamp:0});try{let x=v?.format;if(!x||!x.startsWith("BGR")&&!x.startsWith("RGB"))throw new Error(`Unrecognized format ${x}`);let w=x.startsWith("BGR"),M=new Uint8ClampedArray(u*p*4);if(yield v.copyTo(M,function(I,z,D,$,Z){let G=4*Math.max(1,0),K=(Math.max(0,D)-D)*$*4+G,ne=4*$,le=Math.max(0,z),Me=Math.max(0,D);return{rect:{x:le,y:Me,width:Math.min(I.width,z+$)-le,height:Math.min(I.height,D+Z)-Me},layout:[{offset:K,stride:ne}]}}(o,t,r,u,p)),w)for(let I=0;I<M.length;I+=4){let z=M[I];M[I]=M[I+2],M[I+2]=z}return M}finally{v.close()}})}let jn,Pr;function mo(o,t,r,u){return o.addEventListener(t,r,u),{unsubscribe:()=>{o.removeEventListener(t,r,u)}}}function io(o){return o*Math.PI/180}function no(o){return o/Math.PI*180}let Jo={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},ni={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},Gi="AbortError";function Ot(){return new Error(Gi)}let qr={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Tn(o){return qr.REGISTERED_PROTOCOLS[o.substring(0,o.indexOf("://"))]}let Ti="global-dispatcher";class dn extends Error{constructor(t,r,u,p){super(`AJAXError: ${r} (${t}): ${u}`),this.status=t,this.statusText=r,this.url=u,this.body=p}}let An=()=>Ui(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Rn=function(o,t){if(/:\/\//.test(o.url)&&!/^https?:|^file:/.test(o.url)){let u=Tn(o.url);if(u)return u(o,t);if(Ui(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:o,targetMapId:Ti},t)}if(!(/^file:/.test(r=o.url)||/^file:/.test(An())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(u,p){return a(this,void 0,void 0,function*(){let v=new Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,cache:u.cache,referrer:An(),signal:p.signal}),x,w;u.type!=="json"||v.headers.has("Accept")||v.headers.set("Accept","application/json");try{x=yield fetch(v)}catch(I){throw new dn(0,I.message,u.url,new Blob)}if(!x.ok){let I=yield x.blob();throw new dn(x.status,x.statusText,u.url,I)}w=u.type==="arrayBuffer"||u.type==="image"?x.arrayBuffer():u.type==="json"?x.json():x.text();let M=yield w;if(p.signal.aborted)throw Ot();return{data:M,cacheControl:x.headers.get("Cache-Control"),expires:x.headers.get("Expires")}})}(o,t);if(Ui(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:o,mustQueue:!0,targetMapId:Ti},t)}var r;return function(u,p){return new Promise((v,x)=>{var w;let M=new XMLHttpRequest;M.open(u.method||"GET",u.url,!0),u.type!=="arrayBuffer"&&u.type!=="image"||(M.responseType="arraybuffer");for(let I in u.headers)M.setRequestHeader(I,u.headers[I]);u.type==="json"&&(M.responseType="text",!((w=u.headers)===null||w===void 0)&&w.Accept||M.setRequestHeader("Accept","application/json")),M.withCredentials=u.credentials==="include",M.onerror=()=>{x(new Error(M.statusText))},M.onload=()=>{if(!p.signal.aborted)if((M.status>=200&&M.status<300||M.status===0)&&M.response!==null){let I=M.response;if(u.type==="json")try{I=JSON.parse(M.response)}catch(z){return void x(z)}v({data:I,cacheControl:M.getResponseHeader("Cache-Control"),expires:M.getResponseHeader("Expires")})}else{let I=new Blob([M.response],{type:M.getResponseHeader("Content-Type")});x(new dn(M.status,M.statusText,u.url,I))}},p.signal.addEventListener("abort",()=>{M.abort(),x(Ot())}),M.send(u.body)})}(o,t)};function Re(o){if(!o||o.indexOf("://")<=0||o.indexOf("data:image/")===0||o.indexOf("blob:")===0)return!0;let t=new URL(o),r=window.location;return t.protocol===r.protocol&&t.host===r.host}function X(o,t,r){r[o]&&r[o].indexOf(t)!==-1||(r[o]=r[o]||[],r[o].push(t))}function Y(o,t,r){if(r&&r[o]){let u=r[o].indexOf(t);u!==-1&&r[o].splice(u,1)}}class te{constructor(t,r={}){Ft(this,r),this.type=t}}class me extends te{constructor(t,r={}){super("error",Ft({error:t},r))}}class Te{on(t,r){return this._listeners=this._listeners||{},X(t,r,this._listeners),{unsubscribe:()=>{this.off(t,r)}}}off(t,r){return Y(t,r,this._listeners),Y(t,r,this._oneTimeListeners),this}once(t,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},X(t,r,this._oneTimeListeners),this):new Promise(u=>this.once(t,u))}fire(t,r){typeof t=="string"&&(t=new te(t,r||{}));let u=t.type;if(this.listens(u)){t.target=this;let p=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(let w of p)w.call(this,t);let v=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(let w of v)Y(u,w,this._oneTimeListeners),w.call(this,t);let x=this._eventedParent;x&&(Ft(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(t))}else t instanceof me&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,r){return this._eventedParent=t,this._eventedParentData=r,this}}var ie={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};let Ne=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function ke(o,t){let r={};for(let u in o)u!=="ref"&&(r[u]=o[u]);return Ne.forEach(u=>{u in t&&(r[u]=t[u])}),r}function Be(o,t){if(Array.isArray(o)){if(!Array.isArray(t)||o.length!==t.length)return!1;for(let r=0;r<o.length;r++)if(!Be(o[r],t[r]))return!1;return!0}if(typeof o=="object"&&o!==null&&t!==null){if(typeof t!="object"||Object.keys(o).length!==Object.keys(t).length)return!1;for(let r in o)if(!Be(o[r],t[r]))return!1;return!0}return o===t}function Ze(o,t){o.push(t)}function De(o,t,r){Ze(r,{command:"addSource",args:[o,t[o]]})}function at(o,t,r){Ze(t,{command:"removeSource",args:[o]}),r[o]=!0}function mt(o,t,r,u){at(o,r,u),De(o,t,r)}function yt(o,t,r){let u;for(u in o[r])if(Object.prototype.hasOwnProperty.call(o[r],u)&&u!=="data"&&!Be(o[r][u],t[r][u]))return!1;for(u in t[r])if(Object.prototype.hasOwnProperty.call(t[r],u)&&u!=="data"&&!Be(o[r][u],t[r][u]))return!1;return!0}function Dt(o,t,r,u,p,v){o=o||{},t=t||{};for(let x in o)Object.prototype.hasOwnProperty.call(o,x)&&(Be(o[x],t[x])||r.push({command:v,args:[u,x,t[x],p]}));for(let x in t)Object.prototype.hasOwnProperty.call(t,x)&&!Object.prototype.hasOwnProperty.call(o,x)&&(Be(o[x],t[x])||r.push({command:v,args:[u,x,t[x],p]}))}function Yt(o){return o.id}function Gt(o,t){return o[t.id]=t,o}class Ye{constructor(t,r,u,p){this.message=(t?`${t}: `:"")+u,p&&(this.identifier=p),r!=null&&r.__line__&&(this.line=r.__line__)}}function ri(o,...t){for(let r of t)for(let u in r)o[u]=r[u];return o}class ft extends Error{constructor(t,r){super(r),this.message=r,this.key=t}}class Si{constructor(t,r=[]){this.parent=t,this.bindings={};for(let[u,p]of r)this.bindings[u]=p}concat(t){return new Si(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}let Zt={kind:"null"},ot={kind:"number"},Nt={kind:"string"},Kt={kind:"boolean"},Hi={kind:"color"},$i={kind:"projectionDefinition"},Qn={kind:"object"},ei={kind:"value"},Qo={kind:"collator"},We={kind:"formatted"},Pi={kind:"padding"},tn={kind:"colorArray"},nn={kind:"numberArray"},rn={kind:"resolvedImage"},zi={kind:"variableAnchorOffsetCollection"};function on(o,t){return{kind:"array",itemType:o,N:t}}function qt(o){if(o.kind==="array"){let t=qt(o.itemType);return typeof o.N=="number"?`array<${t}, ${o.N}>`:o.itemType.kind==="value"?"array":`array<${t}>`}return o.kind}let ro=[Zt,ot,Nt,Kt,Hi,$i,We,Qn,on(ei),Pi,nn,tn,rn,zi];function Dn(o,t){if(t.kind==="error")return null;if(o.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Dn(o.itemType,t.itemType))&&(typeof o.N!="number"||o.N===t.N))return null}else{if(o.kind===t.kind)return null;if(o.kind==="value"){for(let r of ro)if(!Dn(r,t))return null}}return`Expected ${qt(o)} but found ${qt(t)} instead.`}function Eo(o,t){return t.some(r=>r.kind===o.kind)}function kn(o,t){return t.some(r=>r==="null"?o===null:r==="array"?Array.isArray(o):r==="object"?o&&!Array.isArray(o)&&typeof o=="object":r===typeof o)}function Dr(o,t){return o.kind==="array"&&t.kind==="array"?o.itemType.kind===t.itemType.kind&&typeof o.N=="number":o.kind===t.kind}let Lo=.96422,Ao=.82521,yi=4/29,Ai=6/29,mn=3*Ai*Ai,Ya=Ai*Ai*Ai,Ja=Math.PI/180,Kl=180/Math.PI;function hi(o){return(o%=360)<0&&(o+=360),o}function pn([o,t,r,u]){let p,v,x=Qa((.2225045*(o=ko(o))+.7168786*(t=ko(t))+.0606169*(r=ko(r)))/1);o===t&&t===r?p=v=x:(p=Qa((.4360747*o+.3850649*t+.1430804*r)/Lo),v=Qa((.0139322*o+.0971045*t+.7141733*r)/Ao));let w=116*x-16;return[w<0?0:w,500*(p-x),200*(x-v),u]}function ko(o){return o<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function Qa(o){return o>Ya?Math.pow(o,1/3):o/mn+yi}function Br([o,t,r,u]){let p=(o+16)/116,v=isNaN(t)?p:p+t/500,x=isNaN(r)?p:p-r/200;return p=1*es(p),v=Lo*es(v),x=Ao*es(x),[va(3.1338561*v-1.6168667*p-.4906146*x),va(-.9787684*v+1.9161415*p+.033454*x),va(.0719453*v-.2289914*p+1.4052427*x),u]}function va(o){return(o=o<=.00304?12.92*o:1.055*Math.pow(o,1/2.4)-.055)<0?0:o>1?1:o}function es(o){return o>Ai?o*o*o:mn*(o-yi)}let xa=Object.hasOwn||function(o,t){return Object.prototype.hasOwnProperty.call(o,t)};function an(o,t){return xa(o,t)?o[t]:void 0}function oo(o){return parseInt(o.padEnd(2,o),16)/255}function ba(o,t){return Bn(t?o/100:o,0,1)}function Bn(o,t,r){return Math.min(Math.max(t,o),r)}function vi(o){return!o.some(Number.isNaN)}let go={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function er(o,t,r){return o+r*(t-o)}function zo(o,t,r){return o.map((u,p)=>er(u,t[p],r))}class di{constructor(t,r,u,p=1,v=!0){this.r=t,this.g=r,this.b=u,this.a=p,v||(this.r*=p,this.g*=p,this.b*=p,p||this.overwriteGetter("rgb",[t,r,u,p]))}static parse(t){if(t instanceof di)return t;if(typeof t!="string")return;let r=function(u){if((u=u.toLowerCase().trim())==="transparent")return[0,0,0,0];let p=an(go,u);if(p){let[x,w,M]=p;return[x/255,w/255,M/255,1]}if(u.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(u)){let x=u.length<6?1:2,w=1;return[oo(u.slice(w,w+=x)),oo(u.slice(w,w+=x)),oo(u.slice(w,w+=x)),oo(u.slice(w,w+x)||"ff")]}if(u.startsWith("rgb")){let x=u.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(x){let[w,M,I,z,D,$,Z,G,K,ne,le,Me]=x,fe=[z||" ",Z||" ",ne].join("");if(fe==="  "||fe==="  /"||fe===",,"||fe===",,,"){let U=[I,$,K].join(""),ee=U==="%%%"?100:U===""?255:0;if(ee){let _e=[Bn(+M/ee,0,1),Bn(+D/ee,0,1),Bn(+G/ee,0,1),le?ba(+le,Me):1];if(vi(_e))return _e}}return}}let v=u.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(v){let[x,w,M,I,z,D,$,Z,G]=v,K=[M||" ",z||" ",$].join("");if(K==="  "||K==="  /"||K===",,"||K===",,,"){let ne=[+w,Bn(+I,0,100),Bn(+D,0,100),Z?ba(+Z,G):1];if(vi(ne))return function([le,Me,fe,U]){function ee(_e){let Ue=(_e+le/30)%12,st=Me*Math.min(fe,1-fe);return fe-st*Math.max(-1,Math.min(Ue-3,9-Ue,1))}return le=hi(le),Me/=100,fe/=100,[ee(0),ee(8),ee(4),U]}(ne)}}}(t);return r?new di(...r,!1):void 0}get rgb(){let{r:t,g:r,b:u,a:p}=this,v=p||1/0;return this.overwriteGetter("rgb",[t/v,r/v,u/v,p])}get hcl(){return this.overwriteGetter("hcl",function(t){let[r,u,p,v]=pn(t),x=Math.sqrt(u*u+p*p);return[Math.round(1e4*x)?hi(Math.atan2(p,u)*Kl):NaN,x,r,v]}(this.rgb))}get lab(){return this.overwriteGetter("lab",pn(this.rgb))}overwriteGetter(t,r){return Object.defineProperty(this,t,{value:r}),r}toString(){let[t,r,u,p]=this.rgb;return`rgba(${[t,r,u].map(v=>Math.round(255*v)).join(",")},${p})`}static interpolate(t,r,u,p="rgb"){switch(p){case"rgb":{let[v,x,w,M]=zo(t.rgb,r.rgb,u);return new di(v,x,w,M,!1)}case"hcl":{let[v,x,w,M]=t.hcl,[I,z,D,$]=r.hcl,Z,G;if(isNaN(v)||isNaN(I))isNaN(v)?isNaN(I)?Z=NaN:(Z=I,w!==1&&w!==0||(G=z)):(Z=v,D!==1&&D!==0||(G=x));else{let fe=I-v;I>v&&fe>180?fe-=360:I<v&&v-I>180&&(fe+=360),Z=v+u*fe}let[K,ne,le,Me]=function([fe,U,ee,_e]){return fe=isNaN(fe)?0:fe*Ja,Br([ee,Math.cos(fe)*U,Math.sin(fe)*U,_e])}([Z,G??er(x,z,u),er(w,D,u),er(M,$,u)]);return new di(K,ne,le,Me,!1)}case"lab":{let[v,x,w,M]=Br(zo(t.lab,r.lab,u));return new di(v,x,w,M,!1)}}}}di.black=new di(0,0,0,1),di.white=new di(1,1,1,1),di.transparent=new di(0,0,0,0),di.red=new di(1,0,0,1);class wa{constructor(t,r,u){this.sensitivity=t?r?"variant":"case":r?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,r){return this.collator.compare(t,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}let Ta=["bottom","center","top"];class Ro{constructor(t,r,u,p,v,x){this.text=t,this.image=r,this.scale=u,this.fontStack=p,this.textColor=v,this.verticalAlign=x}}class yr{constructor(t){this.sections=t}static fromString(t){return new yr([new Ro(t,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof yr?t:yr.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class On{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof On)return t;if(typeof t=="number")return new On([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(let r of t)if(typeof r!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new On(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,r,u){return new On(zo(t.values,r.values,u))}}class Sn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Sn)return t;if(typeof t=="number")return new Sn([t]);if(Array.isArray(t)){for(let r of t)if(typeof r!="number")return;return new Sn(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,r,u){return new Sn(zo(t.values,r.values,u))}}class Ut{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Ut)return t;if(typeof t=="string"){let u=di.parse(t);return u?new Ut([u]):void 0}if(!Array.isArray(t))return;let r=[];for(let u of t){if(typeof u!="string")return;let p=di.parse(u);if(!p)return;r.push(p)}return new Ut(r)}toString(){return JSON.stringify(this.values)}static interpolate(t,r,u,p="rgb"){let v=[];if(t.values.length!=r.values.length)throw new Error(`colorArray: Arrays have mismatched length (${t.values.length} vs. ${r.values.length}), cannot interpolate.`);for(let x=0;x<t.values.length;x++)v.push(di.interpolate(t.values[x],r.values[x],u,p));return new Ut(v)}}class Ei extends Error{constructor(t){super(t),this.name="RuntimeError"}toJSON(){return this.message}}let Di=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class lr{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof lr)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let r=0;r<t.length;r+=2){let u=t[r],p=t[r+1];if(typeof u!="string"||!Di.has(u)||!Array.isArray(p)||p.length!==2||typeof p[0]!="number"||typeof p[1]!="number")return}return new lr(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,r,u){let p=t.values,v=r.values;if(p.length!==v.length)throw new Ei(`Cannot interpolate values of different length. from: ${t.toString()}, to: ${r.toString()}`);let x=[];for(let w=0;w<p.length;w+=2){if(p[w]!==v[w])throw new Ei(`Cannot interpolate values containing mismatched anchors. from[${w}]: ${p[w]}, to[${w}]: ${v[w]}`);x.push(p[w]);let[M,I]=p[w+1],[z,D]=v[w+1];x.push([er(M,z,u),er(I,D,u)])}return new lr(x)}}class vr{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new vr({name:t,available:!1}):null}}class cr{constructor(t,r,u){this.from=t,this.to=r,this.transition=u}static interpolate(t,r,u){return new cr(t,r,u)}static parse(t){return t instanceof cr?t:Array.isArray(t)&&t.length===3&&typeof t[0]=="string"&&typeof t[1]=="string"&&typeof t[2]=="number"?new cr(t[0],t[1],t[2]):typeof t=="object"&&typeof t.from=="string"&&typeof t.to=="string"&&typeof t.transition=="number"?new cr(t.from,t.to,t.transition):typeof t=="string"?new cr(t,t,1):void 0}}function Sa(o,t,r,u){return typeof o=="number"&&o>=0&&o<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[o,t,r,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[o,t,r,u]:[o,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Li(o){if(o===null||typeof o=="string"||typeof o=="boolean"||typeof o=="number"||o instanceof cr||o instanceof di||o instanceof wa||o instanceof yr||o instanceof On||o instanceof Sn||o instanceof Ut||o instanceof lr||o instanceof vr)return!0;if(Array.isArray(o)){for(let t of o)if(!Li(t))return!1;return!0}if(typeof o=="object"){for(let t in o)if(!Li(o[t]))return!1;return!0}return!1}function Ji(o){if(o===null)return Zt;if(typeof o=="string")return Nt;if(typeof o=="boolean")return Kt;if(typeof o=="number")return ot;if(o instanceof di)return Hi;if(o instanceof cr)return $i;if(o instanceof wa)return Qo;if(o instanceof yr)return We;if(o instanceof On)return Pi;if(o instanceof Sn)return nn;if(o instanceof Ut)return tn;if(o instanceof lr)return zi;if(o instanceof vr)return rn;if(Array.isArray(o)){let t=o.length,r;for(let u of o){let p=Ji(u);if(r){if(r===p)continue;r=ei;break}r=p}return on(r||ei,t)}return Qn}function si(o){let t=typeof o;return o===null?"":t==="string"||t==="number"||t==="boolean"?String(o):o instanceof di||o instanceof cr||o instanceof yr||o instanceof On||o instanceof Sn||o instanceof Ut||o instanceof lr||o instanceof vr?o.toString():JSON.stringify(o)}class Bt{constructor(t,r){this.type=t,this.value=r}static parse(t,r){if(t.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Li(t[1]))return r.error("invalid value");let u=t[1],p=Ji(u),v=r.expectedType;return p.kind!=="array"||p.N!==0||!v||v.kind!=="array"||typeof v.N=="number"&&v.N!==0||(p=v),new Bt(p,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}let Wr={string:Nt,number:ot,boolean:Kt,object:Qn};class ti{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let u,p=1,v=t[0];if(v==="array"){let w,M;if(t.length>2){let I=t[1];if(typeof I!="string"||!(I in Wr)||I==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);w=Wr[I],p++}else w=ei;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return r.error('The length argument to "array" must be a positive integer literal',2);M=t[2],p++}u=on(w,M)}else{if(!Wr[v])throw new Error(`Types doesn't contain name = ${v}`);u=Wr[v]}let x=[];for(;p<t.length;p++){let w=r.parse(t[p],p,ei);if(!w)return null;x.push(w)}return new ti(u,x)}evaluate(t){for(let r=0;r<this.args.length;r++){let u=this.args[r].evaluate(t);if(!Dn(this.type,Ji(u)))return u;if(r===this.args.length-1)throw new Ei(`Expected value to be of type ${qt(this.type)}, but found ${qt(Ji(u))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}let zs={"to-boolean":Kt,"to-color":Hi,"to-number":ot,"to-string":Nt};class ur{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let u=t[0];if(!zs[u])throw new Error(`Can't parse ${u} as it is not part of the known types`);if((u==="to-boolean"||u==="to-string")&&t.length!==2)return r.error("Expected one argument.");let p=zs[u],v=[];for(let x=1;x<t.length;x++){let w=r.parse(t[x],x,ei);if(!w)return null;v.push(w)}return new ur(p,v)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let r,u;for(let p of this.args){if(r=p.evaluate(t),u=null,r instanceof di)return r;if(typeof r=="string"){let v=t.parseColor(r);if(v)return v}else if(Array.isArray(r)&&(u=r.length<3||r.length>4?`Invalid rgba value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:Sa(r[0],r[1],r[2],r[3]),!u))return new di(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Ei(u||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(let u of this.args){r=u.evaluate(t);let p=On.parse(r);if(p)return p}throw new Ei(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"numberArray":{let r;for(let u of this.args){r=u.evaluate(t);let p=Sn.parse(r);if(p)return p}throw new Ei(`Could not parse numberArray from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"colorArray":{let r;for(let u of this.args){r=u.evaluate(t);let p=Ut.parse(r);if(p)return p}throw new Ei(`Could not parse colorArray from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(let u of this.args){r=u.evaluate(t);let p=lr.parse(r);if(p)return p}throw new Ei(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(let u of this.args){if(r=u.evaluate(t),r===null)return 0;let p=Number(r);if(!isNaN(p))return p}throw new Ei(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return yr.fromString(si(this.args[0].evaluate(t)));case"resolvedImage":return vr.fromString(si(this.args[0].evaluate(t)));case"projectionDefinition":return this.args[0].evaluate(t);default:return si(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}let fl=["Unknown","Point","LineString","Polygon"];class Rs{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?fl[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let r=this._parseColorCache.get(t);return r||(r=di.parse(t),this._parseColorCache.set(t,r)),r}}class Ds{constructor(t,r,u=[],p,v=new Si,x=[]){this.registry=t,this.path=u,this.key=u.map(w=>`[${w}]`).join(""),this.scope=v,this.errors=x,this.expectedType=p,this._isConstant=r}parse(t,r,u,p,v={}){return r?this.concat(r,u,p)._parse(t,v):this._parse(t,v)}_parse(t,r){function u(p,v,x){return x==="assert"?new ti(v,[p]):x==="coerce"?new ur(v,[p]):p}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let p=t[0];if(typeof p!="string")return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;let v=this.registry[p];if(v){let x=v.parse(t,this);if(!x)return null;if(this.expectedType){let w=this.expectedType,M=x.type;if(w.kind!=="string"&&w.kind!=="number"&&w.kind!=="boolean"&&w.kind!=="object"&&w.kind!=="array"||M.kind!=="value"){if(w.kind==="projectionDefinition"&&["string","array"].includes(M.kind)||["color","formatted","resolvedImage"].includes(w.kind)&&["value","string"].includes(M.kind)||["padding","numberArray"].includes(w.kind)&&["value","number","array"].includes(M.kind)||w.kind==="colorArray"&&["value","string","array"].includes(M.kind)||w.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(M.kind))x=u(x,w,r.typeAnnotation||"coerce");else if(this.checkSubtype(w,M))return null}else x=u(x,w,r.typeAnnotation||"assert")}if(!(x instanceof Bt)&&x.type.kind!=="resolvedImage"&&this._isConstant(x)){let w=new Rs;try{x=new Bt(x.type,x.evaluate(w))}catch(M){return this.error(M.message),null}}return x}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,r,u){let p=typeof t=="number"?this.path.concat(t):this.path,v=u?this.scope.concat(u):this.scope;return new Ds(this.registry,this._isConstant,p,r||null,v,this.errors)}error(t,...r){let u=`${this.key}${r.map(p=>`[${p}]`).join("")}`;this.errors.push(new ft(u,t))}checkSubtype(t,r){let u=Dn(t,r);return u&&this.error(u),u}}class Pa{constructor(t,r){this.type=r.type,this.bindings=[].concat(t),this.result=r}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(let r of this.bindings)t(r[1]);t(this.result)}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);let u=[];for(let v=1;v<t.length-1;v+=2){let x=t[v];if(typeof x!="string")return r.error(`Expected string, but found ${typeof x} instead.`,v);if(/[^a-zA-Z0-9_]/.test(x))return r.error("Variable names must contain only alphanumeric characters or '_'.",v);let w=r.parse(t[v+1],v+1);if(!w)return null;u.push([x,w])}let p=r.parse(t[t.length-1],t.length-1,r.expectedType,u);return p?new Pa(u,p):null}outputDefined(){return this.result.outputDefined()}}class xi{constructor(t,r){this.type=r.type,this.name=t,this.boundExpression=r}static parse(t,r){if(t.length!==2||typeof t[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");let u=t[1];return r.scope.has(u)?new xi(u,r.scope.get(u)):r.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class Xl{constructor(t,r,u){this.type=t,this.index=r,this.input=u}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);let u=r.parse(t[1],1,ot),p=r.parse(t[2],2,on(r.expectedType||ei));return u&&p?new Xl(p.type.itemType,u,p):null}evaluate(t){let r=this.index.evaluate(t),u=this.input.evaluate(t);if(r<0)throw new Ei(`Array index out of bounds: ${r} < 0.`);if(r>=u.length)throw new Ei(`Array index out of bounds: ${r} > ${u.length-1}.`);if(r!==Math.floor(r))throw new Ei(`Array index must be an integer, but found ${r} instead.`);return u[r]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class Mr{constructor(t,r){this.type=Kt,this.needle=t,this.haystack=r}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);let u=r.parse(t[1],1,ei),p=r.parse(t[2],2,ei);return u&&p?Eo(u.type,[Kt,Nt,ot,Zt,ei])?new Mr(u,p):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${qt(u.type)} instead`):null}evaluate(t){let r=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!u)return!1;if(!kn(r,["boolean","string","number","null"]))throw new Ei(`Expected first argument to be of type boolean, string, number or null, but found ${qt(Ji(r))} instead.`);if(!kn(u,["string","array"]))throw new Ei(`Expected second argument to be of type array or string, but found ${qt(Ji(u))} instead.`);return u.indexOf(r)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class Do{constructor(t,r,u){this.type=ot,this.needle=t,this.haystack=r,this.fromIndex=u}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);let u=r.parse(t[1],1,ei),p=r.parse(t[2],2,ei);if(!u||!p)return null;if(!Eo(u.type,[Kt,Nt,ot,Zt,ei]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${qt(u.type)} instead`);if(t.length===4){let v=r.parse(t[3],3,ot);return v?new Do(u,p,v):null}return new Do(u,p)}evaluate(t){let r=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!kn(r,["boolean","string","number","null"]))throw new Ei(`Expected first argument to be of type boolean, string, number or null, but found ${qt(Ji(r))} instead.`);let p;if(this.fromIndex&&(p=this.fromIndex.evaluate(t)),kn(u,["string"])){let v=u.indexOf(r,p);return v===-1?-1:[...u.slice(0,v)].length}if(kn(u,["array"]))return u.indexOf(r,p);throw new Ei(`Expected second argument to be of type array or string, but found ${qt(Ji(u))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class ea{constructor(t,r,u,p,v,x){this.inputType=t,this.type=r,this.input=u,this.cases=p,this.outputs=v,this.otherwise=x}static parse(t,r){if(t.length<5)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return r.error("Expected an even number of arguments.");let u,p;r.expectedType&&r.expectedType.kind!=="value"&&(p=r.expectedType);let v={},x=[];for(let I=2;I<t.length-1;I+=2){let z=t[I],D=t[I+1];Array.isArray(z)||(z=[z]);let $=r.concat(I);if(z.length===0)return $.error("Expected at least one branch label.");for(let G of z){if(typeof G!="number"&&typeof G!="string")return $.error("Branch labels must be numbers or strings.");if(typeof G=="number"&&Math.abs(G)>Number.MAX_SAFE_INTEGER)return $.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof G=="number"&&Math.floor(G)!==G)return $.error("Numeric branch labels must be integer values.");if(u){if($.checkSubtype(u,Ji(G)))return null}else u=Ji(G);if(v[String(G)]!==void 0)return $.error("Branch labels must be unique.");v[String(G)]=x.length}let Z=r.parse(D,I,p);if(!Z)return null;p=p||Z.type,x.push(Z)}let w=r.parse(t[1],1,ei);if(!w)return null;let M=r.parse(t[t.length-1],t.length-1,p);return M?w.type.kind!=="value"&&r.concat(1).checkSubtype(u,w.type)?null:new ea(u,p,w,v,x,M):null}evaluate(t){let r=this.input.evaluate(t);return(Ji(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class $n{constructor(t,r,u){this.type=t,this.branches=r,this.otherwise=u}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return r.error("Expected an odd number of arguments.");let u;r.expectedType&&r.expectedType.kind!=="value"&&(u=r.expectedType);let p=[];for(let x=1;x<t.length-1;x+=2){let w=r.parse(t[x],x,Kt);if(!w)return null;let M=r.parse(t[x+1],x+1,u);if(!M)return null;p.push([w,M]),u=u||M.type}let v=r.parse(t[t.length-1],t.length-1,u);if(!v)return null;if(!u)throw new Error("Can't infer output type");return new $n(u,p,v)}evaluate(t){for(let[r,u]of this.branches)if(r.evaluate(t))return u.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(let[r,u]of this.branches)t(r),t(u);t(this.otherwise)}outputDefined(){return this.branches.every(([t,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class Bo{constructor(t,r,u,p){this.type=t,this.input=r,this.beginIndex=u,this.endIndex=p}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);let u=r.parse(t[1],1,ei),p=r.parse(t[2],2,ot);if(!u||!p)return null;if(!Eo(u.type,[on(ei),Nt,ei]))return r.error(`Expected first argument to be of type array or string, but found ${qt(u.type)} instead`);if(t.length===4){let v=r.parse(t[3],3,ot);return v?new Bo(u.type,u,p,v):null}return new Bo(u.type,u,p)}evaluate(t){let r=this.input.evaluate(t),u=this.beginIndex.evaluate(t),p;if(this.endIndex&&(p=this.endIndex.evaluate(t)),kn(r,["string"]))return[...r].slice(u,p).join("");if(kn(r,["array"]))return r.slice(u,p);throw new Ei(`Expected first argument to be of type array or string, but found ${qt(Ji(r))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Bs(o,t){let r=o.length-1,u,p,v=0,x=r,w=0;for(;v<=x;)if(w=Math.floor((v+x)/2),u=o[w],p=o[w+1],u<=t){if(w===r||t<p)return w;v=w+1}else{if(!(u>t))throw new Ei("Input is not a number.");x=w-1}return 0}class Oo{constructor(t,r,u){this.type=t,this.input=r,this.labels=[],this.outputs=[];for(let[p,v]of u)this.labels.push(p),this.outputs.push(v)}static parse(t,r){if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");let u=r.parse(t[1],1,ot);if(!u)return null;let p=[],v=null;r.expectedType&&r.expectedType.kind!=="value"&&(v=r.expectedType);for(let x=1;x<t.length;x+=2){let w=x===1?-1/0:t[x],M=t[x+1],I=x,z=x+1;if(typeof w!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(p.length&&p[p.length-1][0]>=w)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',I);let D=r.parse(M,z,v);if(!D)return null;v=v||D.type,p.push([w,D])}return new Oo(v,u,p)}evaluate(t){let r=this.labels,u=this.outputs;if(r.length===1)return u[0].evaluate(t);let p=this.input.evaluate(t);if(p<=r[0])return u[0].evaluate(t);let v=r.length;return p>=r[v-1]?u[v-1].evaluate(t):u[Bs(r,p)].evaluate(t)}eachChild(t){t(this.input);for(let r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Un(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var ml,ts,Wc=function(){if(ts)return ml;function o(t,r,u,p){this.cx=3*t,this.bx=3*(u-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(p-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=u,this.p2y=p}return ts=1,ml=o,o.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,r){if(r===void 0&&(r=1e-6),t<0)return 0;if(t>1)return 1;for(var u=t,p=0;p<8;p++){var v=this.sampleCurveX(u)-t;if(Math.abs(v)<r)return u;var x=this.sampleCurveDerivativeX(u);if(Math.abs(x)<1e-6)break;u-=v/x}var w=0,M=1;for(u=t,p=0;p<20&&(v=this.sampleCurveX(u),!(Math.abs(v-t)<r));p++)t>v?w=u:M=u,u=.5*(M-w)+w;return u},solve:function(t,r){return this.sampleCurveY(this.solveCurveX(t,r))}},ml}(),_o=Un(Wc);class hr{constructor(t,r,u,p,v){this.type=t,this.operator=r,this.interpolation=u,this.input=p,this.labels=[],this.outputs=[];for(let[x,w]of v)this.labels.push(x),this.outputs.push(w)}static interpolationFactor(t,r,u,p){let v=0;if(t.name==="exponential")v=is(r,t.base,u,p);else if(t.name==="linear")v=is(r,1,u,p);else if(t.name==="cubic-bezier"){let x=t.controlPoints;v=new _o(x[0],x[1],x[2],x[3]).solve(is(r,1,u,p))}return v}static parse(t,r){let[u,p,v,...x]=t;if(!Array.isArray(p)||p.length===0)return r.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){let I=p[1];if(typeof I!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:I}}else{if(p[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(p[0])}`,1,0);{let I=p.slice(1);if(I.length!==4||I.some(z=>typeof z!="number"||z<0||z>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:I}}}if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(v=r.parse(v,2,ot),!v)return null;let w=[],M=null;u!=="interpolate-hcl"&&u!=="interpolate-lab"||r.expectedType==tn?r.expectedType&&r.expectedType.kind!=="value"&&(M=r.expectedType):M=Hi;for(let I=0;I<x.length;I+=2){let z=x[I],D=x[I+1],$=I+3,Z=I+4;if(typeof z!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',$);if(w.length&&w[w.length-1][0]>=z)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',$);let G=r.parse(D,Z,M);if(!G)return null;M=M||G.type,w.push([z,G])}return Dr(M,ot)||Dr(M,$i)||Dr(M,Hi)||Dr(M,Pi)||Dr(M,nn)||Dr(M,tn)||Dr(M,zi)||Dr(M,on(ot))?new hr(M,u,p,v,w):r.error(`Type ${qt(M)} is not interpolatable.`)}evaluate(t){let r=this.labels,u=this.outputs;if(r.length===1)return u[0].evaluate(t);let p=this.input.evaluate(t);if(p<=r[0])return u[0].evaluate(t);let v=r.length;if(p>=r[v-1])return u[v-1].evaluate(t);let x=Bs(r,p),w=hr.interpolationFactor(this.interpolation,p,r[x],r[x+1]),M=u[x].evaluate(t),I=u[x+1].evaluate(t);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return er(M,I,w);case"color":return di.interpolate(M,I,w);case"padding":return On.interpolate(M,I,w);case"colorArray":return Ut.interpolate(M,I,w);case"numberArray":return Sn.interpolate(M,I,w);case"variableAnchorOffsetCollection":return lr.interpolate(M,I,w);case"array":return zo(M,I,w);case"projectionDefinition":return cr.interpolate(M,I,w)}case"interpolate-hcl":switch(this.type.kind){case"color":return di.interpolate(M,I,w,"hcl");case"colorArray":return Ut.interpolate(M,I,w,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return di.interpolate(M,I,w,"lab");case"colorArray":return Ut.interpolate(M,I,w,"lab")}}}eachChild(t){t(this.input);for(let r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function is(o,t,r,u){let p=u-r,v=o-r;return p===0?0:t===1?v/p:(Math.pow(t,v)-1)/(Math.pow(t,p)-1)}let tr={color:di.interpolate,number:er,padding:On.interpolate,numberArray:Sn.interpolate,colorArray:Ut.interpolate,variableAnchorOffsetCollection:lr.interpolate,array:zo};class ta{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let u=null,p=r.expectedType;p&&p.kind!=="value"&&(u=p);let v=[];for(let w of t.slice(1)){let M=r.parse(w,1+v.length,u,void 0,{typeAnnotation:"omit"});if(!M)return null;u=u||M.type,v.push(M)}if(!u)throw new Error("No output type");let x=p&&v.some(w=>Dn(p,w.type));return new ta(x?ei:u,v)}evaluate(t){let r,u=null,p=0;for(let v of this.args)if(p++,u=v.evaluate(t),u&&u instanceof vr&&!u.available&&(r||(r=u.name),u=null,p===this.args.length&&(u=r)),u!==null)break;return u}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function ns(o,t){return o==="=="||o==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Cr(o,t,r,u){return u.compare(t,r)===0}function Ma(o,t,r){let u=o!=="=="&&o!=="!=";return class h0{constructor(v,x,w){this.type=Kt,this.lhs=v,this.rhs=x,this.collator=w,this.hasUntypedArgument=v.type.kind==="value"||x.type.kind==="value"}static parse(v,x){if(v.length!==3&&v.length!==4)return x.error("Expected two or three arguments.");let w=v[0],M=x.parse(v[1],1,ei);if(!M)return null;if(!ns(w,M.type))return x.concat(1).error(`"${w}" comparisons are not supported for type '${qt(M.type)}'.`);let I=x.parse(v[2],2,ei);if(!I)return null;if(!ns(w,I.type))return x.concat(2).error(`"${w}" comparisons are not supported for type '${qt(I.type)}'.`);if(M.type.kind!==I.type.kind&&M.type.kind!=="value"&&I.type.kind!=="value")return x.error(`Cannot compare types '${qt(M.type)}' and '${qt(I.type)}'.`);u&&(M.type.kind==="value"&&I.type.kind!=="value"?M=new ti(I.type,[M]):M.type.kind!=="value"&&I.type.kind==="value"&&(I=new ti(M.type,[I])));let z=null;if(v.length===4){if(M.type.kind!=="string"&&I.type.kind!=="string"&&M.type.kind!=="value"&&I.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(z=x.parse(v[3],3,Qo),!z)return null}return new h0(M,I,z)}evaluate(v){let x=this.lhs.evaluate(v),w=this.rhs.evaluate(v);if(u&&this.hasUntypedArgument){let M=Ji(x),I=Ji(w);if(M.kind!==I.kind||M.kind!=="string"&&M.kind!=="number")throw new Ei(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${M.kind}, ${I.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){let M=Ji(x),I=Ji(w);if(M.kind!=="string"||I.kind!=="string")return t(v,x,w)}return this.collator?r(v,x,w,this.collator.evaluate(v)):t(v,x,w)}eachChild(v){v(this.lhs),v(this.rhs),this.collator&&v(this.collator)}outputDefined(){return!0}}}let Os=Ma("==",function(o,t,r){return t===r},Cr),Hc=Ma("!=",function(o,t,r){return t!==r},function(o,t,r,u){return!Cr(0,t,r,u)}),Yl=Ma("<",function(o,t,r){return t<r},function(o,t,r,u){return u.compare(t,r)<0}),eh=Ma(">",function(o,t,r){return t>r},function(o,t,r,u){return u.compare(t,r)>0}),Jl=Ma("<=",function(o,t,r){return t<=r},function(o,t,r,u){return u.compare(t,r)<=0}),th=Ma(">=",function(o,t,r){return t>=r},function(o,t,r,u){return u.compare(t,r)>=0});class Fs{constructor(t,r,u){this.type=Qo,this.locale=u,this.caseSensitive=t,this.diacriticSensitive=r}static parse(t,r){if(t.length!==2)return r.error("Expected one argument.");let u=t[1];if(typeof u!="object"||Array.isArray(u))return r.error("Collator options argument must be an object.");let p=r.parse(u["case-sensitive"]!==void 0&&u["case-sensitive"],1,Kt);if(!p)return null;let v=r.parse(u["diacritic-sensitive"]!==void 0&&u["diacritic-sensitive"],1,Kt);if(!v)return null;let x=null;return u.locale&&(x=r.parse(u.locale,1,Nt),!x)?null:new Fs(p,v,x)}evaluate(t){return new wa(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class Ca{constructor(t,r,u,p,v){this.type=Nt,this.number=t,this.locale=r,this.currency=u,this.minFractionDigits=p,this.maxFractionDigits=v}static parse(t,r){if(t.length!==3)return r.error("Expected two arguments.");let u=r.parse(t[1],1,ot);if(!u)return null;let p=t[2];if(typeof p!="object"||Array.isArray(p))return r.error("NumberFormat options argument must be an object.");let v=null;if(p.locale&&(v=r.parse(p.locale,1,Nt),!v))return null;let x=null;if(p.currency&&(x=r.parse(p.currency,1,Nt),!x))return null;let w=null;if(p["min-fraction-digits"]&&(w=r.parse(p["min-fraction-digits"],1,ot),!w))return null;let M=null;return p["max-fraction-digits"]&&(M=r.parse(p["max-fraction-digits"],1,ot),!M)?null:new Ca(u,v,x,w,M)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Ia{constructor(t){this.type=We,this.sections=t}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let u=t[1];if(!Array.isArray(u)&&typeof u=="object")return r.error("First argument must be an image or text section.");let p=[],v=!1;for(let x=1;x<=t.length-1;++x){let w=t[x];if(v&&typeof w=="object"&&!Array.isArray(w)){v=!1;let M=null;if(w["font-scale"]&&(M=r.parse(w["font-scale"],1,ot),!M))return null;let I=null;if(w["text-font"]&&(I=r.parse(w["text-font"],1,on(Nt)),!I))return null;let z=null;if(w["text-color"]&&(z=r.parse(w["text-color"],1,Hi),!z))return null;let D=null;if(w["vertical-align"]){if(typeof w["vertical-align"]=="string"&&!Ta.includes(w["vertical-align"]))return r.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${w["vertical-align"]}' instead.`);if(D=r.parse(w["vertical-align"],1,Nt),!D)return null}let $=p[p.length-1];$.scale=M,$.font=I,$.textColor=z,$.verticalAlign=D}else{let M=r.parse(t[x],1,ei);if(!M)return null;let I=M.type.kind;if(I!=="string"&&I!=="value"&&I!=="null"&&I!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,p.push({content:M,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Ia(p)}evaluate(t){return new yr(this.sections.map(r=>{let u=r.content.evaluate(t);return Ji(u)===rn?new Ro("",u,null,null,null,r.verticalAlign?r.verticalAlign.evaluate(t):null):new Ro(si(u),null,r.scale?r.scale.evaluate(t):null,r.font?r.font.evaluate(t).join(","):null,r.textColor?r.textColor.evaluate(t):null,r.verticalAlign?r.verticalAlign.evaluate(t):null)}))}eachChild(t){for(let r of this.sections)t(r.content),r.scale&&t(r.scale),r.font&&t(r.font),r.textColor&&t(r.textColor),r.verticalAlign&&t(r.verticalAlign)}outputDefined(){return!1}}class yo{constructor(t){this.type=rn,this.input=t}static parse(t,r){if(t.length!==2)return r.error("Expected two arguments.");let u=r.parse(t[1],1,Nt);return u?new yo(u):r.error("No image name provided.")}evaluate(t){let r=this.input.evaluate(t),u=vr.fromString(r);return u&&t.availableImages&&(u.available=t.availableImages.indexOf(r)>-1),u}eachChild(t){t(this.input)}outputDefined(){return!1}}class gl{constructor(t){this.type=ot,this.input=t}static parse(t,r){if(t.length!==2)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);let u=r.parse(t[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${qt(u.type)} instead.`):new gl(u):null}evaluate(t){let r=this.input.evaluate(t);if(typeof r=="string")return[...r].length;if(Array.isArray(r))return r.length;throw new Ei(`Expected value to be of type string or array, but found ${qt(Ji(r))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}let Ir=8192;function Or(o,t){let r=(180+o[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,p=Math.pow(2,t.z);return[Math.round(r*p*Ir),Math.round(u*p*Ir)]}function _l(o,t){let r=Math.pow(2,t.z);return[(p=(o[0]/Ir+t.x)/r,360*p-180),(u=(o[1]/Ir+t.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90)];var u,p}function rs(o,t){o[0]=Math.min(o[0],t[0]),o[1]=Math.min(o[1],t[1]),o[2]=Math.max(o[2],t[0]),o[3]=Math.max(o[3],t[1])}function Ns(o,t){return!(o[0]<=t[0]||o[2]>=t[2]||o[1]<=t[1]||o[3]>=t[3])}function Ql(o,t,r){let u=o[0]-t[0],p=o[1]-t[1],v=o[0]-r[0],x=o[1]-r[1];return u*x-v*p==0&&u*v<=0&&p*x<=0}function os(o,t,r,u){return(p=[u[0]-r[0],u[1]-r[1]])[0]*(v=[t[0]-o[0],t[1]-o[1]])[1]-p[1]*v[0]!=0&&!(!La(o,t,r,u)||!La(r,u,o,t));var p,v}function Kc(o,t,r){for(let u of r)for(let p=0;p<u.length-1;++p)if(os(o,t,u[p],u[p+1]))return!0;return!1}function Ea(o,t,r=!1){let u=!1;for(let w of t)for(let M=0;M<w.length-1;M++){if(Ql(o,w[M],w[M+1]))return r;(v=w[M])[1]>(p=o)[1]!=(x=w[M+1])[1]>p[1]&&p[0]<(x[0]-v[0])*(p[1]-v[1])/(x[1]-v[1])+v[0]&&(u=!u)}var p,v,x;return u}function ec(o,t){for(let r of t)if(Ea(o,r))return!0;return!1}function Xc(o,t){for(let r of o)if(!Ea(r,t))return!1;for(let r=0;r<o.length-1;++r)if(Kc(o[r],o[r+1],t))return!1;return!0}function ao(o,t){for(let r of t)if(Xc(o,r))return!0;return!1}function La(o,t,r,u){let p=u[0]-r[0],v=u[1]-r[1],x=(o[0]-r[0])*v-p*(o[1]-r[1]),w=(t[0]-r[0])*v-p*(t[1]-r[1]);return x>0&&w<0||x<0&&w>0}function js(o,t,r){let u=[];for(let p=0;p<o.length;p++){let v=[];for(let x=0;x<o[p].length;x++){let w=Or(o[p][x],r);rs(t,w),v.push(w)}u.push(v)}return u}function vo(o,t,r){let u=[];for(let p=0;p<o.length;p++){let v=js(o[p],t,r);u.push(v)}return u}function Yc(o,t,r,u){if(o[0]<r[0]||o[0]>r[2]){let p=.5*u,v=o[0]-r[0]>p?-u:r[0]-o[0]>p?u:0;v===0&&(v=o[0]-r[2]>p?-u:r[2]-o[0]>p?u:0),o[0]+=v}rs(t,o)}function Aa(o,t,r,u){let p=Math.pow(2,u.z)*Ir,v=[u.x*Ir,u.y*Ir],x=[];for(let w of o)for(let M of w){let I=[M.x+v[0],M.y+v[1]];Yc(I,t,r,p),x.push(I)}return x}function tc(o,t,r,u){let p=Math.pow(2,u.z)*Ir,v=[u.x*Ir,u.y*Ir],x=[];for(let M of o){let I=[];for(let z of M){let D=[z.x+v[0],z.y+v[1]];rs(t,D),I.push(D)}x.push(I)}if(t[2]-t[0]<=p/2){(w=t)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(let M of x)for(let I of M)Yc(I,t,r,p)}var w;return x}class Hr{constructor(t,r){this.type=Kt,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Li(t[1])){let u=t[1];if(u.type==="FeatureCollection"){let p=[];for(let v of u.features){let{type:x,coordinates:w}=v.geometry;x==="Polygon"&&p.push(w),x==="MultiPolygon"&&p.push(...w)}if(p.length)return new Hr(u,{type:"MultiPolygon",coordinates:p})}else if(u.type==="Feature"){let p=u.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new Hr(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new Hr(u,u)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,u){let p=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],x=r.canonicalID();if(u.type==="Polygon"){let w=js(u.coordinates,v,x),M=Aa(r.geometry(),p,v,x);if(!Ns(p,v))return!1;for(let I of M)if(!Ea(I,w))return!1}if(u.type==="MultiPolygon"){let w=vo(u.coordinates,v,x),M=Aa(r.geometry(),p,v,x);if(!Ns(p,v))return!1;for(let I of M)if(!ec(I,w))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,u){let p=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],x=r.canonicalID();if(u.type==="Polygon"){let w=js(u.coordinates,v,x),M=tc(r.geometry(),p,v,x);if(!Ns(p,v))return!1;for(let I of M)if(!Xc(I,w))return!1}if(u.type==="MultiPolygon"){let w=vo(u.coordinates,v,x),M=tc(r.geometry(),p,v,x);if(!Ns(p,v))return!1;for(let I of M)if(!ao(I,w))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let ic=class{constructor(o=[],t=(r,u)=>r<u?-1:r>u?1:0){if(this.data=o,this.length=this.data.length,this.compare=t,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(o){this.data.push(o),this._up(this.length++)}pop(){if(this.length===0)return;let o=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),o}peek(){return this.data[0]}_up(o){let{data:t,compare:r}=this,u=t[o];for(;o>0;){let p=o-1>>1,v=t[p];if(r(u,v)>=0)break;t[o]=v,o=p}t[o]=u}_down(o){let{data:t,compare:r}=this,u=this.length>>1,p=t[o];for(;o<u;){let v=1+(o<<1),x=v+1;if(x<this.length&&r(t[x],t[v])<0&&(v=x),r(t[v],p)>=0)break;t[o]=t[v],o=v}t[o]=p}};function $s(o,t,r=0,u=o.length-1,p=Fo){for(;u>r;){if(u-r>600){let M=u-r+1,I=t-r+1,z=Math.log(M),D=.5*Math.exp(2*z/3),$=.5*Math.sqrt(z*D*(M-D)/M)*(I-M/2<0?-1:1);$s(o,t,Math.max(r,Math.floor(t-I*D/M+$)),Math.min(u,Math.floor(t+(M-I)*D/M+$)),p)}let v=o[t],x=r,w=u;for(as(o,r,t),p(o[u],v)>0&&as(o,r,u);x<w;){for(as(o,x,w),x++,w--;p(o[x],v)<0;)x++;for(;p(o[w],v)>0;)w--}p(o[r],v)===0?as(o,r,w):(w++,as(o,w,u)),w<=t&&(r=w+1),t<=w&&(u=w-1)}}function as(o,t,r){let u=o[t];o[t]=o[r],o[r]=u}function Fo(o,t){return o<t?-1:o>t?1:0}function ka(o,t){if(o.length<=1)return[o];let r=[],u,p;for(let v of o){let x=nc(v);x!==0&&(v.area=Math.abs(x),p===void 0&&(p=x<0),p===x<0?(u&&r.push(u),u=[v]):u.push(v))}if(u&&r.push(u),t>1)for(let v=0;v<r.length;v++)r[v].length<=t||($s(r[v],t,1,r[v].length-1,ih),r[v]=r[v].slice(0,t));return r}function ih(o,t){return t.area-o.area}function nc(o){let t=0;for(let r,u,p=0,v=o.length,x=v-1;p<v;x=p++)r=o[p],u=o[x],t+=(u.x-r.x)*(r.y+u.y);return t}let rc=1/298.257223563,xo=rc*(2-rc),Jc=Math.PI/180;class ia{constructor(t){let r=6378.137*Jc*1e3,u=Math.cos(t*Jc),p=1/(1-xo*(1-u*u)),v=Math.sqrt(p);this.kx=r*v*u,this.ky=r*v*p*(1-xo)}distance(t,r){let u=this.wrap(t[0]-r[0])*this.kx,p=(t[1]-r[1])*this.ky;return Math.sqrt(u*u+p*p)}pointOnLine(t,r){let u,p,v,x,w=1/0;for(let M=0;M<t.length-1;M++){let I=t[M][0],z=t[M][1],D=this.wrap(t[M+1][0]-I)*this.kx,$=(t[M+1][1]-z)*this.ky,Z=0;D===0&&$===0||(Z=(this.wrap(r[0]-I)*this.kx*D+(r[1]-z)*this.ky*$)/(D*D+$*$),Z>1?(I=t[M+1][0],z=t[M+1][1]):Z>0&&(I+=D/this.kx*Z,z+=$/this.ky*Z)),D=this.wrap(r[0]-I)*this.kx,$=(r[1]-z)*this.ky;let G=D*D+$*$;G<w&&(w=G,u=I,p=z,v=M,x=Z)}return{point:[u,p],index:v,t:Math.max(0,Math.min(1,x))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function Qc(o,t){return t[0]-o[0]}function oi(o){return o[1]-o[0]+1}function Kr(o,t){return o[1]>=o[0]&&o[1]<t}function yl(o,t){if(o[0]>o[1])return[null,null];let r=oi(o);if(t){if(r===2)return[o,null];let p=Math.floor(r/2);return[[o[0],o[0]+p],[o[0]+p,o[1]]]}if(r===1)return[o,null];let u=Math.floor(r/2)-1;return[[o[0],o[0]+u],[o[0]+u+1,o[1]]]}function Us(o,t){if(!Kr(t,o.length))return[1/0,1/0,-1/0,-1/0];let r=[1/0,1/0,-1/0,-1/0];for(let u=t[0];u<=t[1];++u)rs(r,o[u]);return r}function ss(o){let t=[1/0,1/0,-1/0,-1/0];for(let r of o)for(let u of r)rs(t,u);return t}function vl(o){return o[0]!==-1/0&&o[1]!==-1/0&&o[2]!==1/0&&o[3]!==1/0}function ls(o,t,r){if(!vl(o)||!vl(t))return NaN;let u=0,p=0;return o[2]<t[0]&&(u=t[0]-o[2]),o[0]>t[2]&&(u=o[0]-t[2]),o[1]>t[3]&&(p=o[1]-t[3]),o[3]<t[1]&&(p=t[1]-o[3]),r.distance([0,0],[u,p])}function Xr(o,t,r){let u=r.pointOnLine(t,o);return r.distance(o,u.point)}function cs(o,t,r,u,p){let v=Math.min(Xr(o,[r,u],p),Xr(t,[r,u],p)),x=Math.min(Xr(r,[o,t],p),Xr(u,[o,t],p));return Math.min(v,x)}function oc(o,t,r,u,p){if(!Kr(t,o.length)||!Kr(u,r.length))return 1/0;let v=1/0;for(let x=t[0];x<t[1];++x){let w=o[x],M=o[x+1];for(let I=u[0];I<u[1];++I){let z=r[I],D=r[I+1];if(os(w,M,z,D))return 0;v=Math.min(v,cs(w,M,z,D,p))}}return v}function eu(o,t,r,u,p){if(!Kr(t,o.length)||!Kr(u,r.length))return NaN;let v=1/0;for(let x=t[0];x<=t[1];++x)for(let w=u[0];w<=u[1];++w)if(v=Math.min(v,p.distance(o[x],r[w])),v===0)return v;return v}function nh(o,t,r){if(Ea(o,t,!0))return 0;let u=1/0;for(let p of t){let v=p[0],x=p[p.length-1];if(v!==x&&(u=Math.min(u,Xr(o,[x,v],r)),u===0))return u;let w=r.pointOnLine(p,o);if(u=Math.min(u,r.distance(o,w.point)),u===0)return u}return u}function xl(o,t,r,u){if(!Kr(t,o.length))return NaN;for(let v=t[0];v<=t[1];++v)if(Ea(o[v],r,!0))return 0;let p=1/0;for(let v=t[0];v<t[1];++v){let x=o[v],w=o[v+1];for(let M of r)for(let I=0,z=M.length,D=z-1;I<z;D=I++){let $=M[D],Z=M[I];if(os(x,w,$,Z))return 0;p=Math.min(p,cs(x,w,$,Z,u))}}return p}function tu(o,t){for(let r of o)for(let u of r)if(Ea(u,t,!0))return!0;return!1}function iu(o,t,r,u=1/0){let p=ss(o),v=ss(t);if(u!==1/0&&ls(p,v,r)>=u)return u;if(Ns(p,v)){if(tu(o,t))return 0}else if(tu(t,o))return 0;let x=1/0;for(let w of o)for(let M=0,I=w.length,z=I-1;M<I;z=M++){let D=w[z],$=w[M];for(let Z of t)for(let G=0,K=Z.length,ne=K-1;G<K;ne=G++){let le=Z[ne],Me=Z[G];if(os(D,$,le,Me))return 0;x=Math.min(x,cs(D,$,le,Me,r))}}return x}function nu(o,t,r,u,p,v){if(!v)return;let x=ls(Us(u,v),p,r);x<t&&o.push([x,v,[0,0]])}function Zs(o,t,r,u,p,v,x){if(!v||!x)return;let w=ls(Us(u,v),Us(p,x),r);w<t&&o.push([w,v,x])}function bl(o,t,r,u,p=1/0){let v=Math.min(u.distance(o[0],r[0][0]),p);if(v===0)return v;let x=new ic([[0,[0,o.length-1],[0,0]]],Qc),w=ss(r);for(;x.length>0;){let M=x.pop();if(M[0]>=v)continue;let I=M[1],z=t?50:100;if(oi(I)<=z){if(!Kr(I,o.length))return NaN;if(t){let D=xl(o,I,r,u);if(isNaN(D)||D===0)return D;v=Math.min(v,D)}else for(let D=I[0];D<=I[1];++D){let $=nh(o[D],r,u);if(v=Math.min(v,$),v===0)return 0}}else{let D=yl(I,t);nu(x,v,u,o,w,D[0]),nu(x,v,u,o,w,D[1])}}return v}function Fr(o,t,r,u,p,v=1/0){let x=Math.min(v,p.distance(o[0],r[0]));if(x===0)return x;let w=new ic([[0,[0,o.length-1],[0,r.length-1]]],Qc);for(;w.length>0;){let M=w.pop();if(M[0]>=x)continue;let I=M[1],z=M[2],D=t?50:100,$=u?50:100;if(oi(I)<=D&&oi(z)<=$){if(!Kr(I,o.length)&&Kr(z,r.length))return NaN;let Z;if(t&&u)Z=oc(o,I,r,z,p),x=Math.min(x,Z);else if(t&&!u){let G=o.slice(I[0],I[1]+1);for(let K=z[0];K<=z[1];++K)if(Z=Xr(r[K],G,p),x=Math.min(x,Z),x===0)return x}else if(!t&&u){let G=r.slice(z[0],z[1]+1);for(let K=I[0];K<=I[1];++K)if(Z=Xr(o[K],G,p),x=Math.min(x,Z),x===0)return x}else Z=eu(o,I,r,z,p),x=Math.min(x,Z)}else{let Z=yl(I,t),G=yl(z,u);Zs(w,x,p,o,r,Z[0],G[0]),Zs(w,x,p,o,r,Z[0],G[1]),Zs(w,x,p,o,r,Z[1],G[0]),Zs(w,x,p,o,r,Z[1],G[1])}}return x}function us(o){return o.type==="MultiPolygon"?o.coordinates.map(t=>({type:"Polygon",coordinates:t})):o.type==="MultiLineString"?o.coordinates.map(t=>({type:"LineString",coordinates:t})):o.type==="MultiPoint"?o.coordinates.map(t=>({type:"Point",coordinates:t})):[o]}class za{constructor(t,r){this.type=ot,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Li(t[1])){let u=t[1];if(u.type==="FeatureCollection")return new za(u,u.features.map(p=>us(p.geometry)).flat());if(u.type==="Feature")return new za(u,us(u.geometry));if("type"in u&&"coordinates"in u)return new za(u,us(u))}return r.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,u){let p=r.geometry(),v=p.flat().map(M=>_l([M.x,M.y],r.canonical));if(p.length===0)return NaN;let x=new ia(v[0][1]),w=1/0;for(let M of u){switch(M.type){case"Point":w=Math.min(w,Fr(v,!1,[M.coordinates],!1,x,w));break;case"LineString":w=Math.min(w,Fr(v,!1,M.coordinates,!0,x,w));break;case"Polygon":w=Math.min(w,bl(v,!1,M.coordinates,x,w))}if(w===0)return w}return w}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,u){let p=r.geometry(),v=p.flat().map(M=>_l([M.x,M.y],r.canonical));if(p.length===0)return NaN;let x=new ia(v[0][1]),w=1/0;for(let M of u){switch(M.type){case"Point":w=Math.min(w,Fr(v,!0,[M.coordinates],!1,x,w));break;case"LineString":w=Math.min(w,Fr(v,!0,M.coordinates,!0,x,w));break;case"Polygon":w=Math.min(w,bl(v,!0,M.coordinates,x,w))}if(w===0)return w}return w}(t,this.geometries);if(t.geometryType()==="Polygon")return function(r,u){let p=r.geometry();if(p.length===0||p[0].length===0)return NaN;let v=ka(p,0).map(M=>M.map(I=>I.map(z=>_l([z.x,z.y],r.canonical)))),x=new ia(v[0][0][0][1]),w=1/0;for(let M of u)for(let I of v){switch(M.type){case"Point":w=Math.min(w,bl([M.coordinates],!1,I,x,w));break;case"LineString":w=Math.min(w,bl(M.coordinates,!0,I,x,w));break;case"Polygon":w=Math.min(w,iu(I,M.coordinates,x,w))}if(w===0)return w}return w}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Ra{constructor(t){this.type=ei,this.key=t}static parse(t,r){if(t.length!==2)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);let u=t[1];return u==null?r.error("Global state property must be defined."):typeof u!="string"?r.error(`Global state property must be string, but found ${typeof t[1]} instead.`):new Ra(u)}evaluate(t){var r;let u=(r=t.globals)===null||r===void 0?void 0:r.globalState;return u&&Object.keys(u).length!==0?an(u,this.key):null}eachChild(){}outputDefined(){return!1}}let hs={"==":Os,"!=":Hc,">":eh,"<":Yl,">=":th,"<=":Jl,array:ti,at:Xl,boolean:ti,case:$n,coalesce:ta,collator:Fs,format:Ia,image:yo,in:Mr,"index-of":Do,interpolate:hr,"interpolate-hcl":hr,"interpolate-lab":hr,length:gl,let:Pa,literal:Bt,match:ea,number:ti,"number-format":Ca,object:ti,slice:Bo,step:Oo,string:ti,"to-boolean":ur,"to-color":ur,"to-number":ur,"to-string":ur,var:xi,within:Hr,distance:za,"global-state":Ra};class Nr{constructor(t,r,u,p){this.name=t,this.type=r,this._evaluate=u,this.args=p}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,r){let u=t[0],p=Nr.definitions[u];if(!p)return r.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);let v=Array.isArray(p)?p[0]:p.type,x=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,w=x.filter(([I])=>!Array.isArray(I)||I.length===t.length-1),M=null;for(let[I,z]of w){M=new Ds(r.registry,Vs,r.path,null,r.scope);let D=[],$=!1;for(let Z=1;Z<t.length;Z++){let G=t[Z],K=Array.isArray(I)?I[Z-1]:I.type,ne=M.parse(G,1+D.length,K);if(!ne){$=!0;break}D.push(ne)}if(!$)if(Array.isArray(I)&&I.length!==D.length)M.error(`Expected ${I.length} arguments, but found ${D.length} instead.`);else{for(let Z=0;Z<D.length;Z++){let G=Array.isArray(I)?I[Z]:I.type,K=D[Z];M.concat(Z+1).checkSubtype(G,K.type)}if(M.errors.length===0)return new Nr(u,v,z,D)}}if(w.length===1)r.errors.push(...M.errors);else{let I=(w.length?w:x).map(([D])=>{return $=D,Array.isArray($)?`(${$.map(qt).join(", ")})`:`(${qt($.type)}...)`;var $}).join(" | "),z=[];for(let D=1;D<t.length;D++){let $=r.parse(t[D],1+z.length);if(!$)return null;z.push(qt($.type))}r.error(`Expected arguments of type ${I}, but found (${z.join(", ")}) instead.`)}return null}static register(t,r){Nr.definitions=r;for(let u in r)t[u]=Nr}}function ru(o,[t,r,u,p]){t=t.evaluate(o),r=r.evaluate(o),u=u.evaluate(o);let v=p?p.evaluate(o):1,x=Sa(t,r,u,v);if(x)throw new Ei(x);return new di(t/255,r/255,u/255,v,!1)}function ds(o,t){return o in t}function ac(o,t){let r=t[o];return r===void 0?null:r}function Yr(o){return{type:o}}function Vs(o){if(o instanceof xi)return Vs(o.boundExpression);if(o instanceof Nr&&o.name==="error"||o instanceof Fs||o instanceof Hr||o instanceof za||o instanceof Ra)return!1;let t=o instanceof ur||o instanceof ti,r=!0;return o.eachChild(u=>{r=t?r&&Vs(u):r&&u instanceof Bt}),!!r&&Gs(o)&&Jr(o,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Gs(o){if(o instanceof Nr&&(o.name==="get"&&o.args.length===1||o.name==="feature-state"||o.name==="has"&&o.args.length===1||o.name==="properties"||o.name==="geometry-type"||o.name==="id"||/^filter-/.test(o.name))||o instanceof Hr||o instanceof za)return!1;let t=!0;return o.eachChild(r=>{t&&!Gs(r)&&(t=!1)}),t}function qs(o){if(o instanceof Nr&&o.name==="feature-state")return!1;let t=!0;return o.eachChild(r=>{t&&!qs(r)&&(t=!1)}),t}function Jr(o,t){if(o instanceof Nr&&t.indexOf(o.name)>=0)return!1;let r=!0;return o.eachChild(u=>{r&&!Jr(u,t)&&(r=!1)}),r}function Ws(o){return{result:"success",value:o}}function Da(o){return{result:"error",value:o}}function bo(o){return o["property-type"]==="data-driven"||o["property-type"]==="cross-faded-data-driven"}function ou(o){return!!o.expression&&o.expression.parameters.indexOf("zoom")>-1}function Ba(o){return!!o.expression&&o.expression.interpolated}function ii(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":o===null?"null":typeof o}function Hs(o){return typeof o=="object"&&o!==null&&!Array.isArray(o)&&Ji(o)===Qn}function Ks(o){return o}function sc(o,t){let r=o.stops&&typeof o.stops[0][0]=="object",u=r||!(r||o.property!==void 0),p=o.type||(Ba(t)?"exponential":"interval"),v=function(z){switch(z.type){case"color":return di.parse;case"padding":return On.parse;case"numberArray":return Sn.parse;case"colorArray":return Ut.parse;default:return null}}(t);if(v&&((o=ri({},o)).stops&&(o.stops=o.stops.map(z=>[z[0],v(z[1])])),o.default=v(o.default?o.default:t.default)),o.colorSpace&&(x=o.colorSpace)!=="rgb"&&x!=="hcl"&&x!=="lab")throw new Error(`Unknown color space: "${o.colorSpace}"`);var x;let w=function(z){switch(z){case"exponential":return lc;case"interval":return su;case"categorical":return au;case"identity":return lu;default:throw new Error(`Unknown function type "${z}"`)}}(p),M,I;if(p==="categorical"){M=Object.create(null);for(let z of o.stops)M[z[0]]=z[1];I=typeof o.stops[0][0]}if(r){let z={},D=[];for(let G=0;G<o.stops.length;G++){let K=o.stops[G],ne=K[0].zoom;z[ne]===void 0&&(z[ne]={zoom:ne,type:o.type,property:o.property,default:o.default,stops:[]},D.push(ne)),z[ne].stops.push([K[0].value,K[1]])}let $=[];for(let G of D)$.push([z[G].zoom,sc(z[G],t)]);let Z={name:"linear"};return{kind:"composite",interpolationType:Z,interpolationFactor:hr.interpolationFactor.bind(void 0,Z),zoomStops:$.map(G=>G[0]),evaluate:({zoom:G},K)=>lc({stops:$,base:o.base},t,G).evaluate(G,K)}}if(u){let z=p==="exponential"?{name:"exponential",base:o.base!==void 0?o.base:1}:null;return{kind:"camera",interpolationType:z,interpolationFactor:hr.interpolationFactor.bind(void 0,z),zoomStops:o.stops.map(D=>D[0]),evaluate:({zoom:D})=>w(o,t,D,M,I)}}return{kind:"source",evaluate(z,D){let $=D&&D.properties?D.properties[o.property]:void 0;return $===void 0?ps(o.default,t.default):w(o,t,$,M,I)}}}function ps(o,t,r){return o!==void 0?o:t!==void 0?t:r!==void 0?r:void 0}function au(o,t,r,u,p){return ps(typeof r===p?u[r]:void 0,o.default,t.default)}function su(o,t,r){if(ii(r)!=="number")return ps(o.default,t.default);let u=o.stops.length;if(u===1||r<=o.stops[0][0])return o.stops[0][1];if(r>=o.stops[u-1][0])return o.stops[u-1][1];let p=Bs(o.stops.map(v=>v[0]),r);return o.stops[p][1]}function lc(o,t,r){let u=o.base!==void 0?o.base:1;if(ii(r)!=="number")return ps(o.default,t.default);let p=o.stops.length;if(p===1||r<=o.stops[0][0])return o.stops[0][1];if(r>=o.stops[p-1][0])return o.stops[p-1][1];let v=Bs(o.stops.map(z=>z[0]),r),x=function(z,D,$,Z){let G=Z-$,K=z-$;return G===0?0:D===1?K/G:(Math.pow(D,K)-1)/(Math.pow(D,G)-1)}(r,u,o.stops[v][0],o.stops[v+1][0]),w=o.stops[v][1],M=o.stops[v+1][1],I=tr[t.type]||Ks;return typeof w.evaluate=="function"?{evaluate(...z){let D=w.evaluate.apply(void 0,z),$=M.evaluate.apply(void 0,z);if(D!==void 0&&$!==void 0)return I(D,$,x,o.colorSpace)}}:I(w,M,x,o.colorSpace)}function lu(o,t,r){switch(t.type){case"color":r=di.parse(r);break;case"formatted":r=yr.fromString(r.toString());break;case"resolvedImage":r=vr.fromString(r.toString());break;case"padding":r=On.parse(r);break;case"colorArray":r=Ut.parse(r);break;case"numberArray":r=Sn.parse(r);break;default:ii(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0)}return ps(r,o.default,t.default)}Nr.register(hs,{error:[{kind:"error"},[Nt],(o,[t])=>{throw new Ei(t.evaluate(o))}],typeof:[Nt,[ei],(o,[t])=>qt(Ji(t.evaluate(o)))],"to-rgba":[on(ot,4),[Hi],(o,[t])=>{let[r,u,p,v]=t.evaluate(o).rgb;return[255*r,255*u,255*p,v]}],rgb:[Hi,[ot,ot,ot],ru],rgba:[Hi,[ot,ot,ot,ot],ru],has:{type:Kt,overloads:[[[Nt],(o,[t])=>ds(t.evaluate(o),o.properties())],[[Nt,Qn],(o,[t,r])=>ds(t.evaluate(o),r.evaluate(o))]]},get:{type:ei,overloads:[[[Nt],(o,[t])=>ac(t.evaluate(o),o.properties())],[[Nt,Qn],(o,[t,r])=>ac(t.evaluate(o),r.evaluate(o))]]},"feature-state":[ei,[Nt],(o,[t])=>ac(t.evaluate(o),o.featureState||{})],properties:[Qn,[],o=>o.properties()],"geometry-type":[Nt,[],o=>o.geometryType()],id:[ei,[],o=>o.id()],zoom:[ot,[],o=>o.globals.zoom],"heatmap-density":[ot,[],o=>o.globals.heatmapDensity||0],"line-progress":[ot,[],o=>o.globals.lineProgress||0],accumulated:[ei,[],o=>o.globals.accumulated===void 0?null:o.globals.accumulated],"+":[ot,Yr(ot),(o,t)=>{let r=0;for(let u of t)r+=u.evaluate(o);return r}],"*":[ot,Yr(ot),(o,t)=>{let r=1;for(let u of t)r*=u.evaluate(o);return r}],"-":{type:ot,overloads:[[[ot,ot],(o,[t,r])=>t.evaluate(o)-r.evaluate(o)],[[ot],(o,[t])=>-t.evaluate(o)]]},"/":[ot,[ot,ot],(o,[t,r])=>t.evaluate(o)/r.evaluate(o)],"%":[ot,[ot,ot],(o,[t,r])=>t.evaluate(o)%r.evaluate(o)],ln2:[ot,[],()=>Math.LN2],pi:[ot,[],()=>Math.PI],e:[ot,[],()=>Math.E],"^":[ot,[ot,ot],(o,[t,r])=>Math.pow(t.evaluate(o),r.evaluate(o))],sqrt:[ot,[ot],(o,[t])=>Math.sqrt(t.evaluate(o))],log10:[ot,[ot],(o,[t])=>Math.log(t.evaluate(o))/Math.LN10],ln:[ot,[ot],(o,[t])=>Math.log(t.evaluate(o))],log2:[ot,[ot],(o,[t])=>Math.log(t.evaluate(o))/Math.LN2],sin:[ot,[ot],(o,[t])=>Math.sin(t.evaluate(o))],cos:[ot,[ot],(o,[t])=>Math.cos(t.evaluate(o))],tan:[ot,[ot],(o,[t])=>Math.tan(t.evaluate(o))],asin:[ot,[ot],(o,[t])=>Math.asin(t.evaluate(o))],acos:[ot,[ot],(o,[t])=>Math.acos(t.evaluate(o))],atan:[ot,[ot],(o,[t])=>Math.atan(t.evaluate(o))],min:[ot,Yr(ot),(o,t)=>Math.min(...t.map(r=>r.evaluate(o)))],max:[ot,Yr(ot),(o,t)=>Math.max(...t.map(r=>r.evaluate(o)))],abs:[ot,[ot],(o,[t])=>Math.abs(t.evaluate(o))],round:[ot,[ot],(o,[t])=>{let r=t.evaluate(o);return r<0?-Math.round(-r):Math.round(r)}],floor:[ot,[ot],(o,[t])=>Math.floor(t.evaluate(o))],ceil:[ot,[ot],(o,[t])=>Math.ceil(t.evaluate(o))],"filter-==":[Kt,[Nt,ei],(o,[t,r])=>o.properties()[t.value]===r.value],"filter-id-==":[Kt,[ei],(o,[t])=>o.id()===t.value],"filter-type-==":[Kt,[Nt],(o,[t])=>o.geometryType()===t.value],"filter-<":[Kt,[Nt,ei],(o,[t,r])=>{let u=o.properties()[t.value],p=r.value;return typeof u==typeof p&&u<p}],"filter-id-<":[Kt,[ei],(o,[t])=>{let r=o.id(),u=t.value;return typeof r==typeof u&&r<u}],"filter->":[Kt,[Nt,ei],(o,[t,r])=>{let u=o.properties()[t.value],p=r.value;return typeof u==typeof p&&u>p}],"filter-id->":[Kt,[ei],(o,[t])=>{let r=o.id(),u=t.value;return typeof r==typeof u&&r>u}],"filter-<=":[Kt,[Nt,ei],(o,[t,r])=>{let u=o.properties()[t.value],p=r.value;return typeof u==typeof p&&u<=p}],"filter-id-<=":[Kt,[ei],(o,[t])=>{let r=o.id(),u=t.value;return typeof r==typeof u&&r<=u}],"filter->=":[Kt,[Nt,ei],(o,[t,r])=>{let u=o.properties()[t.value],p=r.value;return typeof u==typeof p&&u>=p}],"filter-id->=":[Kt,[ei],(o,[t])=>{let r=o.id(),u=t.value;return typeof r==typeof u&&r>=u}],"filter-has":[Kt,[ei],(o,[t])=>t.value in o.properties()],"filter-has-id":[Kt,[],o=>o.id()!==null&&o.id()!==void 0],"filter-type-in":[Kt,[on(Nt)],(o,[t])=>t.value.indexOf(o.geometryType())>=0],"filter-id-in":[Kt,[on(ei)],(o,[t])=>t.value.indexOf(o.id())>=0],"filter-in-small":[Kt,[Nt,on(ei)],(o,[t,r])=>r.value.indexOf(o.properties()[t.value])>=0],"filter-in-large":[Kt,[Nt,on(ei)],(o,[t,r])=>function(u,p,v,x){for(;v<=x;){let w=v+x>>1;if(p[w]===u)return!0;p[w]>u?x=w-1:v=w+1}return!1}(o.properties()[t.value],r.value,0,r.value.length-1)],all:{type:Kt,overloads:[[[Kt,Kt],(o,[t,r])=>t.evaluate(o)&&r.evaluate(o)],[Yr(Kt),(o,t)=>{for(let r of t)if(!r.evaluate(o))return!1;return!0}]]},any:{type:Kt,overloads:[[[Kt,Kt],(o,[t,r])=>t.evaluate(o)||r.evaluate(o)],[Yr(Kt),(o,t)=>{for(let r of t)if(r.evaluate(o))return!0;return!1}]]},"!":[Kt,[Kt],(o,[t])=>!t.evaluate(o)],"is-supported-script":[Kt,[Nt],(o,[t])=>{let r=o.globals&&o.globals.isSupportedScript;return!r||r(t.evaluate(o))}],upcase:[Nt,[Nt],(o,[t])=>t.evaluate(o).toUpperCase()],downcase:[Nt,[Nt],(o,[t])=>t.evaluate(o).toLowerCase()],concat:[Nt,Yr(ei),(o,t)=>t.map(r=>si(r.evaluate(o))).join("")],"resolved-locale":[Nt,[Qo],(o,[t])=>t.evaluate(o).resolvedLocale()]});class wl{constructor(t,r){this.expression=t,this._warningHistory={},this._evaluator=new Rs,this._defaultValue=r?function(u){if(u.type==="color"&&Hs(u.default))return new di(0,0,0,0);switch(u.type){case"color":return di.parse(u.default)||null;case"padding":return On.parse(u.default)||null;case"numberArray":return Sn.parse(u.default)||null;case"colorArray":return Ut.parse(u.default)||null;case"variableAnchorOffsetCollection":return lr.parse(u.default)||null;case"projectionDefinition":return cr.parse(u.default)||null;default:return u.default===void 0?null:u.default}}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(t,r,u,p,v,x){return this._evaluator.globals=t,this._evaluator.feature=r,this._evaluator.featureState=u,this._evaluator.canonical=p,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=x,this.expression.evaluate(this._evaluator)}evaluate(t,r,u,p,v,x){this._evaluator.globals=t,this._evaluator.feature=r||null,this._evaluator.featureState=u||null,this._evaluator.canonical=p,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=x||null;try{let w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new Ei(`Expected value to be one of ${Object.keys(this._enumValues).map(M=>JSON.stringify(M)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function fs(o){return Array.isArray(o)&&o.length>0&&typeof o[0]=="string"&&o[0]in hs}function Xs(o,t){let r=new Ds(hs,Vs,[],t?function(p){let v={color:Hi,string:Nt,number:ot,enum:Nt,boolean:Kt,formatted:We,padding:Pi,numberArray:nn,colorArray:tn,projectionDefinition:$i,resolvedImage:rn,variableAnchorOffsetCollection:zi};return p.type==="array"?on(v[p.value]||ei,p.length):v[p.type]}(t):void 0),u=r.parse(o,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return u?Ws(new wl(u,t)):Da(r.errors)}class cc{constructor(t,r){this.kind=t,this._styleExpression=r,this.isStateDependent=t!=="constant"&&!qs(r.expression)}evaluateWithoutErrorHandling(t,r,u,p,v,x){return this._styleExpression.evaluateWithoutErrorHandling(t,r,u,p,v,x)}evaluate(t,r,u,p,v,x){return this._styleExpression.evaluate(t,r,u,p,v,x)}}class c{constructor(t,r,u,p){this.kind=t,this.zoomStops=u,this._styleExpression=r,this.isStateDependent=t!=="camera"&&!qs(r.expression),this.interpolationType=p}evaluateWithoutErrorHandling(t,r,u,p,v,x){return this._styleExpression.evaluateWithoutErrorHandling(t,r,u,p,v,x)}evaluate(t,r,u,p,v,x){return this._styleExpression.evaluate(t,r,u,p,v,x)}interpolationFactor(t,r,u){return this.interpolationType?hr.interpolationFactor(this.interpolationType,t,r,u):0}}function g(o,t){let r=Xs(o,t);if(r.result==="error")return r;let u=r.value.expression,p=Gs(u);if(!p&&!bo(t))return Da([new ft("","data expressions not supported")]);let v=Jr(u,["zoom"]);if(!v&&!ou(t))return Da([new ft("","zoom expressions not supported")]);let x=A(u);return x||v?x instanceof ft?Da([x]):x instanceof hr&&!Ba(t)?Da([new ft("",'"interpolate" expressions cannot be used with this property')]):Ws(x?new c(p?"camera":"composite",r.value,x.labels,x instanceof hr?x.interpolation:void 0):new cc(p?"constant":"source",r.value)):Da([new ft("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class T{constructor(t,r){this._parameters=t,this._specification=r,ri(this,sc(this._parameters,this._specification))}static deserialize(t){return new T(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function A(o){let t=null;if(o instanceof Pa)t=A(o.result);else if(o instanceof ta){for(let r of o.args)if(t=A(r),t)break}else(o instanceof Oo||o instanceof hr)&&o.input instanceof Nr&&o.input.name==="zoom"&&(t=o);return t instanceof ft||o.eachChild(r=>{let u=A(r);u instanceof ft?t=u:!t&&u?t=new ft("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&u&&t!==u&&(t=new ft("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function F(o){if(o===!0||o===!1)return!0;if(!Array.isArray(o)||o.length===0)return!1;switch(o[0]){case"has":return o.length>=2&&o[1]!=="$id"&&o[1]!=="$type";case"in":return o.length>=3&&(typeof o[1]!="string"||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return o.length!==3||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(let t of o.slice(1))if(!F(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}let J={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function xe(o){if(o==null)return{filter:()=>!0,needGeometry:!1};F(o)||(o=ut(o));let t=Xs(o,J);if(t.result==="error")throw new Error(t.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,u,p)=>t.value.evaluate(r,u,{},p),needGeometry:Je(o)}}function je(o,t){return o<t?-1:o>t?1:0}function Je(o){if(!Array.isArray(o))return!1;if(o[0]==="within"||o[0]==="distance")return!0;for(let t=1;t<o.length;t++)if(Je(o[t]))return!0;return!1}function ut(o){if(!o)return!0;let t=o[0];return o.length<=1?t!=="any":t==="=="?Mt(o[1],o[2],"=="):t==="!="?Zn(Mt(o[1],o[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Mt(o[1],o[2],t):t==="any"?(r=o.slice(1),["any"].concat(r.map(ut))):t==="all"?["all"].concat(o.slice(1).map(ut)):t==="none"?["all"].concat(o.slice(1).map(ut).map(Zn)):t==="in"?Xt(o[1],o.slice(2)):t==="!in"?Zn(Xt(o[1],o.slice(2))):t==="has"?pi(o[1]):t!=="!has"||Zn(pi(o[1]));var r}function Mt(o,t,r){switch(o){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,o,t]}}function Xt(o,t){if(t.length===0)return!1;switch(o){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(r=>typeof r!=typeof t[0])?["filter-in-large",o,["literal",t.sort(je)]]:["filter-in-small",o,["literal",t]]}}function pi(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function Zn(o){return["!",o]}function Pn(o){let t=typeof o;if(t==="number"||t==="boolean"||t==="string"||o==null)return JSON.stringify(o);if(Array.isArray(o)){let p="[";for(let v of o)p+=`${Pn(v)},`;return`${p}]`}let r=Object.keys(o).sort(),u="{";for(let p=0;p<r.length;p++)u+=`${JSON.stringify(r[p])}:${Pn(o[r[p]])},`;return`${u}}`}function jr(o){let t="";for(let r of Ne)t+=`/${Pn(o[r])}`;return t}function Vn(o){let t=o.value;return t?[new Ye(o.key,t,"constants have been deprecated as of v8")]:[]}function qi(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function na(o){if(Array.isArray(o))return o.map(na);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){let t={};for(let r in o)t[r]=na(o[r]);return t}return qi(o)}function $r(o){let t=o.key,r=o.value,u=o.valueSpec||{},p=o.objectElementValidators||{},v=o.style,x=o.styleSpec,w=o.validateSpec,M=[],I=ii(r);if(I!=="object")return[new Ye(t,r,`object expected, ${I} found`)];for(let z in r){let D=z.split(".")[0],$=an(u,D)||u["*"],Z;if(an(p,D))Z=p[D];else if(an(u,D))Z=w;else if(p["*"])Z=p["*"];else{if(!u["*"]){M.push(new Ye(t,r[z],`unknown property "${z}"`));continue}Z=w}M=M.concat(Z({key:(t&&`${t}.`)+z,value:r[z],valueSpec:$,style:v,styleSpec:x,object:r,objectKey:z,validateSpec:w},r))}for(let z in u)p[z]||u[z].required&&u[z].default===void 0&&r[z]===void 0&&M.push(new Ye(t,r,`missing required property "${z}"`));return M}function uc(o){let t=o.value,r=o.valueSpec,u=o.style,p=o.styleSpec,v=o.key,x=o.arrayElementValidator||o.validateSpec;if(ii(t)!=="array")return[new Ye(v,t,`array expected, ${ii(t)} found`)];if(r.length&&t.length!==r.length)return[new Ye(v,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new Ye(v,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let w={type:r.value,values:r.values};p.$version<7&&(w.function=r.function),ii(r.value)==="object"&&(w=r.value);let M=[];for(let I=0;I<t.length;I++)M=M.concat(x({array:t,arrayIndex:I,value:t[I],valueSpec:w,validateSpec:o.validateSpec,style:u,styleSpec:p,key:`${v}[${I}]`}));return M}function ms(o){let t=o.key,r=o.value,u=o.valueSpec,p=ii(r);return p==="number"&&r!=r&&(p="NaN"),p!=="number"?[new Ye(t,r,`number expected, ${p} found`)]:"minimum"in u&&r<u.minimum?[new Ye(t,r,`${r} is less than the minimum value ${u.minimum}`)]:"maximum"in u&&r>u.maximum?[new Ye(t,r,`${r} is greater than the maximum value ${u.maximum}`)]:[]}function hc(o){let t=o.valueSpec,r=qi(o.value.type),u,p,v,x={},w=r!=="categorical"&&o.value.property===void 0,M=!w,I=ii(o.value.stops)==="array"&&ii(o.value.stops[0])==="array"&&ii(o.value.stops[0][0])==="object",z=$r({key:o.key,value:o.value,valueSpec:o.styleSpec.function,validateSpec:o.validateSpec,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{stops:function(Z){if(r==="identity")return[new Ye(Z.key,Z.value,'identity function may not have a "stops" property')];let G=[],K=Z.value;return G=G.concat(uc({key:Z.key,value:K,valueSpec:Z.valueSpec,validateSpec:Z.validateSpec,style:Z.style,styleSpec:Z.styleSpec,arrayElementValidator:D})),ii(K)==="array"&&K.length===0&&G.push(new Ye(Z.key,K,"array must have at least one stop")),G},default:function(Z){return Z.validateSpec({key:Z.key,value:Z.value,valueSpec:t,validateSpec:Z.validateSpec,style:Z.style,styleSpec:Z.styleSpec})}}});return r==="identity"&&w&&z.push(new Ye(o.key,o.value,'missing required property "property"')),r==="identity"||o.value.stops||z.push(new Ye(o.key,o.value,'missing required property "stops"')),r==="exponential"&&o.valueSpec.expression&&!Ba(o.valueSpec)&&z.push(new Ye(o.key,o.value,"exponential functions not supported")),o.styleSpec.$version>=8&&(M&&!bo(o.valueSpec)?z.push(new Ye(o.key,o.value,"property functions not supported")):w&&!ou(o.valueSpec)&&z.push(new Ye(o.key,o.value,"zoom functions not supported"))),r!=="categorical"&&!I||o.value.property!==void 0||z.push(new Ye(o.key,o.value,'"property" property is required')),z;function D(Z){let G=[],K=Z.value,ne=Z.key;if(ii(K)!=="array")return[new Ye(ne,K,`array expected, ${ii(K)} found`)];if(K.length!==2)return[new Ye(ne,K,`array length 2 expected, length ${K.length} found`)];if(I){if(ii(K[0])!=="object")return[new Ye(ne,K,`object expected, ${ii(K[0])} found`)];if(K[0].zoom===void 0)return[new Ye(ne,K,"object stop key must have zoom")];if(K[0].value===void 0)return[new Ye(ne,K,"object stop key must have value")];if(v&&v>qi(K[0].zoom))return[new Ye(ne,K[0].zoom,"stop zoom values must appear in ascending order")];qi(K[0].zoom)!==v&&(v=qi(K[0].zoom),p=void 0,x={}),G=G.concat($r({key:`${ne}[0]`,value:K[0],valueSpec:{zoom:{}},validateSpec:Z.validateSpec,style:Z.style,styleSpec:Z.styleSpec,objectElementValidators:{zoom:ms,value:$}}))}else G=G.concat($({key:`${ne}[0]`,value:K[0],validateSpec:Z.validateSpec,style:Z.style,styleSpec:Z.styleSpec},K));return fs(na(K[1]))?G.concat([new Ye(`${ne}[1]`,K[1],"expressions are not allowed in function stops.")]):G.concat(Z.validateSpec({key:`${ne}[1]`,value:K[1],valueSpec:t,validateSpec:Z.validateSpec,style:Z.style,styleSpec:Z.styleSpec}))}function $(Z,G){let K=ii(Z.value),ne=qi(Z.value),le=Z.value!==null?Z.value:G;if(u){if(K!==u)return[new Ye(Z.key,le,`${K} stop domain type must match previous stop domain type ${u}`)]}else u=K;if(K!=="number"&&K!=="string"&&K!=="boolean")return[new Ye(Z.key,le,"stop domain value must be a number, string, or boolean")];if(K!=="number"&&r!=="categorical"){let Me=`number expected, ${K} found`;return bo(t)&&r===void 0&&(Me+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ye(Z.key,le,Me)]}return r!=="categorical"||K!=="number"||isFinite(ne)&&Math.floor(ne)===ne?r!=="categorical"&&K==="number"&&p!==void 0&&ne<p?[new Ye(Z.key,le,"stop domain values must appear in ascending order")]:(p=ne,r==="categorical"&&ne in x?[new Ye(Z.key,le,"stop domain values must be unique")]:(x[ne]=!0,[])):[new Ye(Z.key,le,`integer expected, found ${ne}`)]}}function so(o){let t=(o.expressionContext==="property"?g:Xs)(na(o.value),o.valueSpec);if(t.result==="error")return t.value.map(u=>new Ye(`${o.key}${u.key}`,o.value,u.message));let r=t.value.expression||t.value._styleExpression.expression;if(o.expressionContext==="property"&&o.propertyKey==="text-font"&&!r.outputDefined())return[new Ye(o.key,o.value,`Invalid data expression for "${o.propertyKey}". Output values must be contained as literals within the expression.`)];if(o.expressionContext==="property"&&o.propertyType==="layout"&&!qs(r))return[new Ye(o.key,o.value,'"feature-state" data expressions are not supported with layout properties.')];if(o.expressionContext==="filter"&&!qs(r))return[new Ye(o.key,o.value,'"feature-state" data expressions are not supported with filters.')];if(o.expressionContext&&o.expressionContext.indexOf("cluster")===0){if(!Jr(r,["zoom","feature-state"]))return[new Ye(o.key,o.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(o.expressionContext==="cluster-initial"&&!Gs(r))return[new Ye(o.key,o.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function gn(o){let t=o.key,r=o.value,u=ii(r);return u!=="string"?[new Ye(t,r,`color expected, ${u} found`)]:di.parse(String(r))?[]:[new Ye(t,r,`color expected, "${r}" found`)]}function ra(o){let t=o.key,r=o.value,u=o.valueSpec,p=[];return Array.isArray(u.values)?u.values.indexOf(qi(r))===-1&&p.push(new Ye(t,r,`expected one of [${u.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(u.values).indexOf(qi(r))===-1&&p.push(new Ye(t,r,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(r)} found`)),p}function dc(o){return F(na(o.value))?so(ri({},o,{expressionContext:"filter",valueSpec:{value:"boolean"}})):cu(o)}function cu(o){let t=o.value,r=o.key;if(ii(t)!=="array")return[new Ye(r,t,`array expected, ${ii(t)} found`)];let u=o.styleSpec,p,v=[];if(t.length<1)return[new Ye(r,t,"filter array must have at least 1 element")];switch(v=v.concat(ra({key:`${r}[0]`,value:t[0],valueSpec:u.filter_operator,style:o.style,styleSpec:o.styleSpec})),qi(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&qi(t[1])==="$type"&&v.push(new Ye(r,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&v.push(new Ye(r,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(p=ii(t[1]),p!=="string"&&v.push(new Ye(`${r}[1]`,t[1],`string expected, ${p} found`)));for(let x=2;x<t.length;x++)p=ii(t[x]),qi(t[1])==="$type"?v=v.concat(ra({key:`${r}[${x}]`,value:t[x],valueSpec:u.geometry_type,style:o.style,styleSpec:o.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&v.push(new Ye(`${r}[${x}]`,t[x],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let x=1;x<t.length;x++)v=v.concat(cu({key:`${r}[${x}]`,value:t[x],style:o.style,styleSpec:o.styleSpec}));break;case"has":case"!has":p=ii(t[1]),t.length!==2?v.push(new Ye(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):p!=="string"&&v.push(new Ye(`${r}[1]`,t[1],`string expected, ${p} found`))}return v}function uu(o,t){let r=o.key,u=o.validateSpec,p=o.style,v=o.styleSpec,x=o.value,w=o.objectKey,M=v[`${t}_${o.layerType}`];if(!M)return[];let I=w.match(/^(.*)-transition$/);if(t==="paint"&&I&&M[I[1]]&&M[I[1]].transition)return u({key:r,value:x,valueSpec:v.transition,style:p,styleSpec:v});let z=o.valueSpec||M[w];if(!z)return[new Ye(r,x,`unknown property "${w}"`)];let D;if(ii(x)==="string"&&bo(z)&&!z.tokens&&(D=/^{([^}]+)}$/.exec(x)))return[new Ye(r,x,`"${w}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(D[1])} }\`.`)];let $=[];return o.layerType==="symbol"&&(w==="text-field"&&p&&!p.glyphs&&$.push(new Ye(r,x,'use of "text-field" requires a style "glyphs" property')),w==="text-font"&&Hs(na(x))&&qi(x.type)==="identity"&&$.push(new Ye(r,x,'"text-font" does not support identity functions'))),$.concat(u({key:o.key,value:x,valueSpec:z,style:p,styleSpec:v,expressionContext:"property",propertyType:t,propertyKey:w}))}function Tl(o){return uu(o,"paint")}function Oa(o){return uu(o,"layout")}function gs(o){let t=[],r=o.value,u=o.key,p=o.style,v=o.styleSpec;if(ii(r)!=="object")return[new Ye(u,r,`object expected, ${ii(r)} found`)];r.type||r.ref||t.push(new Ye(u,r,'either "type" or "ref" is required'));let x=qi(r.type),w=qi(r.ref);if(r.id){let M=qi(r.id);for(let I=0;I<o.arrayIndex;I++){let z=p.layers[I];qi(z.id)===M&&t.push(new Ye(u,r.id,`duplicate layer id "${r.id}", previously used at line ${z.id.__line__}`))}}if("ref"in r){let M;["type","source","source-layer","filter","layout"].forEach(I=>{I in r&&t.push(new Ye(u,r[I],`"${I}" is prohibited for ref layers`))}),p.layers.forEach(I=>{qi(I.id)===w&&(M=I)}),M?M.ref?t.push(new Ye(u,r.ref,"ref cannot reference another ref layer")):x=qi(M.type):t.push(new Ye(u,r.ref,`ref layer "${w}" not found`))}else if(x!=="background")if(r.source){let M=p.sources&&p.sources[r.source],I=M&&qi(M.type);M?I==="vector"&&x==="raster"?t.push(new Ye(u,r.source,`layer "${r.id}" requires a raster source`)):I!=="raster-dem"&&x==="hillshade"?t.push(new Ye(u,r.source,`layer "${r.id}" requires a raster-dem source`)):I==="raster"&&x!=="raster"?t.push(new Ye(u,r.source,`layer "${r.id}" requires a vector source`)):I!=="vector"||r["source-layer"]?I==="raster-dem"&&x!=="hillshade"?t.push(new Ye(u,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):x!=="line"||!r.paint||!r.paint["line-gradient"]||I==="geojson"&&M.lineMetrics||t.push(new Ye(u,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Ye(u,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new Ye(u,r.source,`source "${r.source}" not found`))}else t.push(new Ye(u,r,'missing required property "source"'));return t=t.concat($r({key:u,value:r,valueSpec:v.layer,style:o.style,styleSpec:o.styleSpec,validateSpec:o.validateSpec,objectElementValidators:{"*":()=>[],type:()=>o.validateSpec({key:`${u}.type`,value:r.type,valueSpec:v.layer.type,style:o.style,styleSpec:o.styleSpec,validateSpec:o.validateSpec,object:r,objectKey:"type"}),filter:dc,layout:M=>$r({layer:r,key:M.key,value:M.value,style:M.style,styleSpec:M.styleSpec,validateSpec:M.validateSpec,objectElementValidators:{"*":I=>Oa(ri({layerType:x},I))}}),paint:M=>$r({layer:r,key:M.key,value:M.value,style:M.style,styleSpec:M.styleSpec,validateSpec:M.validateSpec,objectElementValidators:{"*":I=>Tl(ri({layerType:x},I))}})}})),t}function ir(o){let t=o.value,r=o.key,u=ii(t);return u!=="string"?[new Ye(r,t,`string expected, ${u} found`)]:[]}let Sl={promoteId:function({key:o,value:t}){if(ii(t)==="string")return ir({key:o,value:t});{let r=[];for(let u in t)r.push(...ir({key:`${o}.${u}`,value:t[u]}));return r}}};function rh(o){let t=o.value,r=o.key,u=o.styleSpec,p=o.style,v=o.validateSpec;if(!t.type)return[new Ye(r,t,'"type" is required')];let x=qi(t.type),w;switch(x){case"vector":case"raster":return w=$r({key:r,value:t,valueSpec:u[`source_${x.replace("-","_")}`],style:o.style,styleSpec:u,objectElementValidators:Sl,validateSpec:v}),w;case"raster-dem":return w=function(M){var I;let z=(I=M.sourceName)!==null&&I!==void 0?I:"",D=M.value,$=M.styleSpec,Z=$.source_raster_dem,G=M.style,K=[],ne=ii(D);if(D===void 0)return K;if(ne!=="object")return K.push(new Ye("source_raster_dem",D,`object expected, ${ne} found`)),K;let le=qi(D.encoding)==="custom",Me=["redFactor","greenFactor","blueFactor","baseShift"],fe=M.value.encoding?`"${M.value.encoding}"`:"Default";for(let U in D)!le&&Me.includes(U)?K.push(new Ye(U,D[U],`In "${z}": "${U}" is only valid when "encoding" is set to "custom". ${fe} encoding found`)):Z[U]?K=K.concat(M.validateSpec({key:U,value:D[U],valueSpec:Z[U],validateSpec:M.validateSpec,style:G,styleSpec:$})):K.push(new Ye(U,D[U],`unknown property "${U}"`));return K}({sourceName:r,value:t,style:o.style,styleSpec:u,validateSpec:v}),w;case"geojson":if(w=$r({key:r,value:t,valueSpec:u.source_geojson,style:p,styleSpec:u,validateSpec:v,objectElementValidators:Sl}),t.cluster)for(let M in t.clusterProperties){let[I,z]=t.clusterProperties[M],D=typeof I=="string"?[I,["accumulated"],["get",M]]:I;w.push(...so({key:`${r}.${M}.map`,value:z,expressionContext:"cluster-map"})),w.push(...so({key:`${r}.${M}.reduce`,value:D,expressionContext:"cluster-reduce"}))}return w;case"video":return $r({key:r,value:t,valueSpec:u.source_video,style:p,validateSpec:v,styleSpec:u});case"image":return $r({key:r,value:t,valueSpec:u.source_image,style:p,validateSpec:v,styleSpec:u});case"canvas":return[new Ye(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ra({key:`${r}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function bd(o){let t=o.value,r=o.styleSpec,u=r.light,p=o.style,v=[],x=ii(t);if(t===void 0)return v;if(x!=="object")return v=v.concat([new Ye("light",t,`object expected, ${x} found`)]),v;for(let w in t){let M=w.match(/^(.*)-transition$/);v=v.concat(M&&u[M[1]]&&u[M[1]].transition?o.validateSpec({key:w,value:t[w],valueSpec:r.transition,validateSpec:o.validateSpec,style:p,styleSpec:r}):u[w]?o.validateSpec({key:w,value:t[w],valueSpec:u[w],validateSpec:o.validateSpec,style:p,styleSpec:r}):[new Ye(w,t[w],`unknown property "${w}"`)])}return v}function wd(o){let t=o.value,r=o.styleSpec,u=r.sky,p=o.style,v=ii(t);if(t===void 0)return[];if(v!=="object")return[new Ye("sky",t,`object expected, ${v} found`)];let x=[];for(let w in t)x=x.concat(u[w]?o.validateSpec({key:w,value:t[w],valueSpec:u[w],style:p,styleSpec:r}):[new Ye(w,t[w],`unknown property "${w}"`)]);return x}function Pl(o){let t=o.value,r=o.styleSpec,u=r.terrain,p=o.style,v=[],x=ii(t);if(t===void 0)return v;if(x!=="object")return v=v.concat([new Ye("terrain",t,`object expected, ${x} found`)]),v;for(let w in t)v=v.concat(u[w]?o.validateSpec({key:w,value:t[w],valueSpec:u[w],validateSpec:o.validateSpec,style:p,styleSpec:r}):[new Ye(w,t[w],`unknown property "${w}"`)]);return v}function oh(o){let t=[],r=o.value,u=o.key;if(Array.isArray(r)){let p=[],v=[];for(let x in r)r[x].id&&p.includes(r[x].id)&&t.push(new Ye(u,r,`all the sprites' ids must be unique, but ${r[x].id} is duplicated`)),p.push(r[x].id),r[x].url&&v.includes(r[x].url)&&t.push(new Ye(u,r,`all the sprites' URLs must be unique, but ${r[x].url} is duplicated`)),v.push(r[x].url),t=t.concat($r({key:`${u}[${x}]`,value:r[x],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:o.validateSpec}));return t}return ir({key:u,value:r})}function hu(o){return t=o.value,t&&t.constructor===Object?[]:[new Ye(o.key,o.value,`object expected, ${ii(o.value)} found`)];var t}let Td={"*":()=>[],array:uc,boolean:function(o){let t=o.value,r=o.key,u=ii(t);return u!=="boolean"?[new Ye(r,t,`boolean expected, ${u} found`)]:[]},number:ms,color:gn,constants:Vn,enum:ra,filter:dc,function:hc,layer:gs,object:$r,source:rh,light:bd,sky:wd,terrain:Pl,projection:function(o){let t=o.value,r=o.styleSpec,u=r.projection,p=o.style,v=ii(t);if(t===void 0)return[];if(v!=="object")return[new Ye("projection",t,`object expected, ${v} found`)];let x=[];for(let w in t)x=x.concat(u[w]?o.validateSpec({key:w,value:t[w],valueSpec:u[w],style:p,styleSpec:r}):[new Ye(w,t[w],`unknown property "${w}"`)]);return x},projectionDefinition:function(o){let t=o.key,r=o.value;r=r instanceof String?r.valueOf():r;let u=ii(r);return u!=="array"||function(p){return Array.isArray(p)&&p.length===3&&typeof p[0]=="string"&&typeof p[1]=="string"&&typeof p[2]=="number"}(r)||function(p){return!!["interpolate","step","literal"].includes(p[0])}(r)?["array","string"].includes(u)?[]:[new Ye(t,r,`projection expected, invalid type "${u}" found`)]:[new Ye(t,r,`projection expected, invalid array ${JSON.stringify(r)} found`)]},string:ir,formatted:function(o){return ir(o).length===0?[]:so(o)},resolvedImage:function(o){return ir(o).length===0?[]:so(o)},padding:function(o){let t=o.key,r=o.value;if(ii(r)==="array"){if(r.length<1||r.length>4)return[new Ye(t,r,`padding requires 1 to 4 values; ${r.length} values found`)];let u={type:"number"},p=[];for(let v=0;v<r.length;v++)p=p.concat(o.validateSpec({key:`${t}[${v}]`,value:r[v],validateSpec:o.validateSpec,valueSpec:u}));return p}return ms({key:t,value:r,valueSpec:{}})},numberArray:function(o){let t=o.key,r=o.value;if(ii(r)==="array"){let u={type:"number"};if(r.length<1)return[new Ye(t,r,"array length at least 1 expected, length 0 found")];let p=[];for(let v=0;v<r.length;v++)p=p.concat(o.validateSpec({key:`${t}[${v}]`,value:r[v],validateSpec:o.validateSpec,valueSpec:u}));return p}return ms({key:t,value:r,valueSpec:{}})},colorArray:function(o){let t=o.key,r=o.value;if(ii(r)==="array"){if(r.length<1)return[new Ye(t,r,"array length at least 1 expected, length 0 found")];let u=[];for(let p=0;p<r.length;p++)u=u.concat(gn({key:`${t}[${p}]`,value:r[p]}));return u}return gn({key:t,value:r})},variableAnchorOffsetCollection:function(o){let t=o.key,r=o.value,u=ii(r),p=o.styleSpec;if(u!=="array"||r.length<1||r.length%2!=0)return[new Ye(t,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let v=[];for(let x=0;x<r.length;x+=2)v=v.concat(ra({key:`${t}[${x}]`,value:r[x],valueSpec:p.layout_symbol["text-anchor"]})),v=v.concat(uc({key:`${t}[${x+1}]`,value:r[x+1],valueSpec:{length:2,value:"number"},validateSpec:o.validateSpec,style:o.style,styleSpec:p}));return v},sprite:oh,state:hu};function Ml(o){let t=o.value,r=o.valueSpec,u=o.styleSpec;return o.validateSpec=Ml,r.expression&&Hs(qi(t))?hc(o):r.expression&&fs(na(t))?so(o):r.type&&Td[r.type]?Td[r.type](o):$r(ri({},o,{valueSpec:r.type?u[r.type]:r}))}function Sd(o){let t=o.value,r=o.key,u=ir(o);return u.length||(t.indexOf("{fontstack}")===-1&&u.push(new Ye(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&u.push(new Ye(r,t,'"glyphs" url must include a "{range}" token'))),u}function Er(o,t=ie){let r=[];return r=r.concat(Ml({key:"",value:o,valueSpec:t.$root,styleSpec:t,style:o,validateSpec:Ml,objectElementValidators:{glyphs:Sd,"*":()=>[]}})),o.constants&&(r=r.concat(Vn({key:"constants",value:o.constants}))),Cl(r)}function No(o){return function(t){return o(Po(ai({},t),{validateSpec:Ml}))}}function Cl(o){return[].concat(o).sort((t,r)=>t.line-r.line)}function jo(o){return function(...t){return Cl(o.apply(this,t))}}Er.source=jo(No(rh)),Er.sprite=jo(No(oh)),Er.glyphs=jo(No(Sd)),Er.light=jo(No(bd)),Er.sky=jo(No(wd)),Er.terrain=jo(No(Pl)),Er.state=jo(No(hu)),Er.layer=jo(No(gs)),Er.filter=jo(No(dc)),Er.paintProperty=jo(No(Tl)),Er.layoutProperty=jo(No(Oa));let Il=Er,du=Il.light,_f=Il.sky,ah=Il.paintProperty,pu=Il.layoutProperty;function sh(o,t){let r=!1;if(t&&t.length)for(let u of t)o.fire(new me(new Error(u.message))),r=!0;return r}class El{constructor(t,r,u){let p=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;let x=new Int32Array(this.arrayBuffer);t=x[0],this.d=(r=x[1])+2*(u=x[2]);for(let M=0;M<this.d*this.d;M++){let I=x[3+M],z=x[3+M+1];p.push(I===z?null:x.subarray(I,z))}let w=x[3+p.length+1];this.keys=x.subarray(x[3+p.length],w),this.bboxes=x.subarray(w),this.insert=this._insertReadonly}else{this.d=r+2*u;for(let x=0;x<this.d*this.d;x++)p.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=t,this.padding=u,this.scale=r/t,this.uid=0;let v=u/r*t;this.min=-v,this.max=t+v}insert(t,r,u,p,v){this._forEachCell(r,u,p,v,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(r),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(v)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,r,u,p,v,x){this.cells[v].push(x)}query(t,r,u,p,v){let x=this.min,w=this.max;if(t<=x&&r<=x&&w<=u&&w<=p&&!v)return Array.prototype.slice.call(this.keys);{let M=[];return this._forEachCell(t,r,u,p,this._queryCell,M,{},v),M}}_queryCell(t,r,u,p,v,x,w,M){let I=this.cells[v];if(I!==null){let z=this.keys,D=this.bboxes;for(let $=0;$<I.length;$++){let Z=I[$];if(w[Z]===void 0){let G=4*Z;(M?M(D[G+0],D[G+1],D[G+2],D[G+3]):t<=D[G+2]&&r<=D[G+3]&&u>=D[G+0]&&p>=D[G+1])?(w[Z]=!0,x.push(z[Z])):w[Z]=!1}}}}_forEachCell(t,r,u,p,v,x,w,M){let I=this._convertToCellCoord(t),z=this._convertToCellCoord(r),D=this._convertToCellCoord(u),$=this._convertToCellCoord(p);for(let Z=I;Z<=D;Z++)for(let G=z;G<=$;G++){let K=this.d*G+Z;if((!M||M(this._convertFromCellCoord(Z),this._convertFromCellCoord(G),this._convertFromCellCoord(Z+1),this._convertFromCellCoord(G+1)))&&v.call(this,t,r,u,p,K,x,w,M))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;let t=this.cells,r=3+this.cells.length+1+1,u=0;for(let x=0;x<this.cells.length;x++)u+=this.cells[x].length;let p=new Int32Array(r+u+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;let v=r;for(let x=0;x<t.length;x++){let w=t[x];p[3+x]=v,p.set(w,v),v+=w.length}return p[3+t.length]=v,p.set(this.keys,v),v+=this.keys.length,p[3+t.length+1]=v,p.set(this.bboxes,v),v+=this.bboxes.length,p.buffer}static serialize(t,r){let u=t.toArrayBuffer();return r&&r.push(u),{buffer:u}}static deserialize(t){return new El(t.buffer)}}let oa={};function wt(o,t,r={}){if(oa[o])throw new Error(`${o} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:o,writeable:!1}),oa[o]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}wt("Object",Object),wt("TransferableGridIndex",El),wt("Color",di),wt("Error",Error),wt("AJAXError",dn),wt("ResolvedImage",vr),wt("StylePropertyFunction",T),wt("StyleExpression",wl,{omit:["_evaluator"]}),wt("ZoomDependentExpression",c),wt("ZoomConstantExpression",cc),wt("CompoundExpression",Nr,{omit:["_evaluate"]});for(let o in hs)hs[o]._classRegistryKey||wt(`Expression_${o}`,hs[o]);function fu(o){return o&&typeof ArrayBuffer<"u"&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}function mu(o){return o.$name||o.constructor._classRegistryKey}function Pd(o){return!function(t){if(t===null||typeof t!="object")return!1;let r=mu(t);return!(!r||r==="Object")}(o)&&(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||o instanceof Blob||o instanceof Error||fu(o)||ui(o)||ArrayBuffer.isView(o)||o instanceof ImageData)}function Ll(o,t){if(Pd(o))return(fu(o)||ui(o))&&t&&t.push(o),ArrayBuffer.isView(o)&&t&&t.push(o.buffer),o instanceof ImageData&&t&&t.push(o.data.buffer),o;if(Array.isArray(o)){let v=[];for(let x of o)v.push(Ll(x,t));return v}if(typeof o!="object")throw new Error("can't serialize object of type "+typeof o);let r=mu(o);if(!r)throw new Error(`can't serialize object of unregistered class ${o.constructor.name}`);if(!oa[r])throw new Error(`${r} is not registered.`);let{klass:u}=oa[r],p=u.serialize?u.serialize(o,t):{};if(u.serialize){if(t&&p===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(let v in o){if(!o.hasOwnProperty(v)||oa[r].omit.indexOf(v)>=0)continue;let x=o[v];p[v]=oa[r].shallow.indexOf(v)>=0?x:Ll(x,t)}o instanceof Error&&(p.message=o.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(p.$name=r),p}function pc(o){if(Pd(o))return o;if(Array.isArray(o))return o.map(pc);if(typeof o!="object")throw new Error("can't deserialize object of type "+typeof o);let t=mu(o)||"Object";if(!oa[t])throw new Error(`can't deserialize unregistered class ${t}`);let{klass:r}=oa[t];if(!r)throw new Error(`can't deserialize unregistered class ${t}`);if(r.deserialize)return r.deserialize(o);let u=Object.create(r.prototype);for(let p of Object.keys(o)){if(p==="$name")continue;let v=o[p];u[p]=oa[t].shallow.indexOf(p)>=0?v:pc(v)}return u}class lh{constructor(){this.first=!0}update(t,r){let u=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=u,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=u,!0):(this.lastFloorZoom>u?(this.lastIntegerZoom=u+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<u&&(this.lastIntegerZoom=u,this.lastIntegerZoomTime=r),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=u,!0))}}let bi={"Latin-1 Supplement":o=>o>=128&&o<=255,"Hangul Jamo":o=>o>=4352&&o<=4607,Khmer:o=>o>=6016&&o<=6143,"General Punctuation":o=>o>=8192&&o<=8303,"Letterlike Symbols":o=>o>=8448&&o<=8527,"Number Forms":o=>o>=8528&&o<=8591,"Miscellaneous Technical":o=>o>=8960&&o<=9215,"Control Pictures":o=>o>=9216&&o<=9279,"Optical Character Recognition":o=>o>=9280&&o<=9311,"Enclosed Alphanumerics":o=>o>=9312&&o<=9471,"Geometric Shapes":o=>o>=9632&&o<=9727,"Miscellaneous Symbols":o=>o>=9728&&o<=9983,"Miscellaneous Symbols and Arrows":o=>o>=11008&&o<=11263,"Ideographic Description Characters":o=>o>=12272&&o<=12287,"CJK Symbols and Punctuation":o=>o>=12288&&o<=12351,Hiragana:o=>o>=12352&&o<=12447,Katakana:o=>o>=12448&&o<=12543,Kanbun:o=>o>=12688&&o<=12703,"CJK Strokes":o=>o>=12736&&o<=12783,"Enclosed CJK Letters and Months":o=>o>=12800&&o<=13055,"CJK Compatibility":o=>o>=13056&&o<=13311,"Yijing Hexagram Symbols":o=>o>=19904&&o<=19967,"CJK Unified Ideographs":o=>o>=19968&&o<=40959,"Hangul Syllables":o=>o>=44032&&o<=55215,"Private Use Area":o=>o>=57344&&o<=63743,"Vertical Forms":o=>o>=65040&&o<=65055,"CJK Compatibility Forms":o=>o>=65072&&o<=65103,"Small Form Variants":o=>o>=65104&&o<=65135,"Halfwidth and Fullwidth Forms":o=>o>=65280&&o<=65519};function gu(o){for(let t of o)if(_u(t.charCodeAt(0)))return!0;return!1}function yf(o){for(let t of o)if(!Cd(t.charCodeAt(0)))return!1;return!0}function ch(o){let t=o.map(r=>{try{return new RegExp(`\\p{sc=${r}}`,"u").source}catch{return null}}).filter(r=>r);return new RegExp(t.join("|"),"u")}let Md=ch(["Arab","Dupl","Mong","Ougr","Syrc"]);function Cd(o){return!Md.test(String.fromCodePoint(o))}let uh=ch(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function _u(o){return!(o!==746&&o!==747&&(o<4352||!(bi["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||bi["CJK Compatibility"](o)||bi["CJK Strokes"](o)||!(!bi["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||o===12336)||bi["Enclosed CJK Letters and Months"](o)||bi["Ideographic Description Characters"](o)||bi.Kanbun(o)||bi.Katakana(o)&&o!==12540||!(!bi["Halfwidth and Fullwidth Forms"](o)||o===65288||o===65289||o===65293||o>=65306&&o<=65310||o===65339||o===65341||o===65343||o>=65371&&o<=65503||o===65507||o>=65512&&o<=65519)||!(!bi["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||bi["Vertical Forms"](o)||bi["Yijing Hexagram Symbols"](o)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(o))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(o))||uh.test(String.fromCodePoint(o)))))}function fc(o){return!(_u(o)||function(t){return!!(bi["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||bi["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||bi["Letterlike Symbols"](t)||bi["Number Forms"](t)||bi["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||bi["Control Pictures"](t)&&t!==9251||bi["Optical Character Recognition"](t)||bi["Enclosed Alphanumerics"](t)||bi["Geometric Shapes"](t)||bi["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||bi["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||bi["CJK Symbols and Punctuation"](t)||bi.Katakana(t)||bi["Private Use Area"](t)||bi["CJK Compatibility Forms"](t)||bi["Small Form Variants"](t)||bi["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(o))}let vf=ch(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function yu(o){return vf.test(String.fromCodePoint(o))}function xf(o,t){return!(!t&&yu(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||bi.Khmer(o))}function bf(o){for(let t of o)if(yu(t.charCodeAt(0)))return!0;return!1}let Fa=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(o){this.pluginStatus=o.pluginStatus,this.pluginURL=o.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(o){if(Fa.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=o.applyArabicShaping,this.processBidirectionalText=o.processBidirectionalText,this.processStyledBidirectionalText=o.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(o,t){return a(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(o.pluginStatus!=="loading")return this.setState(o),o;let r=o.pluginURL,u=new Promise(v=>{this.loadScriptResolve=v});t(r);let p=new Promise(v=>setTimeout(()=>v(),this.TIMEOUT));if(yield Promise.race([u,p]),this.isParsed()){let v={pluginStatus:"loaded",pluginURL:r};return this.setState(v),v}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${r}`)})}};class sn{constructor(t,r){this.zoom=t,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new lh,this.transition={})}isSupportedScript(t){return function(r,u){for(let p of r)if(!xf(p.charCodeAt(0),u))return!1;return!0}(t,Fa.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){let t=this.zoom,r=t-Math.floor(t),u=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*u}:{fromScale:.5,toScale:1,t:1-(1-u)*r}}}class mc{constructor(t,r){this.property=t,this.value=r,this.expression=function(u,p){if(Hs(u))return new T(u,p);if(fs(u)){let v=g(u,p);if(v.result==="error")throw new Error(v.value.map(x=>`${x.key}: ${x.message}`).join(", "));return v.value}{let v=u;return p.type==="color"&&typeof u=="string"?v=di.parse(u):p.type!=="padding"||typeof u!="number"&&!Array.isArray(u)?p.type!=="numberArray"||typeof u!="number"&&!Array.isArray(u)?p.type!=="colorArray"||typeof u!="string"&&!Array.isArray(u)?p.type==="variableAnchorOffsetCollection"&&Array.isArray(u)?v=lr.parse(u):p.type==="projectionDefinition"&&typeof u=="string"&&(v=cr.parse(u)):v=Ut.parse(u):v=Sn.parse(u):v=On.parse(u),{kind:"constant",evaluate:()=>v}}}(r===void 0?t.specification.default:r,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,r,u){return this.property.possiblyEvaluate(this,t,r,u)}}class hh{constructor(t){this.property=t,this.value=new mc(t,void 0)}transitioned(t,r){return new Ed(this.property,this.value,r,Ft({},t.transition,this.transition),t.now)}untransitioned(){return new Ed(this.property,this.value,null,{},0)}}class Id{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return hn(this._values[t].value.value)}setValue(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new hh(this._values[t].property)),this._values[t].value=new mc(this._values[t].property,r===null?void 0:hn(r))}getTransition(t){return hn(this._values[t].transition)}setTransition(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new hh(this._values[t].property)),this._values[t].transition=hn(r)||void 0}serialize(){let t={};for(let r of Object.keys(this._values)){let u=this.getValue(r);u!==void 0&&(t[r]=u);let p=this.getTransition(r);p!==void 0&&(t[`${r}-transition`]=p)}return t}transitioned(t,r){let u=new Ld(this._properties);for(let p of Object.keys(this._values))u._values[p]=this._values[p].transitioned(t,r._values[p]);return u}untransitioned(){let t=new Ld(this._properties);for(let r of Object.keys(this._values))t._values[r]=this._values[r].untransitioned();return t}}class Ed{constructor(t,r,u,p,v){this.property=t,this.value=r,this.begin=v+p.delay||0,this.end=this.begin+p.duration||0,t.specification.transition&&(p.delay||p.duration)&&(this.prior=u)}possiblyEvaluate(t,r,u){let p=t.now||0,v=this.value.possiblyEvaluate(t,r,u),x=this.prior;if(x){if(p>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(p<this.begin)return x.possiblyEvaluate(t,r,u);{let w=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(t,r,u),v,xt(w))}}return v}}class Ld{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,r,u){let p=new vu(this._properties);for(let v of Object.keys(this._values))p._values[v]=this._values[v].possiblyEvaluate(t,r,u);return p}hasTransition(){for(let t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class wf{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return hn(this._values[t].value)}setValue(t,r){this._values[t]=new mc(this._values[t].property,r===null?void 0:hn(r))}serialize(){let t={};for(let r of Object.keys(this._values)){let u=this.getValue(r);u!==void 0&&(t[r]=u)}return t}possiblyEvaluate(t,r,u){let p=new vu(this._properties);for(let v of Object.keys(this._values))p._values[v]=this._values[v].possiblyEvaluate(t,r,u);return p}}class Ur{constructor(t,r,u){this.property=t,this.value=r,this.parameters=u}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,r,u,p){return this.property.evaluate(this.value,this.parameters,t,r,u,p)}}class vu{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Rt{constructor(t){this.specification=t}possiblyEvaluate(t,r){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(r)}interpolate(t,r,u){let p=tr[this.specification.type];return p?p(t,r,u):t}}class Wt{constructor(t,r){this.specification=t,this.overrides=r}possiblyEvaluate(t,r,u,p){return new Ur(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(r,null,{},u,p)}:t.expression,r)}interpolate(t,r,u){if(t.value.kind!=="constant"||r.value.kind!=="constant")return t;if(t.value.value===void 0||r.value.value===void 0)return new Ur(this,{kind:"constant",value:void 0},t.parameters);let p=tr[this.specification.type];if(p){let v=p(t.value.value,r.value.value,u);return new Ur(this,{kind:"constant",value:v},t.parameters)}return t}evaluate(t,r,u,p,v,x){return t.kind==="constant"?t.value:t.evaluate(r,u,p,v,x)}}class gc extends Wt{possiblyEvaluate(t,r,u,p){if(t.value===void 0)return new Ur(this,{kind:"constant",value:void 0},r);if(t.expression.kind==="constant"){let v=t.expression.evaluate(r,null,{},u,p),x=t.property.specification.type==="resolvedImage"&&typeof v!="string"?v.name:v,w=this._calculate(x,x,x,r);return new Ur(this,{kind:"constant",value:w},r)}if(t.expression.kind==="camera"){let v=this._calculate(t.expression.evaluate({zoom:r.zoom-1}),t.expression.evaluate({zoom:r.zoom}),t.expression.evaluate({zoom:r.zoom+1}),r);return new Ur(this,{kind:"constant",value:v},r)}return new Ur(this,t.expression,r)}evaluate(t,r,u,p,v,x){if(t.kind==="source"){let w=t.evaluate(r,u,p,v,x);return this._calculate(w,w,w,r)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(r.zoom)-1},u,p),t.evaluate({zoom:Math.floor(r.zoom)},u,p),t.evaluate({zoom:Math.floor(r.zoom)+1},u,p),r):t.value}_calculate(t,r,u,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:u,to:r}}interpolate(t){return t}}class dh{constructor(t){this.specification=t}possiblyEvaluate(t,r,u,p){if(t.value!==void 0){if(t.expression.kind==="constant"){let v=t.expression.evaluate(r,null,{},u,p);return this._calculate(v,v,v,r)}return this._calculate(t.expression.evaluate(new sn(Math.floor(r.zoom-1),r)),t.expression.evaluate(new sn(Math.floor(r.zoom),r)),t.expression.evaluate(new sn(Math.floor(r.zoom+1),r)),r)}}_calculate(t,r,u,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:u,to:r}}interpolate(t){return t}}class ph{constructor(t){this.specification=t}possiblyEvaluate(t,r,u,p){return!!t.expression.evaluate(r,null,{},u,p)}interpolate(){return!1}}class Gn{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(let r in t){let u=t[r];u.specification.overridable&&this.overridableProperties.push(r);let p=this.defaultPropertyValues[r]=new mc(u,void 0),v=this.defaultTransitionablePropertyValues[r]=new hh(u);this.defaultTransitioningPropertyValues[r]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=p.possiblyEvaluate({})}}}wt("DataDrivenProperty",Wt),wt("DataConstantProperty",Rt),wt("CrossFadedDataDrivenProperty",gc),wt("CrossFadedProperty",dh),wt("ColorRampProperty",ph);let fh="-transition";class wo extends Te{constructor(t,r){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),r.layout&&(this._unevaluatedLayout=new wf(r.layout)),r.paint)){this._transitionablePaint=new Id(r.paint);for(let u in t.paint)this.setPaintProperty(u,t.paint[u],{validate:!1});for(let u in t.layout)this.setLayoutProperty(u,t.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new vu(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,r,u={}){r!=null&&this._validate(pu,`layers.${this.id}.layout.${t}`,t,r,u)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,r):this.visibility=r)}getPaintProperty(t){return t.endsWith(fh)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,r,u={}){if(r!=null&&this._validate(ah,`layers.${this.id}.paint.${t}`,t,r,u))return!1;if(t.endsWith(fh))return this._transitionablePaint.setTransition(t.slice(0,-11),r||void 0),!1;{let p=this._transitionablePaint._values[t],v=p.property.specification["property-type"]==="cross-faded-data-driven",x=p.value.isDataDriven(),w=p.value;this._transitionablePaint.setValue(t,r),this._handleSpecialPaintPropertyUpdate(t);let M=this._transitionablePaint._values[t].value;return M.isDataDriven()||x||v||this._handleOverridablePaintPropertyUpdate(t,w,M)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,r,u){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,r){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,r)}serialize(){let t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),Jn(t,(r,u)=>!(r===void 0||u==="layout"&&!Object.keys(r).length||u==="paint"&&!Object.keys(r).length))}_validate(t,r,u,p,v={}){return(!v||v.validate!==!1)&&sh(this,t.call(Il,{key:r,layerType:this.type,objectKey:u,value:p,styleSpec:ie,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(let t in this.paint._values){let r=this.paint.get(t);if(r instanceof Ur&&bo(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}let Ad={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ys{constructor(t,r){this._structArray=t,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Mn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,r){return t._trim(),r&&(t.isTransferred=!0,r.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){let r=Object.create(this.prototype);return r.arrayBuffer=t.arrayBuffer,r.length=t.length,r.capacity=t.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function _n(o,t=1){let r=0,u=0;return{members:o.map(p=>{let v=Ad[p.type].BYTES_PER_ELEMENT,x=r=Al(r,Math.max(t,v)),w=p.components||1;return u=Math.max(u,v),r+=v*w,{name:p.name,type:p.type,components:w,offset:x}}),size:Al(r,Math.max(u,t)),alignment:t}}function Al(o,t){return Math.ceil(o/t)*t}class _c extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r){let u=this.length;return this.resize(u+1),this.emplace(u,t,r)}emplace(t,r,u){let p=2*t;return this.int16[p+0]=r,this.int16[p+1]=u,t}}_c.prototype.bytesPerElement=4,wt("StructArrayLayout2i4",_c);class yc extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,u){let p=this.length;return this.resize(p+1),this.emplace(p,t,r,u)}emplace(t,r,u,p){let v=3*t;return this.int16[v+0]=r,this.int16[v+1]=u,this.int16[v+2]=p,t}}yc.prototype.bytesPerElement=6,wt("StructArrayLayout3i6",yc);class Js extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,u,p){let v=this.length;return this.resize(v+1),this.emplace(v,t,r,u,p)}emplace(t,r,u,p,v){let x=4*t;return this.int16[x+0]=r,this.int16[x+1]=u,this.int16[x+2]=p,this.int16[x+3]=v,t}}Js.prototype.bytesPerElement=8,wt("StructArrayLayout4i8",Js);class mh extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,u,p,v,x){let w=this.length;return this.resize(w+1),this.emplace(w,t,r,u,p,v,x)}emplace(t,r,u,p,v,x,w){let M=6*t;return this.int16[M+0]=r,this.int16[M+1]=u,this.int16[M+2]=p,this.int16[M+3]=v,this.int16[M+4]=x,this.int16[M+5]=w,t}}mh.prototype.bytesPerElement=12,wt("StructArrayLayout2i4i12",mh);class gh extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,u,p,v,x){let w=this.length;return this.resize(w+1),this.emplace(w,t,r,u,p,v,x)}emplace(t,r,u,p,v,x,w){let M=4*t,I=8*t;return this.int16[M+0]=r,this.int16[M+1]=u,this.uint8[I+4]=p,this.uint8[I+5]=v,this.uint8[I+6]=x,this.uint8[I+7]=w,t}}gh.prototype.bytesPerElement=8,wt("StructArrayLayout2i4ub8",gh);class kl extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r){let u=this.length;return this.resize(u+1),this.emplace(u,t,r)}emplace(t,r,u){let p=2*t;return this.float32[p+0]=r,this.float32[p+1]=u,t}}kl.prototype.bytesPerElement=8,wt("StructArrayLayout2f8",kl);class _h extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,u,p,v,x,w,M,I,z){let D=this.length;return this.resize(D+1),this.emplace(D,t,r,u,p,v,x,w,M,I,z)}emplace(t,r,u,p,v,x,w,M,I,z,D){let $=10*t;return this.uint16[$+0]=r,this.uint16[$+1]=u,this.uint16[$+2]=p,this.uint16[$+3]=v,this.uint16[$+4]=x,this.uint16[$+5]=w,this.uint16[$+6]=M,this.uint16[$+7]=I,this.uint16[$+8]=z,this.uint16[$+9]=D,t}}_h.prototype.bytesPerElement=20,wt("StructArrayLayout10ui20",_h);class _ extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,u,p,v,x,w,M,I,z,D,$){let Z=this.length;return this.resize(Z+1),this.emplace(Z,t,r,u,p,v,x,w,M,I,z,D,$)}emplace(t,r,u,p,v,x,w,M,I,z,D,$,Z){let G=12*t;return this.int16[G+0]=r,this.int16[G+1]=u,this.int16[G+2]=p,this.int16[G+3]=v,this.uint16[G+4]=x,this.uint16[G+5]=w,this.uint16[G+6]=M,this.uint16[G+7]=I,this.int16[G+8]=z,this.int16[G+9]=D,this.int16[G+10]=$,this.int16[G+11]=Z,t}}_.prototype.bytesPerElement=24,wt("StructArrayLayout4i4ui4i24",_);class e extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,u){let p=this.length;return this.resize(p+1),this.emplace(p,t,r,u)}emplace(t,r,u,p){let v=3*t;return this.float32[v+0]=r,this.float32[v+1]=u,this.float32[v+2]=p,t}}e.prototype.bytesPerElement=12,wt("StructArrayLayout3f12",e);class n extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){let r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint32[1*t+0]=r,t}}n.prototype.bytesPerElement=4,wt("StructArrayLayout1ul4",n);class h extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,u,p,v,x,w,M,I){let z=this.length;return this.resize(z+1),this.emplace(z,t,r,u,p,v,x,w,M,I)}emplace(t,r,u,p,v,x,w,M,I,z){let D=10*t,$=5*t;return this.int16[D+0]=r,this.int16[D+1]=u,this.int16[D+2]=p,this.int16[D+3]=v,this.int16[D+4]=x,this.int16[D+5]=w,this.uint32[$+3]=M,this.uint16[D+8]=I,this.uint16[D+9]=z,t}}h.prototype.bytesPerElement=20,wt("StructArrayLayout6i1ul2ui20",h);class d extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,u,p,v,x){let w=this.length;return this.resize(w+1),this.emplace(w,t,r,u,p,v,x)}emplace(t,r,u,p,v,x,w){let M=6*t;return this.int16[M+0]=r,this.int16[M+1]=u,this.int16[M+2]=p,this.int16[M+3]=v,this.int16[M+4]=x,this.int16[M+5]=w,t}}d.prototype.bytesPerElement=12,wt("StructArrayLayout2i2i2i12",d);class y extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,u,p,v){let x=this.length;return this.resize(x+1),this.emplace(x,t,r,u,p,v)}emplace(t,r,u,p,v,x){let w=4*t,M=8*t;return this.float32[w+0]=r,this.float32[w+1]=u,this.float32[w+2]=p,this.int16[M+6]=v,this.int16[M+7]=x,t}}y.prototype.bytesPerElement=16,wt("StructArrayLayout2f1f2i16",y);class b extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,u,p,v,x){let w=this.length;return this.resize(w+1),this.emplace(w,t,r,u,p,v,x)}emplace(t,r,u,p,v,x,w){let M=16*t,I=4*t,z=8*t;return this.uint8[M+0]=r,this.uint8[M+1]=u,this.float32[I+1]=p,this.float32[I+2]=v,this.int16[z+6]=x,this.int16[z+7]=w,t}}b.prototype.bytesPerElement=16,wt("StructArrayLayout2ub2f2i16",b);class S extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,u){let p=this.length;return this.resize(p+1),this.emplace(p,t,r,u)}emplace(t,r,u,p){let v=3*t;return this.uint16[v+0]=r,this.uint16[v+1]=u,this.uint16[v+2]=p,t}}S.prototype.bytesPerElement=6,wt("StructArrayLayout3ui6",S);class C extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,u,p,v,x,w,M,I,z,D,$,Z,G,K,ne,le){let Me=this.length;return this.resize(Me+1),this.emplace(Me,t,r,u,p,v,x,w,M,I,z,D,$,Z,G,K,ne,le)}emplace(t,r,u,p,v,x,w,M,I,z,D,$,Z,G,K,ne,le,Me){let fe=24*t,U=12*t,ee=48*t;return this.int16[fe+0]=r,this.int16[fe+1]=u,this.uint16[fe+2]=p,this.uint16[fe+3]=v,this.uint32[U+2]=x,this.uint32[U+3]=w,this.uint32[U+4]=M,this.uint16[fe+10]=I,this.uint16[fe+11]=z,this.uint16[fe+12]=D,this.float32[U+7]=$,this.float32[U+8]=Z,this.uint8[ee+36]=G,this.uint8[ee+37]=K,this.uint8[ee+38]=ne,this.uint32[U+10]=le,this.int16[fe+22]=Me,t}}C.prototype.bytesPerElement=48,wt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",C);class k extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,u,p,v,x,w,M,I,z,D,$,Z,G,K,ne,le,Me,fe,U,ee,_e,Ue,st,Ge,et,ht,lt){let dt=this.length;return this.resize(dt+1),this.emplace(dt,t,r,u,p,v,x,w,M,I,z,D,$,Z,G,K,ne,le,Me,fe,U,ee,_e,Ue,st,Ge,et,ht,lt)}emplace(t,r,u,p,v,x,w,M,I,z,D,$,Z,G,K,ne,le,Me,fe,U,ee,_e,Ue,st,Ge,et,ht,lt,dt){let it=32*t,Ct=16*t;return this.int16[it+0]=r,this.int16[it+1]=u,this.int16[it+2]=p,this.int16[it+3]=v,this.int16[it+4]=x,this.int16[it+5]=w,this.int16[it+6]=M,this.int16[it+7]=I,this.uint16[it+8]=z,this.uint16[it+9]=D,this.uint16[it+10]=$,this.uint16[it+11]=Z,this.uint16[it+12]=G,this.uint16[it+13]=K,this.uint16[it+14]=ne,this.uint16[it+15]=le,this.uint16[it+16]=Me,this.uint16[it+17]=fe,this.uint16[it+18]=U,this.uint16[it+19]=ee,this.uint16[it+20]=_e,this.uint16[it+21]=Ue,this.uint16[it+22]=st,this.uint32[Ct+12]=Ge,this.float32[Ct+13]=et,this.float32[Ct+14]=ht,this.uint16[it+30]=lt,this.uint16[it+31]=dt,t}}k.prototype.bytesPerElement=64,wt("StructArrayLayout8i15ui1ul2f2ui64",k);class R extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){let r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.float32[1*t+0]=r,t}}R.prototype.bytesPerElement=4,wt("StructArrayLayout1f4",R);class j extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,u){let p=this.length;return this.resize(p+1),this.emplace(p,t,r,u)}emplace(t,r,u,p){let v=3*t;return this.uint16[6*t+0]=r,this.float32[v+1]=u,this.float32[v+2]=p,t}}j.prototype.bytesPerElement=12,wt("StructArrayLayout1ui2f12",j);class N extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,u){let p=this.length;return this.resize(p+1),this.emplace(p,t,r,u)}emplace(t,r,u,p){let v=4*t;return this.uint32[2*t+0]=r,this.uint16[v+2]=u,this.uint16[v+3]=p,t}}N.prototype.bytesPerElement=8,wt("StructArrayLayout1ul2ui8",N);class q extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r){let u=this.length;return this.resize(u+1),this.emplace(u,t,r)}emplace(t,r,u){let p=2*t;return this.uint16[p+0]=r,this.uint16[p+1]=u,t}}q.prototype.bytesPerElement=4,wt("StructArrayLayout2ui4",q);class H extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){let r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint16[1*t+0]=r,t}}H.prototype.bytesPerElement=2,wt("StructArrayLayout1ui2",H);class ae extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,u,p){let v=this.length;return this.resize(v+1),this.emplace(v,t,r,u,p)}emplace(t,r,u,p,v){let x=4*t;return this.float32[x+0]=r,this.float32[x+1]=u,this.float32[x+2]=p,this.float32[x+3]=v,t}}ae.prototype.bytesPerElement=16,wt("StructArrayLayout4f16",ae);class oe extends Ys{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new he(this.anchorPointX,this.anchorPointY)}}oe.prototype.size=20;class se extends h{get(t){return new oe(this,t)}}wt("CollisionBoxArray",se);class pe extends Ys{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}pe.prototype.size=48;class ve extends C{get(t){return new pe(this,t)}}wt("PlacedSymbolArray",ve);class ye extends Ys{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}ye.prototype.size=64;class we extends k{get(t){return new ye(this,t)}}wt("SymbolInstanceArray",we);class Le extends R{getoffsetX(t){return this.float32[1*t+0]}}wt("GlyphOffsetArray",Le);class Pe extends yc{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}wt("SymbolLineVertexArray",Pe);class $e extends Ys{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}$e.prototype.size=12;class tt extends j{get(t){return new $e(this,t)}}wt("TextAnchorOffsetArray",tt);class He extends Ys{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}He.prototype.size=8;class Ke extends N{get(t){return new He(this,t)}}wt("FeatureIndexArray",Ke);class Qe extends _c{}class vt extends _c{}class gt extends _c{}class ct extends mh{}class Lt extends gh{}class li extends kl{}class Ci extends _h{}class yn extends _{}class Ki extends e{}class vn extends n{}class xn extends d{}class Qi extends b{}class Bi extends S{}class nr extends q{}let dr=_n([{name:"a_pos",components:2,type:"Int16"}],4),{members:xr}=dr;class Oi{constructor(t=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=t}prepareSegment(t,r,u,p){let v=this.segments[this.segments.length-1];return t>Oi.MAX_VERTEX_ARRAY_LENGTH&&Ri(`Max vertices per segment is ${Oi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${Oi.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!v||v.vertexLength+t>Oi.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==p?this.createNewSegment(r,u,p):v}createNewSegment(t,r,u){let p={vertexOffset:t.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0,vaos:{}};return u!==void 0&&(p.sortKey=u),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(p),p}getOrCreateLatestSegment(t,r,u){return this.prepareSegment(0,t,r,u)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(let t of this.segments)for(let r in t.vaos)t.vaos[r].destroy()}static simpleSegment(t,r,u,p){return new Oi([{vertexOffset:t,primitiveOffset:r,vertexLength:u,primitiveLength:p,vaos:{},sortKey:0}])}}function _s(o,t){return 256*(o=St(Math.floor(o),0,255))+St(Math.floor(t),0,255)}Oi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,wt("SegmentVector",Oi);let aa=_n([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var ys,Qs,vc,vs={exports:{}},el={exports:{}},lo={exports:{}},xs=function(){if(vc)return vs.exports;vc=1;var o=(ys||(ys=1,el.exports=function(r,u){var p,v,x,w,M,I,z,D;for(v=r.length-(p=3&r.length),x=u,M=3432918353,I=461845907,D=0;D<v;)z=255&r.charCodeAt(D)|(255&r.charCodeAt(++D))<<8|(255&r.charCodeAt(++D))<<16|(255&r.charCodeAt(++D))<<24,++D,x=27492+(65535&(w=5*(65535&(x=(x^=z=(65535&(z=(z=(65535&z)*M+(((z>>>16)*M&65535)<<16)&4294967295)<<15|z>>>17))*I+(((z>>>16)*I&65535)<<16)&4294967295)<<13|x>>>19))+((5*(x>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(z=0,p){case 3:z^=(255&r.charCodeAt(D+2))<<16;case 2:z^=(255&r.charCodeAt(D+1))<<8;case 1:x^=z=(65535&(z=(z=(65535&(z^=255&r.charCodeAt(D)))*M+(((z>>>16)*M&65535)<<16)&4294967295)<<15|z>>>17))*I+(((z>>>16)*I&65535)<<16)&4294967295}return x^=r.length,x=2246822507*(65535&(x^=x>>>16))+((2246822507*(x>>>16)&65535)<<16)&4294967295,x=3266489909*(65535&(x^=x>>>13))+((3266489909*(x>>>16)&65535)<<16)&4294967295,(x^=x>>>16)>>>0}),el.exports),t=(Qs||(Qs=1,lo.exports=function(r,u){for(var p,v=r.length,x=u^v,w=0;v>=4;)p=1540483477*(65535&(p=255&r.charCodeAt(w)|(255&r.charCodeAt(++w))<<8|(255&r.charCodeAt(++w))<<16|(255&r.charCodeAt(++w))<<24))+((1540483477*(p>>>16)&65535)<<16),x=1540483477*(65535&x)+((1540483477*(x>>>16)&65535)<<16)^(p=1540483477*(65535&(p^=p>>>24))+((1540483477*(p>>>16)&65535)<<16)),v-=4,++w;switch(v){case 3:x^=(255&r.charCodeAt(w+2))<<16;case 2:x^=(255&r.charCodeAt(w+1))<<8;case 1:x=1540483477*(65535&(x^=255&r.charCodeAt(w)))+((1540483477*(x>>>16)&65535)<<16)}return x=1540483477*(65535&(x^=x>>>13))+((1540483477*(x>>>16)&65535)<<16),(x^=x>>>15)>>>0}),lo.exports);return vs.exports=o,vs.exports.murmur3=o,vs.exports.murmur2=t,vs.exports}(),Na=P(xs);class bs{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,r,u,p){this.ids.push(qn(t)),this.positions.push(r,u,p)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");let r=qn(t),u=0,p=this.ids.length-1;for(;u<p;){let x=u+p>>1;this.ids[x]>=r?p=x:u=x+1}let v=[];for(;this.ids[u]===r;)v.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return v}static serialize(t,r){let u=new Float64Array(t.ids),p=new Uint32Array(t.positions);return Wn(u,p,0,u.length-1),r&&r.push(u.buffer,p.buffer),{ids:u,positions:p}}static deserialize(t){let r=new bs;return r.ids=t.ids,r.positions=t.positions,r.indexed=!0,r}}function qn(o){let t=+o;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Na(String(o))}function Wn(o,t,r,u){for(;r<u;){let p=o[r+u>>1],v=r-1,x=u+1;for(;;){do v++;while(o[v]<p);do x--;while(o[x]>p);if(v>=x)break;Zr(o,v,x),Zr(t,3*v,3*x),Zr(t,3*v+1,3*x+1),Zr(t,3*v+2,3*x+2)}x-r<u-x?(Wn(o,t,r,x),r=x+1):(Wn(o,t,x+1,u),u=x)}}function Zr(o,t,r){let u=o[t];o[t]=o[r],o[r]=u}wt("FeaturePositionMap",bs);class ln{constructor(t,r){this.gl=t.gl,this.location=r}}class xu extends ln{constructor(t,r){super(t,r),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class kd extends ln{constructor(t,r){super(t,r),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class zd extends ln{constructor(t,r){super(t,r),this.current=di.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}let Tf=new Float32Array(16);function yh(o){return[_s(255*o.r,255*o.g),_s(255*o.b,255*o.a)]}class xc{constructor(t,r,u){this.value=t,this.uniformNames=r.map(p=>`u_${p}`),this.type=u}setUniform(t,r,u){t.set(u.constantOr(this.value))}getBinding(t,r,u){return this.type==="color"?new zd(t,r):new xu(t,r)}}class To{constructor(t,r){this.uniformNames=r.map(u=>`u_${u}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=t.tlbr}setUniform(t,r,u,p){let v=p==="u_pattern_to"?this.patternTo:p==="u_pattern_from"?this.patternFrom:p==="u_pixel_ratio_to"?this.pixelRatioTo:p==="u_pixel_ratio_from"?this.pixelRatioFrom:null;v&&t.set(v)}getBinding(t,r,u){return u.substr(0,9)==="u_pattern"?new kd(t,r):new xu(t,r)}}class sa{constructor(t,r,u,p){this.expression=t,this.type=u,this.maxValue=0,this.paintVertexAttributes=r.map(v=>({name:`a_${v}`,type:"Float32",components:u==="color"?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(t,r,u,p,v){let x=this.paintVertexArray.length,w=this.expression.evaluate(new sn(0),r,{},p,[],v);this.paintVertexArray.resize(t),this._setPaintValue(x,t,w)}updatePaintArray(t,r,u,p){let v=this.expression.evaluate({zoom:0},u,p);this._setPaintValue(t,r,v)}_setPaintValue(t,r,u){if(this.type==="color"){let p=yh(u);for(let v=t;v<r;v++)this.paintVertexArray.emplace(v,p[0],p[1])}else{for(let p=t;p<r;p++)this.paintVertexArray.emplace(p,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class So{constructor(t,r,u,p,v,x){this.expression=t,this.uniformNames=r.map(w=>`u_${w}_t`),this.type=u,this.useIntegerZoom=p,this.zoom=v,this.maxValue=0,this.paintVertexAttributes=r.map(w=>({name:`a_${w}`,type:"Float32",components:u==="color"?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(t,r,u,p,v){let x=this.expression.evaluate(new sn(this.zoom),r,{},p,[],v),w=this.expression.evaluate(new sn(this.zoom+1),r,{},p,[],v),M=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(M,t,x,w)}updatePaintArray(t,r,u,p){let v=this.expression.evaluate({zoom:this.zoom},u,p),x=this.expression.evaluate({zoom:this.zoom+1},u,p);this._setPaintValue(t,r,v,x)}_setPaintValue(t,r,u,p){if(this.type==="color"){let v=yh(u),x=yh(p);for(let w=t;w<r;w++)this.paintVertexArray.emplace(w,v[0],v[1],x[0],x[1])}else{for(let v=t;v<r;v++)this.paintVertexArray.emplace(v,u,p);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(p))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,r){let u=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,p=St(this.expression.interpolationFactor(u,this.zoom,this.zoom+1),0,1);t.set(p)}getBinding(t,r,u){return new xu(t,r)}}class ja{constructor(t,r,u,p,v,x){this.expression=t,this.type=r,this.useIntegerZoom=u,this.zoom=p,this.layerId=x,this.zoomInPaintVertexArray=new v,this.zoomOutPaintVertexArray=new v}populatePaintArray(t,r,u){let p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(p,t,r.patterns&&r.patterns[this.layerId],u)}updatePaintArray(t,r,u,p,v){this._setPaintValues(t,r,u.patterns&&u.patterns[this.layerId],v)}_setPaintValues(t,r,u,p){if(!p||!u)return;let{min:v,mid:x,max:w}=u,M=p[v],I=p[x],z=p[w];if(M&&I&&z)for(let D=t;D<r;D++)this.zoomInPaintVertexArray.emplace(D,I.tl[0],I.tl[1],I.br[0],I.br[1],M.tl[0],M.tl[1],M.br[0],M.br[1],I.pixelRatio,M.pixelRatio),this.zoomOutPaintVertexArray.emplace(D,I.tl[0],I.tl[1],I.br[0],I.br[1],z.tl[0],z.tl[1],z.br[0],z.br[1],I.pixelRatio,z.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,aa.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,aa.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class bu{constructor(t,r,u){this.binders={},this._buffers=[];let p=[];for(let v in t.paint._values){if(!u(v))continue;let x=t.paint.get(v);if(!(x instanceof Ur&&bo(x.property.specification)))continue;let w=vh(v,t.type),M=x.value,I=x.property.specification.type,z=x.property.useIntegerZoom,D=x.property.specification["property-type"],$=D==="cross-faded"||D==="cross-faded-data-driven";if(M.kind==="constant")this.binders[v]=$?new To(M.value,w):new xc(M.value,w,I),p.push(`/u_${v}`);else if(M.kind==="source"||$){let Z=s_(v,I,"source");this.binders[v]=$?new ja(M,I,z,r,Z,t.id):new sa(M,w,I,Z),p.push(`/a_${v}`)}else{let Z=s_(v,I,"composite");this.binders[v]=new So(M,w,I,z,r,Z),p.push(`/z_${v}`)}}this.cacheKey=p.sort().join("")}getMaxValue(t){let r=this.binders[t];return r instanceof sa||r instanceof So?r.maxValue:0}populatePaintArrays(t,r,u,p,v){for(let x in this.binders){let w=this.binders[x];(w instanceof sa||w instanceof So||w instanceof ja)&&w.populatePaintArray(t,r,u,p,v)}}setConstantPatternPositions(t,r){for(let u in this.binders){let p=this.binders[u];p instanceof To&&p.setConstantPatternPositions(t,r)}}updatePaintArrays(t,r,u,p,v){let x=!1;for(let w in t){let M=r.getPositions(w);for(let I of M){let z=u.feature(I.index);for(let D in this.binders){let $=this.binders[D];if(($ instanceof sa||$ instanceof So||$ instanceof ja)&&$.expression.isStateDependent===!0){let Z=p.paint.get(D);$.expression=Z.value,$.updatePaintArray(I.start,I.end,z,t[w],v),x=!0}}}}return x}defines(){let t=[];for(let r in this.binders){let u=this.binders[r];(u instanceof xc||u instanceof To)&&t.push(...u.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return t}getBinderAttributes(){let t=[];for(let r in this.binders){let u=this.binders[r];if(u instanceof sa||u instanceof So)for(let p=0;p<u.paintVertexAttributes.length;p++)t.push(u.paintVertexAttributes[p].name);else if(u instanceof ja)for(let p=0;p<aa.members.length;p++)t.push(aa.members[p].name)}return t}getBinderUniforms(){let t=[];for(let r in this.binders){let u=this.binders[r];if(u instanceof xc||u instanceof To||u instanceof So)for(let p of u.uniformNames)t.push(p)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,r){let u=[];for(let p in this.binders){let v=this.binders[p];if(v instanceof xc||v instanceof To||v instanceof So){for(let x of v.uniformNames)if(r[x]){let w=v.getBinding(t,r[x],x);u.push({name:x,property:p,binding:w})}}}return u}setUniforms(t,r,u,p){for(let{name:v,property:x,binding:w}of r)this.binders[x].setUniform(w,p,u.get(x),v)}updatePaintBuffers(t){this._buffers=[];for(let r in this.binders){let u=this.binders[r];if(t&&u instanceof ja){let p=t.fromScale===2?u.zoomInPaintVertexBuffer:u.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(u instanceof sa||u instanceof So)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}}upload(t){for(let r in this.binders){let u=this.binders[r];(u instanceof sa||u instanceof So||u instanceof ja)&&u.upload(t)}this.updatePaintBuffers()}destroy(){for(let t in this.binders){let r=this.binders[t];(r instanceof sa||r instanceof So||r instanceof ja)&&r.destroy()}}}class ws{constructor(t,r,u=()=>!0){this.programConfigurations={};for(let p of t)this.programConfigurations[p.id]=new bu(p,r,u);this.needsUpload=!1,this._featureMap=new bs,this._bufferOffset=0}populatePaintArrays(t,r,u,p,v,x){for(let w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(t,r,p,v,x);r.id!==void 0&&this._featureMap.add(r.id,u,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,r,u,p){for(let v of u)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(t,this._featureMap,r,v,p)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(let r in this.programConfigurations)this.programConfigurations[r].upload(t);this.needsUpload=!1}}destroy(){for(let t in this.programConfigurations)this.programConfigurations[t].destroy()}}function vh(o,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[o]||[o.replace(`${t}-`,"").replace(/-/g,"_")]}function s_(o,t,r){let u={color:{source:kl,composite:ae},number:{source:R,composite:kl}},p=function(v){return{"line-pattern":{source:Ci,composite:Ci},"fill-pattern":{source:Ci,composite:Ci},"fill-extrusion-pattern":{source:Ci,composite:Ci}}[v]}(o);return p&&p[r]||u[t][r]}wt("ConstantBinder",xc),wt("CrossFadedConstantBinder",To),wt("SourceExpressionBinder",sa),wt("CrossFadedCompositeBinder",ja),wt("CompositeExpressionBinder",So),wt("ProgramConfiguration",bu,{omit:["_buffers"]}),wt("ProgramConfigurationSet",ws);let Sf=Math.pow(2,14)-1,l_=-Sf-1;function bc(o){let t=ge/o.extent,r=o.loadGeometry();for(let u=0;u<r.length;u++){let p=r[u];for(let v=0;v<p.length;v++){let x=p[v],w=Math.round(x.x*t),M=Math.round(x.y*t);x.x=St(w,l_,Sf),x.y=St(M,l_,Sf),(w<x.x||w>x.x+1||M<x.y||M>x.y+1)&&Ri("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function wc(o,t){return{type:o.type,id:o.id,properties:o.properties,geometry:t?bc(o):[]}}let c_=-32768;function Wx(o,t,r,u,p){o.emplaceBack(c_+8*t+u,c_+8*r+p)}class Pf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new vt,this.indexArray=new Bi,this.segments=new Oi,this.programConfigurations=new ws(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,u){let p=this.layers[0],v=[],x=null,w=!1,M=p.type==="heatmap";if(p.type==="circle"){let z=p;x=z.layout.get("circle-sort-key"),w=!x.isConstant(),M=M||z.paint.get("circle-pitch-alignment")==="map"}let I=M?r.subdivisionGranularity.circle:1;for(let{feature:z,id:D,index:$,sourceLayerIndex:Z}of t){let G=this.layers[0]._featureFilter.needGeometry,K=wc(z,G);if(!this.layers[0]._featureFilter.filter(new sn(this.zoom),K,u))continue;let ne=w?x.evaluate(K,{},u):void 0,le={id:D,properties:z.properties,type:z.type,sourceLayerIndex:Z,index:$,geometry:G?K.geometry:bc(z),patterns:{},sortKey:ne};v.push(le)}w&&v.sort((z,D)=>z.sortKey-D.sortKey);for(let z of v){let{geometry:D,index:$,sourceLayerIndex:Z}=z,G=t[$].feature;this.addFeature(z,D,$,u,I),r.featureIndex.insert(G,D,$,Z,this.index)}}update(t,r,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,xr),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,r,u,p,v=1){let x;switch(v){case 1:x=[0,7];break;case 3:x=[0,2,5,7];break;case 5:x=[0,1,3,4,6,7];break;case 7:x=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${v}; valid values are 1, 3, 5, 7.`)}let w=x.length;for(let M of r)for(let I of M){let z=I.x,D=I.y;if(z<0||z>=ge||D<0||D>=ge)continue;let $=this.segments.prepareSegment(w*w,this.layoutVertexArray,this.indexArray,t.sortKey),Z=$.vertexLength;for(let G=0;G<w;G++)for(let K=0;K<w;K++)Wx(this.layoutVertexArray,z,D,x[K],x[G]);for(let G=0;G<w-1;G++)for(let K=0;K<w-1;K++){let ne=Z+G*w+K,le=Z+(G+1)*w+K;this.indexArray.emplaceBack(ne,le+1,ne+1),this.indexArray.emplaceBack(ne,le,le+1)}$.vertexLength+=w*w,$.primitiveLength+=(w-1)*(w-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,{},p)}}function u_(o,t){for(let r=0;r<o.length;r++)if(Tc(t,o[r]))return!0;for(let r=0;r<t.length;r++)if(Tc(o,t[r]))return!0;return!!Mf(o,t)}function Hx(o,t,r){return!!Tc(o,t)||!!Cf(t,o,r)}function h_(o,t){if(o.length===1)return p_(t,o[0]);for(let r=0;r<t.length;r++){let u=t[r];for(let p=0;p<u.length;p++)if(Tc(o,u[p]))return!0}for(let r=0;r<o.length;r++)if(p_(t,o[r]))return!0;for(let r=0;r<t.length;r++)if(Mf(o,t[r]))return!0;return!1}function Kx(o,t,r){if(o.length>1){if(Mf(o,t))return!0;for(let u=0;u<t.length;u++)if(Cf(t[u],o,r))return!0}for(let u=0;u<o.length;u++)if(Cf(o[u],t,r))return!0;return!1}function Mf(o,t){if(o.length===0||t.length===0)return!1;for(let r=0;r<o.length-1;r++){let u=o[r],p=o[r+1];for(let v=0;v<t.length-1;v++)if(Xx(u,p,t[v],t[v+1]))return!0}return!1}function Xx(o,t,r,u){return _i(o,r,u)!==_i(t,r,u)&&_i(o,t,r)!==_i(o,t,u)}function Cf(o,t,r){let u=r*r;if(t.length===1)return o.distSqr(t[0])<u;for(let p=1;p<t.length;p++)if(d_(o,t[p-1],t[p])<u)return!0;return!1}function d_(o,t,r){let u=t.distSqr(r);if(u===0)return o.distSqr(t);let p=((o.x-t.x)*(r.x-t.x)+(o.y-t.y)*(r.y-t.y))/u;return o.distSqr(p<0?t:p>1?r:r.sub(t)._mult(p)._add(t))}function p_(o,t){for(let r=0;r<o.length;r++)if(Tc(o[r],t))return!0;return!1}function Tc(o,t){let r=!1;for(let u=0,p=o.length-1;u<o.length;p=u++){let v=o[u],x=o[p];v.y>t.y!=x.y>t.y&&t.x<(x.x-v.x)*(t.y-v.y)/(x.y-v.y)+v.x&&(r=!r)}return r}function Yx(o,t,r){let u=r[0],p=r[2];if(o.x<u.x&&t.x<u.x||o.x>p.x&&t.x>p.x||o.y<u.y&&t.y<u.y||o.y>p.y&&t.y>p.y)return!1;let v=_i(o,t,r[0]);return v!==_i(o,t,r[1])||v!==_i(o,t,r[2])||v!==_i(o,t,r[3])}function xh(o,t,r){let u=t.paint.get(o).value;return u.kind==="constant"?u.value:r.programConfigurations.get(t.id).getMaxValue(o)}function Rd(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function Dd(o,t,r,u,p){if(!t[0]&&!t[1])return o;let v=he.convert(t)._mult(p);r==="viewport"&&v._rotate(-u);let x=[];for(let w=0;w<o.length;w++)x.push(o[w].sub(v));return x}let f_,m_;wt("CircleBucket",Pf,{omit:["layers"]});var Jx={get paint(){return m_=m_||new Gn({"circle-radius":new Wt(ie.paint_circle["circle-radius"]),"circle-color":new Wt(ie.paint_circle["circle-color"]),"circle-blur":new Wt(ie.paint_circle["circle-blur"]),"circle-opacity":new Wt(ie.paint_circle["circle-opacity"]),"circle-translate":new Rt(ie.paint_circle["circle-translate"]),"circle-translate-anchor":new Rt(ie.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Rt(ie.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Rt(ie.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Wt(ie.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Wt(ie.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Wt(ie.paint_circle["circle-stroke-opacity"])})},get layout(){return f_=f_||new Gn({"circle-sort-key":new Wt(ie.layout_circle["circle-sort-key"])})}};class Qx extends wo{constructor(t){super(t,Jx)}createBucket(t){return new Pf(t)}queryRadius(t){let r=t;return xh("circle-radius",this,r)+xh("circle-stroke-width",this,r)+Rd(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:t,feature:r,featureState:u,geometry:p,transform:v,pixelsToTileUnits:x,unwrappedTileID:w,getElevation:M}){let I=Dd(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-v.bearingInRadians,x),z=this.paint.get("circle-radius").evaluate(r,u)+this.paint.get("circle-stroke-width").evaluate(r,u),D=this.paint.get("circle-pitch-alignment")==="map",$=D?I:function(G,K,ne,le){return G.map(Me=>g_(Me,K,ne,le))}(I,v,w,M),Z=D?z*x:z;for(let G of p)for(let K of G){let ne=D?K:g_(K,v,w,M),le=Z,Me=v.projectTileCoordinates(K.x,K.y,w,M).signedDistanceFromCamera;if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?le*=Me/v.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(le*=v.cameraToCenterDistance/Me),Hx($,ne,le))return!0}return!1}}function g_(o,t,r,u){let p=t.projectTileCoordinates(o.x,o.y,r,u).point;return new he((.5*p.x+.5)*t.width,(.5*-p.y+.5)*t.height)}class __ extends Pf{}let y_;wt("HeatmapBucket",__,{omit:["layers"]});var eb={get paint(){return y_=y_||new Gn({"heatmap-radius":new Wt(ie.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Wt(ie.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Rt(ie.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ph(ie.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Rt(ie.paint_heatmap["heatmap-opacity"])})}};function If(o,{width:t,height:r},u,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==t*r*u)throw new RangeError(`mismatched image size. expected: ${p.length} but got: ${t*r*u}`)}else p=new Uint8Array(t*r*u);return o.width=t,o.height=r,o.data=p,o}function v_(o,{width:t,height:r},u){if(t===o.width&&r===o.height)return;let p=If({},{width:t,height:r},u);Ef(o,p,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,t),height:Math.min(o.height,r)},u),o.width=t,o.height=r,o.data=p.data}function Ef(o,t,r,u,p,v){if(p.width===0||p.height===0)return t;if(p.width>o.width||p.height>o.height||r.x>o.width-p.width||r.y>o.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>t.width||p.height>t.height||u.x>t.width-p.width||u.y>t.height-p.height)throw new RangeError("out of range destination coordinates for image copy");let x=o.data,w=t.data;if(x===w)throw new Error("srcData equals dstData, so image is already copied");for(let M=0;M<p.height;M++){let I=((r.y+M)*o.width+r.x)*v,z=((u.y+M)*t.width+u.x)*v;for(let D=0;D<p.width*v;D++)w[z+D]=x[I+D]}return t}class bh{constructor(t,r){If(this,t,1,r)}resize(t){v_(this,t,1)}clone(){return new bh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,u,p,v){Ef(t,r,u,p,v,1)}}class $o{constructor(t,r){If(this,t,4,r)}resize(t){v_(this,t,4)}replace(t,r){r?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new $o({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,u,p,v){Ef(t,r,u,p,v,4)}}function x_(o){let t={},r=o.resolution||256,u=o.clips?o.clips.length:1,p=o.image||new $o({width:r,height:u});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);let v=(x,w,M)=>{t[o.evaluationKey]=M;let I=o.expression.evaluate(t);p.data[x+w+0]=Math.floor(255*I.r/I.a),p.data[x+w+1]=Math.floor(255*I.g/I.a),p.data[x+w+2]=Math.floor(255*I.b/I.a),p.data[x+w+3]=Math.floor(255*I.a)};if(o.clips)for(let x=0,w=0;x<u;++x,w+=4*r)for(let M=0,I=0;M<r;M++,I+=4){let z=M/(r-1),{start:D,end:$}=o.clips[x];v(w,I,D*(1-z)+$*z)}else for(let x=0,w=0;x<r;x++,w+=4)v(0,w,x/(r-1));return p}wt("AlphaImage",bh),wt("RGBAImage",$o);let Lf="big-fb";class tb extends wo{createBucket(t){return new __(t)}constructor(t){super(t,eb),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=x_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Lf)&&this.heatmapFbos.delete(Lf)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let b_;var ib={get paint(){return b_=b_||new Gn({"hillshade-illumination-direction":new Rt(ie.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new Rt(ie.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new Rt(ie.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Rt(ie.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Rt(ie.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Rt(ie.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Rt(ie.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new Rt(ie.paint_hillshade["hillshade-method"])})}};class nb extends wo{constructor(t){super(t,ib),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let t=this.paint.get("hillshade-illumination-direction").values,r=this.paint.get("hillshade-illumination-altitude").values,u=this.paint.get("hillshade-highlight-color").values,p=this.paint.get("hillshade-shadow-color").values,v=Math.max(t.length,r.length,u.length,p.length);t=t.concat(Array(v-t.length).fill(t.at(-1))),r=r.concat(Array(v-r.length).fill(r.at(-1))),u=u.concat(Array(v-u.length).fill(u.at(-1))),p=p.concat(Array(v-p.length).fill(p.at(-1)));let x=r.map(io);return{directionRadians:t.map(io),altitudeRadians:x,shadowColor:p,highlightColor:u}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let rb=_n([{name:"a_pos",components:2,type:"Int16"}],4),{members:ob}=rb;function Af(o,t,r){let u=r.patternDependencies,p=!1;for(let v of t){let x=v.paint.get(`${o}-pattern`);x.isConstant()||(p=!0);let w=x.constantOr(null);w&&(p=!0,u[w.to]=!0,u[w.from]=!0)}return p}function kf(o,t,r,u,p){let v=p.patternDependencies;for(let x of t){let w=x.paint.get(`${o}-pattern`).value;if(w.kind!=="constant"){let M=w.evaluate({zoom:u-1},r,{},p.availableImages),I=w.evaluate({zoom:u},r,{},p.availableImages),z=w.evaluate({zoom:u+1},r,{},p.availableImages);M=M&&M.name?M.name:M,I=I&&I.name?I.name:I,z=z&&z.name?z.name:z,v[M]=!0,v[I]=!0,v[z]=!0,r.patterns[x.id]={min:M,mid:I,max:z}}}return r}function w_(o,t,r,u,p){let v;if(p===function(x,w,M,I){let z=0;for(let D=w,$=M-I;D<M;D+=I)z+=(x[$]-x[D])*(x[D+1]+x[$+1]),$=D;return z}(o,t,r,u)>0)for(let x=t;x<r;x+=u)v=M_(x/u|0,o[x],o[x+1],v);else for(let x=r-u;x>=t;x-=u)v=M_(x/u|0,o[x],o[x+1],v);return v&&wu(v,v.next)&&(Ph(v),v=v.next),v}function Sc(o,t){if(!o)return o;t||(t=o);let r,u=o;do if(r=!1,u.steiner||!wu(u,u.next)&&Fn(u.prev,u,u.next)!==0)u=u.next;else{if(Ph(u),u=t=u.prev,u===u.next)break;r=!0}while(r||u!==t);return t}function wh(o,t,r,u,p,v,x){if(!o)return;!x&&v&&function(M,I,z,D){let $=M;do $.z===0&&($.z=zf($.x,$.y,I,z,D)),$.prevZ=$.prev,$.nextZ=$.next,$=$.next;while($!==M);$.prevZ.nextZ=null,$.prevZ=null,function(Z){let G,K=1;do{let ne,le=Z;Z=null;let Me=null;for(G=0;le;){G++;let fe=le,U=0;for(let _e=0;_e<K&&(U++,fe=fe.nextZ,fe);_e++);let ee=K;for(;U>0||ee>0&&fe;)U!==0&&(ee===0||!fe||le.z<=fe.z)?(ne=le,le=le.nextZ,U--):(ne=fe,fe=fe.nextZ,ee--),Me?Me.nextZ=ne:Z=ne,ne.prevZ=Me,Me=ne;le=fe}Me.nextZ=null,K*=2}while(G>1)}($)}(o,u,p,v);let w=o;for(;o.prev!==o.next;){let M=o.prev,I=o.next;if(v?sb(o,u,p,v):ab(o))t.push(M.i,o.i,I.i),Ph(o),o=I.next,w=I.next;else if((o=I)===w){x?x===1?wh(o=lb(Sc(o),t),t,r,u,p,v,2):x===2&&cb(o,t,r,u,p,v):wh(Sc(o),t,r,u,p,v,1);break}}}function ab(o){let t=o.prev,r=o,u=o.next;if(Fn(t,r,u)>=0)return!1;let p=t.x,v=r.x,x=u.x,w=t.y,M=r.y,I=u.y,z=Math.min(p,v,x),D=Math.min(w,M,I),$=Math.max(p,v,x),Z=Math.max(w,M,I),G=u.next;for(;G!==t;){if(G.x>=z&&G.x<=$&&G.y>=D&&G.y<=Z&&Th(p,w,v,M,x,I,G.x,G.y)&&Fn(G.prev,G,G.next)>=0)return!1;G=G.next}return!0}function sb(o,t,r,u){let p=o.prev,v=o,x=o.next;if(Fn(p,v,x)>=0)return!1;let w=p.x,M=v.x,I=x.x,z=p.y,D=v.y,$=x.y,Z=Math.min(w,M,I),G=Math.min(z,D,$),K=Math.max(w,M,I),ne=Math.max(z,D,$),le=zf(Z,G,t,r,u),Me=zf(K,ne,t,r,u),fe=o.prevZ,U=o.nextZ;for(;fe&&fe.z>=le&&U&&U.z<=Me;){if(fe.x>=Z&&fe.x<=K&&fe.y>=G&&fe.y<=ne&&fe!==p&&fe!==x&&Th(w,z,M,D,I,$,fe.x,fe.y)&&Fn(fe.prev,fe,fe.next)>=0||(fe=fe.prevZ,U.x>=Z&&U.x<=K&&U.y>=G&&U.y<=ne&&U!==p&&U!==x&&Th(w,z,M,D,I,$,U.x,U.y)&&Fn(U.prev,U,U.next)>=0))return!1;U=U.nextZ}for(;fe&&fe.z>=le;){if(fe.x>=Z&&fe.x<=K&&fe.y>=G&&fe.y<=ne&&fe!==p&&fe!==x&&Th(w,z,M,D,I,$,fe.x,fe.y)&&Fn(fe.prev,fe,fe.next)>=0)return!1;fe=fe.prevZ}for(;U&&U.z<=Me;){if(U.x>=Z&&U.x<=K&&U.y>=G&&U.y<=ne&&U!==p&&U!==x&&Th(w,z,M,D,I,$,U.x,U.y)&&Fn(U.prev,U,U.next)>=0)return!1;U=U.nextZ}return!0}function lb(o,t){let r=o;do{let u=r.prev,p=r.next.next;!wu(u,p)&&S_(u,r,r.next,p)&&Sh(u,p)&&Sh(p,u)&&(t.push(u.i,r.i,p.i),Ph(r),Ph(r.next),r=o=p),r=r.next}while(r!==o);return Sc(r)}function cb(o,t,r,u,p,v){let x=o;do{let w=x.next.next;for(;w!==x.prev;){if(x.i!==w.i&&fb(x,w)){let M=P_(x,w);return x=Sc(x,x.next),M=Sc(M,M.next),wh(x,t,r,u,p,v,0),void wh(M,t,r,u,p,v,0)}w=w.next}x=x.next}while(x!==o)}function ub(o,t){let r=o.x-t.x;return r===0&&(r=o.y-t.y,r===0)&&(r=(o.next.y-o.y)/(o.next.x-o.x)-(t.next.y-t.y)/(t.next.x-t.x)),r}function hb(o,t){let r=function(p,v){let x=v,w=p.x,M=p.y,I,z=-1/0;if(wu(p,x))return x;do{if(wu(p,x.next))return x.next;if(M<=x.y&&M>=x.next.y&&x.next.y!==x.y){let K=x.x+(M-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(K<=w&&K>z&&(z=K,I=x.x<x.next.x?x:x.next,K===w))return I}x=x.next}while(x!==v);if(!I)return null;let D=I,$=I.x,Z=I.y,G=1/0;x=I;do{if(w>=x.x&&x.x>=$&&w!==x.x&&T_(M<Z?w:z,M,$,Z,M<Z?z:w,M,x.x,x.y)){let K=Math.abs(M-x.y)/(w-x.x);Sh(x,p)&&(K<G||K===G&&(x.x>I.x||x.x===I.x&&db(I,x)))&&(I=x,G=K)}x=x.next}while(x!==D);return I}(o,t);if(!r)return t;let u=P_(r,o);return Sc(u,u.next),Sc(r,r.next)}function db(o,t){return Fn(o.prev,o,t.prev)<0&&Fn(t.next,o,o.next)<0}function zf(o,t,r,u,p){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-r)*p|0)|o<<8))|o<<4))|o<<2))|o<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-u)*p|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function pb(o){let t=o,r=o;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==o);return r}function T_(o,t,r,u,p,v,x,w){return(p-x)*(t-w)>=(o-x)*(v-w)&&(o-x)*(u-w)>=(r-x)*(t-w)&&(r-x)*(v-w)>=(p-x)*(u-w)}function Th(o,t,r,u,p,v,x,w){return!(o===x&&t===w)&&T_(o,t,r,u,p,v,x,w)}function fb(o,t){return o.next.i!==t.i&&o.prev.i!==t.i&&!function(r,u){let p=r;do{if(p.i!==r.i&&p.next.i!==r.i&&p.i!==u.i&&p.next.i!==u.i&&S_(p,p.next,r,u))return!0;p=p.next}while(p!==r);return!1}(o,t)&&(Sh(o,t)&&Sh(t,o)&&function(r,u){let p=r,v=!1,x=(r.x+u.x)/2,w=(r.y+u.y)/2;do p.y>w!=p.next.y>w&&p.next.y!==p.y&&x<(p.next.x-p.x)*(w-p.y)/(p.next.y-p.y)+p.x&&(v=!v),p=p.next;while(p!==r);return v}(o,t)&&(Fn(o.prev,o,t.prev)||Fn(o,t.prev,t))||wu(o,t)&&Fn(o.prev,o,o.next)>0&&Fn(t.prev,t,t.next)>0)}function Fn(o,t,r){return(t.y-o.y)*(r.x-t.x)-(t.x-o.x)*(r.y-t.y)}function wu(o,t){return o.x===t.x&&o.y===t.y}function S_(o,t,r,u){let p=Od(Fn(o,t,r)),v=Od(Fn(o,t,u)),x=Od(Fn(r,u,o)),w=Od(Fn(r,u,t));return p!==v&&x!==w||!(p!==0||!Bd(o,r,t))||!(v!==0||!Bd(o,u,t))||!(x!==0||!Bd(r,o,u))||!(w!==0||!Bd(r,t,u))}function Bd(o,t,r){return t.x<=Math.max(o.x,r.x)&&t.x>=Math.min(o.x,r.x)&&t.y<=Math.max(o.y,r.y)&&t.y>=Math.min(o.y,r.y)}function Od(o){return o>0?1:o<0?-1:0}function Sh(o,t){return Fn(o.prev,o,o.next)<0?Fn(o,t,o.next)>=0&&Fn(o,o.prev,t)>=0:Fn(o,t,o.prev)<0||Fn(o,o.next,t)<0}function P_(o,t){let r=Rf(o.i,o.x,o.y),u=Rf(t.i,t.x,t.y),p=o.next,v=t.prev;return o.next=t,t.prev=o,r.next=p,p.prev=r,u.next=r,r.prev=u,v.next=u,u.prev=v,u}function M_(o,t,r,u){let p=Rf(o,t,r);return u?(p.next=u.next,p.prev=u,u.next.prev=p,u.next=p):(p.prev=p,p.next=p),p}function Ph(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function Rf(o,t,r){return{i:o,x:t,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Tu{constructor(t,r){if(r>t)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=t,this._minGranularity=r}getGranularityForZoomLevel(t){return Math.max(Math.floor(this._baseZoomGranularity/(1<<t)),this._minGranularity,1)}}class Fd{constructor(t){this.fill=t.fill,this.line=t.line,this.tile=t.tile,this.stencil=t.stencil,this.circle=t.circle}}Fd.noSubdivision=new Fd({fill:new Tu(0,0),line:new Tu(0,0),tile:new Tu(0,0),stencil:new Tu(0,0),circle:1}),wt("SubdivisionGranularityExpression",Tu),wt("SubdivisionGranularitySetting",Fd);let Su=-32768,Mh=32767;class mb{constructor(t,r){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=t,this._granularityCellSize=ge/t,this._canonical=r}_getKey(t,r){return(t+=32768)<<16|(r+=32768)<<0}_vertexToIndex(t,r){if(t<-32768||r<-32768||t>32767||r>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");let u=0|Math.round(t),p=0|Math.round(r),v=this._getKey(u,p);if(this._vertexDictionary.has(v))return this._vertexDictionary.get(v);let x=this._vertexBuffer.length/2;return this._vertexDictionary.set(v,x),this._vertexBuffer.push(u,p),x}_subdivideTrianglesScanline(t){if(this._granularity<2)return function(p,v){let x=[];for(let w=0;w<v.length;w+=3){let M=v[w],I=v[w+1],z=v[w+2],D=p[2*M],$=p[2*M+1];(p[2*I]-D)*(p[2*z+1]-$)-(p[2*I+1]-$)*(p[2*z]-D)>0?(x.push(M),x.push(z),x.push(I)):(x.push(M),x.push(I),x.push(z))}return x}(this._vertexBuffer,t);let r=[],u=t.length;for(let p=0;p<u;p+=3){let v=[t[p+0],t[p+1],t[p+2]],x=[this._vertexBuffer[2*t[p+0]+0],this._vertexBuffer[2*t[p+0]+1],this._vertexBuffer[2*t[p+1]+0],this._vertexBuffer[2*t[p+1]+1],this._vertexBuffer[2*t[p+2]+0],this._vertexBuffer[2*t[p+2]+1]],w=1/0,M=1/0,I=-1/0,z=-1/0;for(let K=0;K<3;K++){let ne=x[2*K],le=x[2*K+1];w=Math.min(w,ne),I=Math.max(I,ne),M=Math.min(M,le),z=Math.max(z,le)}if(w===I||M===z)continue;let D=Math.floor(w/this._granularityCellSize),$=Math.ceil(I/this._granularityCellSize),Z=Math.floor(M/this._granularityCellSize),G=Math.ceil(z/this._granularityCellSize);if(D!==$||Z!==G)for(let K=Z;K<G;K++){let ne=this._scanlineGenerateVertexRingForCellRow(K,x,v);gb(this._vertexBuffer,ne,r)}else r.push(...v)}return r}_scanlineGenerateVertexRingForCellRow(t,r,u){let p=t*this._granularityCellSize,v=p+this._granularityCellSize,x=[];for(let w=0;w<3;w++){let M=r[2*w],I=r[2*w+1],z=r[2*(w+1)%6],D=r[(2*(w+1)+1)%6],$=r[2*(w+2)%6],Z=r[(2*(w+2)+1)%6],G=z-M,K=D-I,ne=G===0,le=K===0,Me=(p-I)/K,fe=(v-I)/K,U=Math.min(Me,fe),ee=Math.max(Me,fe);if(!le&&(U>=1||ee<=0)||le&&(I<p||I>v)){D>=p&&D<=v&&x.push(u[(w+1)%3]);continue}!le&&U>0&&x.push(this._vertexToIndex(M+G*U,I+K*U));let _e=M+G*Math.max(U,0),Ue=M+G*Math.min(ee,1);ne||this._generateIntraEdgeVertices(x,M,I,z,D,_e,Ue),!le&&ee<1&&x.push(this._vertexToIndex(M+G*ee,I+K*ee)),(le||D>=p&&D<=v)&&x.push(u[(w+1)%3]),!le&&(D<=p||D>=v)&&this._generateInterEdgeVertices(x,M,I,z,D,$,Z,Ue,p,v)}return x}_generateIntraEdgeVertices(t,r,u,p,v,x,w){let M=p-r,I=v-u,z=I===0,D=z?Math.min(r,p):Math.min(x,w),$=z?Math.max(r,p):Math.max(x,w),Z=Math.floor(D/this._granularityCellSize)+1,G=Math.ceil($/this._granularityCellSize)-1;if(z?r<p:x<w)for(let K=Z;K<=G;K++){let ne=K*this._granularityCellSize;t.push(this._vertexToIndex(ne,u+I*(ne-r)/M))}else for(let K=G;K>=Z;K--){let ne=K*this._granularityCellSize;t.push(this._vertexToIndex(ne,u+I*(ne-r)/M))}}_generateInterEdgeVertices(t,r,u,p,v,x,w,M,I,z){let D=v-u,$=x-p,Z=w-v,G=(I-v)/Z,K=(z-v)/Z,ne=Math.min(G,K),le=Math.max(G,K),Me=p+$*ne,fe=Math.floor(Math.min(Me,M)/this._granularityCellSize)+1,U=Math.ceil(Math.max(Me,M)/this._granularityCellSize)-1,ee=M<Me,_e=Z===0;if(_e&&(w===I||w===z))return;if(_e||ne>=1||le<=0){let st=u-w,Ge=x+(r-x)*Math.min((I-w)/st,(z-w)/st);fe=Math.floor(Math.min(Ge,M)/this._granularityCellSize)+1,U=Math.ceil(Math.max(Ge,M)/this._granularityCellSize)-1,ee=M<Ge}let Ue=D>0?z:I;if(ee)for(let st=fe;st<=U;st++)t.push(this._vertexToIndex(st*this._granularityCellSize,Ue));else for(let st=U;st>=fe;st--)t.push(this._vertexToIndex(st*this._granularityCellSize,Ue))}_generateOutline(t){let r=[];for(let u of t){let p=Pc(u,this._granularity,!0),v=this._pointArrayToIndices(p),x=[];for(let w=1;w<v.length;w++)x.push(v[w-1]),x.push(v[w]);r.push(x)}return r}_handlePoles(t){let r=!1,u=!1;this._canonical&&(this._canonical.y===0&&(r=!0),this._canonical.y===(1<<this._canonical.z)-1&&(u=!0)),(r||u)&&this._fillPoles(t,r,u)}_ensureNoPoleVertices(){let t=this._vertexBuffer;for(let r=0;r<t.length;r+=2){let u=t[r+1];u===Su&&(t[r+1]=-32767),u===Mh&&(t[r+1]=32766)}}_generatePoleQuad(t,r,u,p,v,x){p>v!=(x===Su)?(t.push(r),t.push(u),t.push(this._vertexToIndex(p,x)),t.push(u),t.push(this._vertexToIndex(v,x)),t.push(this._vertexToIndex(p,x))):(t.push(u),t.push(r),t.push(this._vertexToIndex(p,x)),t.push(this._vertexToIndex(v,x)),t.push(u),t.push(this._vertexToIndex(p,x)))}_fillPoles(t,r,u){let p=this._vertexBuffer,v=ge,x=t.length;for(let w=2;w<x;w+=3){let M=t[w-2],I=t[w-1],z=t[w],D=p[2*M],$=p[2*M+1],Z=p[2*I],G=p[2*I+1],K=p[2*z],ne=p[2*z+1];r&&($===0&&G===0&&this._generatePoleQuad(t,M,I,D,Z,Su),G===0&&ne===0&&this._generatePoleQuad(t,I,z,Z,K,Su),ne===0&&$===0&&this._generatePoleQuad(t,z,M,K,D,Su)),u&&($===v&&G===v&&this._generatePoleQuad(t,M,I,D,Z,Mh),G===v&&ne===v&&this._generatePoleQuad(t,I,z,Z,K,Mh),ne===v&&$===v&&this._generatePoleQuad(t,z,M,K,D,Mh))}}_initializeVertices(t){for(let r=0;r<t.length;r+=2)this._vertexToIndex(t[r],t[r+1])}subdividePolygonInternal(t,r){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;let{flattened:u,holeIndices:p}=function(w){let M=[],I=[];for(let z of w)if(z.length!==0){z!==w[0]&&M.push(I.length/2);for(let D=0;D<z.length;D++)I.push(z[D].x),I.push(z[D].y)}return{flattened:I,holeIndices:M}}(t),v;this._initializeVertices(u);try{let w=function(I,z,D=2){let $=z&&z.length,Z=$?z[0]*D:I.length,G=w_(I,0,Z,D,!0),K=[];if(!G||G.next===G.prev)return K;let ne,le,Me;if($&&(G=function(fe,U,ee,_e){let Ue=[];for(let st=0,Ge=U.length;st<Ge;st++){let et=w_(fe,U[st]*_e,st<Ge-1?U[st+1]*_e:fe.length,_e,!1);et===et.next&&(et.steiner=!0),Ue.push(pb(et))}Ue.sort(ub);for(let st=0;st<Ue.length;st++)ee=hb(Ue[st],ee);return ee}(I,z,G,D)),I.length>80*D){ne=1/0,le=1/0;let fe=-1/0,U=-1/0;for(let ee=D;ee<Z;ee+=D){let _e=I[ee],Ue=I[ee+1];_e<ne&&(ne=_e),Ue<le&&(le=Ue),_e>fe&&(fe=_e),Ue>U&&(U=Ue)}Me=Math.max(fe-ne,U-le),Me=Me!==0?32767/Me:0}return wh(G,K,D,ne,le,Me,0),K}(u,p),M=this._convertIndices(u,w);v=this._subdivideTrianglesScanline(M)}catch(w){console.error(w)}let x=[];return r&&(x=this._generateOutline(t)),this._ensureNoPoleVertices(),this._handlePoles(v),{verticesFlattened:this._vertexBuffer,indicesTriangles:v,indicesLineList:x}}_convertIndices(t,r){let u=[];for(let p=0;p<r.length;p++)u.push(this._vertexToIndex(t[2*r[p]],t[2*r[p]+1]));return u}_pointArrayToIndices(t){let r=[];for(let u=0;u<t.length;u++){let p=t[u];r.push(this._vertexToIndex(p.x,p.y))}return r}}function C_(o,t,r,u=!0){return new mb(r,t).subdividePolygonInternal(o,u)}function Pc(o,t,r=!1){if(!o||o.length<1)return[];if(o.length<2)return[];let u=o[0],p=o[o.length-1],v=r&&(u.x!==p.x||u.y!==p.y);if(t<2)return v?[...o,o[0]]:[...o];let x=Math.floor(ge/t),w=[];w.push(new he(o[0].x,o[0].y));let M=o.length,I=v?M:M-1;for(let z=0;z<I;z++){let D=o[z],$=z<M-1?o[z+1]:o[0],Z=D.x,G=D.y,K=$.x,ne=$.y,le=Z!==K,Me=G!==ne;if(!le&&!Me)continue;let fe=K-Z,U=ne-G,ee=Math.abs(fe),_e=Math.abs(U),Ue=Z,st=G;for(;;){let et=fe>0?(Math.floor(Ue/x)+1)*x:(Math.ceil(Ue/x)-1)*x,ht=U>0?(Math.floor(st/x)+1)*x:(Math.ceil(st/x)-1)*x,lt=Math.abs(Ue-et),dt=Math.abs(st-ht),it=Math.abs(Ue-K),Ct=Math.abs(st-ne),Vt=le?lt/ee:Number.POSITIVE_INFINITY,jt=Me?dt/_e:Number.POSITIVE_INFINITY;if((it<=lt||!le)&&(Ct<=dt||!Me))break;if(Vt<jt&&le||!Me){Ue=et,st+=U*Vt;let At=new he(Ue,Math.round(st));w[w.length-1].x===At.x&&w[w.length-1].y===At.y||w.push(At)}else{Ue+=fe*jt,st=ht;let At=new he(Math.round(Ue),st);w[w.length-1].x===At.x&&w[w.length-1].y===At.y||w.push(At)}}let Ge=new he(K,ne);w[w.length-1].x===Ge.x&&w[w.length-1].y===Ge.y||w.push(Ge)}return w}function gb(o,t,r){if(t.length===0)throw new Error("Subdivision vertex ring is empty.");let u=0,p=o[2*t[0]];for(let M=1;M<t.length;M++){let I=o[2*t[M]];I<p&&(p=I,u=M)}let v=t.length,x=u,w=(x+1)%v;for(;;){let M=x-1>=0?x-1:v-1,I=(w+1)%v,z=o[2*t[M]],D=o[2*t[I]],$=o[2*t[x]],Z=o[2*t[x]+1],G=o[2*t[w]+1],K=!1;if(z<D)K=!0;else if(z>D)K=!1;else{let ne=G-Z,le=-(o[2*t[w]]-$),Me=Z<G?1:-1;((z-$)*ne+(o[2*t[M]+1]-Z)*le)*Me>((D-$)*ne+(o[2*t[I]+1]-Z)*le)*Me&&(K=!0)}if(K){let ne=t[M],le=t[x],Me=t[w];ne!==le&&ne!==Me&&le!==Me&&r.push(Me,le,ne),x--,x<0&&(x=v-1)}else{let ne=t[I],le=t[x],Me=t[w];ne!==le&&ne!==Me&&le!==Me&&r.push(Me,le,ne),w++,w>=v&&(w=0)}if(M===I)break}}function I_(o,t,r,u,p,v,x,w,M){let I=p.length/2,z=x&&w&&M;if(I<Oi.MAX_VERTEX_ARRAY_LENGTH){let D=t.prepareSegment(I,r,u),$=D.vertexLength;for(let K=0;K<v.length;K+=3)u.emplaceBack($+v[K],$+v[K+1],$+v[K+2]);let Z,G;D.vertexLength+=I,D.primitiveLength+=v.length/3,z&&(G=x.prepareSegment(I,r,w),Z=G.vertexLength,G.vertexLength+=I);for(let K=0;K<p.length;K+=2)o(p[K],p[K+1]);if(z)for(let K=0;K<M.length;K++){let ne=M[K];for(let le=1;le<ne.length;le+=2)w.emplaceBack(Z+ne[le-1],Z+ne[le]);G.primitiveLength+=ne.length/2}}else(function(D,$,Z,G,K,ne){let le=[];for(let _e=0;_e<G.length/2;_e++)le.push(-1);let Me={count:0},fe=0,U=D.getOrCreateLatestSegment($,Z),ee=U.vertexLength;for(let _e=2;_e<K.length;_e+=3){let Ue=K[_e-2],st=K[_e-1],Ge=K[_e],et=le[Ue]<fe,ht=le[st]<fe,lt=le[Ge]<fe;U.vertexLength+((et?1:0)+(ht?1:0)+(lt?1:0))>Oi.MAX_VERTEX_ARRAY_LENGTH&&(U=D.createNewSegment($,Z),fe=Me.count,et=!0,ht=!0,lt=!0,ee=0);let dt=Ch(le,G,ne,Me,Ue,et,U),it=Ch(le,G,ne,Me,st,ht,U),Ct=Ch(le,G,ne,Me,Ge,lt,U);Z.emplaceBack(ee+dt-fe,ee+it-fe,ee+Ct-fe),U.primitiveLength++}})(t,r,u,p,v,o),z&&function(D,$,Z,G,K,ne){let le=[];for(let _e=0;_e<G.length/2;_e++)le.push(-1);let Me={count:0},fe=0,U=D.getOrCreateLatestSegment($,Z),ee=U.vertexLength;for(let _e=0;_e<K.length;_e++){let Ue=K[_e];for(let st=1;st<K[_e].length;st+=2){let Ge=Ue[st-1],et=Ue[st],ht=le[Ge]<fe,lt=le[et]<fe;U.vertexLength+((ht?1:0)+(lt?1:0))>Oi.MAX_VERTEX_ARRAY_LENGTH&&(U=D.createNewSegment($,Z),fe=Me.count,ht=!0,lt=!0,ee=0);let dt=Ch(le,G,ne,Me,Ge,ht,U),it=Ch(le,G,ne,Me,et,lt,U);Z.emplaceBack(ee+dt-fe,ee+it-fe),U.primitiveLength++}}}(x,r,w,p,M,o),t.forceNewSegmentOnNextPrepare(),x?.forceNewSegmentOnNextPrepare()}function Ch(o,t,r,u,p,v,x){if(v){let w=u.count;return r(t[2*p],t[2*p+1]),o[p]=u.count,u.count++,x.vertexLength++,w}return o[p]}class Df{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new gt,this.indexArray=new Bi,this.indexArray2=new nr,this.programConfigurations=new ws(t.layers,t.zoom),this.segments=new Oi,this.segments2=new Oi,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,u){this.hasPattern=Af("fill",this.layers,r);let p=this.layers[0].layout.get("fill-sort-key"),v=!p.isConstant(),x=[];for(let{feature:w,id:M,index:I,sourceLayerIndex:z}of t){let D=this.layers[0]._featureFilter.needGeometry,$=wc(w,D);if(!this.layers[0]._featureFilter.filter(new sn(this.zoom),$,u))continue;let Z=v?p.evaluate($,{},u,r.availableImages):void 0,G={id:M,properties:w.properties,type:w.type,sourceLayerIndex:z,index:I,geometry:D?$.geometry:bc(w),patterns:{},sortKey:Z};x.push(G)}v&&x.sort((w,M)=>w.sortKey-M.sortKey);for(let w of x){let{geometry:M,index:I,sourceLayerIndex:z}=w;if(this.hasPattern){let D=kf("fill",this.layers,w,this.zoom,r);this.patternFeatures.push(D)}else this.addFeature(w,M,I,u,{},r.subdivisionGranularity);r.featureIndex.insert(t[I].feature,M,I,z,this.index)}}update(t,r,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,u)}addFeatures(t,r,u){for(let p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,r,u,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ob),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,r,u,p,v,x){for(let w of ka(r,500)){let M=C_(w,p,x.fill.getGranularityForZoomLevel(p.z)),I=this.layoutVertexArray;I_((z,D)=>{I.emplaceBack(z,D)},this.segments,this.layoutVertexArray,this.indexArray,M.verticesFlattened,M.indicesTriangles,this.segments2,this.indexArray2,M.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,v,p)}}let E_,L_;wt("FillBucket",Df,{omit:["layers","patternFeatures"]});var _b={get paint(){return L_=L_||new Gn({"fill-antialias":new Rt(ie.paint_fill["fill-antialias"]),"fill-opacity":new Wt(ie.paint_fill["fill-opacity"]),"fill-color":new Wt(ie.paint_fill["fill-color"]),"fill-outline-color":new Wt(ie.paint_fill["fill-outline-color"]),"fill-translate":new Rt(ie.paint_fill["fill-translate"]),"fill-translate-anchor":new Rt(ie.paint_fill["fill-translate-anchor"]),"fill-pattern":new gc(ie.paint_fill["fill-pattern"])})},get layout(){return E_=E_||new Gn({"fill-sort-key":new Wt(ie.layout_fill["fill-sort-key"])})}};class yb extends wo{constructor(t){super(t,_b)}recalculate(t,r){super.recalculate(t,r);let u=this.paint._values["fill-outline-color"];u.value.kind==="constant"&&u.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Df(t)}queryRadius(){return Rd(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:t,geometry:r,transform:u,pixelsToTileUnits:p}){return h_(Dd(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-u.bearingInRadians,p),r)}isTileClipped(){return!0}}let vb=_n([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),xb=_n([{name:"a_centroid",components:2,type:"Int16"}],4),{members:bb}=vb;var Bf,A_,Of,k_,Ff,z_,R_,Nd={};function D_(){if(A_)return Bf;A_=1;var o=B();function t(p,v,x,w,M){this.properties={},this.extent=x,this.type=0,this._pbf=p,this._geometry=-1,this._keys=w,this._values=M,p.readFields(r,this,v)}function r(p,v,x){p==1?v.id=x.readVarint():p==2?function(w,M){for(var I=w.readVarint()+w.pos;w.pos<I;){var z=M._keys[w.readVarint()],D=M._values[w.readVarint()];M.properties[z]=D}}(x,v):p==3?v.type=x.readVarint():p==4&&(v._geometry=x.pos)}function u(p){for(var v,x,w=0,M=0,I=p.length,z=I-1;M<I;z=M++)w+=((x=p[z]).x-(v=p[M]).x)*(v.y+x.y);return w}return Bf=t,t.types=["Unknown","Point","LineString","Polygon"],t.prototype.loadGeometry=function(){var p=this._pbf;p.pos=this._geometry;for(var v,x=p.readVarint()+p.pos,w=1,M=0,I=0,z=0,D=[];p.pos<x;){if(M<=0){var $=p.readVarint();w=7&$,M=$>>3}if(M--,w===1||w===2)I+=p.readSVarint(),z+=p.readSVarint(),w===1&&(v&&D.push(v),v=[]),v.push(new o(I,z));else{if(w!==7)throw new Error("unknown command "+w);v&&v.push(v[0].clone())}}return v&&D.push(v),D},t.prototype.bbox=function(){var p=this._pbf;p.pos=this._geometry;for(var v=p.readVarint()+p.pos,x=1,w=0,M=0,I=0,z=1/0,D=-1/0,$=1/0,Z=-1/0;p.pos<v;){if(w<=0){var G=p.readVarint();x=7&G,w=G>>3}if(w--,x===1||x===2)(M+=p.readSVarint())<z&&(z=M),M>D&&(D=M),(I+=p.readSVarint())<$&&($=I),I>Z&&(Z=I);else if(x!==7)throw new Error("unknown command "+x)}return[z,$,D,Z]},t.prototype.toGeoJSON=function(p,v,x){var w,M,I=this.extent*Math.pow(2,x),z=this.extent*p,D=this.extent*v,$=this.loadGeometry(),Z=t.types[this.type];function G(le){for(var Me=0;Me<le.length;Me++){var fe=le[Me];le[Me]=[360*(fe.x+z)/I-180,360/Math.PI*Math.atan(Math.exp((180-360*(fe.y+D)/I)*Math.PI/180))-90]}}switch(this.type){case 1:var K=[];for(w=0;w<$.length;w++)K[w]=$[w][0];G($=K);break;case 2:for(w=0;w<$.length;w++)G($[w]);break;case 3:for($=function(le){var Me=le.length;if(Me<=1)return[le];for(var fe,U,ee=[],_e=0;_e<Me;_e++){var Ue=u(le[_e]);Ue!==0&&(U===void 0&&(U=Ue<0),U===Ue<0?(fe&&ee.push(fe),fe=[le[_e]]):fe.push(le[_e]))}return fe&&ee.push(fe),ee}($),w=0;w<$.length;w++)for(M=0;M<$[w].length;M++)G($[w][M])}$.length===1?$=$[0]:Z="Multi"+Z;var ne={type:"Feature",geometry:{type:Z,coordinates:$},properties:this.properties};return"id"in this&&(ne.id=this.id),ne},Bf}function B_(){if(k_)return Of;k_=1;var o=D_();function t(u,p){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=u,this._keys=[],this._values=[],this._features=[],u.readFields(r,this,p),this.length=this._features.length}function r(u,p,v){u===15?p.version=v.readVarint():u===1?p.name=v.readString():u===5?p.extent=v.readVarint():u===2?p._features.push(v.pos):u===3?p._keys.push(v.readString()):u===4&&p._values.push(function(x){for(var w=null,M=x.readVarint()+x.pos;x.pos<M;){var I=x.readVarint()>>3;w=I===1?x.readString():I===2?x.readFloat():I===3?x.readDouble():I===4?x.readVarint64():I===5?x.readVarint():I===6?x.readSVarint():I===7?x.readBoolean():null}return w}(v))}return Of=t,t.prototype.feature=function(u){if(u<0||u>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[u];var p=this._pbf.readVarint()+this._pbf.pos;return new o(this._pbf,p,this.extent,this._keys,this._values)},Of}function O_(){return R_||(R_=1,Nd.VectorTile=function(){if(z_)return Ff;z_=1;var o=B_();function t(r,u,p){if(r===3){var v=new o(p,p.readVarint()+p.pos);v.length&&(u[v.name]=v)}}return Ff=function(r,u){this.layers=r.readFields(t,{},u)},Ff}(),Nd.VectorTileFeature=D_(),Nd.VectorTileLayer=B_()),Nd}var Ih=P(O_());let wb=Ih.VectorTileFeature.types,Nf=Math.pow(2,13);function Eh(o,t,r,u,p,v,x,w){o.emplaceBack(t,r,2*Math.floor(u*Nf)+x,p*Nf*2,v*Nf*2,Math.round(w))}class jf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new ct,this.centroidVertexArray=new Qe,this.indexArray=new Bi,this.programConfigurations=new ws(t.layers,t.zoom),this.segments=new Oi,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,u){this.features=[],this.hasPattern=Af("fill-extrusion",this.layers,r);for(let{feature:p,id:v,index:x,sourceLayerIndex:w}of t){let M=this.layers[0]._featureFilter.needGeometry,I=wc(p,M);if(!this.layers[0]._featureFilter.filter(new sn(this.zoom),I,u))continue;let z={id:v,sourceLayerIndex:w,index:x,geometry:M?I.geometry:bc(p),properties:p.properties,type:p.type,patterns:{}};this.hasPattern?this.features.push(kf("fill-extrusion",this.layers,z,this.zoom,r)):this.addFeature(z,z.geometry,x,u,{},r.subdivisionGranularity),r.featureIndex.insert(p,z.geometry,x,w,this.index,!0)}}addFeatures(t,r,u){for(let p of this.features){let{geometry:v}=p;this.addFeature(p,v,p.index,r,u,t.subdivisionGranularity)}}update(t,r,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,u)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,bb),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,xb.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,r,u,p,v,x){for(let w of ka(r,500)){let M={x:0,y:0,sampleCount:0},I=this.layoutVertexArray.length;this.processPolygon(M,p,t,w,x);let z=this.layoutVertexArray.length-I,D=Math.floor(M.x/M.sampleCount),$=Math.floor(M.y/M.sampleCount);for(let Z=0;Z<z;Z++)this.centroidVertexArray.emplaceBack(D,$)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,v,p)}processPolygon(t,r,u,p,v){if(p.length<1||F_(p[0]))return;for(let D of p)D.length!==0&&Tb(t,D);let x={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},w=v.fill.getGranularityForZoomLevel(r.z),M=wb[u.type]==="Polygon";for(let D of p){if(D.length===0||F_(D))continue;let $=Pc(D,w,M);this._generateSideFaces($,x)}if(!M)return;let I=C_(p,r,w,!1),z=this.layoutVertexArray;I_((D,$)=>{Eh(z,D,$,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,I.verticesFlattened,I.indicesTriangles)}_generateSideFaces(t,r){let u=0;for(let p=1;p<t.length;p++){let v=t[p],x=t[p-1];if(Sb(v,x))continue;r.segment.vertexLength+4>Oi.MAX_VERTEX_ARRAY_LENGTH&&(r.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));let w=v.sub(x)._perp()._unit(),M=x.dist(v);u+M>32768&&(u=0),Eh(this.layoutVertexArray,v.x,v.y,w.x,w.y,0,0,u),Eh(this.layoutVertexArray,v.x,v.y,w.x,w.y,0,1,u),u+=M,Eh(this.layoutVertexArray,x.x,x.y,w.x,w.y,0,0,u),Eh(this.layoutVertexArray,x.x,x.y,w.x,w.y,0,1,u);let I=r.segment.vertexLength;this.indexArray.emplaceBack(I,I+2,I+1),this.indexArray.emplaceBack(I+1,I+2,I+3),r.segment.vertexLength+=4,r.segment.primitiveLength+=2}}}function Tb(o,t){for(let r=0;r<t.length;r++){let u=t[r];r===t.length-1&&t[0].x===u.x&&t[0].y===u.y||(o.x+=u.x,o.y+=u.y,o.sampleCount++)}}function Sb(o,t){return o.x===t.x&&(o.x<0||o.x>ge)||o.y===t.y&&(o.y<0||o.y>ge)}function F_(o){return o.every(t=>t.x<0)||o.every(t=>t.x>ge)||o.every(t=>t.y<0)||o.every(t=>t.y>ge)}let N_;wt("FillExtrusionBucket",jf,{omit:["layers","features"]});var Pb={get paint(){return N_=N_||new Gn({"fill-extrusion-opacity":new Rt(ie["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Wt(ie["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Rt(ie["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Rt(ie["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new gc(ie["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Wt(ie["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Wt(ie["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Rt(ie["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Mb extends wo{constructor(t){super(t,Pb)}createBucket(t){return new jf(t)}queryRadius(){return Rd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:t,feature:r,featureState:u,geometry:p,transform:v,pixelsToTileUnits:x,pixelPosMatrix:w}){let M=Dd(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-v.bearingInRadians,x),I=this.paint.get("fill-extrusion-height").evaluate(r,u),z=this.paint.get("fill-extrusion-base").evaluate(r,u),D=function(Z,G,K){let ne=[];for(let le of Z){let Me=[le.x,le.y,0,1];de(Me,Me,G),ne.push(new he(Me[0]/Me[3],Me[1]/Me[3]))}return ne}(M,w),$=function(Z,G,K,ne){let le=[],Me=[],fe=ne[8]*G,U=ne[9]*G,ee=ne[10]*G,_e=ne[11]*G,Ue=ne[8]*K,st=ne[9]*K,Ge=ne[10]*K,et=ne[11]*K;for(let ht of Z){let lt=[],dt=[];for(let it of ht){let Ct=it.x,Vt=it.y,jt=ne[0]*Ct+ne[4]*Vt+ne[12],At=ne[1]*Ct+ne[5]*Vt+ne[13],Mi=ne[2]*Ct+ne[6]*Vt+ne[14],Cn=ne[3]*Ct+ne[7]*Vt+ne[15],or=Mi+ee,Ar=Cn+_e,Zo=jt+Ue,uo=At+st,br=Mi+Ge,bn=Cn+et,pr=new he((jt+fe)/Ar,(At+U)/Ar);pr.z=or/Ar,lt.push(pr);let wr=new he(Zo/bn,uo/bn);wr.z=br/bn,dt.push(wr)}le.push(lt),Me.push(dt)}return[le,Me]}(p,z,I,w);return function(Z,G,K){let ne=1/0;h_(K,G)&&(ne=j_(K,G[0]));for(let le=0;le<G.length;le++){let Me=G[le],fe=Z[le];for(let U=0;U<Me.length-1;U++){let ee=Me[U],_e=[ee,Me[U+1],fe[U+1],fe[U],ee];u_(K,_e)&&(ne=Math.min(ne,j_(K,_e)))}}return ne!==1/0&&ne}($[0],$[1],D)}}function Lh(o,t){return o.x*t.x+o.y*t.y}function j_(o,t){if(o.length===1){let r=0,u=t[r++],p;for(;!p||u.equals(p);)if(p=t[r++],!p)return 1/0;for(;r<t.length;r++){let v=t[r],x=o[0],w=p.sub(u),M=v.sub(u),I=x.sub(u),z=Lh(w,w),D=Lh(w,M),$=Lh(M,M),Z=Lh(I,w),G=Lh(I,M),K=z*$-D*D,ne=($*Z-D*G)/K,le=(z*G-D*Z)/K,Me=u.z*(1-ne-le)+p.z*ne+v.z*le;if(isFinite(Me))return Me}return 1/0}{let r=1/0;for(let u of t)r=Math.min(r,u.z);return r}}let Cb=_n([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Ib}=Cb,Eb=_n([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Lb}=Eb,Ab=Ih.VectorTileFeature.types,kb=Math.cos(Math.PI/180*37.5),$_=Math.pow(2,14)/.5;class $f{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new Lt,this.layoutVertexArray2=new li,this.indexArray=new Bi,this.programConfigurations=new ws(t.layers,t.zoom),this.segments=new Oi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,u){this.hasPattern=Af("line",this.layers,r);let p=this.layers[0].layout.get("line-sort-key"),v=!p.isConstant(),x=[];for(let{feature:w,id:M,index:I,sourceLayerIndex:z}of t){let D=this.layers[0]._featureFilter.needGeometry,$=wc(w,D);if(!this.layers[0]._featureFilter.filter(new sn(this.zoom),$,u))continue;let Z=v?p.evaluate($,{},u):void 0,G={id:M,properties:w.properties,type:w.type,sourceLayerIndex:z,index:I,geometry:D?$.geometry:bc(w),patterns:{},sortKey:Z};x.push(G)}v&&x.sort((w,M)=>w.sortKey-M.sortKey);for(let w of x){let{geometry:M,index:I,sourceLayerIndex:z}=w;if(this.hasPattern){let D=kf("line",this.layers,w,this.zoom,r);this.patternFeatures.push(D)}else this.addFeature(w,M,I,u,{},r.subdivisionGranularity);r.featureIndex.insert(t[I].feature,M,I,z,this.index)}}update(t,r,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,u)}addFeatures(t,r,u){for(let p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,r,u,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Lb)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ib),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,r,u,p,v,x){let w=this.layers[0].layout,M=w.get("line-join").evaluate(t,{}),I=w.get("line-cap"),z=w.get("line-miter-limit"),D=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(let $ of r)this.addLine($,t,M,I,z,D,p,x);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,v,p)}addLine(t,r,u,p,v,x,w,M){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,t=Pc(t,w?M.line.getGranularityForZoomLevel(w.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let fe=0;fe<t.length-1;fe++)this.totalDistance+=t[fe].dist(t[fe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let I=Ab[r.type]==="Polygon",z=t.length;for(;z>=2&&t[z-1].equals(t[z-2]);)z--;let D=0;for(;D<z-1&&t[D].equals(t[D+1]);)D++;if(z<(I?3:2))return;u==="bevel"&&(v=1.05);let $=this.overscaling<=16?15*ge/(512*this.overscaling):0,Z=this.segments.prepareSegment(10*z,this.layoutVertexArray,this.indexArray),G,K,ne,le,Me;this.e1=this.e2=-1,I&&(G=t[z-2],Me=t[D].sub(G)._unit()._perp());for(let fe=D;fe<z;fe++){if(ne=fe===z-1?I?t[D+1]:void 0:t[fe+1],ne&&t[fe].equals(ne))continue;Me&&(le=Me),G&&(K=G),G=t[fe],Me=ne?ne.sub(G)._unit()._perp():le,le=le||Me;let U=le.add(Me);U.x===0&&U.y===0||U._unit();let ee=le.x*Me.x+le.y*Me.y,_e=U.x*Me.x+U.y*Me.y,Ue=_e!==0?1/_e:1/0,st=2*Math.sqrt(2-2*_e),Ge=_e<kb&&K&&ne,et=le.x*Me.y-le.y*Me.x>0;if(Ge&&fe>D){let dt=G.dist(K);if(dt>2*$){let it=G.sub(G.sub(K)._mult($/dt)._round());this.updateDistance(K,it),this.addCurrentVertex(it,le,0,0,Z),K=it}}let ht=K&&ne,lt=ht?u:I?"butt":p;if(ht&&lt==="round"&&(Ue<x?lt="miter":Ue<=2&&(lt="fakeround")),lt==="miter"&&Ue>v&&(lt="bevel"),lt==="bevel"&&(Ue>2&&(lt="flipbevel"),Ue<v&&(lt="miter")),K&&this.updateDistance(K,G),lt==="miter")U._mult(Ue),this.addCurrentVertex(G,U,0,0,Z);else if(lt==="flipbevel"){if(Ue>100)U=Me.mult(-1);else{let dt=Ue*le.add(Me).mag()/le.sub(Me).mag();U._perp()._mult(dt*(et?-1:1))}this.addCurrentVertex(G,U,0,0,Z),this.addCurrentVertex(G,U.mult(-1),0,0,Z)}else if(lt==="bevel"||lt==="fakeround"){let dt=-Math.sqrt(Ue*Ue-1),it=et?dt:0,Ct=et?0:dt;if(K&&this.addCurrentVertex(G,le,it,Ct,Z),lt==="fakeround"){let Vt=Math.round(180*st/Math.PI/20);for(let jt=1;jt<Vt;jt++){let At=jt/Vt;if(At!==.5){let Cn=At-.5;At+=At*Cn*(At-1)*((1.0904+ee*(ee*(3.55645-1.43519*ee)-3.2452))*Cn*Cn+(.848013+ee*(.215638*ee-1.06021)))}let Mi=Me.sub(le)._mult(At)._add(le)._unit()._mult(et?-1:1);this.addHalfVertex(G,Mi.x,Mi.y,!1,et,0,Z)}}ne&&this.addCurrentVertex(G,Me,-it,-Ct,Z)}else if(lt==="butt")this.addCurrentVertex(G,U,0,0,Z);else if(lt==="square"){let dt=K?1:-1;this.addCurrentVertex(G,U,dt,dt,Z)}else lt==="round"&&(K&&(this.addCurrentVertex(G,le,0,0,Z),this.addCurrentVertex(G,le,1,1,Z,!0)),ne&&(this.addCurrentVertex(G,Me,-1,-1,Z,!0),this.addCurrentVertex(G,Me,0,0,Z)));if(Ge&&fe<z-1){let dt=G.dist(ne);if(dt>2*$){let it=G.add(ne.sub(G)._mult($/dt)._round());this.updateDistance(G,it),this.addCurrentVertex(it,Me,0,0,Z),G=it}}}}addCurrentVertex(t,r,u,p,v,x=!1){let w=r.y*p-r.x,M=-r.y-r.x*p;this.addHalfVertex(t,r.x+r.y*u,r.y-r.x*u,x,!1,u,v),this.addHalfVertex(t,w,M,x,!0,-p,v),this.distance>$_/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,r,u,p,v,x))}addHalfVertex({x:t,y:r},u,p,v,x,w,M){let I=.5*(this.lineClips?this.scaledDistance*($_-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(v?1:0),(r<<1)+(x?1:0),Math.round(63*u)+128,Math.round(63*p)+128,1+(w===0?0:w<0?-1:1)|(63&I)<<2,I>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);let z=M.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,z,this.e2),M.primitiveLength++),x?this.e2=z:this.e1=z}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,r){this.distance+=t.dist(r),this.updateScaledDistance()}}let U_,Z_;wt("LineBucket",$f,{omit:["layers","patternFeatures"]});var V_={get paint(){return Z_=Z_||new Gn({"line-opacity":new Wt(ie.paint_line["line-opacity"]),"line-color":new Wt(ie.paint_line["line-color"]),"line-translate":new Rt(ie.paint_line["line-translate"]),"line-translate-anchor":new Rt(ie.paint_line["line-translate-anchor"]),"line-width":new Wt(ie.paint_line["line-width"]),"line-gap-width":new Wt(ie.paint_line["line-gap-width"]),"line-offset":new Wt(ie.paint_line["line-offset"]),"line-blur":new Wt(ie.paint_line["line-blur"]),"line-dasharray":new dh(ie.paint_line["line-dasharray"]),"line-pattern":new gc(ie.paint_line["line-pattern"]),"line-gradient":new ph(ie.paint_line["line-gradient"])})},get layout(){return U_=U_||new Gn({"line-cap":new Rt(ie.layout_line["line-cap"]),"line-join":new Wt(ie.layout_line["line-join"]),"line-miter-limit":new Rt(ie.layout_line["line-miter-limit"]),"line-round-limit":new Rt(ie.layout_line["line-round-limit"]),"line-sort-key":new Wt(ie.layout_line["line-sort-key"])})}};class zb extends Wt{possiblyEvaluate(t,r){return r=new sn(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(t,r)}evaluate(t,r,u,p){return r=Ft({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(t,r,u,p)}}let jd;class Rb extends wo{constructor(t){super(t,V_),this.gradientVersion=0,jd||(jd=new zb(V_.paint.properties["line-width"].specification),jd.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){let r=this.gradientExpression();this.stepInterpolant=!!function(u){return u._styleExpression!==void 0}(r)&&r._styleExpression.expression instanceof Oo,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,r){super.recalculate(t,r),this.paint._values["line-floorwidth"]=jd.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new $f(t)}queryRadius(t){let r=t,u=G_(xh("line-width",this,r),xh("line-gap-width",this,r)),p=xh("line-offset",this,r);return u/2+Math.abs(p)+Rd(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:t,feature:r,featureState:u,geometry:p,transform:v,pixelsToTileUnits:x}){let w=Dd(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-v.bearingInRadians,x),M=x/2*G_(this.paint.get("line-width").evaluate(r,u),this.paint.get("line-gap-width").evaluate(r,u)),I=this.paint.get("line-offset").evaluate(r,u);return I&&(p=function(z,D){let $=[];for(let Z=0;Z<z.length;Z++){let G=z[Z],K=[];for(let ne=0;ne<G.length;ne++){let le=G[ne-1],Me=G[ne],fe=G[ne+1],U=ne===0?new he(0,0):Me.sub(le)._unit()._perp(),ee=ne===G.length-1?new he(0,0):fe.sub(Me)._unit()._perp(),_e=U._add(ee)._unit(),Ue=_e.x*ee.x+_e.y*ee.y;Ue!==0&&_e._mult(1/Ue),K.push(_e._mult(D)._add(Me))}$.push(K)}return $}(p,I*x)),function(z,D,$){for(let Z=0;Z<D.length;Z++){let G=D[Z];if(z.length>=3){for(let K=0;K<G.length;K++)if(Tc(z,G[K]))return!0}if(Kx(z,G,$))return!0}return!1}(w,p,M)}isTileClipped(){return!0}}function G_(o,t){return t>0?t+2*o:o}let Db=_n([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Bb=_n([{name:"a_projected_pos",components:3,type:"Float32"}],4);_n([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let Ob=_n([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);_n([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let q_=_n([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Fb=_n([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Nb(o,t,r){return o.sections.forEach(u=>{u.text=function(p,v,x){let w=v.layout.get("text-transform").evaluate(x,{});return w==="uppercase"?p=p.toLocaleUpperCase():w==="lowercase"&&(p=p.toLocaleLowerCase()),Fa.applyArabicShaping&&(p=Fa.applyArabicShaping(p)),p}(u.text,t,r)}),o}_n([{name:"triangle",components:3,type:"Uint16"}]),_n([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),_n([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),_n([{type:"Float32",name:"offsetX"}]),_n([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),_n([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);let Ah={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};var W_,Uf,H_,rr=24,Zf={};function jb(){return W_||(W_=1,Zf.read=function(o,t,r,u,p){var v,x,w=8*p-u-1,M=(1<<w)-1,I=M>>1,z=-7,D=r?p-1:0,$=r?-1:1,Z=o[t+D];for(D+=$,v=Z&(1<<-z)-1,Z>>=-z,z+=w;z>0;v=256*v+o[t+D],D+=$,z-=8);for(x=v&(1<<-z)-1,v>>=-z,z+=u;z>0;x=256*x+o[t+D],D+=$,z-=8);if(v===0)v=1-I;else{if(v===M)return x?NaN:1/0*(Z?-1:1);x+=Math.pow(2,u),v-=I}return(Z?-1:1)*x*Math.pow(2,v-u)},Zf.write=function(o,t,r,u,p,v){var x,w,M,I=8*v-p-1,z=(1<<I)-1,D=z>>1,$=p===23?Math.pow(2,-24)-Math.pow(2,-77):0,Z=u?0:v-1,G=u?1:-1,K=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(w=isNaN(t)?1:0,x=z):(x=Math.floor(Math.log(t)/Math.LN2),t*(M=Math.pow(2,-x))<1&&(x--,M*=2),(t+=x+D>=1?$/M:$*Math.pow(2,1-D))*M>=2&&(x++,M/=2),x+D>=z?(w=0,x=z):x+D>=1?(w=(t*M-1)*Math.pow(2,p),x+=D):(w=t*Math.pow(2,D-1)*Math.pow(2,p),x=0));p>=8;o[r+Z]=255&w,Z+=G,w/=256,p-=8);for(x=x<<p|w,I+=p;I>0;o[r+Z]=255&x,Z+=G,x/=256,I-=8);o[r+Z-G]|=128*K}),Zf}function K_(){if(H_)return Uf;H_=1,Uf=t;var o=jb();function t(U){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(U)?U:new Uint8Array(U||0),this.pos=0,this.type=0,this.length=this.buf.length}t.Varint=0,t.Fixed64=1,t.Bytes=2,t.Fixed32=5;var r=4294967296,u=1/r,p=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function v(U){return U.type===t.Bytes?U.readVarint()+U.pos:U.pos+1}function x(U,ee,_e){return _e?4294967296*ee+(U>>>0):4294967296*(ee>>>0)+(U>>>0)}function w(U,ee,_e){var Ue=ee<=16383?1:ee<=2097151?2:ee<=268435455?3:Math.floor(Math.log(ee)/(7*Math.LN2));_e.realloc(Ue);for(var st=_e.pos-1;st>=U;st--)_e.buf[st+Ue]=_e.buf[st]}function M(U,ee){for(var _e=0;_e<U.length;_e++)ee.writeVarint(U[_e])}function I(U,ee){for(var _e=0;_e<U.length;_e++)ee.writeSVarint(U[_e])}function z(U,ee){for(var _e=0;_e<U.length;_e++)ee.writeFloat(U[_e])}function D(U,ee){for(var _e=0;_e<U.length;_e++)ee.writeDouble(U[_e])}function $(U,ee){for(var _e=0;_e<U.length;_e++)ee.writeBoolean(U[_e])}function Z(U,ee){for(var _e=0;_e<U.length;_e++)ee.writeFixed32(U[_e])}function G(U,ee){for(var _e=0;_e<U.length;_e++)ee.writeSFixed32(U[_e])}function K(U,ee){for(var _e=0;_e<U.length;_e++)ee.writeFixed64(U[_e])}function ne(U,ee){for(var _e=0;_e<U.length;_e++)ee.writeSFixed64(U[_e])}function le(U,ee){return(U[ee]|U[ee+1]<<8|U[ee+2]<<16)+16777216*U[ee+3]}function Me(U,ee,_e){U[_e]=ee,U[_e+1]=ee>>>8,U[_e+2]=ee>>>16,U[_e+3]=ee>>>24}function fe(U,ee){return(U[ee]|U[ee+1]<<8|U[ee+2]<<16)+(U[ee+3]<<24)}return t.prototype={destroy:function(){this.buf=null},readFields:function(U,ee,_e){for(_e=_e||this.length;this.pos<_e;){var Ue=this.readVarint(),st=Ue>>3,Ge=this.pos;this.type=7&Ue,U(st,ee,this),this.pos===Ge&&this.skip(Ue)}return ee},readMessage:function(U,ee){return this.readFields(U,ee,this.readVarint()+this.pos)},readFixed32:function(){var U=le(this.buf,this.pos);return this.pos+=4,U},readSFixed32:function(){var U=fe(this.buf,this.pos);return this.pos+=4,U},readFixed64:function(){var U=le(this.buf,this.pos)+le(this.buf,this.pos+4)*r;return this.pos+=8,U},readSFixed64:function(){var U=le(this.buf,this.pos)+fe(this.buf,this.pos+4)*r;return this.pos+=8,U},readFloat:function(){var U=o.read(this.buf,this.pos,!0,23,4);return this.pos+=4,U},readDouble:function(){var U=o.read(this.buf,this.pos,!0,52,8);return this.pos+=8,U},readVarint:function(U){var ee,_e,Ue=this.buf;return ee=127&(_e=Ue[this.pos++]),_e<128?ee:(ee|=(127&(_e=Ue[this.pos++]))<<7,_e<128?ee:(ee|=(127&(_e=Ue[this.pos++]))<<14,_e<128?ee:(ee|=(127&(_e=Ue[this.pos++]))<<21,_e<128?ee:function(st,Ge,et){var ht,lt,dt=et.buf;if(ht=(112&(lt=dt[et.pos++]))>>4,lt<128||(ht|=(127&(lt=dt[et.pos++]))<<3,lt<128)||(ht|=(127&(lt=dt[et.pos++]))<<10,lt<128)||(ht|=(127&(lt=dt[et.pos++]))<<17,lt<128)||(ht|=(127&(lt=dt[et.pos++]))<<24,lt<128)||(ht|=(1&(lt=dt[et.pos++]))<<31,lt<128))return x(st,ht,Ge);throw new Error("Expected varint not more than 10 bytes")}(ee|=(15&(_e=Ue[this.pos]))<<28,U,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var U=this.readVarint();return U%2==1?(U+1)/-2:U/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var U=this.readVarint()+this.pos,ee=this.pos;return this.pos=U,U-ee>=12&&p?function(_e,Ue,st){return p.decode(_e.subarray(Ue,st))}(this.buf,ee,U):function(_e,Ue,st){for(var Ge="",et=Ue;et<st;){var ht,lt,dt,it=_e[et],Ct=null,Vt=it>239?4:it>223?3:it>191?2:1;if(et+Vt>st)break;Vt===1?it<128&&(Ct=it):Vt===2?(192&(ht=_e[et+1]))==128&&(Ct=(31&it)<<6|63&ht)<=127&&(Ct=null):Vt===3?(lt=_e[et+2],(192&(ht=_e[et+1]))==128&&(192&lt)==128&&((Ct=(15&it)<<12|(63&ht)<<6|63&lt)<=2047||Ct>=55296&&Ct<=57343)&&(Ct=null)):Vt===4&&(lt=_e[et+2],dt=_e[et+3],(192&(ht=_e[et+1]))==128&&(192&lt)==128&&(192&dt)==128&&((Ct=(15&it)<<18|(63&ht)<<12|(63&lt)<<6|63&dt)<=65535||Ct>=1114112)&&(Ct=null)),Ct===null?(Ct=65533,Vt=1):Ct>65535&&(Ct-=65536,Ge+=String.fromCharCode(Ct>>>10&1023|55296),Ct=56320|1023&Ct),Ge+=String.fromCharCode(Ct),et+=Vt}return Ge}(this.buf,ee,U)},readBytes:function(){var U=this.readVarint()+this.pos,ee=this.buf.subarray(this.pos,U);return this.pos=U,ee},readPackedVarint:function(U,ee){if(this.type!==t.Bytes)return U.push(this.readVarint(ee));var _e=v(this);for(U=U||[];this.pos<_e;)U.push(this.readVarint(ee));return U},readPackedSVarint:function(U){if(this.type!==t.Bytes)return U.push(this.readSVarint());var ee=v(this);for(U=U||[];this.pos<ee;)U.push(this.readSVarint());return U},readPackedBoolean:function(U){if(this.type!==t.Bytes)return U.push(this.readBoolean());var ee=v(this);for(U=U||[];this.pos<ee;)U.push(this.readBoolean());return U},readPackedFloat:function(U){if(this.type!==t.Bytes)return U.push(this.readFloat());var ee=v(this);for(U=U||[];this.pos<ee;)U.push(this.readFloat());return U},readPackedDouble:function(U){if(this.type!==t.Bytes)return U.push(this.readDouble());var ee=v(this);for(U=U||[];this.pos<ee;)U.push(this.readDouble());return U},readPackedFixed32:function(U){if(this.type!==t.Bytes)return U.push(this.readFixed32());var ee=v(this);for(U=U||[];this.pos<ee;)U.push(this.readFixed32());return U},readPackedSFixed32:function(U){if(this.type!==t.Bytes)return U.push(this.readSFixed32());var ee=v(this);for(U=U||[];this.pos<ee;)U.push(this.readSFixed32());return U},readPackedFixed64:function(U){if(this.type!==t.Bytes)return U.push(this.readFixed64());var ee=v(this);for(U=U||[];this.pos<ee;)U.push(this.readFixed64());return U},readPackedSFixed64:function(U){if(this.type!==t.Bytes)return U.push(this.readSFixed64());var ee=v(this);for(U=U||[];this.pos<ee;)U.push(this.readSFixed64());return U},skip:function(U){var ee=7&U;if(ee===t.Varint)for(;this.buf[this.pos++]>127;);else if(ee===t.Bytes)this.pos=this.readVarint()+this.pos;else if(ee===t.Fixed32)this.pos+=4;else{if(ee!==t.Fixed64)throw new Error("Unimplemented type: "+ee);this.pos+=8}},writeTag:function(U,ee){this.writeVarint(U<<3|ee)},realloc:function(U){for(var ee=this.length||16;ee<this.pos+U;)ee*=2;if(ee!==this.length){var _e=new Uint8Array(ee);_e.set(this.buf),this.buf=_e,this.length=ee}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(U){this.realloc(4),Me(this.buf,U,this.pos),this.pos+=4},writeSFixed32:function(U){this.realloc(4),Me(this.buf,U,this.pos),this.pos+=4},writeFixed64:function(U){this.realloc(8),Me(this.buf,-1&U,this.pos),Me(this.buf,Math.floor(U*u),this.pos+4),this.pos+=8},writeSFixed64:function(U){this.realloc(8),Me(this.buf,-1&U,this.pos),Me(this.buf,Math.floor(U*u),this.pos+4),this.pos+=8},writeVarint:function(U){(U=+U||0)>268435455||U<0?function(ee,_e){var Ue,st;if(ee>=0?(Ue=ee%4294967296|0,st=ee/4294967296|0):(st=~(-ee/4294967296),4294967295^(Ue=~(-ee%4294967296))?Ue=Ue+1|0:(Ue=0,st=st+1|0)),ee>=18446744073709552e3||ee<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");_e.realloc(10),function(Ge,et,ht){ht.buf[ht.pos++]=127&Ge|128,Ge>>>=7,ht.buf[ht.pos++]=127&Ge|128,Ge>>>=7,ht.buf[ht.pos++]=127&Ge|128,Ge>>>=7,ht.buf[ht.pos++]=127&Ge|128,ht.buf[ht.pos]=127&(Ge>>>=7)}(Ue,0,_e),function(Ge,et){var ht=(7&Ge)<<4;et.buf[et.pos++]|=ht|((Ge>>>=3)?128:0),Ge&&(et.buf[et.pos++]=127&Ge|((Ge>>>=7)?128:0),Ge&&(et.buf[et.pos++]=127&Ge|((Ge>>>=7)?128:0),Ge&&(et.buf[et.pos++]=127&Ge|((Ge>>>=7)?128:0),Ge&&(et.buf[et.pos++]=127&Ge|((Ge>>>=7)?128:0),Ge&&(et.buf[et.pos++]=127&Ge)))))}(st,_e)}(U,this):(this.realloc(4),this.buf[this.pos++]=127&U|(U>127?128:0),U<=127||(this.buf[this.pos++]=127&(U>>>=7)|(U>127?128:0),U<=127||(this.buf[this.pos++]=127&(U>>>=7)|(U>127?128:0),U<=127||(this.buf[this.pos++]=U>>>7&127))))},writeSVarint:function(U){this.writeVarint(U<0?2*-U-1:2*U)},writeBoolean:function(U){this.writeVarint(!!U)},writeString:function(U){U=String(U),this.realloc(4*U.length),this.pos++;var ee=this.pos;this.pos=function(Ue,st,Ge){for(var et,ht,lt=0;lt<st.length;lt++){if((et=st.charCodeAt(lt))>55295&&et<57344){if(!ht){et>56319||lt+1===st.length?(Ue[Ge++]=239,Ue[Ge++]=191,Ue[Ge++]=189):ht=et;continue}if(et<56320){Ue[Ge++]=239,Ue[Ge++]=191,Ue[Ge++]=189,ht=et;continue}et=ht-55296<<10|et-56320|65536,ht=null}else ht&&(Ue[Ge++]=239,Ue[Ge++]=191,Ue[Ge++]=189,ht=null);et<128?Ue[Ge++]=et:(et<2048?Ue[Ge++]=et>>6|192:(et<65536?Ue[Ge++]=et>>12|224:(Ue[Ge++]=et>>18|240,Ue[Ge++]=et>>12&63|128),Ue[Ge++]=et>>6&63|128),Ue[Ge++]=63&et|128)}return Ge}(this.buf,U,this.pos);var _e=this.pos-ee;_e>=128&&w(ee,_e,this),this.pos=ee-1,this.writeVarint(_e),this.pos+=_e},writeFloat:function(U){this.realloc(4),o.write(this.buf,U,this.pos,!0,23,4),this.pos+=4},writeDouble:function(U){this.realloc(8),o.write(this.buf,U,this.pos,!0,52,8),this.pos+=8},writeBytes:function(U){var ee=U.length;this.writeVarint(ee),this.realloc(ee);for(var _e=0;_e<ee;_e++)this.buf[this.pos++]=U[_e]},writeRawMessage:function(U,ee){this.pos++;var _e=this.pos;U(ee,this);var Ue=this.pos-_e;Ue>=128&&w(_e,Ue,this),this.pos=_e-1,this.writeVarint(Ue),this.pos+=Ue},writeMessage:function(U,ee,_e){this.writeTag(U,t.Bytes),this.writeRawMessage(ee,_e)},writePackedVarint:function(U,ee){ee.length&&this.writeMessage(U,M,ee)},writePackedSVarint:function(U,ee){ee.length&&this.writeMessage(U,I,ee)},writePackedBoolean:function(U,ee){ee.length&&this.writeMessage(U,$,ee)},writePackedFloat:function(U,ee){ee.length&&this.writeMessage(U,z,ee)},writePackedDouble:function(U,ee){ee.length&&this.writeMessage(U,D,ee)},writePackedFixed32:function(U,ee){ee.length&&this.writeMessage(U,Z,ee)},writePackedSFixed32:function(U,ee){ee.length&&this.writeMessage(U,G,ee)},writePackedFixed64:function(U,ee){ee.length&&this.writeMessage(U,K,ee)},writePackedSFixed64:function(U,ee){ee.length&&this.writeMessage(U,ne,ee)},writeBytesField:function(U,ee){this.writeTag(U,t.Bytes),this.writeBytes(ee)},writeFixed32Field:function(U,ee){this.writeTag(U,t.Fixed32),this.writeFixed32(ee)},writeSFixed32Field:function(U,ee){this.writeTag(U,t.Fixed32),this.writeSFixed32(ee)},writeFixed64Field:function(U,ee){this.writeTag(U,t.Fixed64),this.writeFixed64(ee)},writeSFixed64Field:function(U,ee){this.writeTag(U,t.Fixed64),this.writeSFixed64(ee)},writeVarintField:function(U,ee){this.writeTag(U,t.Varint),this.writeVarint(ee)},writeSVarintField:function(U,ee){this.writeTag(U,t.Varint),this.writeSVarint(ee)},writeStringField:function(U,ee){this.writeTag(U,t.Bytes),this.writeString(ee)},writeFloatField:function(U,ee){this.writeTag(U,t.Fixed32),this.writeFloat(ee)},writeDoubleField:function(U,ee){this.writeTag(U,t.Fixed64),this.writeDouble(ee)},writeBooleanField:function(U,ee){this.writeVarintField(U,!!ee)}},Uf}var Vf=P(K_());let Gf=3;function $b(o,t,r){o===1&&r.readMessage(Ub,t)}function Ub(o,t,r){if(o===3){let{id:u,bitmap:p,width:v,height:x,left:w,top:M,advance:I}=r.readMessage(Zb,{});t.push({id:u,bitmap:new bh({width:v+2*Gf,height:x+2*Gf},p),metrics:{width:v,height:x,left:w,top:M,advance:I}})}}function Zb(o,t,r){o===1?t.id=r.readVarint():o===2?t.bitmap=r.readBytes():o===3?t.width=r.readVarint():o===4?t.height=r.readVarint():o===5?t.left=r.readSVarint():o===6?t.top=r.readSVarint():o===7&&(t.advance=r.readVarint())}let Vb=Gf;function X_(o){let t=0,r=0;for(let x of o)t+=x.w*x.h,r=Math.max(r,x.w);o.sort((x,w)=>w.h-x.h);let u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}],p=0,v=0;for(let x of o)for(let w=u.length-1;w>=0;w--){let M=u[w];if(!(x.w>M.w||x.h>M.h)){if(x.x=M.x,x.y=M.y,v=Math.max(v,x.y+x.h),p=Math.max(p,x.x+x.w),x.w===M.w&&x.h===M.h){let I=u.pop();w<u.length&&(u[w]=I)}else x.h===M.h?(M.x+=x.w,M.w-=x.w):x.w===M.w?(M.y+=x.h,M.h-=x.h):(u.push({x:M.x+x.w,y:M.y,w:M.w-x.w,h:x.h}),M.y+=x.h,M.h-=x.h);break}}return{w:p,h:v,fill:t/(p*v)||0}}let co=1;class qf{constructor(t,{pixelRatio:r,version:u,stretchX:p,stretchY:v,content:x,textFitWidth:w,textFitHeight:M}){this.paddedRect=t,this.pixelRatio=r,this.stretchX=p,this.stretchY=v,this.content=x,this.version=u,this.textFitWidth=w,this.textFitHeight=M}get tl(){return[this.paddedRect.x+co,this.paddedRect.y+co]}get br(){return[this.paddedRect.x+this.paddedRect.w-co,this.paddedRect.y+this.paddedRect.h-co]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*co)/this.pixelRatio,(this.paddedRect.h-2*co)/this.pixelRatio]}}class Y_{constructor(t,r){let u={},p={};this.haveRenderCallbacks=[];let v=[];this.addImages(t,u,v),this.addImages(r,p,v);let{w:x,h:w}=X_(v),M=new $o({width:x||1,height:w||1});for(let I in t){let z=t[I],D=u[I].paddedRect;$o.copy(z.data,M,{x:0,y:0},{x:D.x+co,y:D.y+co},z.data)}for(let I in r){let z=r[I],D=p[I].paddedRect,$=D.x+co,Z=D.y+co,G=z.data.width,K=z.data.height;$o.copy(z.data,M,{x:0,y:0},{x:$,y:Z},z.data),$o.copy(z.data,M,{x:0,y:K-1},{x:$,y:Z-1},{width:G,height:1}),$o.copy(z.data,M,{x:0,y:0},{x:$,y:Z+K},{width:G,height:1}),$o.copy(z.data,M,{x:G-1,y:0},{x:$-1,y:Z},{width:1,height:K}),$o.copy(z.data,M,{x:0,y:0},{x:$+G,y:Z},{width:1,height:K})}this.image=M,this.iconPositions=u,this.patternPositions=p}addImages(t,r,u){for(let p in t){let v=t[p],x={x:0,y:0,w:v.data.width+2*co,h:v.data.height+2*co};u.push(x),r[p]=new qf(x,v),v.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(t,r){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(let u in t.updatedImages)this.patchUpdatedImage(this.iconPositions[u],t.getImage(u),r),this.patchUpdatedImage(this.patternPositions[u],t.getImage(u),r)}patchUpdatedImage(t,r,u){if(!t||!r||t.version===r.version)return;t.version=r.version;let[p,v]=t.tl;u.update(r.data,void 0,{x:p,y:v})}}var zl;wt("ImagePosition",qf),wt("ImageAtlas",Y_),f.al=void 0,(zl=f.al||(f.al={}))[zl.none=0]="none",zl[zl.horizontal=1]="horizontal",zl[zl.vertical=2]="vertical",zl[zl.horizontalOnly=3]="horizontalOnly";let $d=-17;class kh{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(t,r,u){let p=new kh;return p.scale=t||1,p.fontStack=r,p.verticalAlign=u||"bottom",p}static forImage(t,r){let u=new kh;return u.imageName=t,u.verticalAlign=r||"bottom",u}}class Pu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,r){let u=new Pu;for(let p=0;p<t.sections.length;p++){let v=t.sections[p];v.image?u.addImageSection(v):u.addTextSection(v,r)}return u}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let r="";for(let u=0;u<t.length;u++){let p=t.charCodeAt(u+1)||null,v=t.charCodeAt(u-1)||null;r+=p&&fc(p)&&!Ah[t[u+1]]||v&&fc(v)&&!Ah[t[u-1]]||!Ah[t[u]]?t[u]:Ah[t[u]]}return r}(this.text)}trim(){let t=0;for(let u=0;u<this.text.length&&Zd[this.text.charCodeAt(u)];u++)t++;let r=this.text.length;for(let u=this.text.length-1;u>=0&&u>=t&&Zd[this.text.charCodeAt(u)];u--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)}substring(t,r){let u=new Pu;return u.text=this.text.substring(t,r),u.sectionIndex=this.sectionIndex.slice(t,r),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,r)=>Math.max(t,this.sections[r].scale),0)}getMaxImageSize(t){let r=0,u=0;for(let p=0;p<this.length();p++){let v=this.getSection(p);if(v.imageName){let x=t[v.imageName];if(!x)continue;let w=x.displaySize;r=Math.max(r,w[0]),u=Math.max(u,w[1])}}return{maxImageWidth:r,maxImageHeight:u}}addTextSection(t,r){this.text+=t.text,this.sections.push(kh.forText(t.scale,t.fontStack||r,t.verticalAlign));let u=this.sections.length-1;for(let p=0;p<t.text.length;++p)this.sectionIndex.push(u)}addImageSection(t){let r=t.image?t.image.name:"";if(r.length===0)return void Ri("Can't add FormattedSection with an empty image.");let u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(kh.forImage(r,t.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):Ri("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ud(o,t,r,u,p,v,x,w,M,I,z,D,$,Z,G){let K=Pu.fromFeature(o,p),ne;D===f.al.vertical&&K.verticalizePunctuation();let{processBidirectionalText:le,processStyledBidirectionalText:Me}=Fa;if(le&&K.sections.length===1){ne=[];let ee=le(K.toString(),Wf(K,I,v,t,u,Z));for(let _e of ee){let Ue=new Pu;Ue.text=_e,Ue.sections=K.sections;for(let st=0;st<_e.length;st++)Ue.sectionIndex.push(0);ne.push(Ue)}}else if(Me){ne=[];let ee=Me(K.text,K.sectionIndex,Wf(K,I,v,t,u,Z));for(let _e of ee){let Ue=new Pu;Ue.text=_e[0],Ue.sectionIndex=_e[1],Ue.sections=K.sections,ne.push(Ue)}}else ne=function(ee,_e){let Ue=[],st=ee.text,Ge=0;for(let et of _e)Ue.push(ee.substring(Ge,et)),Ge=et;return Ge<st.length&&Ue.push(ee.substring(Ge,st.length)),Ue}(K,Wf(K,I,v,t,u,Z));let fe=[],U={positionedLines:fe,text:K.toString(),top:z[1],bottom:z[1],left:z[0],right:z[0],writingMode:D,iconsInText:!1,verticalizable:!1};return function(ee,_e,Ue,st,Ge,et,ht,lt,dt,it,Ct,Vt){let jt=0,At=0,Mi=0,Cn=0,or=lt==="right"?1:lt==="left"?0:.5,Ar=rr/Vt,Zo=0;for(let bn of Ge){bn.trim();let pr=bn.getMaxScale(),wr={positionedGlyphs:[],lineOffset:0};ee.positionedLines[Zo]=wr;let Tr=wr.positionedGlyphs,Qr=0;if(!bn.length()){At+=et,++Zo;continue}let Vo=Hb(st,bn,Ar);for(let ho=0;ho<bn.length();ho++){let ar=bn.getSection(ho),mr=bn.getSectionIndex(ho),gr=bn.getCharCode(ho),Hn=Kb(dt,Ct,gr),cn;if(ar.imageName){if(ee.iconsInText=!0,ar.scale=ar.scale*Ar,cn=Yb(ar,Hn,pr,Vo,st),!cn)continue;Qr=Math.max(Qr,cn.imageOffset)}else if(cn=Xb(ar,gr,Hn,Vo,_e,Ue),!cn)continue;let{rect:$a,metrics:Eu,baselineOffset:Ua}=cn;Tr.push({glyph:gr,imageName:ar.imageName,x:jt,y:At+Ua+$d,vertical:Hn,scale:ar.scale,fontStack:ar.fontStack,sectionIndex:mr,metrics:Eu,rect:$a}),Hn?(ee.verticalizable=!0,jt+=(ar.imageName?Eu.advance:rr)*ar.scale+it):jt+=Eu.advance*ar.scale+it}Tr.length!==0&&(Mi=Math.max(jt-it,Mi),Jb(Tr,0,Tr.length-1,or)),jt=0,wr.lineOffset=Math.max(Qr,(pr-1)*rr);let fr=et*pr+Qr;At+=fr,Cn=Math.max(fr,Cn),++Zo}let{horizontalAlign:uo,verticalAlign:br}=Hf(ht);(function(bn,pr,wr,Tr,Qr,Vo,fr,ho,ar){let mr=(pr-wr)*Qr,gr=0;gr=Vo!==fr?-ho*Tr-$d:-Tr*ar*fr+.5*fr;for(let Hn of bn)for(let cn of Hn.positionedGlyphs)cn.x+=mr,cn.y+=gr})(ee.positionedLines,or,uo,br,Mi,Cn,et,At,Ge.length),ee.top+=-br*At,ee.bottom=ee.top+At,ee.left+=-uo*Mi,ee.right=ee.left+Mi}(U,t,r,u,ne,x,w,M,D,I,$,G),!function(ee){for(let _e of ee)if(_e.positionedGlyphs.length!==0)return!1;return!0}(fe)&&U}let Zd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Gb={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},qb={40:!0};function J_(o,t,r,u,p,v){if(t.imageName){let x=u[t.imageName];return x?x.displaySize[0]*t.scale*rr/v+p:0}{let x=r[t.fontStack],w=x&&x[o];return w?w.metrics.advance*t.scale+p:0}}function Q_(o,t,r,u){let p=Math.pow(o-t,2);return u?o<t?p/2:2*p:p+Math.abs(r)*r}function Wb(o,t,r){let u=0;return o===10&&(u-=1e4),r&&(u+=150),o!==40&&o!==65288||(u+=50),t!==41&&t!==65289||(u+=50),u}function ey(o,t,r,u,p,v){let x=null,w=Q_(t,r,p,v);for(let M of u){let I=Q_(t-M.x,r,p,v)+M.badness;I<=w&&(x=M,w=I)}return{index:o,x:t,priorBreak:x,badness:w}}function ty(o){return o?ty(o.priorBreak).concat(o.index):[]}function Wf(o,t,r,u,p,v){if(!o)return[];let x=[],w=function(D,$,Z,G,K,ne){let le=0;for(let Me=0;Me<D.length();Me++){let fe=D.getSection(Me);le+=J_(D.getCharCode(Me),fe,G,K,$,ne)}return le/Math.max(1,Math.ceil(le/Z))}(o,t,r,u,p,v),M=o.text.indexOf("\u200B")>=0,I=0;for(let D=0;D<o.length();D++){let $=o.getSection(D),Z=o.getCharCode(D);if(Zd[Z]||(I+=J_(Z,$,u,p,t,v)),D<o.length()-1){let G=!((z=Z)<11904)&&(!!bi["CJK Compatibility Forms"](z)||!!bi["CJK Compatibility"](z)||!!bi["CJK Strokes"](z)||!!bi["CJK Symbols and Punctuation"](z)||!!bi["Enclosed CJK Letters and Months"](z)||!!bi["Halfwidth and Fullwidth Forms"](z)||!!bi["Ideographic Description Characters"](z)||!!bi["Vertical Forms"](z)||uh.test(String.fromCodePoint(z)));(Gb[Z]||G||$.imageName||D!==o.length()-2&&qb[o.getCharCode(D+1)])&&x.push(ey(D+1,I,w,x,Wb(Z,o.getCharCode(D+1),G&&M),!1))}}var z;return ty(ey(o.length(),I,w,x,0,!0))}function Hf(o){let t=.5,r=.5;switch(o){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function Hb(o,t,r){let u=t.getMaxScale()*rr,{maxImageWidth:p,maxImageHeight:v}=t.getMaxImageSize(o),x=Math.max(u,v*r);return{verticalLineContentWidth:Math.max(u,p*r),horizontalLineContentHeight:x}}function iy(o){switch(o){case"top":return 0;case"center":return .5;default:return 1}}function Kb(o,t,r){return!(o===f.al.horizontal||!t&&!_u(r)||t&&(Zd[r]||(u=r,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(u)))));var u}function Xb(o,t,r,u,p,v){let x=v[o.fontStack],w=function(I,z,D,$){if(I&&I.rect)return I;let Z=z[D.fontStack],G=Z&&Z[$];return G?{rect:null,metrics:G.metrics}:null}(x&&x[t],p,o,t);if(w===null)return null;let M;if(r)M=u.verticalLineContentWidth-o.scale*rr;else{let I=iy(o.verticalAlign);M=(u.horizontalLineContentHeight-o.scale*rr)*I}return{rect:w.rect,metrics:w.metrics,baselineOffset:M}}function Yb(o,t,r,u,p){let v=p[o.imageName];if(!v)return null;let x=v.paddedRect,w=v.displaySize,M={width:w[0],height:w[1],left:co,top:-3,advance:t?w[1]:w[0]},I;if(t)I=u.verticalLineContentWidth-w[1]*o.scale;else{let z=iy(o.verticalAlign);I=(u.horizontalLineContentHeight-w[1]*o.scale)*z}return{rect:x,metrics:M,baselineOffset:I,imageOffset:(t?w[0]:w[1])*o.scale-rr*r}}function Jb(o,t,r,u){if(u===0)return;let p=o[r],v=(o[r].x+p.metrics.advance*p.scale)*u;for(let x=t;x<=r;x++)o[x].x-=v}function Qb(o,t,r){let{horizontalAlign:u,verticalAlign:p}=Hf(r),v=t[0]-o.displaySize[0]*u,x=t[1]-o.displaySize[1]*p;return{image:o,top:x,bottom:x+o.displaySize[1],left:v,right:v+o.displaySize[0]}}function ny(o){var t,r;let u=o.left,p=o.top,v=o.right-u,x=o.bottom-p,w=(t=o.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",M=(r=o.image.textFitHeight)!==null&&r!==void 0?r:"stretchOrShrink",I=(o.image.content[2]-o.image.content[0])/(o.image.content[3]-o.image.content[1]);if(M==="proportional"){if(w==="stretchOnly"&&v/x<I||w==="proportional"){let z=Math.ceil(x*I);u*=z/v,v=z}}else if(w==="proportional"&&M==="stretchOnly"&&I!==0&&v/x>I){let z=Math.ceil(v/I);p*=z/x,x=z}return{x1:u,y1:p,x2:u+v,y2:p+x}}function ry(o,t,r,u,p,v){let x=o.image,w;if(x.content){let ne=x.content,le=x.pixelRatio||1;w=[ne[0]/le,ne[1]/le,x.displaySize[0]-ne[2]/le,x.displaySize[1]-ne[3]/le]}let M=t.left*v,I=t.right*v,z,D,$,Z;r==="width"||r==="both"?(Z=p[0]+M-u[3],D=p[0]+I+u[1]):(Z=p[0]+(M+I-x.displaySize[0])/2,D=Z+x.displaySize[0]);let G=t.top*v,K=t.bottom*v;return r==="height"||r==="both"?(z=p[1]+G-u[0],$=p[1]+K+u[2]):(z=p[1]+(G+K-x.displaySize[1])/2,$=z+x.displaySize[1]),{image:x,top:z,right:D,bottom:$,left:Z,collisionPadding:w}}let zh=255,Ts=128,Rl=zh*Ts;function oy(o,t){let{expression:r}=t;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new sn(o+1))};if(r.kind==="source")return{kind:"source"};{let{zoomStops:u,interpolationType:p}=r,v=0;for(;v<u.length&&u[v]<=o;)v++;v=Math.max(0,v-1);let x=v;for(;x<u.length&&u[x]<o+1;)x++;x=Math.min(u.length-1,x);let w=u[v],M=u[x];return r.kind==="composite"?{kind:"composite",minZoom:w,maxZoom:M,interpolationType:p}:{kind:"camera",minZoom:w,maxZoom:M,minSize:r.evaluate(new sn(w)),maxSize:r.evaluate(new sn(M)),interpolationType:p}}}function Kf(o,t,r){let u="never",p=o.get(t);return p?u=p:o.get(r)&&(u="always"),u}let ew=Ih.VectorTileFeature.types,tw=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Vd(o,t,r,u,p,v,x,w,M,I,z,D,$){let Z=w?Math.min(Rl,Math.round(w[0])):0,G=w?Math.min(Rl,Math.round(w[1])):0;o.emplaceBack(t,r,Math.round(32*u),Math.round(32*p),v,x,(Z<<1)+(M?1:0),G,16*I,16*z,256*D,256*$)}function Xf(o,t,r){o.emplaceBack(t.x,t.y,r),o.emplaceBack(t.x,t.y,r),o.emplaceBack(t.x,t.y,r),o.emplaceBack(t.x,t.y,r)}function iw(o){for(let t of o.sections)if(bf(t.text))return!0;return!1}class Yf{constructor(t){this.layoutVertexArray=new yn,this.indexArray=new Bi,this.programConfigurations=t,this.segments=new Oi,this.dynamicLayoutVertexArray=new Ki,this.opacityVertexArray=new vn,this.hasVisibleVertices=!1,this.placedSymbolArray=new ve}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,r,u,p){this.isEmpty()||(u&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Db.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Bb.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,tw,!0),this.opacityVertexBuffer.itemSize=1),(u||p)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}wt("SymbolBuffers",Yf);class Jf{constructor(t,r,u){this.layoutVertexArray=new t,this.layoutAttributes=r,this.indexArray=new u,this.segments=new Oi,this.collisionVertexArray=new Qi}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Ob.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}wt("CollisionBuffers",Jf);class Mu{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(x=>x.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];let r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=oy(this.zoom,r["text-size"]),this.iconSizeData=oy(this.zoom,r["icon-size"]);let u=this.layers[0].layout,p=u.get("symbol-sort-key"),v=u.get("symbol-z-order");this.canOverlap=Kf(u,"text-overlap","text-allow-overlap")!=="never"||Kf(u,"icon-overlap","icon-allow-overlap")!=="never"||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=v!=="viewport-y"&&!p.isConstant(),this.sortFeaturesByY=(v==="viewport-y"||v==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,u.get("symbol-placement")==="point"&&(this.writingModes=u.get("text-writing-mode").map(x=>f.al[x])),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=t.sourceID}createArrays(){this.text=new Yf(new ws(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new Yf(new ws(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new Le,this.lineVertexArray=new Pe,this.symbolInstances=new we,this.textAnchorOffsets=new tt}calculateGlyphDependencies(t,r,u,p,v){for(let x=0;x<t.length;x++)if(r[t.charCodeAt(x)]=!0,(u||p)&&v){let w=Ah[t.charAt(x)];w&&(r[w.charCodeAt(0)]=!0)}}populate(t,r,u){let p=this.layers[0],v=p.layout,x=v.get("text-font"),w=v.get("text-field"),M=v.get("icon-image"),I=(w.value.kind!=="constant"||w.value.value instanceof yr&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),z=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,D=v.get("symbol-sort-key");if(this.features=[],!I&&!z)return;let $=r.iconDependencies,Z=r.glyphDependencies,G=r.availableImages,K=new sn(this.zoom);for(let{feature:ne,id:le,index:Me,sourceLayerIndex:fe}of t){let U=p._featureFilter.needGeometry,ee=wc(ne,U);if(!p._featureFilter.filter(K,ee,u))continue;let _e,Ue;if(U||(ee.geometry=bc(ne)),I){let Ge=p.getValueAndResolveTokens("text-field",ee,u,G),et=yr.factory(Ge),ht=this.hasRTLText=this.hasRTLText||iw(et);(!ht||Fa.getRTLTextPluginStatus()==="unavailable"||ht&&Fa.isParsed())&&(_e=Nb(et,p,ee))}if(z){let Ge=p.getValueAndResolveTokens("icon-image",ee,u,G);Ue=Ge instanceof vr?Ge:vr.fromString(Ge)}if(!_e&&!Ue)continue;let st=this.sortFeaturesByKey?D.evaluate(ee,{},u):void 0;if(this.features.push({id:le,text:_e,icon:Ue,index:Me,sourceLayerIndex:fe,geometry:ee.geometry,properties:ne.properties,type:ew[ne.type],sortKey:st}),Ue&&($[Ue.name]=!0),_e){let Ge=x.evaluate(ee,{},u).join(","),et=v.get("text-rotation-alignment")!=="viewport"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(f.al.vertical)>=0;for(let ht of _e.sections)if(ht.image)$[ht.image.name]=!0;else{let lt=gu(_e.toString()),dt=ht.fontStack||Ge,it=Z[dt]=Z[dt]||{};this.calculateGlyphDependencies(ht.text,it,et,this.allowVerticalPlacement,lt)}}}v.get("symbol-placement")==="line"&&(this.features=function(ne){let le={},Me={},fe=[],U=0;function ee(Ge){fe.push(ne[Ge]),U++}function _e(Ge,et,ht){let lt=Me[Ge];return delete Me[Ge],Me[et]=lt,fe[lt].geometry[0].pop(),fe[lt].geometry[0]=fe[lt].geometry[0].concat(ht[0]),lt}function Ue(Ge,et,ht){let lt=le[et];return delete le[et],le[Ge]=lt,fe[lt].geometry[0].shift(),fe[lt].geometry[0]=ht[0].concat(fe[lt].geometry[0]),lt}function st(Ge,et,ht){let lt=ht?et[0][et[0].length-1]:et[0][0];return`${Ge}:${lt.x}:${lt.y}`}for(let Ge=0;Ge<ne.length;Ge++){let et=ne[Ge],ht=et.geometry,lt=et.text?et.text.toString():null;if(!lt){ee(Ge);continue}let dt=st(lt,ht),it=st(lt,ht,!0);if(dt in Me&&it in le&&Me[dt]!==le[it]){let Ct=Ue(dt,it,ht),Vt=_e(dt,it,fe[Ct].geometry);delete le[dt],delete Me[it],Me[st(lt,fe[Vt].geometry,!0)]=Vt,fe[Ct].geometry=null}else dt in Me?_e(dt,it,ht):it in le?Ue(dt,it,ht):(ee(Ge),le[dt]=U-1,Me[it]=U-1)}return fe.filter(Ge=>Ge.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ne,le)=>ne.sortKey-le.sortKey)}update(t,r,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,r,this.layers,u),this.icon.programConfigurations.updatePaintArrays(t,r,this.layers,u))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,r){let u=this.lineVertexArray.length;if(t.segment!==void 0){let p=t.dist(r[t.segment+1]),v=t.dist(r[t.segment]),x={};for(let w=t.segment+1;w<r.length;w++)x[w]={x:r[w].x,y:r[w].y,tileUnitDistanceFromAnchor:p},w<r.length-1&&(p+=r[w+1].dist(r[w]));for(let w=t.segment||0;w>=0;w--)x[w]={x:r[w].x,y:r[w].y,tileUnitDistanceFromAnchor:v},w>0&&(v+=r[w-1].dist(r[w]));for(let w=0;w<r.length;w++){let M=x[w];this.lineVertexArray.emplaceBack(M.x,M.y,M.tileUnitDistanceFromAnchor)}}return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(t,r,u,p,v,x,w,M,I,z,D,$){let Z=t.indexArray,G=t.layoutVertexArray,K=t.segments.prepareSegment(4*r.length,G,Z,this.canOverlap?x.sortKey:void 0),ne=this.glyphOffsetArray.length,le=K.vertexLength,Me=this.allowVerticalPlacement&&w===f.al.vertical?Math.PI/2:0,fe=x.text&&x.text.sections;for(let U=0;U<r.length;U++){let{tl:ee,tr:_e,bl:Ue,br:st,tex:Ge,pixelOffsetTL:et,pixelOffsetBR:ht,minFontScaleX:lt,minFontScaleY:dt,glyphOffset:it,isSDF:Ct,sectionIndex:Vt}=r[U],jt=K.vertexLength,At=it[1];Vd(G,M.x,M.y,ee.x,At+ee.y,Ge.x,Ge.y,u,Ct,et.x,et.y,lt,dt),Vd(G,M.x,M.y,_e.x,At+_e.y,Ge.x+Ge.w,Ge.y,u,Ct,ht.x,et.y,lt,dt),Vd(G,M.x,M.y,Ue.x,At+Ue.y,Ge.x,Ge.y+Ge.h,u,Ct,et.x,ht.y,lt,dt),Vd(G,M.x,M.y,st.x,At+st.y,Ge.x+Ge.w,Ge.y+Ge.h,u,Ct,ht.x,ht.y,lt,dt),Xf(t.dynamicLayoutVertexArray,M,Me),Z.emplaceBack(jt,jt+2,jt+1),Z.emplaceBack(jt+1,jt+2,jt+3),K.vertexLength+=4,K.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(it[0]),U!==r.length-1&&Vt===r[U+1].sectionIndex||t.programConfigurations.populatePaintArrays(G.length,x,x.index,{},$,fe&&fe[Vt])}t.placedSymbolArray.emplaceBack(M.x,M.y,ne,this.glyphOffsetArray.length-ne,le,I,z,M.segment,u?u[0]:0,u?u[1]:0,p[0],p[1],w,0,!1,0,D)}_addCollisionDebugVertex(t,r,u,p,v,x){return r.emplaceBack(0,0),t.emplaceBack(u.x,u.y,p,v,Math.round(x.x),Math.round(x.y))}addCollisionDebugVertices(t,r,u,p,v,x,w){let M=v.segments.prepareSegment(4,v.layoutVertexArray,v.indexArray),I=M.vertexLength,z=v.layoutVertexArray,D=v.collisionVertexArray,$=w.anchorX,Z=w.anchorY;this._addCollisionDebugVertex(z,D,x,$,Z,new he(t,r)),this._addCollisionDebugVertex(z,D,x,$,Z,new he(u,r)),this._addCollisionDebugVertex(z,D,x,$,Z,new he(u,p)),this._addCollisionDebugVertex(z,D,x,$,Z,new he(t,p)),M.vertexLength+=4;let G=v.indexArray;G.emplaceBack(I,I+1),G.emplaceBack(I+1,I+2),G.emplaceBack(I+2,I+3),G.emplaceBack(I+3,I),M.primitiveLength+=4}addDebugCollisionBoxes(t,r,u,p){for(let v=t;v<r;v++){let x=this.collisionBoxArray.get(v);this.addCollisionDebugVertices(x.x1,x.y1,x.x2,x.y2,p?this.textCollisionBox:this.iconCollisionBox,x.anchorPoint,u)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Jf(xn,q_.members,nr),this.iconCollisionBox=new Jf(xn,q_.members,nr);for(let t=0;t<this.symbolInstances.length;t++){let r=this.symbolInstances.get(t);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(t,r,u,p,v,x,w,M,I){let z={};for(let D=r;D<u;D++){let $=t.get(D);z.textBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},z.textFeatureIndex=$.featureIndex;break}for(let D=p;D<v;D++){let $=t.get(D);z.verticalTextBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},z.verticalTextFeatureIndex=$.featureIndex;break}for(let D=x;D<w;D++){let $=t.get(D);z.iconBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},z.iconFeatureIndex=$.featureIndex;break}for(let D=M;D<I;D++){let $=t.get(D);z.verticalIconBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},z.verticalIconFeatureIndex=$.featureIndex;break}return z}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){let u=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,r){let u=t.placedSymbolArray.get(r),p=u.vertexStartIndex+4*u.numGlyphs;for(let v=u.vertexStartIndex;v<p;v+=4)t.indexArray.emplaceBack(v,v+2,v+1),t.indexArray.emplaceBack(v+1,v+2,v+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let r=Math.sin(t),u=Math.cos(t),p=[],v=[],x=[];for(let w=0;w<this.symbolInstances.length;++w){x.push(w);let M=this.symbolInstances.get(w);p.push(0|Math.round(r*M.anchorX+u*M.anchorY)),v.push(M.featureIndex)}return x.sort((w,M)=>p[w]-p[M]||v[M]-v[w]),x}addToSortKeyRanges(t,r){let u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===r?u.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let r of this.symbolInstanceIndexes){let u=this.symbolInstances.get(r);this.featureSortOrder.push(u.featureIndex),[u.rightJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.leftJustifiedTextSymbolIndex].forEach((p,v,x)=>{p>=0&&x.indexOf(p)===v&&this.addIndicesForPlacedSymbol(this.text,p)}),u.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,u.verticalPlacedTextSymbolIndex),u.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.placedIconSymbolIndex),u.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let ay,sy;wt("SymbolBucket",Mu,{omit:["layers","collisionBoxArray","features","compareText"]}),Mu.MAX_GLYPHS=65535,Mu.addDynamicAttributes=Xf;var Qf={get paint(){return sy=sy||new Gn({"icon-opacity":new Wt(ie.paint_symbol["icon-opacity"]),"icon-color":new Wt(ie.paint_symbol["icon-color"]),"icon-halo-color":new Wt(ie.paint_symbol["icon-halo-color"]),"icon-halo-width":new Wt(ie.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Wt(ie.paint_symbol["icon-halo-blur"]),"icon-translate":new Rt(ie.paint_symbol["icon-translate"]),"icon-translate-anchor":new Rt(ie.paint_symbol["icon-translate-anchor"]),"text-opacity":new Wt(ie.paint_symbol["text-opacity"]),"text-color":new Wt(ie.paint_symbol["text-color"],{runtimeType:Hi,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new Wt(ie.paint_symbol["text-halo-color"]),"text-halo-width":new Wt(ie.paint_symbol["text-halo-width"]),"text-halo-blur":new Wt(ie.paint_symbol["text-halo-blur"]),"text-translate":new Rt(ie.paint_symbol["text-translate"]),"text-translate-anchor":new Rt(ie.paint_symbol["text-translate-anchor"])})},get layout(){return ay=ay||new Gn({"symbol-placement":new Rt(ie.layout_symbol["symbol-placement"]),"symbol-spacing":new Rt(ie.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Rt(ie.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Wt(ie.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Rt(ie.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Rt(ie.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Rt(ie.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Rt(ie.layout_symbol["icon-ignore-placement"]),"icon-optional":new Rt(ie.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Rt(ie.layout_symbol["icon-rotation-alignment"]),"icon-size":new Wt(ie.layout_symbol["icon-size"]),"icon-text-fit":new Rt(ie.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Rt(ie.layout_symbol["icon-text-fit-padding"]),"icon-image":new Wt(ie.layout_symbol["icon-image"]),"icon-rotate":new Wt(ie.layout_symbol["icon-rotate"]),"icon-padding":new Wt(ie.layout_symbol["icon-padding"]),"icon-keep-upright":new Rt(ie.layout_symbol["icon-keep-upright"]),"icon-offset":new Wt(ie.layout_symbol["icon-offset"]),"icon-anchor":new Wt(ie.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Rt(ie.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Rt(ie.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Rt(ie.layout_symbol["text-rotation-alignment"]),"text-field":new Wt(ie.layout_symbol["text-field"]),"text-font":new Wt(ie.layout_symbol["text-font"]),"text-size":new Wt(ie.layout_symbol["text-size"]),"text-max-width":new Wt(ie.layout_symbol["text-max-width"]),"text-line-height":new Rt(ie.layout_symbol["text-line-height"]),"text-letter-spacing":new Wt(ie.layout_symbol["text-letter-spacing"]),"text-justify":new Wt(ie.layout_symbol["text-justify"]),"text-radial-offset":new Wt(ie.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Rt(ie.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Wt(ie.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Wt(ie.layout_symbol["text-anchor"]),"text-max-angle":new Rt(ie.layout_symbol["text-max-angle"]),"text-writing-mode":new Rt(ie.layout_symbol["text-writing-mode"]),"text-rotate":new Wt(ie.layout_symbol["text-rotate"]),"text-padding":new Rt(ie.layout_symbol["text-padding"]),"text-keep-upright":new Rt(ie.layout_symbol["text-keep-upright"]),"text-transform":new Wt(ie.layout_symbol["text-transform"]),"text-offset":new Wt(ie.layout_symbol["text-offset"]),"text-allow-overlap":new Rt(ie.layout_symbol["text-allow-overlap"]),"text-overlap":new Rt(ie.layout_symbol["text-overlap"]),"text-ignore-placement":new Rt(ie.layout_symbol["text-ignore-placement"]),"text-optional":new Rt(ie.layout_symbol["text-optional"])})}};class ly{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:Zt,this.defaultValue=t}evaluate(t){if(t.formattedSection){let r=this.defaultValue.property.overrides;if(r&&r.hasOverride(t.formattedSection))return r.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}wt("FormatSectionOverride",ly,{omit:["defaultValue"]});class Gd extends wo{constructor(t){super(t,Qf)}recalculate(t,r){if(super.recalculate(t,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){let u=this.layout.get("text-writing-mode");if(u){let p=[];for(let v of u)p.indexOf(v)<0&&p.push(v);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,r,u,p){let v=this.layout.get(t).evaluate(r,{},u,p),x=this._unevaluatedLayout._values[t];return x.isDataDriven()||fs(x.value)||!v?v:function(w,M){return M.replace(/{([^{}]+)}/g,(I,z)=>w&&z in w?String(w[z]):"")}(r.properties,v)}createBucket(t){return new Mu(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(let t of Qf.paint.overridableProperties){if(!Gd.hasPaintOverride(this.layout,t))continue;let r=this.paint.get(t),u=new ly(r),p=new wl(u,r.property.specification),v=null;v=r.value.kind==="constant"||r.value.kind==="source"?new cc("source",p):new c("composite",p,r.value.zoomStops),this.paint._values[t]=new Ur(r.property,v,r.parameters)}}_handleOverridablePaintPropertyUpdate(t,r,u){return!(!this.layout||r.isDataDriven()||u.isDataDriven())&&Gd.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,r){let u=t.get("text-field"),p=Qf.paint.properties[r],v=!1,x=w=>{for(let M of w)if(p.overrides&&p.overrides.hasOverride(M))return void(v=!0)};if(u.value.kind==="constant"&&u.value.value instanceof yr)x(u.value.value.sections);else if(u.value.kind==="source"){let w=I=>{v||(I instanceof Bt&&Ji(I.value)===We?x(I.value.sections):I instanceof Ia?x(I.sections):I.eachChild(w))},M=u.value;M._styleExpression&&w(M._styleExpression.expression)}return v}}let cy;var nw={get paint(){return cy=cy||new Gn({"background-color":new Rt(ie.paint_background["background-color"]),"background-pattern":new dh(ie.paint_background["background-pattern"]),"background-opacity":new Rt(ie.paint_background["background-opacity"])})}};class rw extends wo{constructor(t){super(t,nw)}}let uy;var ow={get paint(){return uy=uy||new Gn({"raster-opacity":new Rt(ie.paint_raster["raster-opacity"]),"raster-hue-rotate":new Rt(ie.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Rt(ie.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Rt(ie.paint_raster["raster-brightness-max"]),"raster-saturation":new Rt(ie.paint_raster["raster-saturation"]),"raster-contrast":new Rt(ie.paint_raster["raster-contrast"]),"raster-resampling":new Rt(ie.paint_raster["raster-resampling"]),"raster-fade-duration":new Rt(ie.paint_raster["raster-fade-duration"])})}};class aw extends wo{constructor(t){super(t,ow)}}class sw extends wo{constructor(t){super(t,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class lw{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}let cw={once:!0},em=63710088e-1;class Dl{constructor(t,r){if(isNaN(t)||isNaN(r))throw new Error(`Invalid LngLat object: (${t}, ${r})`);if(this.lng=+t,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Dl(zt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){let r=Math.PI/180,u=this.lat*r,p=t.lat*r,v=Math.sin(u)*Math.sin(p)+Math.cos(u)*Math.cos(p)*Math.cos((t.lng-this.lng)*r);return em*Math.acos(Math.min(v,1))}static convert(t){if(t instanceof Dl)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Dl(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Dl(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}let hy=2*Math.PI*em;function dy(o){return hy*Math.cos(o*Math.PI/180)}function py(o){return(180+o)/360}function fy(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function my(o,t){return o/dy(t)}function tm(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function gy(o,t){return o*dy(tm(t))}class Rh{constructor(t,r,u=0){this.x=+t,this.y=+r,this.z=+u}static fromLngLat(t,r=0){let u=Dl.convert(t);return new Rh(py(u.lng),fy(u.lat),my(r,u.lat))}toLngLat(){return new Dl(360*this.x-180,tm(this.y))}toAltitude(){return gy(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/hy*(t=tm(this.y),1/Math.cos(t*Math.PI/180));var t}}function _y(o,t,r){var u=2*Math.PI*6378137/256/Math.pow(2,r);return[o*u-2*Math.PI*6378137/2,t*u-2*Math.PI*6378137/2]}class im{constructor(t,r,u){if(!function(p,v,x){return!(p<0||p>25||x<0||x>=Math.pow(2,p)||v<0||v>=Math.pow(2,p))}(t,r,u))throw new Error(`x=${r}, y=${u}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=r,this.y=u,this.key=Cu(0,t,t,r,u)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,r,u){let p=(x=this.y,w=this.z,M=_y(256*(v=this.x),256*(x=Math.pow(2,w)-x-1),w),I=_y(256*(v+1),256*(x+1),w),M[0]+","+M[1]+","+I[0]+","+I[1]);var v,x,w,M,I;let z=function(D,$,Z){let G,K="";for(let ne=D;ne>0;ne--)G=1<<ne-1,K+=($&G?1:0)+(Z&G?2:0);return K}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(u==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,z).replace(/{bbox-epsg-3857}/g,p)}isChildOf(t){let r=this.z-t.z;return r>0&&t.x===this.x>>r&&t.y===this.y>>r}getTilePoint(t){let r=Math.pow(2,this.z);return new he((t.x*r-this.x)*ge,(t.y*r-this.y)*ge)}toString(){return`${this.z}/${this.x}/${this.y}`}}class yy{constructor(t,r){this.wrap=t,this.canonical=r,this.key=Cu(t,r.z,r.z,r.x,r.y)}}class Uo{constructor(t,r,u,p,v){if(this.terrainRttPosMatrix32f=null,t<u)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${u}`);this.overscaledZ=t,this.wrap=r,this.canonical=new im(u,+p,+v),this.key=Cu(r,t,u,p,v)}clone(){return new Uo(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);let r=this.canonical.z-t;return t>this.canonical.z?new Uo(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Uo(t,this.wrap,t,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(t,r){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);let u=this.canonical.z-t;return t>this.canonical.z?Cu(this.wrap*+r,t,this.canonical.z,this.canonical.x,this.canonical.y):Cu(this.wrap*+r,t,t,this.canonical.x>>u,this.canonical.y>>u)}isChildOf(t){if(t.wrap!==this.wrap)return!1;let r=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>r&&t.canonical.y===this.canonical.y>>r}children(t){if(this.overscaledZ>=t)return[new Uo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let r=this.canonical.z+1,u=2*this.canonical.x,p=2*this.canonical.y;return[new Uo(r,this.wrap,r,u,p),new Uo(r,this.wrap,r,u+1,p),new Uo(r,this.wrap,r,u,p+1),new Uo(r,this.wrap,r,u+1,p+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Uo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Uo(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new yy(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Rh(t.x-this.wrap,t.y))}}function Cu(o,t,r,u,p){(o*=2)<0&&(o=-1*o-1);let v=1<<r;return(v*v*o+v*p+u).toString(36)+r.toString(36)+t.toString(36)}wt("CanonicalTileID",im),wt("OverscaledTileID",Uo,{omit:["terrainRttPosMatrix32f"]});class vy{constructor(t,r,u,p=1,v=1,x=1,w=0){if(this.uid=t,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(u&&!["mapbox","terrarium","custom"].includes(u))return void Ri(`"${u}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;let M=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),u){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=p,this.greenFactor=v,this.blueFactor=x,this.baseShift=w;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let I=0;I<M;I++)this.data[this._idx(-1,I)]=this.data[this._idx(0,I)],this.data[this._idx(M,I)]=this.data[this._idx(M-1,I)],this.data[this._idx(I,-1)]=this.data[this._idx(I,0)],this.data[this._idx(I,M)]=this.data[this._idx(I,M-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(M,-1)]=this.data[this._idx(M-1,0)],this.data[this._idx(-1,M)]=this.data[this._idx(0,M-1)],this.data[this._idx(M,M)]=this.data[this._idx(M-1,M-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let I=0;I<M;I++)for(let z=0;z<M;z++){let D=this.get(I,z);D>this.max&&(this.max=D),D<this.min&&(this.min=D)}}get(t,r){let u=new Uint8Array(this.data.buffer),p=4*this._idx(t,r);return this.unpack(u[p],u[p+1],u[p+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,r){if(t<-1||t>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(t+1)}unpack(t,r,u){return t*this.redFactor+r*this.greenFactor+u*this.blueFactor-this.baseShift}getPixels(){return new $o({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,r,u){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let p=r*this.dim,v=r*this.dim+this.dim,x=u*this.dim,w=u*this.dim+this.dim;switch(r){case-1:p=v-1;break;case 1:v=p+1}switch(u){case-1:x=w-1;break;case 1:w=x+1}let M=-r*this.dim,I=-u*this.dim;for(let z=x;z<w;z++)for(let D=p;D<v;D++)this.data[this._idx(D,z)]=t.data[this._idx(D+M,z+I)]}}wt("DEMData",vy);class xy{constructor(t){this._stringToNumber={},this._numberToString=[];for(let r=0;r<t.length;r++){let u=t[r];this._stringToNumber[u]=r,this._numberToString[r]=u}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class by{constructor(t,r,u,p,v){this.type="Feature",this._vectorTileFeature=t,t._z=r,t._x=u,t._y=p,this.properties=t.properties,this.id=v}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){let t={geometry:this.geometry};for(let r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(t[r]=this[r]);return t}}class wy{constructor(t,r){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new El(ge,16,0),this.grid3D=new El(ge,16,0),this.featureIndexArray=new Ke,this.promoteId=r}insert(t,r,u,p,v,x){let w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,p,v);let M=x?this.grid3D:this.grid;for(let I=0;I<r.length;I++){let z=r[I],D=[1/0,1/0,-1/0,-1/0];for(let $=0;$<z.length;$++){let Z=z[$];D[0]=Math.min(D[0],Z.x),D[1]=Math.min(D[1],Z.y),D[2]=Math.max(D[2],Z.x),D[3]=Math.max(D[3],Z.y)}D[0]<ge&&D[1]<ge&&D[2]>=0&&D[3]>=0&&M.insert(w,D[0],D[1],D[2],D[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Ih.VectorTile(new Vf(this.rawTileData)).layers,this.sourceLayerCoder=new xy(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,r,u,p){this.loadVTLayers();let v=t.params,x=ge/t.tileSize/t.scale,w=xe(v.filter),M=t.queryGeometry,I=t.queryPadding*x,z=Sy(M),D=this.grid.query(z.minX-I,z.minY-I,z.maxX+I,z.maxY+I),$=Sy(t.cameraQueryGeometry),Z=this.grid3D.query($.minX-I,$.minY-I,$.maxX+I,$.maxY+I,(ne,le,Me,fe)=>function(U,ee,_e,Ue,st){for(let et of U)if(ee<=et.x&&_e<=et.y&&Ue>=et.x&&st>=et.y)return!0;let Ge=[new he(ee,_e),new he(ee,st),new he(Ue,st),new he(Ue,_e)];if(U.length>2){for(let et of Ge)if(Tc(U,et))return!0}for(let et=0;et<U.length-1;et++)if(Yx(U[et],U[et+1],Ge))return!0;return!1}(t.cameraQueryGeometry,ne-I,le-I,Me+I,fe+I));for(let ne of Z)D.push(ne);D.sort(uw);let G={},K;for(let ne=0;ne<D.length;ne++){let le=D[ne];if(le===K)continue;K=le;let Me=this.featureIndexArray.get(le),fe=null;this.loadMatchingFeature(G,Me.bucketIndex,Me.sourceLayerIndex,Me.featureIndex,w,v.layers,v.availableImages,r,u,p,(U,ee,_e)=>(fe||(fe=bc(U)),ee.queryIntersectsFeature({queryGeometry:M,feature:U,featureState:_e,geometry:fe,zoom:this.z,transform:t.transform,pixelsToTileUnits:x,pixelPosMatrix:t.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:t.getElevation})))}return G}loadMatchingFeature(t,r,u,p,v,x,w,M,I,z,D){let $=this.bucketLayerIDs[r];if(x&&!$.some(ne=>x.has(ne)))return;let Z=this.sourceLayerCoder.decode(u),G=this.vtLayers[Z].feature(p);if(v.needGeometry){let ne=wc(G,!0);if(!v.filter(new sn(this.tileID.overscaledZ),ne,this.tileID.canonical))return}else if(!v.filter(new sn(this.tileID.overscaledZ),G))return;let K=this.getId(G,Z);for(let ne=0;ne<$.length;ne++){let le=$[ne];if(x&&!x.has(le))continue;let Me=M[le];if(!Me)continue;let fe={};K&&z&&(fe=z.getState(Me.sourceLayer||"_geojsonTileLayer",K));let U=Ft({},I[le]);U.paint=Ty(U.paint,Me.paint,G,fe,w),U.layout=Ty(U.layout,Me.layout,G,fe,w);let ee=!D||D(G,Me,fe);if(!ee)continue;let _e=new by(G,this.z,this.x,this.y,K);_e.layer=U;let Ue=t[le];Ue===void 0&&(Ue=t[le]=[]),Ue.push({featureIndex:p,feature:_e,intersectionZ:ee})}}lookupSymbolFeatures(t,r,u,p,v,x,w,M){let I={};this.loadVTLayers();let z=xe(v);for(let D of t)this.loadMatchingFeature(I,u,p,D,z,x,w,M,r);return I}hasLayer(t){for(let r of this.bucketLayerIDs)for(let u of r)if(t===u)return!0;return!1}getId(t,r){var u;let p=t.id;return this.promoteId&&(p=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof p=="boolean"&&(p=Number(p)),p===void 0&&(!((u=t.properties)===null||u===void 0)&&u.cluster)&&this.promoteId&&(p=Number(t.properties.cluster_id))),p}}function Ty(o,t,r,u,p){return Vi(o,(v,x)=>{let w=t instanceof vu?t.get(x):null;return w&&w.evaluate?w.evaluate(r,u,p):w})}function Sy(o){let t=1/0,r=1/0,u=-1/0,p=-1/0;for(let v of o)t=Math.min(t,v.x),r=Math.min(r,v.y),u=Math.max(u,v.x),p=Math.max(p,v.y);return{minX:t,minY:r,maxX:u,maxY:p}}function uw(o,t){return t-o}function Py(o,t,r,u,p){let v=[];for(let x=0;x<o.length;x++){let w=o[x],M;for(let I=0;I<w.length-1;I++){let z=w[I],D=w[I+1];z.x<t&&D.x<t||(z.x<t?z=new he(t,z.y+(t-z.x)/(D.x-z.x)*(D.y-z.y))._round():D.x<t&&(D=new he(t,z.y+(t-z.x)/(D.x-z.x)*(D.y-z.y))._round()),z.y<r&&D.y<r||(z.y<r?z=new he(z.x+(r-z.y)/(D.y-z.y)*(D.x-z.x),r)._round():D.y<r&&(D=new he(z.x+(r-z.y)/(D.y-z.y)*(D.x-z.x),r)._round()),z.x>=u&&D.x>=u||(z.x>=u?z=new he(u,z.y+(u-z.x)/(D.x-z.x)*(D.y-z.y))._round():D.x>=u&&(D=new he(u,z.y+(u-z.x)/(D.x-z.x)*(D.y-z.y))._round()),z.y>=p&&D.y>=p||(z.y>=p?z=new he(z.x+(p-z.y)/(D.y-z.y)*(D.x-z.x),p)._round():D.y>=p&&(D=new he(z.x+(p-z.y)/(D.y-z.y)*(D.x-z.x),p)._round()),M&&z.equals(M[M.length-1])||(M=[z],v.push(M)),M.push(D)))))}}return v}wt("FeatureIndex",wy,{omit:["rawTileData","sourceLayerCoder"]});class Bl extends he{constructor(t,r,u,p){super(t,r),this.angle=u,p!==void 0&&(this.segment=p)}clone(){return new Bl(this.x,this.y,this.angle,this.segment)}}function My(o,t,r,u,p){if(t.segment===void 0||r===0)return!0;let v=t,x=t.segment+1,w=0;for(;w>-r/2;){if(x--,x<0)return!1;w-=o[x].dist(v),v=o[x]}w+=o[x].dist(o[x+1]),x++;let M=[],I=0;for(;w<r/2;){let z=o[x],D=o[x+1];if(!D)return!1;let $=o[x-1].angleTo(z)-z.angleTo(D);for($=Math.abs(($+3*Math.PI)%(2*Math.PI)-Math.PI),M.push({distance:w,angleDelta:$}),I+=$;w-M[0].distance>u;)I-=M.shift().angleDelta;if(I>p)return!1;x++,w+=z.dist(D)}return!0}function Cy(o){let t=0;for(let r=0;r<o.length-1;r++)t+=o[r].dist(o[r+1]);return t}function Iy(o,t,r){return o?.6*t*r:0}function Ey(o,t){return Math.max(o?o.right-o.left:0,t?t.right-t.left:0)}function hw(o,t,r,u,p,v){let x=Iy(r,p,v),w=Ey(r,u)*v,M=0,I=Cy(o)/2;for(let z=0;z<o.length-1;z++){let D=o[z],$=o[z+1],Z=D.dist($);if(M+Z>I){let G=(I-M)/Z,K=tr.number(D.x,$.x,G),ne=tr.number(D.y,$.y,G),le=new Bl(K,ne,$.angleTo(D),z);return le._round(),!x||My(o,le,w,x,t)?le:void 0}M+=Z}}function dw(o,t,r,u,p,v,x,w,M){let I=Iy(u,v,x),z=Ey(u,p),D=z*x,$=o[0].x===0||o[0].x===M||o[0].y===0||o[0].y===M;return t-D<t/4&&(t=D+t/4),Ly(o,$?t/2*w%t:(z/2+2*v)*x*w%t,t,I,r,D,$,!1,M)}function Ly(o,t,r,u,p,v,x,w,M){let I=v/2,z=Cy(o),D=0,$=t-r,Z=[];for(let G=0;G<o.length-1;G++){let K=o[G],ne=o[G+1],le=K.dist(ne),Me=ne.angleTo(K);for(;$+r<D+le;){$+=r;let fe=($-D)/le,U=tr.number(K.x,ne.x,fe),ee=tr.number(K.y,ne.y,fe);if(U>=0&&U<M&&ee>=0&&ee<M&&$-I>=0&&$+I<=z){let _e=new Bl(U,ee,Me,G);_e._round(),u&&!My(o,_e,v,u,p)||Z.push(_e)}}D+=le}return w||Z.length||x||(Z=Ly(o,D/2,r,u,p,v,x,!0,M)),Z}wt("Anchor",Bl);let Dh=co;function Ay(o,t,r,u){let p=[],v=o.image,x=v.pixelRatio,w=v.paddedRect.w-2*Dh,M=v.paddedRect.h-2*Dh,I={x1:o.left,y1:o.top,x2:o.right,y2:o.bottom},z=v.stretchX||[[0,w]],D=v.stretchY||[[0,M]],$=(it,Ct)=>it+Ct[1]-Ct[0],Z=z.reduce($,0),G=D.reduce($,0),K=w-Z,ne=M-G,le=0,Me=Z,fe=0,U=G,ee=0,_e=K,Ue=0,st=ne;if(v.content&&u){let it=v.content,Ct=it[2]-it[0],Vt=it[3]-it[1];(v.textFitWidth||v.textFitHeight)&&(I=ny(o)),le=qd(z,0,it[0]),fe=qd(D,0,it[1]),Me=qd(z,it[0],it[2]),U=qd(D,it[1],it[3]),ee=it[0]-le,Ue=it[1]-fe,_e=Ct-Me,st=Vt-U}let Ge=I.x1,et=I.y1,ht=I.x2-Ge,lt=I.y2-et,dt=(it,Ct,Vt,jt)=>{let At=Wd(it.stretch-le,Me,ht,Ge),Mi=Hd(it.fixed-ee,_e,it.stretch,Z),Cn=Wd(Ct.stretch-fe,U,lt,et),or=Hd(Ct.fixed-Ue,st,Ct.stretch,G),Ar=Wd(Vt.stretch-le,Me,ht,Ge),Zo=Hd(Vt.fixed-ee,_e,Vt.stretch,Z),uo=Wd(jt.stretch-fe,U,lt,et),br=Hd(jt.fixed-Ue,st,jt.stretch,G),bn=new he(At,Cn),pr=new he(Ar,Cn),wr=new he(Ar,uo),Tr=new he(At,uo),Qr=new he(Mi/x,or/x),Vo=new he(Zo/x,br/x),fr=t*Math.PI/180;if(fr){let mr=Math.sin(fr),gr=Math.cos(fr),Hn=[gr,-mr,mr,gr];bn._matMult(Hn),pr._matMult(Hn),Tr._matMult(Hn),wr._matMult(Hn)}let ho=it.stretch+it.fixed,ar=Ct.stretch+Ct.fixed;return{tl:bn,tr:pr,bl:Tr,br:wr,tex:{x:v.paddedRect.x+Dh+ho,y:v.paddedRect.y+Dh+ar,w:Vt.stretch+Vt.fixed-ho,h:jt.stretch+jt.fixed-ar},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Qr,pixelOffsetBR:Vo,minFontScaleX:_e/x/ht,minFontScaleY:st/x/lt,isSDF:r}};if(u&&(v.stretchX||v.stretchY)){let it=ky(z,K,Z),Ct=ky(D,ne,G);for(let Vt=0;Vt<it.length-1;Vt++){let jt=it[Vt],At=it[Vt+1];for(let Mi=0;Mi<Ct.length-1;Mi++)p.push(dt(jt,Ct[Mi],At,Ct[Mi+1]))}}else p.push(dt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:M+1}));return p}function qd(o,t,r){let u=0;for(let p of o)u+=Math.max(t,Math.min(r,p[1]))-Math.max(t,Math.min(r,p[0]));return u}function ky(o,t,r){let u=[{fixed:-1,stretch:0}];for(let[p,v]of o){let x=u[u.length-1];u.push({fixed:p-x.stretch,stretch:x.stretch}),u.push({fixed:p-x.stretch,stretch:x.stretch+(v-p)})}return u.push({fixed:t+Dh,stretch:r}),u}function Wd(o,t,r,u){return o/t*r+u}function Hd(o,t,r,u){return o-t*r/u}class Kd{constructor(t,r,u,p,v,x,w,M,I,z){var D;if(this.boxStartIndex=t.length,I){let $=x.top,Z=x.bottom,G=x.collisionPadding;G&&($-=G[1],Z+=G[3]);let K=Z-$;K>0&&(K=Math.max(10,K),this.circleDiameter=K)}else{let $=!((D=x.image)===null||D===void 0)&&D.content&&(x.image.textFitWidth||x.image.textFitHeight)?ny(x):{x1:x.left,y1:x.top,x2:x.right,y2:x.bottom};$.y1=$.y1*w-M[0],$.y2=$.y2*w+M[2],$.x1=$.x1*w-M[3],$.x2=$.x2*w+M[1];let Z=x.collisionPadding;if(Z&&($.x1-=Z[0]*w,$.y1-=Z[1]*w,$.x2+=Z[2]*w,$.y2+=Z[3]*w),z){let G=new he($.x1,$.y1),K=new he($.x2,$.y1),ne=new he($.x1,$.y2),le=new he($.x2,$.y2),Me=z*Math.PI/180;G._rotate(Me),K._rotate(Me),ne._rotate(Me),le._rotate(Me),$.x1=Math.min(G.x,K.x,ne.x,le.x),$.x2=Math.max(G.x,K.x,ne.x,le.x),$.y1=Math.min(G.y,K.y,ne.y,le.y),$.y2=Math.max(G.y,K.y,ne.y,le.y)}t.emplaceBack(r.x,r.y,$.x1,$.y1,$.x2,$.y2,u,p,v)}this.boxEndIndex=t.length}}class pw{constructor(t=[],r=(u,p)=>u<p?-1:u>p?1:0){if(this.data=t,this.length=this.data.length,this.compare=r,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;let t=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),t}peek(){return this.data[0]}_up(t){let{data:r,compare:u}=this,p=r[t];for(;t>0;){let v=t-1>>1,x=r[v];if(u(p,x)>=0)break;r[t]=x,t=v}r[t]=p}_down(t){let{data:r,compare:u}=this,p=this.length>>1,v=r[t];for(;t<p;){let x=1+(t<<1),w=x+1;if(w<this.length&&u(r[w],r[x])<0&&(x=w),u(r[x],v)>=0)break;r[t]=r[x],t=x}r[t]=v}}function fw(o,t=1,r=!1){let u=1/0,p=1/0,v=-1/0,x=-1/0,w=o[0];for(let Z=0;Z<w.length;Z++){let G=w[Z];(!Z||G.x<u)&&(u=G.x),(!Z||G.y<p)&&(p=G.y),(!Z||G.x>v)&&(v=G.x),(!Z||G.y>x)&&(x=G.y)}let M=Math.min(v-u,x-p),I=M/2,z=new pw([],mw);if(M===0)return new he(u,p);for(let Z=u;Z<v;Z+=M)for(let G=p;G<x;G+=M)z.push(new Iu(Z+I,G+I,I,o));let D=function(Z){let G=0,K=0,ne=0,le=Z[0];for(let Me=0,fe=le.length,U=fe-1;Me<fe;U=Me++){let ee=le[Me],_e=le[U],Ue=ee.x*_e.y-_e.x*ee.y;K+=(ee.x+_e.x)*Ue,ne+=(ee.y+_e.y)*Ue,G+=3*Ue}return new Iu(K/G,ne/G,0,Z)}(o),$=z.length;for(;z.length;){let Z=z.pop();(Z.d>D.d||!D.d)&&(D=Z,r&&console.log("found best %d after %d probes",Math.round(1e4*Z.d)/1e4,$)),Z.max-D.d<=t||(I=Z.h/2,z.push(new Iu(Z.p.x-I,Z.p.y-I,I,o)),z.push(new Iu(Z.p.x+I,Z.p.y-I,I,o)),z.push(new Iu(Z.p.x-I,Z.p.y+I,I,o)),z.push(new Iu(Z.p.x+I,Z.p.y+I,I,o)),$+=4)}return r&&(console.log(`num probes: ${$}`),console.log(`best distance: ${D.d}`)),D.p}function mw(o,t){return t.max-o.max}function Iu(o,t,r,u){this.p=new he(o,t),this.h=r,this.d=function(p,v){let x=!1,w=1/0;for(let M=0;M<v.length;M++){let I=v[M];for(let z=0,D=I.length,$=D-1;z<D;$=z++){let Z=I[z],G=I[$];Z.y>p.y!=G.y>p.y&&p.x<(G.x-Z.x)*(p.y-Z.y)/(G.y-Z.y)+Z.x&&(x=!x),w=Math.min(w,d_(p,Z,G))}}return(x?1:-1)*Math.sqrt(w)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}var Lr;f.aB=void 0,(Lr=f.aB||(f.aB={}))[Lr.center=1]="center",Lr[Lr.left=2]="left",Lr[Lr.right=3]="right",Lr[Lr.top=4]="top",Lr[Lr.bottom=5]="bottom",Lr[Lr["top-left"]=6]="top-left",Lr[Lr["top-right"]=7]="top-right",Lr[Lr["bottom-left"]=8]="bottom-left",Lr[Lr["bottom-right"]=9]="bottom-right";let Ol=7,nm=Number.POSITIVE_INFINITY;function zy(o,t){return t[1]!==nm?function(r,u,p){let v=0,x=0;switch(u=Math.abs(u),p=Math.abs(p),r){case"top-right":case"top-left":case"top":x=p-Ol;break;case"bottom-right":case"bottom-left":case"bottom":x=-p+Ol}switch(r){case"top-right":case"bottom-right":case"right":v=-u;break;case"top-left":case"bottom-left":case"left":v=u}return[v,x]}(o,t[0],t[1]):function(r,u){let p=0,v=0;u<0&&(u=0);let x=u/Math.SQRT2;switch(r){case"top-right":case"top-left":v=x-Ol;break;case"bottom-right":case"bottom-left":v=-x+Ol;break;case"bottom":v=-u+Ol;break;case"top":v=u-Ol}switch(r){case"top-right":case"bottom-right":p=-x;break;case"top-left":case"bottom-left":p=x;break;case"left":p=u;break;case"right":p=-u}return[p,v]}(o,t[0])}function Ry(o,t,r){var u;let p=o.layout,v=(u=p.get("text-variable-anchor-offset"))===null||u===void 0?void 0:u.evaluate(t,{},r);if(v){let w=v.values,M=[];for(let I=0;I<w.length;I+=2){let z=M[I]=w[I],D=w[I+1].map($=>$*rr);z.startsWith("top")?D[1]-=Ol:z.startsWith("bottom")&&(D[1]+=Ol),M[I+1]=D}return new lr(M)}let x=p.get("text-variable-anchor");if(x){let w;w=o._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[p.get("text-radial-offset").evaluate(t,{},r)*rr,nm]:p.get("text-offset").evaluate(t,{},r).map(I=>I*rr);let M=[];for(let I of x)M.push(I,zy(I,w));return new lr(M)}return null}function rm(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function gw(o,t,r,u,p,v,x,w,M,I,z,D){let $=v.textMaxSize.evaluate(t,{});$===void 0&&($=x);let Z=o.layers[0].layout,G=Z.get("icon-offset").evaluate(t,{},z),K=By(r.horizontal),ne=x/24,le=o.tilePixelRatio*ne,Me=o.tilePixelRatio*$/24,fe=o.tilePixelRatio*w,U=o.tilePixelRatio*Z.get("symbol-spacing"),ee=Z.get("text-padding")*o.tilePixelRatio,_e=function(Vt,jt,At,Mi=1){let Cn=Vt.get("icon-padding").evaluate(jt,{},At),or=Cn&&Cn.values;return[or[0]*Mi,or[1]*Mi,or[2]*Mi,or[3]*Mi]}(Z,t,z,o.tilePixelRatio),Ue=Z.get("text-max-angle")/180*Math.PI,st=Z.get("text-rotation-alignment")!=="viewport"&&Z.get("symbol-placement")!=="point",Ge=Z.get("icon-rotation-alignment")==="map"&&Z.get("symbol-placement")!=="point",et=Z.get("symbol-placement"),ht=U/2,lt=Z.get("icon-text-fit"),dt;u&&lt!=="none"&&(o.allowVerticalPlacement&&r.vertical&&(dt=ry(u,r.vertical,lt,Z.get("icon-text-fit-padding"),G,ne)),K&&(u=ry(u,K,lt,Z.get("icon-text-fit-padding"),G,ne)));let it=z?D.line.getGranularityForZoomLevel(z.z):1,Ct=(Vt,jt)=>{jt.x<0||jt.x>=ge||jt.y<0||jt.y>=ge||function(At,Mi,Cn,or,Ar,Zo,uo,br,bn,pr,wr,Tr,Qr,Vo,fr,ho,ar,mr,gr,Hn,cn,$a,Eu,Ua,vw){let Lu=At.addToLineVertexArray(Mi,Cn),Mc,Au,ku,zu,jy=0,$y=0,Uy=0,Zy=0,dm=-1,pm=-1,tl={},Vy=Na("");if(At.allowVerticalPlacement&&or.vertical){let Vr=br.layout.get("text-rotate").evaluate(cn,{},Ua)+90;ku=new Kd(bn,Mi,pr,wr,Tr,or.vertical,Qr,Vo,fr,Vr),uo&&(zu=new Kd(bn,Mi,pr,wr,Tr,uo,ar,mr,fr,Vr))}if(Ar){let Vr=br.layout.get("icon-rotate").evaluate(cn,{}),Go=br.layout.get("icon-text-fit")!=="none",Cc=Ay(Ar,Vr,Eu,Go),Va=uo?Ay(uo,Vr,Eu,Go):void 0;Au=new Kd(bn,Mi,pr,wr,Tr,Ar,ar,mr,!1,Vr),jy=4*Cc.length;let Ic=At.iconSizeData,Ss=null;Ic.kind==="source"?(Ss=[Ts*br.layout.get("icon-size").evaluate(cn,{})],Ss[0]>Rl&&Ri(`${At.layerIds[0]}: Value for "icon-size" is >= ${zh}. Reduce your "icon-size".`)):Ic.kind==="composite"&&(Ss=[Ts*$a.compositeIconSizes[0].evaluate(cn,{},Ua),Ts*$a.compositeIconSizes[1].evaluate(cn,{},Ua)],(Ss[0]>Rl||Ss[1]>Rl)&&Ri(`${At.layerIds[0]}: Value for "icon-size" is >= ${zh}. Reduce your "icon-size".`)),At.addSymbols(At.icon,Cc,Ss,Hn,gr,cn,f.al.none,Mi,Lu.lineStartIndex,Lu.lineLength,-1,Ua),dm=At.icon.placedSymbolArray.length-1,Va&&($y=4*Va.length,At.addSymbols(At.icon,Va,Ss,Hn,gr,cn,f.al.vertical,Mi,Lu.lineStartIndex,Lu.lineLength,-1,Ua),pm=At.icon.placedSymbolArray.length-1)}let Gy=Object.keys(or.horizontal);for(let Vr of Gy){let Go=or.horizontal[Vr];if(!Mc){Vy=Na(Go.text);let Va=br.layout.get("text-rotate").evaluate(cn,{},Ua);Mc=new Kd(bn,Mi,pr,wr,Tr,Go,Qr,Vo,fr,Va)}let Cc=Go.positionedLines.length===1;if(Uy+=Dy(At,Mi,Go,Zo,br,fr,cn,ho,Lu,or.vertical?f.al.horizontal:f.al.horizontalOnly,Cc?Gy:[Vr],tl,dm,$a,Ua),Cc)break}or.vertical&&(Zy+=Dy(At,Mi,or.vertical,Zo,br,fr,cn,ho,Lu,f.al.vertical,["vertical"],tl,pm,$a,Ua));let xw=Mc?Mc.boxStartIndex:At.collisionBoxArray.length,bw=Mc?Mc.boxEndIndex:At.collisionBoxArray.length,ww=ku?ku.boxStartIndex:At.collisionBoxArray.length,Tw=ku?ku.boxEndIndex:At.collisionBoxArray.length,Sw=Au?Au.boxStartIndex:At.collisionBoxArray.length,Pw=Au?Au.boxEndIndex:At.collisionBoxArray.length,Mw=zu?zu.boxStartIndex:At.collisionBoxArray.length,Cw=zu?zu.boxEndIndex:At.collisionBoxArray.length,Za=-1,Yd=(Vr,Go)=>Vr&&Vr.circleDiameter?Math.max(Vr.circleDiameter,Go):Go;Za=Yd(Mc,Za),Za=Yd(ku,Za),Za=Yd(Au,Za),Za=Yd(zu,Za);let qy=Za>-1?1:0;qy&&(Za*=vw/rr),At.glyphOffsetArray.length>=Mu.MAX_GLYPHS&&Ri("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),cn.sortKey!==void 0&&At.addToSortKeyRanges(At.symbolInstances.length,cn.sortKey);let Iw=Ry(br,cn,Ua),[Ew,Lw]=function(Vr,Go){let Cc=Vr.length,Va=Go?.values;if(Va?.length>0)for(let Ic=0;Ic<Va.length;Ic+=2){let Ss=Va[Ic+1];Vr.emplaceBack(f.aB[Va[Ic]],Ss[0],Ss[1])}return[Cc,Vr.length]}(At.textAnchorOffsets,Iw);At.symbolInstances.emplaceBack(Mi.x,Mi.y,tl.right>=0?tl.right:-1,tl.center>=0?tl.center:-1,tl.left>=0?tl.left:-1,tl.vertical||-1,dm,pm,Vy,xw,bw,ww,Tw,Sw,Pw,Mw,Cw,pr,Uy,Zy,jy,$y,qy,0,Qr,Za,Ew,Lw)}(o,jt,Vt,r,u,p,dt,o.layers[0],o.collisionBoxArray,t.index,t.sourceLayerIndex,o.index,le,[ee,ee,ee,ee],st,M,fe,_e,Ge,G,t,v,I,z,x)};if(et==="line")for(let Vt of Py(t.geometry,0,0,ge,ge)){let jt=Pc(Vt,it),At=dw(jt,U,Ue,r.vertical||K,u,24,Me,o.overscaling,ge);for(let Mi of At)K&&_w(o,K.text,ht,Mi)||Ct(jt,Mi)}else if(et==="line-center"){for(let Vt of t.geometry)if(Vt.length>1){let jt=Pc(Vt,it),At=hw(jt,Ue,r.vertical||K,u,24,Me);At&&Ct(jt,At)}}else if(t.type==="Polygon")for(let Vt of ka(t.geometry,0)){let jt=fw(Vt,16);Ct(Pc(Vt[0],it,!0),new Bl(jt.x,jt.y,0))}else if(t.type==="LineString")for(let Vt of t.geometry){let jt=Pc(Vt,it);Ct(jt,new Bl(jt[0].x,jt[0].y,0))}else if(t.type==="Point")for(let Vt of t.geometry)for(let jt of Vt)Ct([jt],new Bl(jt.x,jt.y,0))}function Dy(o,t,r,u,p,v,x,w,M,I,z,D,$,Z,G){let K=function(Me,fe,U,ee,_e,Ue,st,Ge){let et=ee.layout.get("text-rotate").evaluate(Ue,{})*Math.PI/180,ht=[];for(let lt of fe.positionedLines)for(let dt of lt.positionedGlyphs){if(!dt.rect)continue;let it=dt.rect||{},Ct=Vb+1,Vt=!0,jt=1,At=0,Mi=(_e||Ge)&&dt.vertical,Cn=dt.metrics.advance*dt.scale/2;if(Ge&&fe.verticalizable&&(At=lt.lineOffset/2-(dt.imageName?-(rr-dt.metrics.width*dt.scale)/2:(dt.scale-1)*rr)),dt.imageName){let mr=st[dt.imageName];Vt=mr.sdf,jt=mr.pixelRatio,Ct=co/jt}let or=_e?[dt.x+Cn,dt.y]:[0,0],Ar=_e?[0,0]:[dt.x+Cn+U[0],dt.y+U[1]-At],Zo=[0,0];Mi&&(Zo=Ar,Ar=[0,0]);let uo=dt.metrics.isDoubleResolution?2:1,br=(dt.metrics.left-Ct)*dt.scale-Cn+Ar[0],bn=(-dt.metrics.top-Ct)*dt.scale+Ar[1],pr=br+it.w/uo*dt.scale/jt,wr=bn+it.h/uo*dt.scale/jt,Tr=new he(br,bn),Qr=new he(pr,bn),Vo=new he(br,wr),fr=new he(pr,wr);if(Mi){let mr=new he(-Cn,Cn-$d),gr=-Math.PI/2,Hn=rr/2-Cn,cn=new he(5-$d-Hn,-(dt.imageName?Hn:0)),$a=new he(...Zo);Tr._rotateAround(gr,mr)._add(cn)._add($a),Qr._rotateAround(gr,mr)._add(cn)._add($a),Vo._rotateAround(gr,mr)._add(cn)._add($a),fr._rotateAround(gr,mr)._add(cn)._add($a)}if(et){let mr=Math.sin(et),gr=Math.cos(et),Hn=[gr,-mr,mr,gr];Tr._matMult(Hn),Qr._matMult(Hn),Vo._matMult(Hn),fr._matMult(Hn)}let ho=new he(0,0),ar=new he(0,0);ht.push({tl:Tr,tr:Qr,bl:Vo,br:fr,tex:it,writingMode:fe.writingMode,glyphOffset:or,sectionIndex:dt.sectionIndex,isSDF:Vt,pixelOffsetTL:ho,pixelOffsetBR:ar,minFontScaleX:0,minFontScaleY:0})}return ht}(0,r,w,p,v,x,u,o.allowVerticalPlacement),ne=o.textSizeData,le=null;ne.kind==="source"?(le=[Ts*p.layout.get("text-size").evaluate(x,{})],le[0]>Rl&&Ri(`${o.layerIds[0]}: Value for "text-size" is >= ${zh}. Reduce your "text-size".`)):ne.kind==="composite"&&(le=[Ts*Z.compositeTextSizes[0].evaluate(x,{},G),Ts*Z.compositeTextSizes[1].evaluate(x,{},G)],(le[0]>Rl||le[1]>Rl)&&Ri(`${o.layerIds[0]}: Value for "text-size" is >= ${zh}. Reduce your "text-size".`)),o.addSymbols(o.text,K,le,w,v,x,I,t,M.lineStartIndex,M.lineLength,$,G);for(let Me of z)D[Me]=o.text.placedSymbolArray.length-1;return 4*K.length}function By(o){for(let t in o)return o[t];return null}function _w(o,t,r,u){let p=o.compareText;if(t in p){let v=p[t];for(let x=v.length-1;x>=0;x--)if(u.dist(v[x])<r)return!0}else p[t]=[];return p[t].push(u),!1}let Oy=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class om{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[r,u]=new Uint8Array(t,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");let p=u>>4;if(p!==1)throw new Error(`Got v${p} data when expected v1.`);let v=Oy[15&u];if(!v)throw new Error("Unrecognized array type.");let[x]=new Uint16Array(t,2,1),[w]=new Uint32Array(t,4,1);return new om(w,x,v,t)}constructor(t,r=64,u=Float64Array,p){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=u,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;let v=Oy.indexOf(this.ArrayType),x=2*t*this.ArrayType.BYTES_PER_ELEMENT,w=t*this.IndexArrayType.BYTES_PER_ELEMENT,M=(8-w%8)%8;if(v<0)throw new Error(`Unexpected typed array class: ${u}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+w+M,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+x+w+M),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+w+M,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+v]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=t)}add(t,r){let u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=t,this.coords[this._pos++]=r,u}finish(){let t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return am(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,r,u,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:v,coords:x,nodeSize:w}=this,M=[0,v.length-1,0],I=[];for(;M.length;){let z=M.pop()||0,D=M.pop()||0,$=M.pop()||0;if(D-$<=w){for(let ne=$;ne<=D;ne++){let le=x[2*ne],Me=x[2*ne+1];le>=t&&le<=u&&Me>=r&&Me<=p&&I.push(v[ne])}continue}let Z=$+D>>1,G=x[2*Z],K=x[2*Z+1];G>=t&&G<=u&&K>=r&&K<=p&&I.push(v[Z]),(z===0?t<=G:r<=K)&&(M.push($),M.push(Z-1),M.push(1-z)),(z===0?u>=G:p>=K)&&(M.push(Z+1),M.push(D),M.push(1-z))}return I}within(t,r,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:p,coords:v,nodeSize:x}=this,w=[0,p.length-1,0],M=[],I=u*u;for(;w.length;){let z=w.pop()||0,D=w.pop()||0,$=w.pop()||0;if(D-$<=x){for(let ne=$;ne<=D;ne++)Ny(v[2*ne],v[2*ne+1],t,r)<=I&&M.push(p[ne]);continue}let Z=$+D>>1,G=v[2*Z],K=v[2*Z+1];Ny(G,K,t,r)<=I&&M.push(p[Z]),(z===0?t-u<=G:r-u<=K)&&(w.push($),w.push(Z-1),w.push(1-z)),(z===0?t+u>=G:r+u>=K)&&(w.push(Z+1),w.push(D),w.push(1-z))}return M}}function am(o,t,r,u,p,v){if(p-u<=r)return;let x=u+p>>1;Fy(o,t,x,u,p,v),am(o,t,r,u,x-1,1-v),am(o,t,r,x+1,p,1-v)}function Fy(o,t,r,u,p,v){for(;p>u;){if(p-u>600){let I=p-u+1,z=r-u+1,D=Math.log(I),$=.5*Math.exp(2*D/3),Z=.5*Math.sqrt(D*$*(I-$)/I)*(z-I/2<0?-1:1);Fy(o,t,r,Math.max(u,Math.floor(r-z*$/I+Z)),Math.min(p,Math.floor(r+(I-z)*$/I+Z)),v)}let x=t[2*r+v],w=u,M=p;for(Bh(o,t,u,r),t[2*p+v]>x&&Bh(o,t,u,p);w<M;){for(Bh(o,t,w,M),w++,M--;t[2*w+v]<x;)w++;for(;t[2*M+v]>x;)M--}t[2*u+v]===x?Bh(o,t,u,M):(M++,Bh(o,t,M,p)),M<=r&&(u=M+1),r<=M&&(p=M-1)}}function Bh(o,t,r,u){sm(o,r,u),sm(t,2*r,2*u),sm(t,2*r+1,2*u+1)}function sm(o,t,r){let u=o[t];o[t]=o[r],o[r]=u}function Ny(o,t,r,u){let p=o-r,v=t-u;return p*p+v*v}var lm;f.co=void 0,(lm=f.co||(f.co={})).create="create",lm.load="load",lm.fullLoad="fullLoad";let Xd=null,Oh=[],cm=1e3/60,um="loadTime",hm="fullLoadTime",yw={mark(o){performance.mark(o)},frame(o){let t=o;Xd!=null&&Oh.push(t-Xd),Xd=t},clearMetrics(){Xd=null,Oh=[],performance.clearMeasures(um),performance.clearMeasures(hm);for(let o in f.co)performance.clearMarks(f.co[o])},getPerformanceMetrics(){performance.measure(um,f.co.create,f.co.load),performance.measure(hm,f.co.create,f.co.fullLoad);let o=performance.getEntriesByName(um)[0].duration,t=performance.getEntriesByName(hm)[0].duration,r=Oh.length,u=1/(Oh.reduce((v,x)=>v+x,0)/r/1e3),p=Oh.filter(v=>v>cm).reduce((v,x)=>v+(x-cm)/cm,0);return{loadTime:o,fullLoadTime:t,fps:u,percentDroppedFrames:p/(r+p)*100,totalFrames:r}}};f.$=Rh,f.A=pt,f.B=tr,f.C=sn,f.D=Rt,f.E=Te,f.F=_f,f.G=function(o){if(Zi==null){let t=o.navigator?o.navigator.userAgent:null;Zi=!!o.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Zi},f.H=class{constructor(o,t){this.target=o,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new lw(()=>this.process()),this.subscription=mo(this.target,"message",r=>this.receive(r),!1),this.globalScope=Ui(self)?o:window}registerMessageHandler(o,t){this.messageHandlers[o]=t}sendAsync(o,t){return new Promise((r,u)=>{let p=Math.round(1e18*Math.random()).toString(36).substring(0,10),v=t?mo(t.signal,"abort",()=>{v?.unsubscribe(),delete this.resolveRejects[p];let M={id:p,type:"<cancel>",origin:location.origin,targetMapId:o.targetMapId,sourceMapId:this.mapId};this.target.postMessage(M)},cw):null;this.resolveRejects[p]={resolve:M=>{v?.unsubscribe(),r(M)},reject:M=>{v?.unsubscribe(),u(M)}};let x=[],w=Object.assign(Object.assign({},o),{id:p,sourceMapId:this.mapId,origin:location.origin,data:Ll(o.data,x)});this.target.postMessage(w,{transfer:x})})}receive(o){let t=o.data,r=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[r];let u=this.abortControllers[r];return delete this.abortControllers[r],void(u&&u.abort())}if(Ui(self)||t.mustQueue)return this.tasks[r]=t,this.taskQueue.push(r),void this.invoker.trigger();this.processTask(r,t)}}process(){if(this.taskQueue.length===0)return;let o=this.taskQueue.shift(),t=this.tasks[o];delete this.tasks[o],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(o,t)}processTask(o,t){return a(this,void 0,void 0,function*(){if(t.type==="<response>"){let p=this.resolveRejects[o];return delete this.resolveRejects[o],p?void(t.error?p.reject(pc(t.error)):p.resolve(pc(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(o,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));let r=pc(t.data),u=new AbortController;this.abortControllers[o]=u;try{let p=yield this.messageHandlers[t.type](t.sourceMapId,r,u);this.completeTask(o,null,p)}catch(p){this.completeTask(o,p)}})}completeTask(o,t,r){let u=[];delete this.abortControllers[o];let p={id:o,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?Ll(t):null,data:Ll(r,u)};this.target.postMessage(p,{transfer:u})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},f.I=qf,f.J=Ti,f.K=function(){var o=new pt(16);return pt!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},f.L=function(o,t,r){var u,p,v,x,w,M,I,z,D,$,Z,G,K=r[0],ne=r[1],le=r[2];return t===o?(o[12]=t[0]*K+t[4]*ne+t[8]*le+t[12],o[13]=t[1]*K+t[5]*ne+t[9]*le+t[13],o[14]=t[2]*K+t[6]*ne+t[10]*le+t[14],o[15]=t[3]*K+t[7]*ne+t[11]*le+t[15]):(p=t[1],v=t[2],x=t[3],w=t[4],M=t[5],I=t[6],z=t[7],D=t[8],$=t[9],Z=t[10],G=t[11],o[0]=u=t[0],o[1]=p,o[2]=v,o[3]=x,o[4]=w,o[5]=M,o[6]=I,o[7]=z,o[8]=D,o[9]=$,o[10]=Z,o[11]=G,o[12]=u*K+w*ne+D*le+t[12],o[13]=p*K+M*ne+$*le+t[13],o[14]=v*K+I*ne+Z*le+t[14],o[15]=x*K+z*ne+G*le+t[15]),o},f.M=function(o,t,r){var u=r[0],p=r[1],v=r[2];return o[0]=t[0]*u,o[1]=t[1]*u,o[2]=t[2]*u,o[3]=t[3]*u,o[4]=t[4]*p,o[5]=t[5]*p,o[6]=t[6]*p,o[7]=t[7]*p,o[8]=t[8]*v,o[9]=t[9]*v,o[10]=t[10]*v,o[11]=t[11]*v,o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15],o},f.N=function(o,t,r){var u=t[0],p=t[1],v=t[2],x=t[3],w=t[4],M=t[5],I=t[6],z=t[7],D=t[8],$=t[9],Z=t[10],G=t[11],K=t[12],ne=t[13],le=t[14],Me=t[15],fe=r[0],U=r[1],ee=r[2],_e=r[3];return o[0]=fe*u+U*w+ee*D+_e*K,o[1]=fe*p+U*M+ee*$+_e*ne,o[2]=fe*v+U*I+ee*Z+_e*le,o[3]=fe*x+U*z+ee*G+_e*Me,o[4]=(fe=r[4])*u+(U=r[5])*w+(ee=r[6])*D+(_e=r[7])*K,o[5]=fe*p+U*M+ee*$+_e*ne,o[6]=fe*v+U*I+ee*Z+_e*le,o[7]=fe*x+U*z+ee*G+_e*Me,o[8]=(fe=r[8])*u+(U=r[9])*w+(ee=r[10])*D+(_e=r[11])*K,o[9]=fe*p+U*M+ee*$+_e*ne,o[10]=fe*v+U*I+ee*Z+_e*le,o[11]=fe*x+U*z+ee*G+_e*Me,o[12]=(fe=r[12])*u+(U=r[13])*w+(ee=r[14])*D+(_e=r[15])*K,o[13]=fe*p+U*M+ee*$+_e*ne,o[14]=fe*v+U*I+ee*Z+_e*le,o[15]=fe*x+U*z+ee*G+_e*Me,o},f.O=function(o,t){let r={};for(let u=0;u<t.length;u++){let p=t[u];p in o&&(r[p]=o[p])}return r},f.P=he,f.Q=Dl,f.R=$o,f.S=fy,f.T=Id,f.U=py,f.V=Ve,f.W=Se,f.X=Io,f.Y=Uo,f.Z=ge,f._=a,f.a=qr,f.a$=function(o,t,r){var u=Math.sin(r),p=Math.cos(r),v=t[4],x=t[5],w=t[6],M=t[7],I=t[8],z=t[9],D=t[10],$=t[11];return t!==o&&(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15]),o[4]=v*p+I*u,o[5]=x*p+z*u,o[6]=w*p+D*u,o[7]=M*p+$*u,o[8]=I*p-v*u,o[9]=z*p-x*u,o[10]=D*p-w*u,o[11]=$*p-M*u,o},f.a0=25,f.a1=im,f.a2=o=>{let t=window.document.createElement("video");return t.muted=!0,new Promise(r=>{t.onloadstart=()=>{r(t)};for(let u of o){let p=window.document.createElement("source");Re(u)||(t.crossOrigin="Anonymous"),p.src=u,t.appendChild(p)}})},f.a3=Ye,f.a4=function(){return Qt++},f.a5=se,f.a6=Mu,f.a7=xe,f.a8=wc,f.a9=by,f.aA=function(o,t,r,u,p=!1){if(!r[0]&&!r[1])return[0,0];let v=p?u==="map"?-o.bearingInRadians:0:u==="viewport"?o.bearingInRadians:0;if(v){let x=Math.sin(v),w=Math.cos(v);r=[r[0]*w-r[1]*x,r[0]*x+r[1]*w]}return[p?r[0]:Fe(t,r[0],o.zoom),p?r[1]:Fe(t,r[1],o.zoom)]},f.aC=Kf,f.aD=rm,f.aE=Hf,f.aF=om,f.aG=_n,f.aH=Fd,f.aI=Qe,f.aJ=Oi,f.aK=Bi,f.aL=zt,f.aM=no,f.aN=gy,f.aO=function(o,t,r){return o[0]=t[0]*r,o[1]=t[1]*r,o[2]=t[2]*r,o},f.aP=function(o,t,r){return o[0]=t[0]+r[0],o[1]=t[1]+r[1],o[2]=t[2]+r[2],o},f.aQ=function(o){var t=new pt(3);return t[0]=o[0],t[1]=o[1],t[2]=o[2],t},f.aR=function(o,t,r){return o[0]=t[0]*r[0],o[1]=t[1]*r[1],o[2]=t[2]*r[2],o[3]=t[3]*r[3],o},f.aS=function(o,t,r){return o[0]=t[0]-r[0],o[1]=t[1]-r[1],o[2]=t[2]-r[2],o},f.aT=function(o,t){var r=t[0],u=t[1],p=t[2],v=r*r+u*u+p*p;return v>0&&(v=1/Math.sqrt(v)),o[0]=t[0]*v,o[1]=t[1]*v,o[2]=t[2]*v,o},f.aU=function(o,t,r){var u=t[0],p=t[1],v=t[2],x=r[0],w=r[1],M=r[2];return o[0]=p*M-v*w,o[1]=v*x-u*M,o[2]=u*w-p*x,o},f.aV=function(o,t){return o[0]*t[0]+o[1]*t[1]+o[2]*t[2]},f.aW=yy,f.aX=Cu,f.aY=function(o,t,r,u,p){var v,x=1/Math.tan(t/2);return o[0]=x/r,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=x,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,p!=null&&p!==1/0?(o[10]=(p+u)*(v=1/(u-p)),o[14]=2*p*u*v):(o[10]=-1,o[14]=-2*u),o},f.aZ=function(o){var t=new pt(16);return t[0]=o[0],t[1]=o[1],t[2]=o[2],t[3]=o[3],t[4]=o[4],t[5]=o[5],t[6]=o[6],t[7]=o[7],t[8]=o[8],t[9]=o[9],t[10]=o[10],t[11]=o[11],t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15],t},f.a_=function(o,t,r){var u=Math.sin(r),p=Math.cos(r),v=t[0],x=t[1],w=t[2],M=t[3],I=t[4],z=t[5],D=t[6],$=t[7];return t!==o&&(o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15]),o[0]=v*p+I*u,o[1]=x*p+z*u,o[2]=w*p+D*u,o[3]=M*p+$*u,o[4]=I*p-v*u,o[5]=z*p-x*u,o[6]=D*p-w*u,o[7]=$*p-M*u,o},f.aa=function(o){let t={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,u,p,v)=>{let x=p||v;return t[u]=!x||x.toLowerCase(),""}),t["max-age"]){let r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t},f.ab=io,f.ac=function(o){return Math.pow(2,o)},f.ad=kt,f.ae=St,f.af=85.051129,f.ag=my,f.ah=function(o){return Math.log(o)/Math.LN2},f.ai=function(o){var t=o[0],r=o[1];return t*t+r*r},f.aj=function(o,t){let r=[];for(let u in o)u in t||r.push(u);return r},f.ak=function(o,t){let r=0,u=0;if(o.kind==="constant")u=o.layoutSize;else if(o.kind!=="source"){let{interpolationType:p,minZoom:v,maxZoom:x}=o,w=p?St(hr.interpolationFactor(p,t,v,x),0,1):0;o.kind==="camera"?u=tr.number(o.minSize,o.maxSize,w):r=w}return{uSizeT:r,uSize:u}},f.am=function(o,{uSize:t,uSizeT:r},{lowerSize:u,upperSize:p}){return o.kind==="source"?u/Ts:o.kind==="composite"?tr.number(u/Ts,p/Ts,r):t},f.an=function(o,t){var r=t[0],u=t[1],p=t[2],v=t[3],x=t[4],w=t[5],M=t[6],I=t[7],z=t[8],D=t[9],$=t[10],Z=t[11],G=t[12],K=t[13],ne=t[14],le=t[15],Me=r*w-u*x,fe=r*M-p*x,U=r*I-v*x,ee=u*M-p*w,_e=u*I-v*w,Ue=p*I-v*M,st=z*K-D*G,Ge=z*ne-$*G,et=z*le-Z*G,ht=D*ne-$*K,lt=D*le-Z*K,dt=$*le-Z*ne,it=Me*dt-fe*lt+U*ht+ee*et-_e*Ge+Ue*st;return it?(o[0]=(w*dt-M*lt+I*ht)*(it=1/it),o[1]=(p*lt-u*dt-v*ht)*it,o[2]=(K*Ue-ne*_e+le*ee)*it,o[3]=($*_e-D*Ue-Z*ee)*it,o[4]=(M*et-x*dt-I*Ge)*it,o[5]=(r*dt-p*et+v*Ge)*it,o[6]=(ne*U-G*Ue-le*fe)*it,o[7]=(z*Ue-$*U+Z*fe)*it,o[8]=(x*lt-w*et+I*st)*it,o[9]=(u*et-r*lt-v*st)*it,o[10]=(G*_e-K*U+le*Me)*it,o[11]=(D*U-z*_e-Z*Me)*it,o[12]=(w*Ge-x*ht-M*st)*it,o[13]=(r*ht-u*Ge+p*st)*it,o[14]=(K*fe-G*ee-ne*Me)*it,o[15]=(z*ee-D*fe+$*Me)*it,o):null},f.ao=Ae,f.ap=function(o){return Math.hypot(o[0],o[1])},f.aq=function(o){return o[0]=0,o[1]=0,o},f.ar=function(o,t,r){return o[0]=t[0]*r,o[1]=t[1]*r,o},f.as=Xf,f.at=de,f.au=function(o,t,r,u){let p=t.y-o.y,v=t.x-o.x,x=u.y-r.y,w=u.x-r.x,M=x*v-w*p;if(M===0)return null;let I=(w*(o.y-r.y)-x*(o.x-r.x))/M;return new he(o.x+I*v,o.y+I*p)},f.av=Py,f.aw=u_,f.ax=function(o){let t=1/0,r=1/0,u=-1/0,p=-1/0;for(let v of o)t=Math.min(t,v.x),r=Math.min(r,v.y),u=Math.max(u,v.x),p=Math.max(p,v.y);return[t,r,u,p]},f.ay=rr,f.az=Fe,f.b=ui,f.b$=class extends H{},f.b0=function(){let o=new Float32Array(16);return kt(o),o},f.b1=function(){let o=new Float64Array(16);return kt(o),o},f.b2=function(){return new Float64Array(16)},f.b3=function(o,t,r){let u=new Float64Array(4);return function(p,v,x,w){var M=.5*Math.PI/180;v*=M,x*=M,w*=M;var I=Math.sin(v),z=Math.cos(v),D=Math.sin(x),$=Math.cos(x),Z=Math.sin(w),G=Math.cos(w);p[0]=I*$*G-z*D*Z,p[1]=z*D*G+I*$*Z,p[2]=z*$*Z-I*D*G,p[3]=z*$*G+I*D*Z}(u,o,t-90,r),u},f.b4=function(o,t,r,u){var p,v,x,w,M,I=t[0],z=t[1],D=t[2],$=t[3],Z=r[0],G=r[1],K=r[2],ne=r[3];return(v=I*Z+z*G+D*K+$*ne)<0&&(v=-v,Z=-Z,G=-G,K=-K,ne=-ne),1-v>nt?(p=Math.acos(v),x=Math.sin(p),w=Math.sin((1-u)*p)/x,M=Math.sin(u*p)/x):(w=1-u,M=u),o[0]=w*I+M*Z,o[1]=w*z+M*G,o[2]=w*D+M*K,o[3]=w*$+M*ne,o},f.b5=function(o){let t=new Float64Array(9);var r,u,p,v,x,w,M,I,z,D,$,Z,G,K,ne,le,Me,fe;D=(p=(u=o)[0])*(M=p+p),$=(v=u[1])*M,G=(x=u[2])*M,K=x*(I=v+v),le=(w=u[3])*M,Me=w*I,fe=w*(z=x+x),(r=t)[0]=1-(Z=v*I)-(ne=x*z),r[3]=$-fe,r[6]=G+Me,r[1]=$+fe,r[4]=1-D-ne,r[7]=K-le,r[2]=G-Me,r[5]=K+le,r[8]=1-D-Z;let U=no(-Math.asin(St(t[2],-1,1))),ee,_e;return Math.hypot(t[5],t[8])<.001?(ee=0,_e=-no(Math.atan2(t[3],t[4]))):(ee=no(t[5]===0&&t[8]===0?0:Math.atan2(t[5],t[8])),_e=no(t[1]===0&&t[0]===0?0:Math.atan2(t[1],t[0]))),{roll:ee,pitch:U+90,bearing:_e}},f.b6=function(o,t){return o.roll==t.roll&&o.pitch==t.pitch&&o.bearing==t.bearing},f.b7=di,f.b8=xu,f.b9=Su,f.bA=function(o){if(o.type==="custom")return new sw(o);switch(o.type){case"background":return new rw(o);case"circle":return new Qx(o);case"fill":return new yb(o);case"fill-extrusion":return new Mb(o);case"heatmap":return new tb(o);case"hillshade":return new nb(o);case"line":return new Rb(o);case"raster":return new aw(o);case"symbol":return new Gd(o)}},f.bB=hn,f.bC=function(o,t){if(!o)return[{command:"setStyle",args:[t]}];let r=[];try{if(!Be(o.version,t.version))return[{command:"setStyle",args:[t]}];Be(o.center,t.center)||r.push({command:"setCenter",args:[t.center]}),Be(o.state,t.state)||r.push({command:"setGlobalState",args:[t.state]}),Be(o.centerAltitude,t.centerAltitude)||r.push({command:"setCenterAltitude",args:[t.centerAltitude]}),Be(o.zoom,t.zoom)||r.push({command:"setZoom",args:[t.zoom]}),Be(o.bearing,t.bearing)||r.push({command:"setBearing",args:[t.bearing]}),Be(o.pitch,t.pitch)||r.push({command:"setPitch",args:[t.pitch]}),Be(o.roll,t.roll)||r.push({command:"setRoll",args:[t.roll]}),Be(o.sprite,t.sprite)||r.push({command:"setSprite",args:[t.sprite]}),Be(o.glyphs,t.glyphs)||r.push({command:"setGlyphs",args:[t.glyphs]}),Be(o.transition,t.transition)||r.push({command:"setTransition",args:[t.transition]}),Be(o.light,t.light)||r.push({command:"setLight",args:[t.light]}),Be(o.terrain,t.terrain)||r.push({command:"setTerrain",args:[t.terrain]}),Be(o.sky,t.sky)||r.push({command:"setSky",args:[t.sky]}),Be(o.projection,t.projection)||r.push({command:"setProjection",args:[t.projection]});let u={},p=[];(function(x,w,M,I){let z;for(z in w=w||{},x=x||{})Object.prototype.hasOwnProperty.call(x,z)&&(Object.prototype.hasOwnProperty.call(w,z)||at(z,M,I));for(z in w)Object.prototype.hasOwnProperty.call(w,z)&&(Object.prototype.hasOwnProperty.call(x,z)?Be(x[z],w[z])||(x[z].type==="geojson"&&w[z].type==="geojson"&&yt(x,w,z)?Ze(M,{command:"setGeoJSONSourceData",args:[z,w[z].data]}):mt(z,w,M,I)):De(z,w,M))})(o.sources,t.sources,p,u);let v=[];o.layers&&o.layers.forEach(x=>{"source"in x&&u[x.source]?r.push({command:"removeLayer",args:[x.id]}):v.push(x)}),r=r.concat(p),function(x,w,M){w=w||[];let I=(x=x||[]).map(Yt),z=w.map(Yt),D=x.reduce(Gt,{}),$=w.reduce(Gt,{}),Z=I.slice(),G=Object.create(null),K,ne,le,Me,fe;for(let U=0,ee=0;U<I.length;U++)K=I[U],Object.prototype.hasOwnProperty.call($,K)?ee++:(Ze(M,{command:"removeLayer",args:[K]}),Z.splice(Z.indexOf(K,ee),1));for(let U=0,ee=0;U<z.length;U++)K=z[z.length-1-U],Z[Z.length-1-U]!==K&&(Object.prototype.hasOwnProperty.call(D,K)?(Ze(M,{command:"removeLayer",args:[K]}),Z.splice(Z.lastIndexOf(K,Z.length-ee),1)):ee++,Me=Z[Z.length-U],Ze(M,{command:"addLayer",args:[$[K],Me]}),Z.splice(Z.length-U,0,K),G[K]=!0);for(let U=0;U<z.length;U++)if(K=z[U],ne=D[K],le=$[K],!G[K]&&!Be(ne,le))if(Be(ne.source,le.source)&&Be(ne["source-layer"],le["source-layer"])&&Be(ne.type,le.type)){for(fe in Dt(ne.layout,le.layout,M,K,null,"setLayoutProperty"),Dt(ne.paint,le.paint,M,K,null,"setPaintProperty"),Be(ne.filter,le.filter)||Ze(M,{command:"setFilter",args:[K,le.filter]}),Be(ne.minzoom,le.minzoom)&&Be(ne.maxzoom,le.maxzoom)||Ze(M,{command:"setLayerZoomRange",args:[K,le.minzoom,le.maxzoom]}),ne)Object.prototype.hasOwnProperty.call(ne,fe)&&fe!=="layout"&&fe!=="paint"&&fe!=="filter"&&fe!=="metadata"&&fe!=="minzoom"&&fe!=="maxzoom"&&(fe.indexOf("paint.")===0?Dt(ne[fe],le[fe],M,K,fe.slice(6),"setPaintProperty"):Be(ne[fe],le[fe])||Ze(M,{command:"setLayerProperty",args:[K,fe,le[fe]]}));for(fe in le)Object.prototype.hasOwnProperty.call(le,fe)&&!Object.prototype.hasOwnProperty.call(ne,fe)&&fe!=="layout"&&fe!=="paint"&&fe!=="filter"&&fe!=="metadata"&&fe!=="minzoom"&&fe!=="maxzoom"&&(fe.indexOf("paint.")===0?Dt(ne[fe],le[fe],M,K,fe.slice(6),"setPaintProperty"):Be(ne[fe],le[fe])||Ze(M,{command:"setLayerProperty",args:[K,fe,le[fe]]}))}else Ze(M,{command:"removeLayer",args:[K]}),Me=Z[Z.lastIndexOf(K)+1],Ze(M,{command:"addLayer",args:[le,Me]})}(v,t.layers,r)}catch(u){console.warn("Unable to compute style diff:",u),r=[{command:"setStyle",args:[t]}]}return r},f.bD=function(o){let t=[],r=o.id;return r===void 0&&t.push({message:`layers.${r}: missing required property "id"`}),o.render===void 0&&t.push({message:`layers.${r}: missing required method "render"`}),o.renderingMode&&o.renderingMode!=="2d"&&o.renderingMode!=="3d"&&t.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),t},f.bE=function o(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(let u=0;u<t.length;u++)if(!o(t[u],r[u]))return!1;return!0}if(typeof t=="object"&&t!==null&&r!==null){if(typeof r!="object"||Object.keys(t).length!==Object.keys(r).length)return!1;for(let u in t)if(!o(t[u],r[u]))return!1;return!0}return t===r},f.bF=Vi,f.bG=Jn,f.bH=class extends ln{constructor(o,t){super(o,t),this.current=0}set(o){this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}},f.bI=zd,f.bJ=class extends ln{constructor(o,t){super(o,t),this.current=Tf}set(o){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let t=1;t<16;t++)if(o[t]!==this.current[t]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}},f.bK=kd,f.bL=class extends ln{constructor(o,t){super(o,t),this.current=[0,0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2]))}},f.bM=class extends ln{constructor(o,t){super(o,t),this.current=[0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1]))}},f.bN=Pt,f.bO=function(o,t){var r=Math.sin(t),u=Math.cos(t);return o[0]=u,o[1]=r,o[2]=0,o[3]=-r,o[4]=u,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},f.bP=function(o,t,r){var u=t[0],p=t[1],v=t[2];return o[0]=u*r[0]+p*r[3]+v*r[6],o[1]=u*r[1]+p*r[4]+v*r[7],o[2]=u*r[2]+p*r[5]+v*r[8],o},f.bQ=function(o,t,r,u,p,v,x){var w=1/(t-r),M=1/(u-p),I=1/(v-x);return o[0]=-2*w,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*M,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*I,o[11]=0,o[12]=(t+r)*w,o[13]=(p+u)*M,o[14]=(x+v)*I,o[15]=1,o},f.bR=class extends ln{constructor(o,t){super(o,t),this.current=new Array}set(o){if(o!=this.current){this.current=o;let t=new Float32Array(4*o.length);for(let r=0;r<o.length;r++)t[4*r]=o[r].r,t[4*r+1]=o[r].g,t[4*r+2]=o[r].b,t[4*r+3]=o[r].a;this.gl.uniform4fv(this.location,t)}}},f.bS=class extends ln{constructor(o,t){super(o,t),this.current=new Array}set(o){if(o!=this.current){this.current=o;let t=new Float32Array(o);this.gl.uniform1fv(this.location,t)}}},f.bT=class extends y{},f.bU=Fb,f.bV=class extends S{},f.bW=Lf,f.bX=function(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))},f.bY=x_,f.bZ=function(o,t,r){var u=t[0],p=t[1],v=t[2],x=r[3]*u+r[7]*p+r[11]*v+r[15];return o[0]=(r[0]*u+r[4]*p+r[8]*v+r[12])/(x=x||1),o[1]=(r[1]*u+r[5]*p+r[9]*v+r[13])/x,o[2]=(r[2]*u+r[6]*p+r[10]*v+r[14])/x,o},f.b_=class extends Js{},f.ba=Mh,f.bb=Tu,f.bc=qe,f.bd=xt,f.be=cr,f.bf=function(o,t,r,u,p){return qe(u,p,St((o-t)/(r-t),0,1))},f.bg=Ee,f.bh=function(){return new Float64Array(3)},f.bi=function(o,t,r,u){return o[0]=t[0]+r[0]*u,o[1]=t[1]+r[1]*u,o[2]=t[2]+r[2]*u,o},f.bj=Ie,f.bk=function(){return new Float64Array(4)},f.bl=function(o,t,r,u){var p=[],v=[];return p[0]=t[0]-r[0],p[1]=t[1]-r[1],p[2]=t[2]-r[2],v[0]=p[0]*Math.cos(u)-p[1]*Math.sin(u),v[1]=p[0]*Math.sin(u)+p[1]*Math.cos(u),v[2]=p[2],o[0]=v[0]+r[0],o[1]=v[1]+r[1],o[2]=v[2]+r[2],o},f.bm=function(o,t,r,u){var p=[],v=[];return p[0]=t[0]-r[0],p[1]=t[1]-r[1],p[2]=t[2]-r[2],v[0]=p[0],v[1]=p[1]*Math.cos(u)-p[2]*Math.sin(u),v[2]=p[1]*Math.sin(u)+p[2]*Math.cos(u),o[0]=v[0]+r[0],o[1]=v[1]+r[1],o[2]=v[2]+r[2],o},f.bn=function(o,t,r,u){var p=[],v=[];return p[0]=t[0]-r[0],p[1]=t[1]-r[1],p[2]=t[2]-r[2],v[0]=p[2]*Math.sin(u)+p[0]*Math.cos(u),v[1]=p[1],v[2]=p[2]*Math.cos(u)-p[0]*Math.sin(u),o[0]=v[0]+r[0],o[1]=v[1]+r[1],o[2]=v[2]+r[2],o},f.bo=Q,f.bp=function(o,t,r){var u=Math.sin(r),p=Math.cos(r),v=t[0],x=t[1],w=t[2],M=t[3],I=t[8],z=t[9],D=t[10],$=t[11];return t!==o&&(o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15]),o[0]=v*p-I*u,o[1]=x*p-z*u,o[2]=w*p-D*u,o[3]=M*p-$*u,o[8]=v*u+I*p,o[9]=x*u+z*p,o[10]=w*u+D*p,o[11]=M*u+$*p,o},f.bq=function(o,t){let r=Ee(o,360),u=Ee(t,360),p=u-r,v=u>r?p-360:p+360;return Math.abs(p)<Math.abs(v)?p:v},f.br=function(o){return o[0]=0,o[1]=0,o[2]=0,o},f.bs=function(o,t,r,u){let p=Math.sqrt(o*o+t*t),v=Math.sqrt(r*r+u*u);o/=p,t/=p,r/=v,u/=v;let x=Math.acos(o*r+t*u);return-t*r+o*u>0?x:-x},f.bt=function(o,t){return o[0]*t[0]+o[1]*t[1]+o[2]*t[2]+o[3]},f.bu=em,f.bv=function(o,t){let r=Ee(o,2*Math.PI),u=Ee(t,2*Math.PI);return Math.min(Math.abs(r-u),Math.abs(r-u+2*Math.PI),Math.abs(r-u-2*Math.PI))},f.bw=function(){let o={},t=ie.$version;for(let r in ie.$root){let u=ie.$root[r];if(u.required){let p=null;p=r==="version"?t:u.type==="array"?[]:{},p!=null&&(o[r]=p)}}return o},f.bx=lh,f.by=An,f.bz=function(o){o=o.slice();let t=Object.create(null);for(let r=0;r<o.length;r++)t[o[r].id]=o[r];for(let r=0;r<o.length;r++)"ref"in o[r]&&(o[r]=ke(o[r],t[o[r].ref]));return o},f.c=Ot,f.c0=function(o,t){return o[0]===t[0]&&o[1]===t[1]&&o[2]===t[2]&&o[3]===t[3]&&o[4]===t[4]&&o[5]===t[5]&&o[6]===t[6]&&o[7]===t[7]&&o[8]===t[8]&&o[9]===t[9]&&o[10]===t[10]&&o[11]===t[11]&&o[12]===t[12]&&o[13]===t[13]&&o[14]===t[14]&&o[15]===t[15]},f.c1=function(o,t){var r=o[0],u=o[1],p=o[2],v=o[3],x=o[4],w=o[5],M=o[6],I=o[7],z=o[8],D=o[9],$=o[10],Z=o[11],G=o[12],K=o[13],ne=o[14],le=o[15],Me=t[0],fe=t[1],U=t[2],ee=t[3],_e=t[4],Ue=t[5],st=t[6],Ge=t[7],et=t[8],ht=t[9],lt=t[10],dt=t[11],it=t[12],Ct=t[13],Vt=t[14],jt=t[15];return Math.abs(r-Me)<=nt*Math.max(1,Math.abs(r),Math.abs(Me))&&Math.abs(u-fe)<=nt*Math.max(1,Math.abs(u),Math.abs(fe))&&Math.abs(p-U)<=nt*Math.max(1,Math.abs(p),Math.abs(U))&&Math.abs(v-ee)<=nt*Math.max(1,Math.abs(v),Math.abs(ee))&&Math.abs(x-_e)<=nt*Math.max(1,Math.abs(x),Math.abs(_e))&&Math.abs(w-Ue)<=nt*Math.max(1,Math.abs(w),Math.abs(Ue))&&Math.abs(M-st)<=nt*Math.max(1,Math.abs(M),Math.abs(st))&&Math.abs(I-Ge)<=nt*Math.max(1,Math.abs(I),Math.abs(Ge))&&Math.abs(z-et)<=nt*Math.max(1,Math.abs(z),Math.abs(et))&&Math.abs(D-ht)<=nt*Math.max(1,Math.abs(D),Math.abs(ht))&&Math.abs($-lt)<=nt*Math.max(1,Math.abs($),Math.abs(lt))&&Math.abs(Z-dt)<=nt*Math.max(1,Math.abs(Z),Math.abs(dt))&&Math.abs(G-it)<=nt*Math.max(1,Math.abs(G),Math.abs(it))&&Math.abs(K-Ct)<=nt*Math.max(1,Math.abs(K),Math.abs(Ct))&&Math.abs(ne-Vt)<=nt*Math.max(1,Math.abs(ne),Math.abs(Vt))&&Math.abs(le-jt)<=nt*Math.max(1,Math.abs(le),Math.abs(jt))},f.c2=function(o,t){return o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15],o},f.c3=o=>o.type==="symbol",f.c4=o=>o.type==="circle",f.c5=o=>o.type==="heatmap",f.c6=o=>o.type==="line",f.c7=o=>o.type==="fill",f.c8=o=>o.type==="fill-extrusion",f.c9=o=>o.type==="hillshade",f.cA=Df,f.cB=jf,f.cC=Ih,f.cD=Vf,f.cE=class{constructor(o){this._marks={start:[o.url,"start"].join("#"),end:[o.url,"end"].join("#"),measure:o.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let o=performance.getEntriesByName(this._marks.measure);return o.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),o=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),o}},f.cF=function(o,t,r,u,p){return a(this,void 0,void 0,function*(){if(Se())try{return yield Io(o,t,r,u,p)}catch{}return function(v,x,w,M,I){let z=v.width,D=v.height;jn&&Pr||(jn=new OffscreenCanvas(z,D),Pr=jn.getContext("2d",{willReadFrequently:!0})),jn.width=z,jn.height=D,Pr.drawImage(v,0,0,z,D);let $=Pr.getImageData(x,w,M,I);return Pr.clearRect(0,0,z,D),$.data}(o,t,r,u,p)})},f.cG=vy,f.cH=P,f.cI=B,f.cJ=O_,f.cK=K_,f.cL=Xs,f.cM=Fa,f.ca=o=>o.type==="raster",f.cb=o=>o.type==="background",f.cc=o=>o.type==="custom",f.cd=Tt,f.ce=function(o,t,r){let u=Ce(t.x-r.x,t.y-r.y),p=Ce(o.x-r.x,o.y-r.y);var v,x;return no(Math.atan2(u[0]*p[1]-u[1]*p[0],(v=u)[0]*(x=p)[0]+v[1]*x[1]))},f.cf=Et,f.cg=function(o,t){return ni[t]&&(o instanceof MouseEvent||o instanceof WheelEvent)},f.ch=function(o,t){return Jo[t]&&"touches"in o},f.ci=function(o){return Jo[o]||ni[o]},f.cj=function(o,t,r){var u=t[0],p=t[1];return o[0]=r[0]*u+r[4]*p+r[12],o[1]=r[1]*u+r[5]*p+r[13],o},f.ck=function(o,t){let{x:r,y:u}=Rh.fromLngLat(t);return!(o<0||o>25||u<0||u>=1||r<0||r>=1)},f.cl=function(o,t){return o[0]=t[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=t[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=t[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},f.cm=class extends yc{},f.cn=yw,f.cp=function(o){return o.message===Gi},f.cq=dn,f.cr=function(o,t){qr.REGISTERED_PROTOCOLS[o]=t},f.cs=function(o){delete qr.REGISTERED_PROTOCOLS[o]},f.ct=function(o,t){let r={};for(let p=0;p<o.length;p++){let v=t&&t[o[p].id]||jr(o[p]);t&&(t[o[p].id]=v);let x=r[v];x||(x=r[v]=[]),x.push(o[p])}let u=[];for(let p in r)u.push(r[p]);return u},f.cu=wt,f.cv=xy,f.cw=wy,f.cx=Y_,f.cy=function(o){o.bucket.createArrays(),o.bucket.tilePixelRatio=ge/(512*o.bucket.overscaling),o.bucket.compareText={},o.bucket.iconsNeedLinear=!1;let t=o.bucket.layers[0],r=t.layout,u=t._unevaluatedLayout._values,p={layoutIconSize:u["icon-size"].possiblyEvaluate(new sn(o.bucket.zoom+1),o.canonical),layoutTextSize:u["text-size"].possiblyEvaluate(new sn(o.bucket.zoom+1),o.canonical),textMaxSize:u["text-size"].possiblyEvaluate(new sn(18))};if(o.bucket.textSizeData.kind==="composite"){let{minZoom:I,maxZoom:z}=o.bucket.textSizeData;p.compositeTextSizes=[u["text-size"].possiblyEvaluate(new sn(I),o.canonical),u["text-size"].possiblyEvaluate(new sn(z),o.canonical)]}if(o.bucket.iconSizeData.kind==="composite"){let{minZoom:I,maxZoom:z}=o.bucket.iconSizeData;p.compositeIconSizes=[u["icon-size"].possiblyEvaluate(new sn(I),o.canonical),u["icon-size"].possiblyEvaluate(new sn(z),o.canonical)]}let v=r.get("text-line-height")*rr,x=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",w=r.get("text-keep-upright"),M=r.get("text-size");for(let I of o.bucket.features){let z=r.get("text-font").evaluate(I,{},o.canonical).join(","),D=M.evaluate(I,{},o.canonical),$=p.layoutTextSize.evaluate(I,{},o.canonical),Z=p.layoutIconSize.evaluate(I,{},o.canonical),G={horizontal:{},vertical:void 0},K=I.text,ne,le=[0,0];if(K){let U=K.toString(),ee=r.get("text-letter-spacing").evaluate(I,{},o.canonical)*rr,_e=yf(U)?ee:0,Ue=r.get("text-anchor").evaluate(I,{},o.canonical),st=Ry(t,I,o.canonical);if(!st){let lt=r.get("text-radial-offset").evaluate(I,{},o.canonical);le=lt?zy(Ue,[lt*rr,nm]):r.get("text-offset").evaluate(I,{},o.canonical).map(dt=>dt*rr)}let Ge=x?"center":r.get("text-justify").evaluate(I,{},o.canonical),et=r.get("symbol-placement")==="point"?r.get("text-max-width").evaluate(I,{},o.canonical)*rr:1/0,ht=()=>{o.bucket.allowVerticalPlacement&&gu(U)&&(G.vertical=Ud(K,o.glyphMap,o.glyphPositions,o.imagePositions,z,et,v,Ue,"left",_e,le,f.al.vertical,!0,$,D))};if(!x&&st){let lt=new Set;if(Ge==="auto")for(let it=0;it<st.values.length;it+=2)lt.add(rm(st.values[it]));else lt.add(Ge);let dt=!1;for(let it of lt)if(!G.horizontal[it])if(dt)G.horizontal[it]=G.horizontal[0];else{let Ct=Ud(K,o.glyphMap,o.glyphPositions,o.imagePositions,z,et,v,"center",it,_e,le,f.al.horizontal,!1,$,D);Ct&&(G.horizontal[it]=Ct,dt=Ct.positionedLines.length===1)}ht()}else{Ge==="auto"&&(Ge=rm(Ue));let lt=Ud(K,o.glyphMap,o.glyphPositions,o.imagePositions,z,et,v,Ue,Ge,_e,le,f.al.horizontal,!1,$,D);lt&&(G.horizontal[Ge]=lt),ht(),gu(U)&&x&&w&&(G.vertical=Ud(K,o.glyphMap,o.glyphPositions,o.imagePositions,z,et,v,Ue,Ge,_e,le,f.al.vertical,!1,$,D))}}let Me=!1;if(I.icon&&I.icon.name){let U=o.imageMap[I.icon.name];U&&(ne=Qb(o.imagePositions[I.icon.name],r.get("icon-offset").evaluate(I,{},o.canonical),r.get("icon-anchor").evaluate(I,{},o.canonical)),Me=!!U.sdf,o.bucket.sdfIcons===void 0?o.bucket.sdfIcons=Me:o.bucket.sdfIcons!==Me&&Ri("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(U.pixelRatio!==o.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(o.bucket.iconsNeedLinear=!0))}let fe=By(G.horizontal)||G.vertical;o.bucket.iconsInText=!!fe&&fe.iconsInText,(fe||ne)&&gw(o.bucket,I,G,ne,o.imageMap,p,$,Z,le,Me,o.canonical,o.subdivisionGranularity)}o.showCollisionBoxes&&o.bucket.generateCollisionDebugBuffers()},f.cz=$f,f.d=Re,f.e=Ft,f.f=o=>a(void 0,void 0,void 0,function*(){if(o.byteLength===0)return createImageBitmap(new ImageData(1,1));let t=new Blob([new Uint8Array(o)],{type:"image/png"});try{return createImageBitmap(t)}catch(r){throw new Error(`Could not load image because of ${r.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),f.g=Tn,f.h=o=>new Promise((t,r)=>{let u=new Image;u.onload=()=>{t(u),URL.revokeObjectURL(u.src),u.onload=null,window.requestAnimationFrame(()=>{u.src=to})},u.onerror=()=>r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let p=new Blob([new Uint8Array(o)],{type:"image/png"});u.src=o.byteLength?URL.createObjectURL(p):to}),f.i=Ui,f.j=(o,t)=>Rn(Ft(o,{type:"json"}),t),f.k=me,f.l=te,f.m=Rn,f.n=(o,t)=>Rn(Ft(o,{type:"arrayBuffer"}),t),f.o=function(o){return new Vf(o).readFields($b,[])},f.p=X_,f.q=bh,f.r=Gn,f.s=mo,f.t=du,f.u=bi,f.v=ie,f.w=Ri,f.x=sh,f.y=Il,f.z=function([o,t,r]){return t+=90,t*=Math.PI/180,r*=Math.PI/180,{x:o*Math.cos(t)*Math.sin(r),y:o*Math.sin(t)*Math.sin(r),z:o*Math.cos(r)}}}),l("worker",["./shared"],function(f){"use strict";class a{constructor(X){this.keyCache={},X&&this.replace(X)}replace(X){this._layerConfigs={},this._layers={},this.update(X,[])}update(X,Y){for(let me of X){this._layerConfigs[me.id]=me;let Te=this._layers[me.id]=f.bA(me);Te._featureFilter=f.a7(Te.filter),this.keyCache[me.id]&&delete this.keyCache[me.id]}for(let me of Y)delete this.keyCache[me],delete this._layerConfigs[me],delete this._layers[me];this.familiesBySource={};let te=f.ct(Object.values(this._layerConfigs),this.keyCache);for(let me of te){let Te=me.map(De=>this._layers[De.id]),ie=Te[0];if(ie.visibility==="none")continue;let Ne=ie.source||"",ke=this.familiesBySource[Ne];ke||(ke=this.familiesBySource[Ne]={});let Be=ie.sourceLayer||"_geojsonTileLayer",Ze=ke[Be];Ze||(Ze=ke[Be]=[]),Ze.push(Te)}}}class P{constructor(X){let Y={},te=[];for(let Ne in X){let ke=X[Ne],Be=Y[Ne]={};for(let Ze in ke){let De=ke[+Ze];if(!De||De.bitmap.width===0||De.bitmap.height===0)continue;let at={x:0,y:0,w:De.bitmap.width+2,h:De.bitmap.height+2};te.push(at),Be[Ze]={rect:at,metrics:De.metrics}}}let{w:me,h:Te}=f.p(te),ie=new f.q({width:me||1,height:Te||1});for(let Ne in X){let ke=X[Ne];for(let Be in ke){let Ze=ke[+Be];if(!Ze||Ze.bitmap.width===0||Ze.bitmap.height===0)continue;let De=Y[Ne][Be].rect;f.q.copy(Ze.bitmap,ie,{x:0,y:0},{x:De.x+1,y:De.y+1},Ze.bitmap)}}this.image=ie,this.positions=Y}}f.cu("GlyphAtlas",P);class E{constructor(X){this.tileID=new f.Y(X.tileID.overscaledZ,X.tileID.wrap,X.tileID.canonical.z,X.tileID.canonical.x,X.tileID.canonical.y),this.uid=X.uid,this.zoom=X.zoom,this.pixelRatio=X.pixelRatio,this.tileSize=X.tileSize,this.source=X.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=X.showCollisionBoxes,this.collectResourceTiming=!!X.collectResourceTiming,this.returnDependencies=!!X.returnDependencies,this.promoteId=X.promoteId,this.inFlightDependencies=[]}parse(X,Y,te,me,Te){return f._(this,void 0,void 0,function*(){this.status="parsing",this.data=X,this.collisionBoxArray=new f.a5;let ie=new f.cv(Object.keys(X.layers).sort()),Ne=new f.cw(this.tileID,this.promoteId);Ne.bucketLayerIDs=[];let ke={},Be={featureIndex:Ne,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:te,subdivisionGranularity:Te},Ze=Y.familiesBySource[this.source];for(let Zt in Ze){let ot=X.layers[Zt];if(!ot)continue;ot.version===1&&f.w(`Vector tile source "${this.source}" layer "${Zt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let Nt=ie.encode(Zt),Kt=[];for(let Hi=0;Hi<ot.length;Hi++){let $i=ot.feature(Hi),Qn=Ne.getId($i,Zt);Kt.push({feature:$i,id:Qn,index:Hi,sourceLayerIndex:Nt})}for(let Hi of Ze[Zt]){let $i=Hi[0];$i.source!==this.source&&f.w(`layer.source = ${$i.source} does not equal this.source = ${this.source}`),$i.minzoom&&this.zoom<Math.floor($i.minzoom)||$i.maxzoom&&this.zoom>=$i.maxzoom||$i.visibility!=="none"&&(O(Hi,this.zoom,te),(ke[$i.id]=$i.createBucket({index:Ne.bucketLayerIDs.length,layers:Hi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Nt,sourceID:this.source})).populate(Kt,Be,this.tileID.canonical),Ne.bucketLayerIDs.push(Hi.map(Qn=>Qn.id)))}}let De=f.bF(Be.glyphDependencies,Zt=>Object.keys(Zt).map(Number));this.inFlightDependencies.forEach(Zt=>Zt?.abort()),this.inFlightDependencies=[];let at=Promise.resolve({});if(Object.keys(De).length){let Zt=new AbortController;this.inFlightDependencies.push(Zt),at=me.sendAsync({type:"GG",data:{stacks:De,source:this.source,tileID:this.tileID,type:"glyphs"}},Zt)}let mt=Object.keys(Be.iconDependencies),yt=Promise.resolve({});if(mt.length){let Zt=new AbortController;this.inFlightDependencies.push(Zt),yt=me.sendAsync({type:"GI",data:{icons:mt,source:this.source,tileID:this.tileID,type:"icons"}},Zt)}let Dt=Object.keys(Be.patternDependencies),Yt=Promise.resolve({});if(Dt.length){let Zt=new AbortController;this.inFlightDependencies.push(Zt),Yt=me.sendAsync({type:"GI",data:{icons:Dt,source:this.source,tileID:this.tileID,type:"patterns"}},Zt)}let[Gt,Ye,ri]=yield Promise.all([at,yt,Yt]),ft=new P(Gt),Si=new f.cx(Ye,ri);for(let Zt in ke){let ot=ke[Zt];ot instanceof f.a6?(O(ot.layers,this.zoom,te),f.cy({bucket:ot,glyphMap:Gt,glyphPositions:ft.positions,imageMap:Ye,imagePositions:Si.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Be.subdivisionGranularity})):ot.hasPattern&&(ot instanceof f.cz||ot instanceof f.cA||ot instanceof f.cB)&&(O(ot.layers,this.zoom,te),ot.addFeatures(Be,this.tileID.canonical,Si.patternPositions))}return this.status="done",{buckets:Object.values(ke).filter(Zt=>!Zt.isEmpty()),featureIndex:Ne,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ft.image,imageAtlas:Si,glyphMap:this.returnDependencies?Gt:null,iconMap:this.returnDependencies?Ye:null,glyphPositions:this.returnDependencies?ft.positions:null}})}}function O(Re,X,Y){let te=new f.C(X);for(let me of Re)me.recalculate(te,Y)}class B{constructor(X,Y,te){this.actor=X,this.layerIndex=Y,this.availableImages=te,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(X,Y){return f._(this,void 0,void 0,function*(){let te=yield f.n(X.request,Y);try{return{vectorTile:new f.cC.VectorTile(new f.cD(te.data)),rawData:te.data,cacheControl:te.cacheControl,expires:te.expires}}catch(me){let Te=new Uint8Array(te.data),ie=`Unable to parse the tile at ${X.request.url}, `;throw ie+=Te[0]===31&&Te[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${me.message}`,new Error(ie)}})}loadTile(X){return f._(this,void 0,void 0,function*(){let Y=X.uid,te=!!(X&&X.request&&X.request.collectResourceTiming)&&new f.cE(X.request),me=new E(X);this.loading[Y]=me;let Te=new AbortController;me.abort=Te;try{let ie=yield this.loadVectorTile(X,Te);if(delete this.loading[Y],!ie)return null;let Ne=ie.rawData,ke={};ie.expires&&(ke.expires=ie.expires),ie.cacheControl&&(ke.cacheControl=ie.cacheControl);let Be={};if(te){let De=te.finish();De&&(Be.resourceTiming=JSON.parse(JSON.stringify(De)))}me.vectorTile=ie.vectorTile;let Ze=me.parse(ie.vectorTile,this.layerIndex,this.availableImages,this.actor,X.subdivisionGranularity);this.loaded[Y]=me,this.fetching[Y]={rawTileData:Ne,cacheControl:ke,resourceTiming:Be};try{let De=yield Ze;return f.e({rawTileData:Ne.slice(0)},De,ke,Be)}finally{delete this.fetching[Y]}}catch(ie){throw delete this.loading[Y],me.status="done",this.loaded[Y]=me,ie}})}reloadTile(X){return f._(this,void 0,void 0,function*(){let Y=X.uid;if(!this.loaded||!this.loaded[Y])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");let te=this.loaded[Y];if(te.showCollisionBoxes=X.showCollisionBoxes,te.status==="parsing"){let me=yield te.parse(te.vectorTile,this.layerIndex,this.availableImages,this.actor,X.subdivisionGranularity),Te;if(this.fetching[Y]){let{rawTileData:ie,cacheControl:Ne,resourceTiming:ke}=this.fetching[Y];delete this.fetching[Y],Te=f.e({rawTileData:ie.slice(0)},me,Ne,ke)}else Te=me;return Te}if(te.status==="done"&&te.vectorTile)return te.parse(te.vectorTile,this.layerIndex,this.availableImages,this.actor,X.subdivisionGranularity)})}abortTile(X){return f._(this,void 0,void 0,function*(){let Y=this.loading,te=X.uid;Y&&Y[te]&&Y[te].abort&&(Y[te].abort.abort(),delete Y[te])})}removeTile(X){return f._(this,void 0,void 0,function*(){this.loaded&&this.loaded[X.uid]&&delete this.loaded[X.uid]})}}class W{constructor(){this.loaded={}}loadTile(X){return f._(this,void 0,void 0,function*(){let{uid:Y,encoding:te,rawImageData:me,redFactor:Te,greenFactor:ie,blueFactor:Ne,baseShift:ke}=X,Be=me.width+2,Ze=me.height+2,De=f.b(me)?new f.R({width:Be,height:Ze},yield f.cF(me,-1,-1,Be,Ze)):me,at=new f.cG(Y,De,te,Te,ie,Ne,ke);return this.loaded=this.loaded||{},this.loaded[Y]=at,at})}removeTile(X){let Y=this.loaded,te=X.uid;Y&&Y[te]&&delete Y[te]}}var V,he,ue=function(){if(he)return V;function Re(Y,te){if(Y.length!==0){X(Y[0],te);for(var me=1;me<Y.length;me++)X(Y[me],!te)}}function X(Y,te){for(var me=0,Te=0,ie=0,Ne=Y.length,ke=Ne-1;ie<Ne;ke=ie++){var Be=(Y[ie][0]-Y[ke][0])*(Y[ke][1]+Y[ie][1]),Ze=me+Be;Te+=Math.abs(me)>=Math.abs(Be)?me-Ze+Be:Be-Ze+me,me=Ze}me+Te>=0!=!!te&&Y.reverse()}return he=1,V=function Y(te,me){var Te,ie=te&&te.type;if(ie==="FeatureCollection")for(Te=0;Te<te.features.length;Te++)Y(te.features[Te],me);else if(ie==="GeometryCollection")for(Te=0;Te<te.geometries.length;Te++)Y(te.geometries[Te],me);else if(ie==="Feature")Y(te.geometry,me);else if(ie==="Polygon")Re(te.coordinates,me);else if(ie==="MultiPolygon")for(Te=0;Te<te.coordinates.length;Te++)Re(te.coordinates[Te],me);return te}}(),be=f.cH(ue);let ze=f.cC.VectorTileFeature.prototype.toGeoJSON;class Xe{constructor(X){this._feature=X,this.extent=f.Z,this.type=X.type,this.properties=X.tags,"id"in X&&!isNaN(X.id)&&(this.id=parseInt(X.id,10))}loadGeometry(){if(this._feature.type===1){let X=[];for(let Y of this._feature.geometry)X.push([new f.P(Y[0],Y[1])]);return X}{let X=[];for(let Y of this._feature.geometry){let te=[];for(let me of Y)te.push(new f.P(me[0],me[1]));X.push(te)}return X}}toGeoJSON(X,Y,te){return ze.call(this,X,Y,te)}}class Ve{constructor(X){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=f.Z,this.length=X.length,this._features=X}feature(X){return new Xe(this._features[X])}}var Se,nt,pt,Pt={exports:{}},kt=function(){if(pt)return Pt.exports;pt=1;var Re=f.cK(),X=function(){if(nt)return Se;nt=1;var Ze=f.cI(),De=f.cJ().VectorTileFeature;function at(yt,Dt){this.options=Dt||{},this.features=yt,this.length=yt.length}function mt(yt,Dt){this.id=typeof yt.id=="number"?yt.id:void 0,this.type=yt.type,this.rawGeometry=yt.type===1?[yt.geometry]:yt.geometry,this.properties=yt.tags,this.extent=Dt||4096}return Se=at,at.prototype.feature=function(yt){return new mt(this.features[yt],this.options.extent)},mt.prototype.loadGeometry=function(){var yt=this.rawGeometry;this.geometry=[];for(var Dt=0;Dt<yt.length;Dt++){for(var Yt=yt[Dt],Gt=[],Ye=0;Ye<Yt.length;Ye++)Gt.push(new Ze(Yt[Ye][0],Yt[Ye][1]));this.geometry.push(Gt)}return this.geometry},mt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var yt=this.geometry,Dt=1/0,Yt=-1/0,Gt=1/0,Ye=-1/0,ri=0;ri<yt.length;ri++)for(var ft=yt[ri],Si=0;Si<ft.length;Si++){var Zt=ft[Si];Dt=Math.min(Dt,Zt.x),Yt=Math.max(Yt,Zt.x),Gt=Math.min(Gt,Zt.y),Ye=Math.max(Ye,Zt.y)}return[Dt,Gt,Yt,Ye]},mt.prototype.toGeoJSON=De.prototype.toGeoJSON,Se}();function Y(Ze){var De=new Re;return function(at,mt){for(var yt in at.layers)mt.writeMessage(3,te,at.layers[yt])}(Ze,De),De.finish()}function te(Ze,De){var at;De.writeVarintField(15,Ze.version||1),De.writeStringField(1,Ze.name||""),De.writeVarintField(5,Ze.extent||4096);var mt={keys:[],values:[],keycache:{},valuecache:{}};for(at=0;at<Ze.length;at++)mt.feature=Ze.feature(at),De.writeMessage(2,me,mt);var yt=mt.keys;for(at=0;at<yt.length;at++)De.writeStringField(3,yt[at]);var Dt=mt.values;for(at=0;at<Dt.length;at++)De.writeMessage(4,Be,Dt[at])}function me(Ze,De){var at=Ze.feature;at.id!==void 0&&De.writeVarintField(1,at.id),De.writeMessage(2,Te,Ze),De.writeVarintField(3,at.type),De.writeMessage(4,ke,at)}function Te(Ze,De){var at=Ze.feature,mt=Ze.keys,yt=Ze.values,Dt=Ze.keycache,Yt=Ze.valuecache;for(var Gt in at.properties){var Ye=at.properties[Gt],ri=Dt[Gt];if(Ye!==null){ri===void 0&&(mt.push(Gt),Dt[Gt]=ri=mt.length-1),De.writeVarint(ri);var ft=typeof Ye;ft!=="string"&&ft!=="boolean"&&ft!=="number"&&(Ye=JSON.stringify(Ye));var Si=ft+":"+Ye,Zt=Yt[Si];Zt===void 0&&(yt.push(Ye),Yt[Si]=Zt=yt.length-1),De.writeVarint(Zt)}}}function ie(Ze,De){return(De<<3)+(7&Ze)}function Ne(Ze){return Ze<<1^Ze>>31}function ke(Ze,De){for(var at=Ze.loadGeometry(),mt=Ze.type,yt=0,Dt=0,Yt=at.length,Gt=0;Gt<Yt;Gt++){var Ye=at[Gt],ri=1;mt===1&&(ri=Ye.length),De.writeVarint(ie(1,ri));for(var ft=mt===3?Ye.length-1:Ye.length,Si=0;Si<ft;Si++){Si===1&&mt!==1&&De.writeVarint(ie(2,ft-1));var Zt=Ye[Si].x-yt,ot=Ye[Si].y-Dt;De.writeVarint(Ne(Zt)),De.writeVarint(Ne(ot)),yt+=Zt,Dt+=ot}mt===3&&De.writeVarint(ie(7,1))}}function Be(Ze,De){var at=typeof Ze;at==="string"?De.writeStringField(1,Ze):at==="boolean"?De.writeBooleanField(7,Ze):at==="number"&&(Ze%1!=0?De.writeDoubleField(3,Ze):Ze<0?De.writeSVarintField(6,Ze):De.writeVarintField(5,Ze))}return Pt.exports=Y,Pt.exports.fromVectorTileJs=Y,Pt.exports.fromGeojsonVt=function(Ze,De){De=De||{};var at={};for(var mt in Ze)at[mt]=new X(Ze[mt].features,De),at[mt].name=mt,at[mt].version=De.version,at[mt].extent=De.extent;return Y({layers:at})},Pt.exports.GeoJSONWrapper=X,Pt.exports}(),It=f.cH(kt);let Q={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Re=>Re},re=Math.fround||(ce=new Float32Array(1),Re=>(ce[0]=+Re,ce[0]));var ce;let Ie=3,de=5,Oe=6;class Ae{constructor(X){this.options=Object.assign(Object.create(Q),X),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(X){let{log:Y,minZoom:te,maxZoom:me}=this.options;Y&&console.time("total time");let Te=`prepare ${X.length} points`;Y&&console.time(Te),this.points=X;let ie=[];for(let ke=0;ke<X.length;ke++){let Be=X[ke];if(!Be.geometry)continue;let[Ze,De]=Be.geometry.coordinates,at=re(Fe(Ze)),mt=re(Ee(De));ie.push(at,mt,1/0,ke,-1,1),this.options.reduce&&ie.push(0)}let Ne=this.trees[me+1]=this._createTree(ie);Y&&console.timeEnd(Te);for(let ke=me;ke>=te;ke--){let Be=+Date.now();Ne=this.trees[ke]=this._createTree(this._cluster(Ne,ke)),Y&&console.log("z%d: %d clusters in %dms",ke,Ne.numItems,+Date.now()-Be)}return Y&&console.timeEnd("total time"),this}getClusters(X,Y){let te=((X[0]+180)%360+360)%360-180,me=Math.max(-90,Math.min(90,X[1])),Te=X[2]===180?180:((X[2]+180)%360+360)%360-180,ie=Math.max(-90,Math.min(90,X[3]));if(X[2]-X[0]>=360)te=-180,Te=180;else if(te>Te){let De=this.getClusters([te,me,180,ie],Y),at=this.getClusters([-180,me,Te,ie],Y);return De.concat(at)}let Ne=this.trees[this._limitZoom(Y)],ke=Ne.range(Fe(te),Ee(ie),Fe(Te),Ee(me)),Be=Ne.data,Ze=[];for(let De of ke){let at=this.stride*De;Ze.push(Be[at+de]>1?Ce(Be,at,this.clusterProps):this.points[Be[at+Ie]])}return Ze}getChildren(X){let Y=this._getOriginId(X),te=this._getOriginZoom(X),me="No cluster with the specified id.",Te=this.trees[te];if(!Te)throw new Error(me);let ie=Te.data;if(Y*this.stride>=ie.length)throw new Error(me);let Ne=this.options.radius/(this.options.extent*Math.pow(2,te-1)),ke=Te.within(ie[Y*this.stride],ie[Y*this.stride+1],Ne),Be=[];for(let Ze of ke){let De=Ze*this.stride;ie[De+4]===X&&Be.push(ie[De+de]>1?Ce(ie,De,this.clusterProps):this.points[ie[De+Ie]])}if(Be.length===0)throw new Error(me);return Be}getLeaves(X,Y,te){let me=[];return this._appendLeaves(me,X,Y=Y||10,te=te||0,0),me}getTile(X,Y,te){let me=this.trees[this._limitZoom(X)],Te=Math.pow(2,X),{extent:ie,radius:Ne}=this.options,ke=Ne/ie,Be=(te-ke)/Te,Ze=(te+1+ke)/Te,De={features:[]};return this._addTileFeatures(me.range((Y-ke)/Te,Be,(Y+1+ke)/Te,Ze),me.data,Y,te,Te,De),Y===0&&this._addTileFeatures(me.range(1-ke/Te,Be,1,Ze),me.data,Te,te,Te,De),Y===Te-1&&this._addTileFeatures(me.range(0,Be,ke/Te,Ze),me.data,-1,te,Te,De),De.features.length?De:null}getClusterExpansionZoom(X){let Y=this._getOriginZoom(X)-1;for(;Y<=this.options.maxZoom;){let te=this.getChildren(X);if(Y++,te.length!==1)break;X=te[0].properties.cluster_id}return Y}_appendLeaves(X,Y,te,me,Te){let ie=this.getChildren(Y);for(let Ne of ie){let ke=Ne.properties;if(ke&&ke.cluster?Te+ke.point_count<=me?Te+=ke.point_count:Te=this._appendLeaves(X,ke.cluster_id,te,me,Te):Te<me?Te++:X.push(Ne),X.length===te)break}return Te}_createTree(X){let Y=new f.aF(X.length/this.stride|0,this.options.nodeSize,Float32Array);for(let te=0;te<X.length;te+=this.stride)Y.add(X[te],X[te+1]);return Y.finish(),Y.data=X,Y}_addTileFeatures(X,Y,te,me,Te,ie){for(let Ne of X){let ke=Ne*this.stride,Be=Y[ke+de]>1,Ze,De,at;if(Be)Ze=ge(Y,ke,this.clusterProps),De=Y[ke],at=Y[ke+1];else{let Dt=this.points[Y[ke+Ie]];Ze=Dt.properties;let[Yt,Gt]=Dt.geometry.coordinates;De=Fe(Yt),at=Ee(Gt)}let mt={type:1,geometry:[[Math.round(this.options.extent*(De*Te-te)),Math.round(this.options.extent*(at*Te-me))]],tags:Ze},yt;yt=Be||this.options.generateId?Y[ke+Ie]:this.points[Y[ke+Ie]].id,yt!==void 0&&(mt.id=yt),ie.features.push(mt)}}_limitZoom(X){return Math.max(this.options.minZoom,Math.min(Math.floor(+X),this.options.maxZoom+1))}_cluster(X,Y){let{radius:te,extent:me,reduce:Te,minPoints:ie}=this.options,Ne=te/(me*Math.pow(2,Y)),ke=X.data,Be=[],Ze=this.stride;for(let De=0;De<ke.length;De+=Ze){if(ke[De+2]<=Y)continue;ke[De+2]=Y;let at=ke[De],mt=ke[De+1],yt=X.within(ke[De],ke[De+1],Ne),Dt=ke[De+de],Yt=Dt;for(let Gt of yt){let Ye=Gt*Ze;ke[Ye+2]>Y&&(Yt+=ke[Ye+de])}if(Yt>Dt&&Yt>=ie){let Gt,Ye=at*Dt,ri=mt*Dt,ft=-1,Si=((De/Ze|0)<<5)+(Y+1)+this.points.length;for(let Zt of yt){let ot=Zt*Ze;if(ke[ot+2]<=Y)continue;ke[ot+2]=Y;let Nt=ke[ot+de];Ye+=ke[ot]*Nt,ri+=ke[ot+1]*Nt,ke[ot+4]=Si,Te&&(Gt||(Gt=this._map(ke,De,!0),ft=this.clusterProps.length,this.clusterProps.push(Gt)),Te(Gt,this._map(ke,ot)))}ke[De+4]=Si,Be.push(Ye/Yt,ri/Yt,1/0,Si,-1,Yt),Te&&Be.push(ft)}else{for(let Gt=0;Gt<Ze;Gt++)Be.push(ke[De+Gt]);if(Yt>1)for(let Gt of yt){let Ye=Gt*Ze;if(!(ke[Ye+2]<=Y)){ke[Ye+2]=Y;for(let ri=0;ri<Ze;ri++)Be.push(ke[Ye+ri])}}}}return Be}_getOriginId(X){return X-this.points.length>>5}_getOriginZoom(X){return(X-this.points.length)%32}_map(X,Y,te){if(X[Y+de]>1){let ie=this.clusterProps[X[Y+Oe]];return te?Object.assign({},ie):ie}let me=this.points[X[Y+Ie]].properties,Te=this.options.map(me);return te&&Te===me?Object.assign({},Te):Te}}function Ce(Re,X,Y){return{type:"Feature",id:Re[X+Ie],properties:ge(Re,X,Y),geometry:{type:"Point",coordinates:[(te=Re[X],360*(te-.5)),qe(Re[X+1])]}};var te}function ge(Re,X,Y){let te=Re[X+de],me=te>=1e4?`${Math.round(te/1e3)}k`:te>=1e3?Math.round(te/100)/10+"k":te,Te=Re[X+Oe],ie=Te===-1?{}:Object.assign({},Y[Te]);return Object.assign(ie,{cluster:!0,cluster_id:Re[X+Ie],point_count:te,point_count_abbreviated:me})}function Fe(Re){return Re/360+.5}function Ee(Re){let X=Math.sin(Re*Math.PI/180),Y=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return Y<0?0:Y>1?1:Y}function qe(Re){let X=(180-360*Re)*Math.PI/180;return 360*Math.atan(Math.exp(X))/Math.PI-90}function xt(Re,X,Y,te){let me=te,Te=X+(Y-X>>1),ie,Ne=Y-X,ke=Re[X],Be=Re[X+1],Ze=Re[Y],De=Re[Y+1];for(let at=X+3;at<Y;at+=3){let mt=Tt(Re[at],Re[at+1],ke,Be,Ze,De);if(mt>me)ie=at,me=mt;else if(mt===me){let yt=Math.abs(at-Te);yt<Ne&&(ie=at,Ne=yt)}}me>te&&(ie-X>3&&xt(Re,X,ie,te),Re[ie+2]=me,Y-ie>3&&xt(Re,ie,Y,te))}function Tt(Re,X,Y,te,me,Te){let ie=me-Y,Ne=Te-te;if(ie!==0||Ne!==0){let ke=((Re-Y)*ie+(X-te)*Ne)/(ie*ie+Ne*Ne);ke>1?(Y=me,te=Te):ke>0&&(Y+=ie*ke,te+=Ne*ke)}return ie=Re-Y,Ne=X-te,ie*ie+Ne*Ne}function Et(Re,X,Y,te){let me={id:Re??null,type:X,geometry:Y,tags:te,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(X==="Point"||X==="MultiPoint"||X==="LineString")St(me,Y);else if(X==="Polygon")St(me,Y[0]);else if(X==="MultiLineString")for(let Te of Y)St(me,Te);else if(X==="MultiPolygon")for(let Te of Y)St(me,Te[0]);return me}function St(Re,X){for(let Y=0;Y<X.length;Y+=3)Re.minX=Math.min(Re.minX,X[Y]),Re.minY=Math.min(Re.minY,X[Y+1]),Re.maxX=Math.max(Re.maxX,X[Y]),Re.maxY=Math.max(Re.maxY,X[Y+1])}function zt(Re,X,Y,te){if(!X.geometry)return;let me=X.geometry.coordinates;if(me&&me.length===0)return;let Te=X.geometry.type,ie=Math.pow(Y.tolerance/((1<<Y.maxZoom)*Y.extent),2),Ne=[],ke=X.id;if(Y.promoteId?ke=X.properties[Y.promoteId]:Y.generateId&&(ke=te||0),Te==="Point")Ft(me,Ne);else if(Te==="MultiPoint")for(let Be of me)Ft(Be,Ne);else if(Te==="LineString")Qt(me,Ne,ie,!1);else if(Te==="MultiLineString"){if(Y.lineMetrics){for(let Be of me)Ne=[],Qt(Be,Ne,ie,!1),Re.push(Et(ke,"LineString",Ne,X.properties));return}Vi(me,Ne,ie,!1)}else if(Te==="Polygon")Vi(me,Ne,ie,!0);else{if(Te!=="MultiPolygon"){if(Te==="GeometryCollection"){for(let Be of X.geometry.geometries)zt(Re,{id:ke,geometry:Be,properties:X.properties},Y,te);return}throw new Error("Input data is not a valid GeoJSON object.")}for(let Be of me){let Ze=[];Vi(Be,Ze,ie,!0),Ne.push(Ze)}}Re.push(Et(ke,Te,Ne,X.properties))}function Ft(Re,X){X.push(Jn(Re[0]),hn(Re[1]),0)}function Qt(Re,X,Y,te){let me,Te,ie=0;for(let ke=0;ke<Re.length;ke++){let Be=Jn(Re[ke][0]),Ze=hn(Re[ke][1]);X.push(Be,Ze,0),ke>0&&(ie+=te?(me*Ze-Be*Te)/2:Math.sqrt(Math.pow(Be-me,2)+Math.pow(Ze-Te,2))),me=Be,Te=Ze}let Ne=X.length-3;X[2]=1,xt(X,0,Ne,Y),X[Ne+2]=1,X.size=Math.abs(ie),X.start=0,X.end=X.size}function Vi(Re,X,Y,te){for(let me=0;me<Re.length;me++){let Te=[];Qt(Re[me],Te,Y,te),X.push(Te)}}function Jn(Re){return Re/360+.5}function hn(Re){let X=Math.sin(Re*Math.PI/180),Y=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return Y<0?0:Y>1?1:Y}function Yi(Re,X,Y,te,me,Te,ie,Ne){if(te/=X,Te>=(Y/=X)&&ie<te)return Re;if(ie<Y||Te>=te)return null;let ke=[];for(let Be of Re){let Ze=Be.geometry,De=Be.type,at=me===0?Be.minX:Be.minY,mt=me===0?Be.maxX:Be.maxY;if(at>=Y&&mt<te){ke.push(Be);continue}if(mt<Y||at>=te)continue;let yt=[];if(De==="Point"||De==="MultiPoint")Ri(Ze,yt,Y,te,me);else if(De==="LineString")_i(Ze,yt,Y,te,me,!1,Ne.lineMetrics);else if(De==="MultiLineString")Zi(Ze,yt,Y,te,me,!1);else if(De==="Polygon")Zi(Ze,yt,Y,te,me,!0);else if(De==="MultiPolygon")for(let Dt of Ze){let Yt=[];Zi(Dt,Yt,Y,te,me,!0),Yt.length&&yt.push(Yt)}if(yt.length){if(Ne.lineMetrics&&De==="LineString"){for(let Dt of yt)ke.push(Et(Be.id,De,Dt,Be.tags));continue}De!=="LineString"&&De!=="MultiLineString"||(yt.length===1?(De="LineString",yt=yt[0]):De="MultiLineString"),De!=="Point"&&De!=="MultiPoint"||(De=yt.length===3?"Point":"MultiPoint"),ke.push(Et(Be.id,De,yt,Be.tags))}}return ke.length?ke:null}function Ri(Re,X,Y,te,me){for(let Te=0;Te<Re.length;Te+=3){let ie=Re[Te+me];ie>=Y&&ie<=te&&ui(X,Re[Te],Re[Te+1],Re[Te+2])}}function _i(Re,X,Y,te,me,Te,ie){let Ne=Ui(Re),ke=me===0?to:Io,Be,Ze,De=Re.start;for(let Yt=0;Yt<Re.length-3;Yt+=3){let Gt=Re[Yt],Ye=Re[Yt+1],ri=Re[Yt+2],ft=Re[Yt+3],Si=Re[Yt+4],Zt=me===0?Gt:Ye,ot=me===0?ft:Si,Nt=!1;ie&&(Be=Math.sqrt(Math.pow(Gt-ft,2)+Math.pow(Ye-Si,2))),Zt<Y?ot>Y&&(Ze=ke(Ne,Gt,Ye,ft,Si,Y),ie&&(Ne.start=De+Be*Ze)):Zt>te?ot<te&&(Ze=ke(Ne,Gt,Ye,ft,Si,te),ie&&(Ne.start=De+Be*Ze)):ui(Ne,Gt,Ye,ri),ot<Y&&Zt>=Y&&(Ze=ke(Ne,Gt,Ye,ft,Si,Y),Nt=!0),ot>te&&Zt<=te&&(Ze=ke(Ne,Gt,Ye,ft,Si,te),Nt=!0),!Te&&Nt&&(ie&&(Ne.end=De+Be*Ze),X.push(Ne),Ne=Ui(Re)),ie&&(De+=Be)}let at=Re.length-3,mt=Re[at],yt=Re[at+1],Dt=me===0?mt:yt;Dt>=Y&&Dt<=te&&ui(Ne,mt,yt,Re[at+2]),at=Ne.length-3,Te&&at>=3&&(Ne[at]!==Ne[0]||Ne[at+1]!==Ne[1])&&ui(Ne,Ne[0],Ne[1],Ne[2]),Ne.length&&X.push(Ne)}function Ui(Re){let X=[];return X.size=Re.size,X.start=Re.start,X.end=Re.end,X}function Zi(Re,X,Y,te,me,Te){for(let ie of Re)_i(ie,X,Y,te,me,Te,!1)}function ui(Re,X,Y,te){Re.push(X,Y,te)}function to(Re,X,Y,te,me,Te){let ie=(Te-X)/(te-X);return ui(Re,Te,Y+(me-Y)*ie,1),ie}function Io(Re,X,Y,te,me,Te){let ie=(Te-Y)/(me-Y);return ui(Re,X+(te-X)*ie,Te,1),ie}function jn(Re,X){let Y=[];for(let te=0;te<Re.length;te++){let me=Re[te],Te=me.type,ie;if(Te==="Point"||Te==="MultiPoint"||Te==="LineString")ie=Pr(me.geometry,X);else if(Te==="MultiLineString"||Te==="Polygon"){ie=[];for(let Ne of me.geometry)ie.push(Pr(Ne,X))}else if(Te==="MultiPolygon"){ie=[];for(let Ne of me.geometry){let ke=[];for(let Be of Ne)ke.push(Pr(Be,X));ie.push(ke)}}Y.push(Et(me.id,Te,ie,me.tags))}return Y}function Pr(Re,X){let Y=[];Y.size=Re.size,Re.start!==void 0&&(Y.start=Re.start,Y.end=Re.end);for(let te=0;te<Re.length;te+=3)Y.push(Re[te]+X,Re[te+1],Re[te+2]);return Y}function mo(Re,X){if(Re.transformed)return Re;let Y=1<<Re.z,te=Re.x,me=Re.y;for(let Te of Re.features){let ie=Te.geometry,Ne=Te.type;if(Te.geometry=[],Ne===1)for(let ke=0;ke<ie.length;ke+=2)Te.geometry.push(io(ie[ke],ie[ke+1],X,Y,te,me));else for(let ke=0;ke<ie.length;ke++){let Be=[];for(let Ze=0;Ze<ie[ke].length;Ze+=2)Be.push(io(ie[ke][Ze],ie[ke][Ze+1],X,Y,te,me));Te.geometry.push(Be)}}return Re.transformed=!0,Re}function io(Re,X,Y,te,me,Te){return[Math.round(Y*(Re*te-me)),Math.round(Y*(X*te-Te))]}function no(Re,X,Y,te,me){let Te=X===me.maxZoom?0:me.tolerance/((1<<X)*me.extent),ie={features:[],numPoints:0,numSimplified:0,numFeatures:Re.length,source:null,x:Y,y:te,z:X,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(let Ne of Re)Jo(ie,Ne,Te,me);return ie}function Jo(Re,X,Y,te){let me=X.geometry,Te=X.type,ie=[];if(Re.minX=Math.min(Re.minX,X.minX),Re.minY=Math.min(Re.minY,X.minY),Re.maxX=Math.max(Re.maxX,X.maxX),Re.maxY=Math.max(Re.maxY,X.maxY),Te==="Point"||Te==="MultiPoint")for(let Ne=0;Ne<me.length;Ne+=3)ie.push(me[Ne],me[Ne+1]),Re.numPoints++,Re.numSimplified++;else if(Te==="LineString")ni(ie,me,Re,Y,!1,!1);else if(Te==="MultiLineString"||Te==="Polygon")for(let Ne=0;Ne<me.length;Ne++)ni(ie,me[Ne],Re,Y,Te==="Polygon",Ne===0);else if(Te==="MultiPolygon")for(let Ne=0;Ne<me.length;Ne++){let ke=me[Ne];for(let Be=0;Be<ke.length;Be++)ni(ie,ke[Be],Re,Y,!0,Be===0)}if(ie.length){let Ne=X.tags||null;if(Te==="LineString"&&te.lineMetrics){Ne={};for(let Be in X.tags)Ne[Be]=X.tags[Be];Ne.mapbox_clip_start=me.start/me.size,Ne.mapbox_clip_end=me.end/me.size}let ke={geometry:ie,type:Te==="Polygon"||Te==="MultiPolygon"?3:Te==="LineString"||Te==="MultiLineString"?2:1,tags:Ne};X.id!==null&&(ke.id=X.id),Re.features.push(ke)}}function ni(Re,X,Y,te,me,Te){let ie=te*te;if(te>0&&X.size<(me?ie:te))return void(Y.numPoints+=X.length/3);let Ne=[];for(let ke=0;ke<X.length;ke+=3)(te===0||X[ke+2]>ie)&&(Y.numSimplified++,Ne.push(X[ke],X[ke+1])),Y.numPoints++;me&&function(ke,Be){let Ze=0;for(let De=0,at=ke.length,mt=at-2;De<at;mt=De,De+=2)Ze+=(ke[De]-ke[mt])*(ke[De+1]+ke[mt+1]);if(Ze>0===Be)for(let De=0,at=ke.length;De<at/2;De+=2){let mt=ke[De],yt=ke[De+1];ke[De]=ke[at-2-De],ke[De+1]=ke[at-1-De],ke[at-2-De]=mt,ke[at-1-De]=yt}}(Ne,Te),Re.push(Ne)}let Gi={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Ot{constructor(X,Y){let te=(Y=this.options=function(Te,ie){for(let Ne in ie)Te[Ne]=ie[Ne];return Te}(Object.create(Gi),Y)).debug;if(te&&console.time("preprocess data"),Y.maxZoom<0||Y.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Y.promoteId&&Y.generateId)throw new Error("promoteId and generateId cannot be used together.");let me=function(Te,ie){let Ne=[];if(Te.type==="FeatureCollection")for(let ke=0;ke<Te.features.length;ke++)zt(Ne,Te.features[ke],ie,ke);else zt(Ne,Te.type==="Feature"?Te:{geometry:Te},ie);return Ne}(X,Y);this.tiles={},this.tileCoords=[],te&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Y.indexMaxZoom,Y.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),me=function(Te,ie){let Ne=ie.buffer/ie.extent,ke=Te,Be=Yi(Te,1,-1-Ne,Ne,0,-1,2,ie),Ze=Yi(Te,1,1-Ne,2+Ne,0,-1,2,ie);return(Be||Ze)&&(ke=Yi(Te,1,-Ne,1+Ne,0,-1,2,ie)||[],Be&&(ke=jn(Be,1).concat(ke)),Ze&&(ke=ke.concat(jn(Ze,-1)))),ke}(me,Y),me.length&&this.splitTile(me,0,0,0),te&&(me.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(X,Y,te,me,Te,ie,Ne){let ke=[X,Y,te,me],Be=this.options,Ze=Be.debug;for(;ke.length;){me=ke.pop(),te=ke.pop(),Y=ke.pop(),X=ke.pop();let De=1<<Y,at=qr(Y,te,me),mt=this.tiles[at];if(!mt&&(Ze>1&&console.time("creation"),mt=this.tiles[at]=no(X,Y,te,me,Be),this.tileCoords.push({z:Y,x:te,y:me}),Ze)){Ze>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Y,te,me,mt.numFeatures,mt.numPoints,mt.numSimplified),console.timeEnd("creation"));let Nt=`z${Y}`;this.stats[Nt]=(this.stats[Nt]||0)+1,this.total++}if(mt.source=X,Te==null){if(Y===Be.indexMaxZoom||mt.numPoints<=Be.indexMaxPoints)continue}else{if(Y===Be.maxZoom||Y===Te)continue;if(Te!=null){let Nt=Te-Y;if(te!==ie>>Nt||me!==Ne>>Nt)continue}}if(mt.source=null,X.length===0)continue;Ze>1&&console.time("clipping");let yt=.5*Be.buffer/Be.extent,Dt=.5-yt,Yt=.5+yt,Gt=1+yt,Ye=null,ri=null,ft=null,Si=null,Zt=Yi(X,De,te-yt,te+Yt,0,mt.minX,mt.maxX,Be),ot=Yi(X,De,te+Dt,te+Gt,0,mt.minX,mt.maxX,Be);X=null,Zt&&(Ye=Yi(Zt,De,me-yt,me+Yt,1,mt.minY,mt.maxY,Be),ri=Yi(Zt,De,me+Dt,me+Gt,1,mt.minY,mt.maxY,Be),Zt=null),ot&&(ft=Yi(ot,De,me-yt,me+Yt,1,mt.minY,mt.maxY,Be),Si=Yi(ot,De,me+Dt,me+Gt,1,mt.minY,mt.maxY,Be),ot=null),Ze>1&&console.timeEnd("clipping"),ke.push(Ye||[],Y+1,2*te,2*me),ke.push(ri||[],Y+1,2*te,2*me+1),ke.push(ft||[],Y+1,2*te+1,2*me),ke.push(Si||[],Y+1,2*te+1,2*me+1)}}getTile(X,Y,te){X=+X,Y=+Y,te=+te;let me=this.options,{extent:Te,debug:ie}=me;if(X<0||X>24)return null;let Ne=1<<X,ke=qr(X,Y=Y+Ne&Ne-1,te);if(this.tiles[ke])return mo(this.tiles[ke],Te);ie>1&&console.log("drilling down to z%d-%d-%d",X,Y,te);let Be,Ze=X,De=Y,at=te;for(;!Be&&Ze>0;)Ze--,De>>=1,at>>=1,Be=this.tiles[qr(Ze,De,at)];return Be&&Be.source?(ie>1&&(console.log("found parent tile z%d-%d-%d",Ze,De,at),console.time("drilling down")),this.splitTile(Be.source,Ze,De,at,X,Y,te),ie>1&&console.timeEnd("drilling down"),this.tiles[ke]?mo(this.tiles[ke],Te):null):null}}function qr(Re,X,Y){return 32*((1<<Re)*Y+X)+Re}function Tn(Re,X){return X?Re.properties[X]:Re.id}function Ti(Re,X){if(Re==null)return!0;if(Re.type==="Feature")return Tn(Re,X)!=null;if(Re.type==="FeatureCollection"){let Y=new Set;for(let te of Re.features){let me=Tn(te,X);if(me==null||Y.has(me))return!1;Y.add(me)}return!0}return!1}function dn(Re,X){let Y=new Map;if(Re!=null)if(Re.type==="Feature")Y.set(Tn(Re,X),Re);else for(let te of Re.features)Y.set(Tn(te,X),te);return Y}class An extends B{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(X,Y){return f._(this,void 0,void 0,function*(){let te=X.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");let me=this._geoJSONIndex.getTile(te.z,te.x,te.y);if(!me)return null;let Te=new Ve(me.features),ie=It(Te);return ie.byteOffset===0&&ie.byteLength===ie.buffer.byteLength||(ie=new Uint8Array(ie)),{vectorTile:Te,rawData:ie.buffer}})}loadData(X){return f._(this,void 0,void 0,function*(){var Y;(Y=this._pendingRequest)===null||Y===void 0||Y.abort();let te=!!(X&&X.request&&X.request.collectResourceTiming)&&new f.cE(X.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(X,this._pendingRequest),this._geoJSONIndex=X.cluster?new Ae(function({superclusterOptions:ie,clusterProperties:Ne}){if(!Ne||!ie)return ie;let ke={},Be={},Ze={accumulated:null,zoom:0},De={properties:null},at=Object.keys(Ne);for(let mt of at){let[yt,Dt]=Ne[mt],Yt=f.cL(Dt),Gt=f.cL(typeof yt=="string"?[yt,["accumulated"],["get",mt]]:yt);ke[mt]=Yt.value,Be[mt]=Gt.value}return ie.map=mt=>{De.properties=mt;let yt={};for(let Dt of at)yt[Dt]=ke[Dt].evaluate(Ze,De);return yt},ie.reduce=(mt,yt)=>{De.properties=yt;for(let Dt of at)Ze.accumulated=mt[Dt],mt[Dt]=Be[Dt].evaluate(Ze,De)},ie}(X)).load((yield this._pendingData).features):(me=yield this._pendingData,new Ot(me,X.geojsonVtOptions)),this.loaded={};let Te={};if(te){let ie=te.finish();ie&&(Te.resourceTiming={},Te.resourceTiming[X.source]=JSON.parse(JSON.stringify(ie)))}return Te}catch(Te){if(delete this._pendingRequest,f.cp(Te))return{abandoned:!0};throw Te}var me})}getData(){return f._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(X){let Y=this.loaded;return Y&&Y[X.uid]?super.reloadTile(X):this.loadTile(X)}loadAndProcessGeoJSON(X,Y){return f._(this,void 0,void 0,function*(){let te=yield this.loadGeoJSON(X,Y);if(delete this._pendingRequest,typeof te!="object")throw new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`);if(be(te,!0),X.filter){let me=f.cL(X.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(me.result==="error")throw new Error(me.value.map(ie=>`${ie.key}: ${ie.message}`).join(", "));te={type:"FeatureCollection",features:te.features.filter(ie=>me.value.evaluate({zoom:0},ie))}}return te})}loadGeoJSON(X,Y){return f._(this,void 0,void 0,function*(){let{promoteId:te}=X;if(X.request){let me=yield f.j(X.request,Y);return this._dataUpdateable=Ti(me.data,te)?dn(me.data,te):void 0,me.data}if(typeof X.data=="string")try{let me=JSON.parse(X.data);return this._dataUpdateable=Ti(me,te)?dn(me,te):void 0,me}catch{throw new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`)}if(!X.dataDiff)throw new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${X.source}`);return function(me,Te,ie){var Ne,ke,Be,Ze;if(Te.removeAll&&me.clear(),Te.remove)for(let De of Te.remove)me.delete(De);if(Te.add)for(let De of Te.add){let at=Tn(De,ie);at!=null&&me.set(at,De)}if(Te.update)for(let De of Te.update){let at=me.get(De.id);if(at==null)continue;let mt=!De.removeAllProperties&&(((Ne=De.removeProperties)===null||Ne===void 0?void 0:Ne.length)>0||((ke=De.addOrUpdateProperties)===null||ke===void 0?void 0:ke.length)>0);if((De.newGeometry||De.removeAllProperties||mt)&&(at=Object.assign({},at),me.set(De.id,at),mt&&(at.properties=Object.assign({},at.properties))),De.newGeometry&&(at.geometry=De.newGeometry),De.removeAllProperties)at.properties={};else if(((Be=De.removeProperties)===null||Be===void 0?void 0:Be.length)>0)for(let yt of De.removeProperties)Object.prototype.hasOwnProperty.call(at.properties,yt)&&delete at.properties[yt];if(((Ze=De.addOrUpdateProperties)===null||Ze===void 0?void 0:Ze.length)>0)for(let{key:yt,value:Dt}of De.addOrUpdateProperties)at.properties[yt]=Dt}}(this._dataUpdateable,X.dataDiff,te),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(X){return f._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(X){return this._geoJSONIndex.getClusterExpansionZoom(X.clusterId)}getClusterChildren(X){return this._geoJSONIndex.getChildren(X.clusterId)}getClusterLeaves(X){return this._geoJSONIndex.getLeaves(X.clusterId,X.limit,X.offset)}}class Rn{constructor(X){this.self=X,this.actor=new f.H(X),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(Y,te)=>{if(this.externalWorkerSourceTypes[Y])throw new Error(`Worker source with name "${Y}" already registered.`);this.externalWorkerSourceTypes[Y]=te},this.self.addProtocol=f.cr,this.self.removeProtocol=f.cs,this.self.registerRTLTextPlugin=Y=>{f.cM.setMethods(Y)},this.actor.registerMessageHandler("LDT",(Y,te)=>this._getDEMWorkerSource(Y,te.source).loadTile(te)),this.actor.registerMessageHandler("RDT",(Y,te)=>f._(this,void 0,void 0,function*(){this._getDEMWorkerSource(Y,te.source).removeTile(te)})),this.actor.registerMessageHandler("GCEZ",(Y,te)=>f._(this,void 0,void 0,function*(){return this._getWorkerSource(Y,te.type,te.source).getClusterExpansionZoom(te)})),this.actor.registerMessageHandler("GCC",(Y,te)=>f._(this,void 0,void 0,function*(){return this._getWorkerSource(Y,te.type,te.source).getClusterChildren(te)})),this.actor.registerMessageHandler("GCL",(Y,te)=>f._(this,void 0,void 0,function*(){return this._getWorkerSource(Y,te.type,te.source).getClusterLeaves(te)})),this.actor.registerMessageHandler("LD",(Y,te)=>this._getWorkerSource(Y,te.type,te.source).loadData(te)),this.actor.registerMessageHandler("GD",(Y,te)=>this._getWorkerSource(Y,te.type,te.source).getData()),this.actor.registerMessageHandler("LT",(Y,te)=>this._getWorkerSource(Y,te.type,te.source).loadTile(te)),this.actor.registerMessageHandler("RT",(Y,te)=>this._getWorkerSource(Y,te.type,te.source).reloadTile(te)),this.actor.registerMessageHandler("AT",(Y,te)=>this._getWorkerSource(Y,te.type,te.source).abortTile(te)),this.actor.registerMessageHandler("RMT",(Y,te)=>this._getWorkerSource(Y,te.type,te.source).removeTile(te)),this.actor.registerMessageHandler("RS",(Y,te)=>f._(this,void 0,void 0,function*(){if(!this.workerSources[Y]||!this.workerSources[Y][te.type]||!this.workerSources[Y][te.type][te.source])return;let me=this.workerSources[Y][te.type][te.source];delete this.workerSources[Y][te.type][te.source],me.removeSource!==void 0&&me.removeSource(te)})),this.actor.registerMessageHandler("RM",Y=>f._(this,void 0,void 0,function*(){delete this.layerIndexes[Y],delete this.availableImages[Y],delete this.workerSources[Y],delete this.demWorkerSources[Y]})),this.actor.registerMessageHandler("SR",(Y,te)=>f._(this,void 0,void 0,function*(){this.referrer=te})),this.actor.registerMessageHandler("SRPS",(Y,te)=>this._syncRTLPluginState(Y,te)),this.actor.registerMessageHandler("IS",(Y,te)=>f._(this,void 0,void 0,function*(){this.self.importScripts(te)})),this.actor.registerMessageHandler("SI",(Y,te)=>this._setImages(Y,te)),this.actor.registerMessageHandler("UL",(Y,te)=>f._(this,void 0,void 0,function*(){this._getLayerIndex(Y).update(te.layers,te.removedIds)})),this.actor.registerMessageHandler("SL",(Y,te)=>f._(this,void 0,void 0,function*(){this._getLayerIndex(Y).replace(te)}))}_setImages(X,Y){return f._(this,void 0,void 0,function*(){this.availableImages[X]=Y;for(let te in this.workerSources[X]){let me=this.workerSources[X][te];for(let Te in me)me[Te].availableImages=Y}})}_syncRTLPluginState(X,Y){return f._(this,void 0,void 0,function*(){return yield f.cM.syncState(Y,this.self.importScripts)})}_getAvailableImages(X){let Y=this.availableImages[X];return Y||(Y=[]),Y}_getLayerIndex(X){let Y=this.layerIndexes[X];return Y||(Y=this.layerIndexes[X]=new a),Y}_getWorkerSource(X,Y,te){if(this.workerSources[X]||(this.workerSources[X]={}),this.workerSources[X][Y]||(this.workerSources[X][Y]={}),!this.workerSources[X][Y][te]){let me={sendAsync:(Te,ie)=>(Te.targetMapId=X,this.actor.sendAsync(Te,ie))};switch(Y){case"vector":this.workerSources[X][Y][te]=new B(me,this._getLayerIndex(X),this._getAvailableImages(X));break;case"geojson":this.workerSources[X][Y][te]=new An(me,this._getLayerIndex(X),this._getAvailableImages(X));break;default:this.workerSources[X][Y][te]=new this.externalWorkerSourceTypes[Y](me,this._getLayerIndex(X),this._getAvailableImages(X))}}return this.workerSources[X][Y][te]}_getDEMWorkerSource(X,Y){return this.demWorkerSources[X]||(this.demWorkerSources[X]={}),this.demWorkerSources[X][Y]||(this.demWorkerSources[X][Y]=new W),this.demWorkerSources[X][Y]}}return f.i(self)&&(self.worker=new Rn(self)),Rn}),l("index",["exports","./shared"],function(f,a){"use strict";var P="5.5.0";function E(){var _=new a.A(4);return a.A!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_}let O,B,W={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(_,e,n){let h=requestAnimationFrame(y=>{d(),e(y)}),{unsubscribe:d}=a.s(_.signal,"abort",()=>{d(),cancelAnimationFrame(h),n(a.c())},!1)},frameAsync(_){return new Promise((e,n)=>{this.frame(_,e,n)})},getImageData(_,e=0){return this.getImageCanvasContext(_).getImageData(-e,-e,_.width+2*e,_.height+2*e)},getImageCanvasContext(_){let e=window.document.createElement("canvas"),n=e.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("failed to create canvas 2d context");return e.width=_.width,e.height=_.height,n.drawImage(_,0,0,_.width,_.height),n},resolveURL:_=>(O||(O=document.createElement("a")),O.href=_,O.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(B==null&&(B=matchMedia("(prefers-reduced-motion: reduce)")),B.matches)}};class V{static testProp(e){if(!V.docStyle)return e[0];for(let n=0;n<e.length;n++)if(e[n]in V.docStyle)return e[n];return e[0]}static create(e,n,h){let d=window.document.createElement(e);return n!==void 0&&(d.className=n),h&&h.appendChild(d),d}static createNS(e,n){return window.document.createElementNS(e,n)}static disableDrag(){V.docStyle&&V.selectProp&&(V.userSelect=V.docStyle[V.selectProp],V.docStyle[V.selectProp]="none")}static enableDrag(){V.docStyle&&V.selectProp&&(V.docStyle[V.selectProp]=V.userSelect)}static setTransform(e,n){e.style[V.transformProp]=n}static addEventListener(e,n,h,d={}){e.addEventListener(n,h,"passive"in d?d:d.capture)}static removeEventListener(e,n,h,d={}){e.removeEventListener(n,h,"passive"in d?d:d.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",V.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",V.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",V.suppressClickInternal,!0)},0)}static getScale(e){let n=e.getBoundingClientRect();return{x:n.width/e.offsetWidth||1,y:n.height/e.offsetHeight||1,boundingClientRect:n}}static getPoint(e,n,h){let d=n.boundingClientRect;return new a.P((h.clientX-d.left)/n.x-e.clientLeft,(h.clientY-d.top)/n.y-e.clientTop)}static mousePos(e,n){let h=V.getScale(e);return V.getPoint(e,h,n)}static touchPos(e,n){let h=[],d=V.getScale(e);for(let y=0;y<n.length;y++)h.push(V.getPoint(e,d,n[y]));return h}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){let n=new DOMParser().parseFromString(e,"text/html").body||document.createElement("body"),h=n.querySelectorAll("script");for(let d of h)d.remove();return V.clean(n),n.innerHTML}static isPossiblyDangerous(e,n){let h=n.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!h.includes("javascript:")&&!h.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){let n=e.children;for(let h of n)V.removeAttributes(h),V.clean(h)}static removeAttributes(e){for(let{name:n,value:h}of e.attributes)V.isPossiblyDangerous(n,h)&&e.removeAttribute(n)}}V.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,V.selectProp=V.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),V.transformProp=V.testProp(["transform","WebkitTransform"]);let he={supported:!1,testSupport:function(_){!ze&&be&&(Xe?Ve(_):ue=_)}},ue,be,ze=!1,Xe=!1;function Ve(_){let e=_.createTexture();_.bindTexture(_.TEXTURE_2D,e);try{if(_.texImage2D(_.TEXTURE_2D,0,_.RGBA,_.RGBA,_.UNSIGNED_BYTE,be),_.isContextLost())return;he.supported=!0}catch{}_.deleteTexture(e),ze=!0}var Se;typeof document<"u"&&(be=document.createElement("img"),be.onload=()=>{ue&&Ve(ue),ue=null,Xe=!0},be.onerror=()=>{ze=!0,ue=null},be.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(_){let e,n,h,d;_.resetRequestQueue=()=>{e=[],n=0,h=0,d={}},_.addThrottleControl=C=>{let k=h++;return d[k]=C,k},_.removeThrottleControl=C=>{delete d[C],b()},_.getImage=(C,k,R=!0)=>new Promise((j,N)=>{he.supported&&(C.headers||(C.headers={}),C.headers.accept="image/webp,*/*"),a.e(C,{type:"image"}),e.push({abortController:k,requestParameters:C,supportImageRefresh:R,state:"queued",onError:q=>{N(q)},onSuccess:q=>{j(q)}}),b()});let y=C=>a._(this,void 0,void 0,function*(){C.state="running";let{requestParameters:k,supportImageRefresh:R,onError:j,onSuccess:N,abortController:q}=C,H=R===!1&&!a.i(self)&&!a.g(k.url)&&(!k.headers||Object.keys(k.headers).reduce((se,pe)=>se&&pe==="accept",!0));n++;let ae=H?S(k,q):a.m(k,q);try{let se=yield ae;delete C.abortController,C.state="completed",se.data instanceof HTMLImageElement||a.b(se.data)?N(se):se.data&&N({data:yield(oe=se.data,typeof createImageBitmap=="function"?a.f(oe):a.h(oe)),cacheControl:se.cacheControl,expires:se.expires})}catch(se){delete C.abortController,j(se)}finally{n--,b()}var oe}),b=()=>{let C=(()=>{for(let k of Object.keys(d))if(d[k]())return!0;return!1})()?a.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:a.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let k=n;k<C&&e.length>0;k++){let R=e.shift();R.abortController.signal.aborted?k--:y(R)}},S=(C,k)=>new Promise((R,j)=>{let N=new Image,q=C.url,H=C.credentials;H&&H==="include"?N.crossOrigin="use-credentials":(H&&H==="same-origin"||!a.d(q))&&(N.crossOrigin="anonymous"),k.signal.addEventListener("abort",()=>{N.src="",j(a.c())}),N.fetchPriority="high",N.onload=()=>{N.onerror=N.onload=null,R({data:N})},N.onerror=()=>{N.onerror=N.onload=null,k.signal.aborted||j(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},N.src=q})}(Se||(Se={})),Se.resetRequestQueue();class nt{constructor(e){this._transformRequestFn=e}transformRequest(e,n){return this._transformRequestFn&&this._transformRequestFn(e,n)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function pt(_){let e=[];if(typeof _=="string")e.push({id:"default",url:_});else if(_&&_.length>0){let n=[];for(let{id:h,url:d}of _){let y=`${h}${d}`;n.indexOf(y)===-1&&(n.push(y),e.push({id:h,url:d}))}}return e}function Pt(_,e,n){try{let h=new URL(_);return h.pathname+=`${e}${n}`,h.toString()}catch{throw new Error(`Invalid sprite URL "${_}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}class kt{constructor(e,n,h,d){this.context=e,this.format=h,this.texture=e.gl.createTexture(),this.update(n,d)}update(e,n,h){let{width:d,height:y}=e,b=!(this.size&&this.size[0]===d&&this.size[1]===y||h),{context:S}=this,{gl:C}=S;if(this.useMipmap=!!(n&&n.useMipmap),C.bindTexture(C.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===C.RGBA&&(!n||n.premultiply!==!1)),b)this.size=[d,y],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||a.b(e)?C.texImage2D(C.TEXTURE_2D,0,this.format,this.format,C.UNSIGNED_BYTE,e):C.texImage2D(C.TEXTURE_2D,0,this.format,d,y,0,this.format,C.UNSIGNED_BYTE,e.data);else{let{x:k,y:R}=h||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||a.b(e)?C.texSubImage2D(C.TEXTURE_2D,0,k,R,C.RGBA,C.UNSIGNED_BYTE,e):C.texSubImage2D(C.TEXTURE_2D,0,k,R,d,y,C.RGBA,C.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&C.generateMipmap(C.TEXTURE_2D),S.pixelStoreUnpackFlipY.setDefault(),S.pixelStoreUnpack.setDefault(),S.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(e,n,h){let{context:d}=this,{gl:y}=d;y.bindTexture(y.TEXTURE_2D,this.texture),h!==y.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(h=y.LINEAR),e!==this.filter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,e),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,h||e),this.filter=e),n!==this.wrap&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,n),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){let{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function It(_){let{userImage:e}=_;return!!(e&&e.render&&e.render())&&(_.data.replace(new Uint8Array(e.data.buffer)),!0)}class Q extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(let{ids:n,promiseResolve:h}of this.requestors)h(this._getImagesForIds(n));this.requestors=[]}}getImage(e){let n=this.images[e];if(n&&!n.data&&n.spriteData){let h=n.spriteData;n.data=new a.R({width:h.width,height:h.height},h.context.getImageData(h.x,h.y,h.width,h.height).data),n.spriteData=null}return n}addImage(e,n){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,n)&&(this.images[e]=n)}_validate(e,n){let h=!0,d=n.data||n.spriteData;return this._validateStretch(n.stretchX,d&&d.width)||(this.fire(new a.k(new Error(`Image "${e}" has invalid "stretchX" value`))),h=!1),this._validateStretch(n.stretchY,d&&d.height)||(this.fire(new a.k(new Error(`Image "${e}" has invalid "stretchY" value`))),h=!1),this._validateContent(n.content,n)||(this.fire(new a.k(new Error(`Image "${e}" has invalid "content" value`))),h=!1),h}_validateStretch(e,n){if(!e)return!0;let h=0;for(let d of e){if(d[0]<h||d[1]<d[0]||n<d[1])return!1;h=d[1]}return!0}_validateContent(e,n){if(!e)return!0;if(e.length!==4)return!1;let h=n.spriteData,d=h&&h.width||n.data.width,y=h&&h.height||n.data.height;return!(e[0]<0||d<e[0]||e[1]<0||y<e[1]||e[2]<0||d<e[2]||e[3]<0||y<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,n,h=!0){let d=this.getImage(e);if(h&&(d.data.width!==n.data.width||d.data.height!==n.data.height))throw new Error(`size mismatch between old image (${d.data.width}x${d.data.height}) and new image (${n.data.width}x${n.data.height}).`);n.version=d.version+1,this.images[e]=n,this.updatedImages[e]=!0}removeImage(e){let n=this.images[e];delete this.images[e],delete this.patterns[e],n.userImage&&n.userImage.onRemove&&n.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((n,h)=>{let d=!0;if(!this.isLoaded())for(let y of e)this.images[y]||(d=!1);this.isLoaded()||d?n(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:n})})}_getImagesForIds(e){let n={};for(let h of e){let d=this.getImage(h);d||(this.fire(new a.l("styleimagemissing",{id:h})),d=this.getImage(h)),d?n[h]={data:d.data.clone(),pixelRatio:d.pixelRatio,sdf:d.sdf,version:d.version,stretchX:d.stretchX,stretchY:d.stretchY,content:d.content,textFitWidth:d.textFitWidth,textFitHeight:d.textFitHeight,hasRenderCallback:!!(d.userImage&&d.userImage.render)}:a.w(`Image "${h}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return n}getPixelSize(){let{width:e,height:n}=this.atlasImage;return{width:e,height:n}}getPattern(e){let n=this.patterns[e],h=this.getImage(e);if(!h)return null;if(n&&n.position.version===h.version)return n.position;if(n)n.position.version=h.version;else{let d={w:h.data.width+2,h:h.data.height+2,x:0,y:0},y=new a.I(d,h);this.patterns[e]={bin:d,position:y}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){let n=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new kt(e,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(){let e=[];for(let y in this.patterns)e.push(this.patterns[y].bin);let{w:n,h}=a.p(e),d=this.atlasImage;d.resize({width:n||1,height:h||1});for(let y in this.patterns){let{bin:b}=this.patterns[y],S=b.x+1,C=b.y+1,k=this.getImage(y).data,R=k.width,j=k.height;a.R.copy(k,d,{x:0,y:0},{x:S,y:C},{width:R,height:j}),a.R.copy(k,d,{x:0,y:j-1},{x:S,y:C-1},{width:R,height:1}),a.R.copy(k,d,{x:0,y:0},{x:S,y:C+j},{width:R,height:1}),a.R.copy(k,d,{x:R-1,y:0},{x:S-1,y:C},{width:1,height:j}),a.R.copy(k,d,{x:0,y:0},{x:S+R,y:C},{width:1,height:j})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(let n of e){if(this.callbackDispatchedThisFrame[n])continue;this.callbackDispatchedThisFrame[n]=!0;let h=this.getImage(n);h||a.w(`Image with ID: "${n}" was not found`),It(h)&&this.updateImage(n,h)}}}let re=1e20;function ce(_,e,n,h,d,y,b,S,C){for(let k=e;k<e+h;k++)Ie(_,n*y+k,y,d,b,S,C);for(let k=n;k<n+d;k++)Ie(_,k*y+e,1,h,b,S,C)}function Ie(_,e,n,h,d,y,b){y[0]=0,b[0]=-1e20,b[1]=re,d[0]=_[e];for(let S=1,C=0,k=0;S<h;S++){d[S]=_[e+S*n];let R=S*S;do{let j=y[C];k=(d[S]-d[j]+R-j*j)/(S-j)/2}while(k<=b[C]&&--C>-1);C++,y[C]=S,b[C]=k,b[C+1]=re}for(let S=0,C=0;S<h;S++){for(;b[C+1]<S;)C++;let k=y[C],R=S-k;_[e+S*n]=d[k]+R*R}}class de{constructor(e,n){this.requestManager=e,this.localIdeographFontFamily=n,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return a._(this,void 0,void 0,function*(){let n=[];for(let y in e)for(let b of e[y])n.push(this._getAndCacheGlyphsPromise(y,b));let h=yield Promise.all(n),d={};for(let{stack:y,id:b,glyph:S}of h)d[y]||(d[y]={}),d[y][b]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics};return d})}_getAndCacheGlyphsPromise(e,n){return a._(this,void 0,void 0,function*(){let h=this.entries[e];h||(h=this.entries[e]={glyphs:{},requests:{},ranges:{}});let d=h.glyphs[n];if(d!==void 0)return{stack:e,id:n,glyph:d};if(d=this._tinySDF(h,e,n),d)return h.glyphs[n]=d,{stack:e,id:n,glyph:d};let y=Math.floor(n/256);if(256*y>65535)throw new Error("glyphs > 65535 not supported");if(h.ranges[y])return{stack:e,id:n,glyph:d};if(!this.url)throw new Error("glyphsUrl is not set");if(!h.requests[y]){let S=de.loadGlyphRange(e,y,this.url,this.requestManager);h.requests[y]=S}let b=yield h.requests[y];for(let S in b)this._doesCharSupportLocalGlyph(+S)||(h.glyphs[+S]=b[+S]);return h.ranges[y]=!0,{stack:e,id:n,glyph:b[n]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))||a.u["CJK Unified Ideographs"](e)||a.u["Hangul Syllables"](e)||a.u.Hiragana(e)||a.u.Katakana(e)||a.u["CJK Symbols and Punctuation"](e)||a.u["Halfwidth and Fullwidth Forms"](e))}_tinySDF(e,n,h){let d=this.localIdeographFontFamily;if(!d||!this._doesCharSupportLocalGlyph(h))return;let y=e.tinySDF;if(!y){let S="400";/bold/i.test(n)?S="900":/medium/i.test(n)?S="500":/light/i.test(n)&&(S="200"),y=e.tinySDF=new de.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:d,fontWeight:S})}let b=y.draw(String.fromCharCode(h));return{id:h,bitmap:new a.q({width:b.width||60,height:b.height||60},b.data),metrics:{width:b.glyphWidth/2||24,height:b.glyphHeight/2||24,left:b.glyphLeft/2+.5||0,top:b.glyphTop/2-27.5||-8,advance:b.glyphAdvance/2||24,isDoubleResolution:!0}}}}de.loadGlyphRange=function(_,e,n,h){return a._(this,void 0,void 0,function*(){let d=256*e,y=d+255,b=h.transformRequest(n.replace("{fontstack}",_).replace("{range}",`${d}-${y}`),"Glyphs"),S=yield a.n(b,new AbortController);if(!S||!S.data)throw new Error(`Could not load glyph range. range: ${e}, ${d}-${y}`);let C={};for(let k of a.o(S.data))C[k.id]=k;return C})},de.TinySDF=class{constructor({fontSize:_=24,buffer:e=3,radius:n=8,cutoff:h=.25,fontFamily:d="sans-serif",fontWeight:y="normal",fontStyle:b="normal"}={}){this.buffer=e,this.cutoff=h,this.radius=n;let S=this.size=_+4*e,C=this._createCanvas(S),k=this.ctx=C.getContext("2d",{willReadFrequently:!0});k.font=`${b} ${y} ${_}px ${d}`,k.textBaseline="alphabetic",k.textAlign="left",k.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(_){let e=document.createElement("canvas");return e.width=e.height=_,e}draw(_){let{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:h,actualBoundingBoxLeft:d,actualBoundingBoxRight:y}=this.ctx.measureText(_),b=Math.ceil(n),S=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(y-d))),C=Math.min(this.size-this.buffer,b+Math.ceil(h)),k=S+2*this.buffer,R=C+2*this.buffer,j=Math.max(k*R,0),N=new Uint8ClampedArray(j),q={data:N,width:k,height:R,glyphWidth:S,glyphHeight:C,glyphTop:b,glyphLeft:0,glyphAdvance:e};if(S===0||C===0)return q;let{ctx:H,buffer:ae,gridInner:oe,gridOuter:se}=this;H.clearRect(ae,ae,S,C),H.fillText(_,ae,ae+b);let pe=H.getImageData(ae,ae,S,C);se.fill(re,0,j),oe.fill(0,0,j);for(let ve=0;ve<C;ve++)for(let ye=0;ye<S;ye++){let we=pe.data[4*(ve*S+ye)+3]/255;if(we===0)continue;let Le=(ve+ae)*k+ye+ae;if(we===1)se[Le]=0,oe[Le]=re;else{let Pe=.5-we;se[Le]=Pe>0?Pe*Pe:0,oe[Le]=Pe<0?Pe*Pe:0}}ce(se,0,0,k,R,k,this.f,this.v,this.z),ce(oe,ae,ae,S,C,k,this.f,this.v,this.z);for(let ve=0;ve<j;ve++){let ye=Math.sqrt(se[ve])-Math.sqrt(oe[ve]);N[ve]=Math.round(255-255*(ye/this.radius+this.cutoff))}return q}};class Oe{constructor(){this.specification=a.v.light.position}possiblyEvaluate(e,n){return a.z(e.expression.evaluate(n))}interpolate(e,n,h){return{x:a.B.number(e.x,n.x,h),y:a.B.number(e.y,n.y,h),z:a.B.number(e.z,n.z,h)}}}let Ae;class Ce extends a.E{constructor(e){super(),Ae=Ae||new a.r({anchor:new a.D(a.v.light.anchor),position:new Oe,color:new a.D(a.v.light.color),intensity:new a.D(a.v.light.intensity)}),this._transitionable=new a.T(Ae),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,n={}){if(!this._validate(a.t,e,n))for(let h in e){let d=e[h];h.endsWith("-transition")?this._transitionable.setTransition(h.slice(0,-11),d):this._transitionable.setValue(h,d)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,n,h){return(!h||h.validate!==!1)&&a.x(this,e.call(a.y,{value:n,style:{glyphs:!0,sprite:!0},styleSpec:a.v}))}}let ge=new a.r({"sky-color":new a.D(a.v.sky["sky-color"]),"horizon-color":new a.D(a.v.sky["horizon-color"]),"fog-color":new a.D(a.v.sky["fog-color"]),"fog-ground-blend":new a.D(a.v.sky["fog-ground-blend"]),"horizon-fog-blend":new a.D(a.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new a.D(a.v.sky["sky-horizon-blend"]),"atmosphere-blend":new a.D(a.v.sky["atmosphere-blend"])});class Fe extends a.E{constructor(e){super(),this._transitionable=new a.T(ge),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new a.C(0))}setSky(e,n={}){if(!this._validate(a.F,e,n)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(let h in e){let d=e[h];h.endsWith("-transition")?this._transitionable.setTransition(h.slice(0,-11),d):this._transitionable.setValue(h,d)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,n,h={}){return h?.validate!==!1&&a.x(this,e.call(a.y,a.e({value:n,style:{glyphs:!0,sprite:!0},styleSpec:a.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class Ee{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,n){let h=e.join(",")+String(n);return this.dashEntry[h]||(this.dashEntry[h]=this.addDash(e,n)),this.dashEntry[h]}getDashRanges(e,n,h){let d=[],y=e.length%2==1?-e[e.length-1]*h:0,b=e[0]*h,S=!0;d.push({left:y,right:b,isDash:S,zeroLength:e[0]===0});let C=e[0];for(let k=1;k<e.length;k++){S=!S;let R=e[k];y=C*h,C+=R,b=C*h,d.push({left:y,right:b,isDash:S,zeroLength:R===0})}return d}addRoundDash(e,n,h){let d=n/2;for(let y=-h;y<=h;y++){let b=this.width*(this.nextRow+h+y),S=0,C=e[S];for(let k=0;k<this.width;k++){k/C.right>1&&(C=e[++S]);let R=Math.abs(k-C.left),j=Math.abs(k-C.right),N=Math.min(R,j),q,H=y/h*(d+1);if(C.isDash){let ae=d-Math.abs(H);q=Math.sqrt(N*N+ae*ae)}else q=d-Math.sqrt(N*N+H*H);this.data[b+k]=Math.max(0,Math.min(255,q+128))}}}addRegularDash(e){for(let S=e.length-1;S>=0;--S){let C=e[S],k=e[S+1];C.zeroLength?e.splice(S,1):k&&k.isDash===C.isDash&&(k.left=C.left,e.splice(S,1))}let n=e[0],h=e[e.length-1];n.isDash===h.isDash&&(n.left=h.left-this.width,h.right=n.right+this.width);let d=this.width*this.nextRow,y=0,b=e[y];for(let S=0;S<this.width;S++){S/b.right>1&&(b=e[++y]);let C=Math.abs(S-b.left),k=Math.abs(S-b.right),R=Math.min(C,k);this.data[d+S]=Math.max(0,Math.min(255,(b.isDash?R:-R)+128))}}addDash(e,n){let h=n?7:0,d=2*h+1;if(this.nextRow+d>this.height)return a.w("LineAtlas out of space"),null;let y=0;for(let S=0;S<e.length;S++)y+=e[S];if(y!==0){let S=this.width/y,C=this.getDashRanges(e,this.width,S);n?this.addRoundDash(C,S,h):this.addRegularDash(C)}let b={y:(this.nextRow+h+.5)/this.height,height:2*h/this.height,width:y};return this.nextRow+=d,this.dirty=!0,b}bind(e){let n=e.gl;this.texture?(n.bindTexture(n.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,n.texSubImage2D(n.TEXTURE_2D,0,0,0,this.width,this.height,n.ALPHA,n.UNSIGNED_BYTE,this.data))):(this.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texImage2D(n.TEXTURE_2D,0,n.ALPHA,this.width,this.height,0,n.ALPHA,n.UNSIGNED_BYTE,this.data))}}let qe="maplibre_preloaded_worker_pool";class xt{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<xt.workerCount;)this.workers.push(new Worker(a.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[qe]}numActive(){return Object.keys(this.active).length}}let Tt=Math.floor(W.hardwareConcurrency/2),Et,St;function zt(){return Et||(Et=new xt),Et}xt.workerCount=a.G(globalThis)?Math.max(Math.min(Tt,3),1):1;class Ft{constructor(e,n){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=n;let h=this.workerPool.acquire(n);for(let d=0;d<h.length;d++){let y=new a.H(h[d],n);y.name=`Worker ${d}`,this.actors.push(y)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,n){let h=[];for(let d of this.actors)h.push(d.sendAsync({type:e,data:n}));return Promise.all(h)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(n=>{n.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,n){for(let h of this.actors)h.registerMessageHandler(e,n)}}function Qt(){return St||(St=new Ft(zt(),a.J),St.registerMessageHandler("GR",(_,e,n)=>a.m(e,n))),St}function Vi(_,e){let n=a.K();return a.L(n,n,[1,1,0]),a.M(n,n,[.5*_.width,.5*_.height,1]),_.calculatePosMatrix?a.N(n,n,_.calculatePosMatrix(e.toUnwrapped())):n}function Jn(_,e,n,h,d,y,b){var S;let C=function(N,q,H){if(N)for(let ae of N){let oe=q[ae];if(oe&&oe.source===H&&oe.type==="fill-extrusion")return!0}else for(let ae in q){let oe=q[ae];if(oe.source===H&&oe.type==="fill-extrusion")return!0}return!1}((S=d?.layers)!==null&&S!==void 0?S:null,e,_.id),k=y.maxPitchScaleFactor(),R=_.tilesIn(h,k,C);R.sort(hn);let j=[];for(let N of R)j.push({wrappedTileID:N.tileID.wrapped().key,queryResults:N.tile.queryRenderedFeatures(e,n,_._state,N.queryGeometry,N.cameraQueryGeometry,N.scale,d,y,k,Vi(_.transform,N.tileID),b?(q,H)=>b(N.tileID,q,H):void 0)});return function(N,q){for(let H in N)for(let ae of N[H])Yi(ae,q);return N}(function(N){let q={},H={};for(let ae of N){let oe=ae.queryResults,se=ae.wrappedTileID,pe=H[se]=H[se]||{};for(let ve in oe){let ye=oe[ve],we=pe[ve]=pe[ve]||{},Le=q[ve]=q[ve]||[];for(let Pe of ye)we[Pe.featureIndex]||(we[Pe.featureIndex]=!0,Le.push(Pe))}}return q}(j),_)}function hn(_,e){let n=_.tileID,h=e.tileID;return n.overscaledZ-h.overscaledZ||n.canonical.y-h.canonical.y||n.wrap-h.wrap||n.canonical.x-h.canonical.x}function Yi(_,e){let n=_.feature,h=e.getFeatureState(n.layer["source-layer"],n.id);n.source=n.layer.source,n.layer["source-layer"]&&(n.sourceLayer=n.layer["source-layer"]),n.state=h}function Ri(_,e,n){return a._(this,void 0,void 0,function*(){let h=_;if(_.url?h=(yield a.j(e.transformRequest(_.url,"Source"),n)).data:yield W.frameAsync(n),!h)return null;let d=a.O(a.e(h,_),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in h&&h.vector_layers&&(d.vectorLayerIds=h.vector_layers.map(y=>y.id)),d})}class _i{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof a.Q?new a.Q(e.lng,e.lat):a.Q.convert(e),this}setSouthWest(e){return this._sw=e instanceof a.Q?new a.Q(e.lng,e.lat):a.Q.convert(e),this}extend(e){let n=this._sw,h=this._ne,d,y;if(e instanceof a.Q)d=e,y=e;else{if(!(e instanceof _i))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(_i.convert(e)):this.extend(a.Q.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(a.Q.convert(e)):this;if(d=e._sw,y=e._ne,!d||!y)return this}return n||h?(n.lng=Math.min(d.lng,n.lng),n.lat=Math.min(d.lat,n.lat),h.lng=Math.max(y.lng,h.lng),h.lat=Math.max(y.lat,h.lat)):(this._sw=new a.Q(d.lng,d.lat),this._ne=new a.Q(y.lng,y.lat)),this}getCenter(){return new a.Q((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new a.Q(this.getWest(),this.getNorth())}getSouthEast(){return new a.Q(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:n,lat:h}=a.Q.convert(e),d=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&d}static convert(e){return e instanceof _i?e:e&&new _i(e)}static fromLngLat(e,n=0){let h=360*n/40075017,d=h/Math.cos(Math.PI/180*e.lat);return new _i(new a.Q(e.lng-d,e.lat-h),new a.Q(e.lng+d,e.lat+h))}adjustAntiMeridian(){let e=new a.Q(this._sw.lng,this._sw.lat),n=new a.Q(this._ne.lng,this._ne.lat);return new _i(e,e.lng>n.lng?new a.Q(n.lng+360,n.lat):n)}}class Ui{constructor(e,n,h){this.bounds=_i.convert(this.validateBounds(e)),this.minzoom=n||0,this.maxzoom=h||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){let n=Math.pow(2,e.z),h=Math.floor(a.U(this.bounds.getWest())*n),d=Math.floor(a.S(this.bounds.getNorth())*n),y=Math.ceil(a.U(this.bounds.getEast())*n),b=Math.ceil(a.S(this.bounds.getSouth())*n);return e.x>=h&&e.x<y&&e.y>=d&&e.y<b}}class Zi extends a.E{constructor(e,n,h,d){if(super(),this.id=e,this.dispatcher=h,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.e(this,a.O(n,["url","scheme","tileSize","promoteId"])),this._options=a.e({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(d)}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{let e=yield Ri(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(a.e(this,e),e.bounds&&(this.tileBounds=new Ui(e.bounds,this.minzoom,this.maxzoom)),this.fire(new a.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.l("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new a.k(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return a.e({},this._options)}loadTile(e){return a._(this,void 0,void 0,function*(){let n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),h={request:this.map._requestManager.transformRequest(n,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};h.request.collectResourceTiming=this._collectResourceTiming;let d="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((y,b)=>{e.reloadPromise={resolve:y,reject:b}})}else e.actor=this.dispatcher.getActor(),d="LT";e.abortController=new AbortController;try{let y=yield e.actor.sendAsync({type:d,data:h},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,y)}catch(y){if(delete e.abortController,e.aborted)return;if(y&&y.status!==404)throw y;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,n){if(n&&n.resourceTiming&&(e.resourceTiming=n.resourceTiming),n&&this.map._refreshExpiredTiles&&e.setExpiryData(n),e.loadVectorData(n,this.map.painter),e.reloadPromise){let h=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(h.resolve).catch(h.reject)}}abortTile(e){return a._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return a._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class ui extends a.E{constructor(e,n,h,d){super(),this.id=e,this.dispatcher=h,this.setEventedParent(d),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.e({type:"raster"},n),a.e(this,a.O(n,["url","scheme","tileSize"]))}load(){return a._(this,arguments,void 0,function*(e=!1){this._loaded=!1,this.fire(new a.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{let n=yield Ri(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,n&&(a.e(this,n),n.bounds&&(this.tileBounds=new Ui(n.bounds,this.minzoom,this.maxzoom)),this.fire(new a.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:e})))}catch(n){this._tileJSONRequest=null,this.fire(new a.k(n))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return a.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return a._(this,void 0,void 0,function*(){let n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{let h=yield Se.getImage(this.map._requestManager.transformRequest(n,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(h&&h.data){this.map._refreshExpiredTiles&&(h.cacheControl||h.expires)&&e.setExpiryData({cacheControl:h.cacheControl,expires:h.expires});let d=this.map.painter.context,y=d.gl,b=h.data;e.texture=this.map.painter.getTileTexture(b.width),e.texture?e.texture.update(b,{useMipmap:!0}):(e.texture=new kt(d,b,y.RGBA,{useMipmap:!0}),e.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE,y.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(h){if(delete e.abortController,e.aborted)e.state="unloaded";else if(h)throw e.state="errored",h}})}abortTile(e){return a._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return a._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class to extends ui{constructor(e,n,h,d){super(e,n,h,d),this.type="raster-dem",this.maxzoom=22,this._options=a.e({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox",this.redFactor=n.redFactor,this.greenFactor=n.greenFactor,this.blueFactor=n.blueFactor,this.baseShift=n.baseShift}loadTile(e){return a._(this,void 0,void 0,function*(){let n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),h=this.map._requestManager.transformRequest(n,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{let d=yield Se.getImage(h,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(d&&d.data){let y=d.data;this.map._refreshExpiredTiles&&(d.cacheControl||d.expires)&&e.setExpiryData({cacheControl:d.cacheControl,expires:d.expires});let b=a.b(y)&&a.V()?y:yield this.readImageNow(y),S={type:this.type,uid:e.uid,source:this.id,rawImageData:b,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();let C=yield e.actor.sendAsync({type:"LDT",data:S});e.dem=C,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(d){if(delete e.abortController,e.aborted)e.state="unloaded";else if(d)throw e.state="errored",d}})}readImageNow(e){return a._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&a.W()){let n=e.width+2,h=e.height+2;try{return new a.R({width:n,height:h},yield a.X(e,-1,-1,n,h))}catch{}}return W.getImageData(e,1)})}_getNeighboringTiles(e){let n=e.canonical,h=Math.pow(2,n.z),d=(n.x-1+h)%h,y=n.x===0?e.wrap-1:e.wrap,b=(n.x+1+h)%h,S=n.x+1===h?e.wrap+1:e.wrap,C={};return C[new a.Y(e.overscaledZ,y,n.z,d,n.y).key]={backfilled:!1},C[new a.Y(e.overscaledZ,S,n.z,b,n.y).key]={backfilled:!1},n.y>0&&(C[new a.Y(e.overscaledZ,y,n.z,d,n.y-1).key]={backfilled:!1},C[new a.Y(e.overscaledZ,e.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},C[new a.Y(e.overscaledZ,S,n.z,b,n.y-1).key]={backfilled:!1}),n.y+1<h&&(C[new a.Y(e.overscaledZ,y,n.z,d,n.y+1).key]={backfilled:!1},C[new a.Y(e.overscaledZ,e.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},C[new a.Y(e.overscaledZ,S,n.z,b,n.y+1).key]={backfilled:!1}),C}unloadTile(e){return a._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class Io extends a.E{constructor(e,n,h,d){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=h.getActor(),this.setEventedParent(d),this._data=n.data,this._options=a.e({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId,n.clusterMaxZoom!==void 0&&this.maxzoom<=n.clusterMaxZoom&&a.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${n.clusterMaxZoom}".`),this.workerOptions=a.e({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(n.buffer!==void 0?n.buffer:128),tolerance:this._pixelsToTileUnits(n.tolerance!==void 0?n.tolerance:.375),extent:a.Z,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:a.Z,radius:this._pixelsToTileUnits(n.clusterRadius||50),log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(e){return e*(a.Z/this.tileSize)}load(){return a._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return a._(this,void 0,void 0,function*(){let e=a.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}getCoordinatesFromGeometry(e){return e.type==="GeometryCollection"?e.geometries.map(n=>n.coordinates).flat(1/0):e.coordinates.flat(1/0)}getBounds(){return a._(this,void 0,void 0,function*(){let e=new _i,n=yield this.getData(),h;switch(n.type){case"FeatureCollection":h=n.features.map(d=>this.getCoordinatesFromGeometry(d.geometry)).flat(1/0);break;case"Feature":h=this.getCoordinatesFromGeometry(n.geometry);break;default:h=this.getCoordinatesFromGeometry(n)}if(h.length==0)return e;for(let d=0;d<h.length-1;d+=2)e.extend([h[d],h[d+1]]);return e})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,n,h){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:n,offset:h}})}_updateWorkerData(e){return a._(this,void 0,void 0,function*(){let n=a.e({type:this.type},this.workerOptions);e?n.dataDiff=e:typeof this._data=="string"?(n.request=this.map._requestManager.transformRequest(W.resolveURL(this._data),"Source"),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new a.l("dataloading",{dataType:"source"}));try{let h=yield this.actor.sendAsync({type:"LD",data:n});if(this._pendingLoads--,this._removed||h.abandoned)return void this.fire(new a.l("dataabort",{dataType:"source"}));let d=null;h.resourceTiming&&h.resourceTiming[this.id]&&(d=h.resourceTiming[this.id].slice(0));let y={dataType:"source"};this._collectResourceTiming&&d&&d.length>0&&a.e(y,{resourceTiming:d}),this.fire(new a.l("data",Object.assign(Object.assign({},y),{sourceDataType:"metadata"}))),this.fire(new a.l("data",Object.assign(Object.assign({},y),{sourceDataType:"content"})))}catch(h){if(this._pendingLoads--,this._removed)return void this.fire(new a.l("dataabort",{dataType:"source"}));this.fire(new a.k(h))}})}loaded(){return this._pendingLoads===0}loadTile(e){return a._(this,void 0,void 0,function*(){let n=e.actor?"RT":"LT";e.actor=this.actor;let h={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};e.abortController=new AbortController;let d=yield this.actor.sendAsync({type:n,data:h},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(d,this.map.painter,n==="RT")})}abortTile(e){return a._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return a._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return a.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class jn extends a.E{constructor(e,n,h,d){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=h,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(d),this.options=n}load(e){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{let n=yield Se.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,n&&n.data&&(this.image=n.data,e&&(this.coordinates=e),this._finishLoading())}catch(n){this._request=null,this._loaded=!0,this.fire(new a.k(n))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;let n=e.map(a.$.fromLngLat);var h;return this.tileID=function(d){let y=1/0,b=1/0,S=-1/0,C=-1/0;for(let N of d)y=Math.min(y,N.x),b=Math.min(b,N.y),S=Math.max(S,N.x),C=Math.max(C,N.y);let k=Math.max(S-y,C-b),R=Math.max(0,Math.floor(-Math.log(k)/Math.LN2)),j=Math.pow(2,R);return new a.a1(R,Math.floor((y+S)/2*j),Math.floor((b+C)/2*j))}(n),this.terrainTileRanges=this._getOverlappingTileRanges(n),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=n.map(d=>this.tileID.getTilePoint(d)._round()),this.flippedWindingOrder=((h=this.tileCoords)[1].x-h[0].x)*(h[2].y-h[0].y)-(h[1].y-h[0].y)*(h[2].x-h[0].x)<0,this.fire(new a.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;let e=this.map.painter.context,n=e.gl;this.texture||(this.texture=new kt(e,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let h=!1;for(let d in this.tiles){let y=this.tiles[d];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,h=!0)}h&&this.fire(new a.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return a._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(e){let n=1/0,h=1/0,d=-1/0,y=-1/0;for(let S of e)n=Math.min(n,S.x),h=Math.min(h,S.y),d=Math.max(d,S.x),y=Math.max(y,S.y);let b={};for(let S=0;S<=a.a0;S++){let C=Math.pow(2,S),k=Math.floor(n*C),R=Math.floor(h*C),j=Math.floor(d*C),N=Math.floor(y*C);b[S]={minTileX:k,minTileY:R,maxTileX:j,maxTileY:N}}return b}}class Pr extends jn{constructor(e,n,h,d){super(e,n,h,d),this.roundZoom=!0,this.type="video",this.options=n}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1;let e=this.options;this.urls=[];for(let n of e.urls)this.urls.push(this.map._requestManager.transformRequest(n,"Source").url);try{let n=yield a.a2(this.urls);if(this._loaded=!0,!n)return;this.video=n,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(n){this.fire(new a.k(n))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){let n=this.video.seekable;e<n.start(0)||e>n.end(0)?this.fire(new a.k(new a.a3(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let e=this.map.painter.context,n=e.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new kt(e,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let h=!1;for(let d in this.tiles){let y=this.tiles[d];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,h=!0)}h&&this.fire(new a.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class mo extends jn{constructor(e,n,h,d){super(e,n,h,d),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(y=>!Array.isArray(y)||y.length!==2||y.some(b=>typeof b!="number"))||this.fire(new a.k(new a.a3(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.k(new a.a3(`sources.${e}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new a.k(new a.a3(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new a.k(new a.a3(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.k(new a.a3(`sources.${e}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){return a._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let n=this.map.painter.context,h=n.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new kt(n,this.canvas,h.RGBA,{premultiply:!0});let d=!1;for(let y in this.tiles){let b=this.tiles[y];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,d=!0)}d&&this.fire(new a.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}let io={},no=_=>{switch(_){case"geojson":return Io;case"image":return jn;case"raster":return ui;case"raster-dem":return to;case"vector":return Zi;case"video":return Pr;case"canvas":return mo}return io[_]},Jo="RTLPluginLoaded";class ni extends a.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Qt()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(n=>{throw this.status="error",n})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return a._(this,arguments,void 0,function*(n,h=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=W.resolveURL(n),!this.url)throw new Error(`requested url ${n} is invalid`);if(this.status==="unavailable"){if(!h)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return a._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new a.l(Jo))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Gi=null;function Ot(){return Gi||(Gi=new ni),Gi}class qr{constructor(e,n){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=a.a4(),this.uses=0,this.tileSize=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){let n=e+this.timeAdded;n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,n,h){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(d,y){let b={};if(!y)return b;for(let S of d){let C=S.layerIds.map(k=>y.getLayer(k)).filter(Boolean);if(C.length!==0){S.layers=C,S.stateDependentLayerIds&&(S.stateDependentLayers=S.stateDependentLayerIds.map(k=>C.filter(R=>R.id===k)[0]));for(let k of C)b[k.id]=S}}return b}(e.buckets,n?.style),this.hasSymbolBuckets=!1;for(let d in this.buckets){let y=this.buckets[d];if(y instanceof a.a6){if(this.hasSymbolBuckets=!0,!h)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let d in this.buckets){let y=this.buckets[d];if(y instanceof a.a6&&y.hasRTLText){this.hasRTLText=!0,Ot().lazyLoad();break}}this.queryPadding=0;for(let d in this.buckets){let y=this.buckets[d];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(d).queryRadius(y))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new a.a5}unloadVectorData(){for(let e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(let h in this.buckets){let d=this.buckets[h];d.uploadPending()&&d.upload(e)}let n=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new kt(e,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new kt(e,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,n,h,d,y,b,S,C,k,R,j){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:d,cameraQueryGeometry:y,scale:b,tileSize:this.tileSize,pixelPosMatrix:R,transform:C,params:S,queryPadding:this.queryPadding*k,getElevation:j},e,n,h):{}}querySourceFeatures(e,n){let h=this.latestFeatureIndex;if(!h||!h.rawTileData)return;let d=h.loadVTLayers(),y=n&&n.sourceLayer?n.sourceLayer:"",b=d._geojsonTileLayer||d[y];if(!b)return;let S=a.a7(n&&n.filter),{z:C,x:k,y:R}=this.tileID.canonical,j={z:C,x:k,y:R};for(let N=0;N<b.length;N++){let q=b.feature(N);if(S.needGeometry){let oe=a.a8(q,!0);if(!S.filter(new a.C(this.tileID.overscaledZ),oe,this.tileID.canonical))continue}else if(!S.filter(new a.C(this.tileID.overscaledZ),q))continue;let H=h.getId(q,y),ae=new a.a9(q,C,k,R,H);ae.tile=j,e.push(ae)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){let n=this.expirationTime;if(e.cacheControl){let h=a.aa(e.cacheControl);h["max-age"]&&(this.expirationTime=Date.now()+1e3*h["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){let h=Date.now(),d=!1;if(this.expirationTime>h)d=!1;else if(n)if(this.expirationTime<n)d=!0;else{let y=this.expirationTime-n;y?this.expirationTime=h+Math.max(y,3e4):d=!0}else d=!0;d?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;let h=this.latestFeatureIndex.loadVTLayers();for(let d in this.buckets){if(!n.style.hasLayer(d))continue;let y=this.buckets[d],b=y.layers[0].sourceLayer||"_geojsonTileLayer",S=h[b],C=e[b];if(!S||!C||Object.keys(C).length===0)continue;y.update(C,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});let k=n&&n.style&&n.style.getLayer(d);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(y)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<W.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=W.now()+e}setDependencies(e,n){let h={};for(let d of n)h[d]=!0;this.dependencies[e]=h}hasDependency(e,n){for(let h of e){let d=this.dependencies[h];if(d){for(let y of n)if(d[y])return!0}}return!1}}class Tn{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(let e in this.data)for(let n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,h){let d=e.wrapped().key;this.data[d]===void 0&&(this.data[d]=[]);let y={value:n,timeout:void 0};if(h!==void 0&&(y.timeout=setTimeout(()=>{this.remove(e,y)},h)),this.data[d].push(y),this.order.push(d),this.order.length>this.max){let b=this._getAndRemoveByKey(this.order[0]);b&&this.onRemove(b)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){let n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){let n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;let h=e.wrapped().key,d=n===void 0?0:this.data[h].indexOf(n),y=this.data[h][d];return this.data[h].splice(d,1),y.timeout&&clearTimeout(y.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(y.value),this.order.splice(this.order.indexOf(h),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){let n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){let n=[];for(let h in this.data)for(let d of this.data[h])e(d.value)||n.push(d);for(let h of n)this.remove(h.value.tileID,h)}}class Ti{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,h){let d=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][d]=this.stateChanges[e][d]||{},a.e(this.stateChanges[e][d],h),this.deletedStates[e]===null){this.deletedStates[e]={};for(let y in this.state[e])y!==d&&(this.deletedStates[e][y]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][d]===null){this.deletedStates[e][d]={};for(let y in this.state[e][d])h[y]||(this.deletedStates[e][d][y]=null)}else for(let y in h)this.deletedStates[e]&&this.deletedStates[e][d]&&this.deletedStates[e][d][y]===null&&delete this.deletedStates[e][d][y]}removeFeatureState(e,n,h){if(this.deletedStates[e]===null)return;let d=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},h&&n!==void 0)this.deletedStates[e][d]!==null&&(this.deletedStates[e][d]=this.deletedStates[e][d]||{},this.deletedStates[e][d][h]=null);else if(n!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][d])for(h in this.deletedStates[e][d]={},this.stateChanges[e][d])this.deletedStates[e][d][h]=null;else this.deletedStates[e][d]=null;else this.deletedStates[e]=null}getState(e,n){let h=String(n),d=a.e({},(this.state[e]||{})[h],(this.stateChanges[e]||{})[h]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){let y=this.deletedStates[e][n];if(y===null)return{};for(let b in y)delete d[b]}return d}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){let h={};for(let d in this.stateChanges){this.state[d]=this.state[d]||{};let y={};for(let b in this.stateChanges[d])this.state[d][b]||(this.state[d][b]={}),a.e(this.state[d][b],this.stateChanges[d][b]),y[b]=this.state[d][b];h[d]=y}for(let d in this.deletedStates){this.state[d]=this.state[d]||{};let y={};if(this.deletedStates[d]===null)for(let b in this.state[d])y[b]={},this.state[d][b]={};else for(let b in this.deletedStates[d]){if(this.deletedStates[d][b]===null)this.state[d][b]={};else for(let S of Object.keys(this.deletedStates[d][b]))delete this.state[d][b][S];y[b]=this.state[d][b]}h[d]=h[d]||{},a.e(h[d],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(h).length!==0)for(let d in e)e[d].setFeatureState(h,n)}}let dn=89.25;function An(_,e){let n=a.ae(e.lat,-85.051129,a.af);return new a.P(a.U(e.lng)*_,a.S(n)*_)}function Rn(_,e){return new a.$(e.x/_,e.y/_).toLngLat()}function Re(_){return _.cameraToCenterDistance*Math.min(.85*Math.tan(a.ab(90-_.pitch)),Math.tan(a.ab(dn-_.pitch)))}function X(_,e){let n=_.canonical,h=e/a.ac(n.z),d=n.x+Math.pow(2,n.z)*_.wrap,y=a.ad(new Float64Array(16));return a.L(y,y,[d*h,n.y*h,0]),a.M(y,y,[h/a.Z,h/a.Z,1]),y}function Y(_,e,n,h,d){let y=a.$.fromLngLat(_,e),b=d*a.ag(1,_.lat),S=b*Math.cos(a.ab(n)),C=Math.sqrt(b*b-S*S),k=C*Math.sin(a.ab(-h)),R=C*Math.cos(a.ab(-h));return new a.$(y.x+k,y.y+R,y.z+S)}function te(_,e,n){let h=e.intersectsFrustum(_);if(!n)return h;let d=e.intersectsPlane(n);return h===0||d===0?0:h===2&&d===2?2:1}function me(_,e,n){let h=0,d=(n-e)/10;for(let y=0;y<10;y++)h+=d*Math.pow(Math.cos(e+(y+.5)/10*(n-e)),_);return h}function Te(_,e){return function(n,h,d,y,b){let S=2*((_-1)/a.ah(Math.cos(a.ab(dn-b))/Math.cos(a.ab(dn)))-1),C=Math.acos(d/y),k=2*me(S-1,0,a.ab(b/2)),R=Math.min(a.ab(dn),C+a.ab(b/2)),j=me(S-1,Math.min(R,C-a.ab(b/2)),R),N=Math.atan(h/d),q=Math.hypot(h,d),H=n;return H+=a.ah(y/q/Math.max(.5,Math.cos(a.ab(b/2)))),H+=S*a.ah(Math.cos(N))/2,H-=a.ah(Math.max(1,j/k/e))/2,H}}let ie=Te(9.314,3);function Ne(_,e){let n=(e.roundZoom?Math.round:Math.floor)(_.zoom+a.ah(_.tileSize/e.tileSize));return Math.max(0,n)}function ke(_,e){let n=_.getCameraFrustum(),h=_.getClippingPlane(),d=_.screenPointToMercatorCoordinate(_.getCameraPoint()),y=a.$.fromLngLat(_.center,_.elevation);d.z=y.z+Math.cos(_.pitchInRadians)*_.cameraToCenterDistance/_.worldSize;let b=_.getCoveringTilesDetailsProvider(),S=b.allowVariableZoom(_,e),C=Ne(_,e),k=e.minzoom||0,R=e.maxzoom!==void 0?e.maxzoom:_.maxZoom,j=Math.min(Math.max(0,C),R),N=Math.pow(2,j),q=[N*d.x,N*d.y,0],H=[N*y.x,N*y.y,0],ae=Math.hypot(y.x-d.x,y.y-d.y),oe=Math.abs(y.z-d.z),se=Math.hypot(ae,oe),pe=we=>({zoom:0,x:0,y:0,wrap:we,fullyVisible:!1}),ve=[],ye=[];if(_.renderWorldCopies&&b.allowWorldCopies())for(let we=1;we<=3;we++)ve.push(pe(-we)),ve.push(pe(we));for(ve.push(pe(0));ve.length>0;){let we=ve.pop(),Le=we.x,Pe=we.y,$e=we.fullyVisible,tt={x:Le,y:Pe,z:we.zoom},He=b.getTileAABB(tt,we.wrap,_.elevation,e);if(!$e){let gt=te(n,He,h);if(gt===0)continue;$e=gt===2}let Ke=b.distanceToTile2d(d.x,d.y,tt,He),Qe=C;S&&(Qe=(e.calculateTileZoom||ie)(_.zoom+a.ah(_.tileSize/e.tileSize),Ke,oe,se,_.fov)),Qe=(e.roundZoom?Math.round:Math.floor)(Qe),Qe=Math.max(0,Qe);let vt=Math.min(Qe,R);if(we.wrap=b.getWrap(y,tt,we.wrap),we.zoom>=vt){if(we.zoom<k)continue;let gt=j-we.zoom,ct=q[0]-.5-(Le<<gt),Lt=q[1]-.5-(Pe<<gt),li=e.reparseOverscaled?Math.max(we.zoom,Qe):we.zoom;ye.push({tileID:new a.Y(we.zoom===R?li:we.zoom,we.wrap,we.zoom,Le,Pe),distanceSq:a.ai([H[0]-.5-Le,H[1]-.5-Pe]),tileDistanceToCamera:Math.sqrt(ct*ct+Lt*Lt)})}else for(let gt=0;gt<4;gt++)ve.push({zoom:we.zoom+1,x:(Le<<1)+gt%2,y:(Pe<<1)+(gt>>1),wrap:we.wrap,fullyVisible:$e})}return ye.sort((we,Le)=>we.distanceSq-Le.distanceSq).map(we=>we.tileID)}class Be extends a.E{constructor(e,n,h){super(),this.id=e,this.dispatcher=h,this.on("data",d=>this._dataHandler(d)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((d,y,b,S)=>{let C=new(no(y.type))(d,y,b,S);if(C.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${C.id}`);return C})(e,n,h,this),this._tiles={},this._cache=new Tn(0,d=>this._unloadTile(d)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Ti,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(let e in this._tiles){let n=this._tiles[e];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,n,h){return a._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,n,h)}catch(d){e.state="errored",d.status!==404?this._source.fire(new a.k(d,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new a.l("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let n in this._tiles){let h=this._tiles[n];h.upload(e),h.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(Ze).map(e=>e.key)}getRenderableIds(e){let n=[];for(let h in this._tiles)this._isIdRenderable(h,e)&&n.push(this._tiles[h]);return e?n.sort((h,d)=>{let y=h.tileID,b=d.tileID,S=new a.P(y.canonical.x,y.canonical.y)._rotate(-this.transform.bearingInRadians),C=new a.P(b.canonical.x,b.canonical.y)._rotate(-this.transform.bearingInRadians);return y.overscaledZ-b.overscaledZ||C.y-S.y||C.x-S.x}).map(h=>h.tileID.key):n.map(h=>h.tileID).sort(Ze).map(h=>h.key)}hasRenderableParent(e){let n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())}reload(e){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let n in this._tiles)(e||this._tiles[n].state!=="errored")&&this._reloadTile(n,"reloading")}}_reloadTile(e,n){return a._(this,void 0,void 0,function*(){let h=this._tiles[e];h&&(h.state!=="loading"&&(h.state=n),yield this._loadTile(h,e,n))})}_tileLoaded(e,n,h){e.timeAdded=W.now(),h==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new a.l("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){let n=this.getRenderableIds();for(let d=0;d<n.length;d++){let y=n[d];if(e.neighboringTiles&&e.neighboringTiles[y]){let b=this.getTileByID(y);h(e,b),h(b,e)}}function h(d,y){d.needsHillshadePrepare=!0,d.needsTerrainPrepare=!0;let b=y.tileID.canonical.x-d.tileID.canonical.x,S=y.tileID.canonical.y-d.tileID.canonical.y,C=Math.pow(2,d.tileID.canonical.z),k=y.tileID.key;b===0&&S===0||Math.abs(S)>1||(Math.abs(b)>1&&(Math.abs(b+C)===1?b+=C:Math.abs(b-C)===1&&(b-=C)),y.dem&&d.dem&&(d.dem.backfillBorder(y.dem,b,S),d.neighboringTiles&&d.neighboringTiles[k]&&(d.neighboringTiles[k].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,h,d){for(let y in this._tiles){let b=this._tiles[y];if(d[y]||!b.hasData()||b.tileID.overscaledZ<=n||b.tileID.overscaledZ>h)continue;let S=b.tileID;for(;b&&b.tileID.overscaledZ>n+1;){let k=b.tileID.scaledTo(b.tileID.overscaledZ-1);b=this._tiles[k.key],b&&b.hasData()&&(S=k)}let C=S;for(;C.overscaledZ>n;)if(C=C.scaledTo(C.overscaledZ-1),e[C.key]||e[C.canonical.key]){d[S.key]=S;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){let h=this._loadedParentTiles[e.key];return h&&h.tileID.overscaledZ>=n?h:null}for(let h=e.overscaledZ-1;h>=n;h--){let d=e.scaledTo(h),y=this._getLoadedTile(d);if(y)return y}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){let n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){let n=Math.ceil(e.width/this._source.tileSize)+1,h=Math.ceil(e.height/this._source.tileSize)+1,d=Math.floor(n*h*(this._maxTileCacheZoomLevels===null?a.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),y=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,d):d;this._cache.setMaxSize(y)}handleWrapJump(e){let n=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,n){let h={};for(let d in this._tiles){let y=this._tiles[d];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+n),h[y.tileID.key]=y}this._tiles=h;for(let d in this._timers)clearTimeout(this._timers[d]),delete this._timers[d];for(let d in this._tiles)this._setTileReloadTimer(d,this._tiles[d])}}_updateCoveredAndRetainedTiles(e,n,h,d,y,b){let S={},C={},k=Object.keys(e),R=W.now();for(let j of k){let N=e[j],q=this._tiles[j];if(!q||q.fadeEndTime!==0&&q.fadeEndTime<=R)continue;let H=this.findLoadedParent(N,n),ae=this.findLoadedSibling(N),oe=H||ae||null;oe&&(this._addTile(oe.tileID),S[oe.tileID.key]=oe.tileID),C[j]=N}this._retainLoadedChildren(C,d,h,e);for(let j in S)e[j]||(this._coveredTiles[j]=!0,e[j]=S[j]);if(b){let j={},N={};for(let q of y)this._tiles[q.key].hasData()?j[q.key]=q:N[q.key]=q;for(let q in N){let H=N[q].children(this._source.maxzoom);this._tiles[H[0].key]&&this._tiles[H[1].key]&&this._tiles[H[2].key]&&this._tiles[H[3].key]&&(j[H[0].key]=e[H[0].key]=H[0],j[H[1].key]=e[H[1].key]=H[1],j[H[2].key]=e[H[2].key]=H[2],j[H[3].key]=e[H[3].key]=H[3],delete N[q])}for(let q in N){let H=N[q],ae=this.findLoadedParent(H,this._source.minzoom),oe=this.findLoadedSibling(H),se=ae||oe||null;if(se){j[se.tileID.key]=e[se.tileID.key]=se.tileID;for(let pe in j)j[pe].isChildOf(se.tileID)&&delete j[pe]}}for(let q in this._tiles)j[q]||(this._coveredTiles[q]=!0)}}update(e,n){if(!this._sourceLoaded||this._paused)return;let h;this.transform=e,this.terrain=n,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?h=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(R=>new a.Y(R.canonical.z,R.wrap,R.canonical.z,R.canonical.x,R.canonical.y)):(h=ke(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:n,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(h=h.filter(R=>this._source.hasTile(R)))):h=[];let d=Ne(e,this._source),y=Math.max(d-Be.maxOverzooming,this._source.minzoom),b=Math.max(d+Be.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){let R={};for(let j of h)if(j.canonical.z>this._source.minzoom){let N=j.scaledTo(j.canonical.z-1);R[N.key]=N;let q=j.scaledTo(Math.max(this._source.minzoom,Math.min(j.canonical.z,5)));R[q.key]=q}h=h.concat(Object.values(R))}let S=h.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,S&&this.fire(new a.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));let C=this._updateRetainedTiles(h,d);De(this._source.type)&&this._updateCoveredAndRetainedTiles(C,y,b,d,h,n);for(let R in C)this._tiles[R].clearFadeHold();let k=a.aj(this._tiles,C);for(let R of k){let j=this._tiles[R];j.hasSymbolBuckets&&!j.holdingForFade()?j.setHoldDuration(this.map._fadeDuration):j.hasSymbolBuckets&&!j.symbolFadeFinished()||this._removeTile(R)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(let e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,n){var h;let d={},y={},b=Math.max(n-Be.maxOverzooming,this._source.minzoom),S=Math.max(n+Be.maxUnderzooming,this._source.minzoom),C={};for(let k of e){let R=this._addTile(k);d[k.key]=k,R.hasData()||n<this._source.maxzoom&&(C[k.key]=k)}this._retainLoadedChildren(C,n,S,d);for(let k of e){let R=this._tiles[k.key];if(R.hasData())continue;if(n+1>this._source.maxzoom){let N=k.children(this._source.maxzoom)[0],q=this.getTile(N);if(q&&q.hasData()){d[N.key]=N;continue}}else{let N=k.children(this._source.maxzoom);if(d[N[0].key]&&d[N[1].key]&&d[N[2].key]&&d[N[3].key])continue}let j=R.wasRequested();for(let N=k.overscaledZ-1;N>=b;--N){let q=k.scaledTo(N);if(y[q.key])break;if(y[q.key]=!0,R=this.getTile(q),!R&&j&&(R=this._addTile(q)),R){let H=R.hasData();if((H||!(!((h=this.map)===null||h===void 0)&&h.cancelPendingTileRequestsWhileZooming)||j)&&(d[q.key]=q),j=R.wasRequested(),H)break}}}return d}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let e in this._tiles){let n=[],h,d=this._tiles[e].tileID;for(;d.overscaledZ>0;){if(d.key in this._loadedParentTiles){h=this._loadedParentTiles[d.key];break}n.push(d.key);let y=d.scaledTo(d.overscaledZ-1);if(h=this._getLoadedTile(y),h)break;d=y}for(let y of n)this._loadedParentTiles[y]=h}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(let e in this._tiles){let n=this._tiles[e].tileID,h=this._getLoadedTile(n);this._loadedSiblingTiles[n.key]=h}}_addTile(e){let n=this._tiles[e.key];if(n)return n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));let h=n;return n||(n=new qr(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(n,e.key,n.state)),n.uses++,this._tiles[e.key]=n,h||this._source.fire(new a.l("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);let h=n.getExpiryTimeout();h&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},h))}refreshTiles(e){for(let n in this._tiles)this._isIdRenderable(n)&&e.some(h=>h.equals(this._tiles[n].tileID.canonical))&&this._reloadTile(n,"expired")}_removeTile(e){let n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}_dataHandler(e){let n=e.sourceDataType;e.dataType==="source"&&n==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&n==="content"&&(this.reload(e.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,n,h){let d=[],y=this.transform;if(!y)return d;let b=h?y.getCameraQueryGeometry(e):e,S=e.map(H=>y.screenPointToMercatorCoordinate(H,this.terrain)),C=b.map(H=>y.screenPointToMercatorCoordinate(H,this.terrain)),k=this.getIds(),R=1/0,j=1/0,N=-1/0,q=-1/0;for(let H of C)R=Math.min(R,H.x),j=Math.min(j,H.y),N=Math.max(N,H.x),q=Math.max(q,H.y);for(let H=0;H<k.length;H++){let ae=this._tiles[k[H]];if(ae.holdingForFade())continue;let oe=y.getCoveringTilesDetailsProvider().allowWorldCopies()?ae.tileID:ae.tileID.unwrapTo(0),se=Math.pow(2,y.zoom-ae.tileID.overscaledZ),pe=n*ae.queryPadding*a.Z/ae.tileSize/se,ve=[oe.getTilePoint(new a.$(R,j)),oe.getTilePoint(new a.$(N,q))];if(ve[0].x-pe<a.Z&&ve[0].y-pe<a.Z&&ve[1].x+pe>=0&&ve[1].y+pe>=0){let ye=S.map(Le=>oe.getTilePoint(Le)),we=C.map(Le=>oe.getTilePoint(Le));d.push({tile:ae,tileID:oe,queryGeometry:ye,cameraQueryGeometry:we,scale:se})}}return d}getVisibleCoordinates(e){let n=this.getRenderableIds(e).map(h=>this._tiles[h].tileID);return this.transform&&this.transform.populateCache(n),n}hasTransition(){if(this._source.hasTransition())return!0;if(De(this._source.type)){let e=W.now();for(let n in this._tiles)if(this._tiles[n].fadeEndTime>=e)return!0}return!1}setFeatureState(e,n,h){this._state.updateState(e=e||"_geojsonTileLayer",n,h)}removeFeatureState(e,n,h){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,h)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,h){let d=this._tiles[e];d&&d.setDependencies(n,h)}reloadTilesForDependencies(e,n){for(let h in this._tiles)this._tiles[h].hasDependency(e,n)&&this._reloadTile(h,"reloading");this._cache.filter(h=>!h.hasDependency(e,n))}}function Ze(_,e){let n=Math.abs(2*_.wrap)-+(_.wrap<0),h=Math.abs(2*e.wrap)-+(e.wrap<0);return _.overscaledZ-e.overscaledZ||h-n||e.canonical.y-_.canonical.y||e.canonical.x-_.canonical.x}function De(_){return _==="raster"||_==="image"||_==="video"}Be.maxOverzooming=10,Be.maxUnderzooming=3;class at{constructor(e,n){this.reset(e,n)}reset(e,n){this.points=e||[],this._distances=[0];for(let h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=a.ae(e,0,1);let n=1,h=this._distances[n],d=e*this.paddedLength+this.padding;for(;h<d&&n<this._distances.length;)h=this._distances[++n];let y=n-1,b=this._distances[y],S=h-b,C=S>0?(d-b)/S:0;return this.points[y].mult(1-C).add(this.points[n].mult(C))}}function mt(_,e){let n=!0;return _==="always"||_!=="never"&&e!=="never"||(n=!1),n}class yt{constructor(e,n,h){let d=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(e/h),this.yCellCount=Math.ceil(n/h);for(let b=0;b<this.xCellCount*this.yCellCount;b++)d.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=n,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,n,h,d,y){this._forEachCell(n,h,d,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(n),this.bboxes.push(h),this.bboxes.push(d),this.bboxes.push(y)}insertCircle(e,n,h,d){this._forEachCell(n-d,h-d,n+d,h+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(n),this.circles.push(h),this.circles.push(d)}_insertBoxCell(e,n,h,d,y,b){this.boxCells[y].push(b)}_insertCircleCell(e,n,h,d,y,b){this.circleCells[y].push(b)}_query(e,n,h,d,y,b,S){if(h<0||e>this.width||d<0||n>this.height)return[];let C=[];if(e<=0&&n<=0&&this.width<=h&&this.height<=d){if(y)return[{key:null,x1:e,y1:n,x2:h,y2:d}];for(let k=0;k<this.boxKeys.length;k++)C.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(let k=0;k<this.circleKeys.length;k++){let R=this.circles[3*k],j=this.circles[3*k+1],N=this.circles[3*k+2];C.push({key:this.circleKeys[k],x1:R-N,y1:j-N,x2:R+N,y2:j+N})}}else this._forEachCell(e,n,h,d,this._queryCell,C,{hitTest:y,overlapMode:b,seenUids:{box:{},circle:{}}},S);return C}query(e,n,h,d){return this._query(e,n,h,d,!1,null)}hitTest(e,n,h,d,y,b){return this._query(e,n,h,d,!0,y,b).length>0}hitTestCircle(e,n,h,d,y){let b=e-h,S=e+h,C=n-h,k=n+h;if(S<0||b>this.width||k<0||C>this.height)return!1;let R=[];return this._forEachCell(b,C,S,k,this._queryCellCircle,R,{hitTest:!0,overlapMode:d,circle:{x:e,y:n,radius:h},seenUids:{box:{},circle:{}}},y),R.length>0}_queryCell(e,n,h,d,y,b,S,C){let{seenUids:k,hitTest:R,overlapMode:j}=S,N=this.boxCells[y];if(N!==null){let H=this.bboxes;for(let ae of N)if(!k.box[ae]){k.box[ae]=!0;let oe=4*ae,se=this.boxKeys[ae];if(e<=H[oe+2]&&n<=H[oe+3]&&h>=H[oe+0]&&d>=H[oe+1]&&(!C||C(se))&&(!R||!mt(j,se.overlapMode))&&(b.push({key:se,x1:H[oe],y1:H[oe+1],x2:H[oe+2],y2:H[oe+3]}),R))return!0}}let q=this.circleCells[y];if(q!==null){let H=this.circles;for(let ae of q)if(!k.circle[ae]){k.circle[ae]=!0;let oe=3*ae,se=this.circleKeys[ae];if(this._circleAndRectCollide(H[oe],H[oe+1],H[oe+2],e,n,h,d)&&(!C||C(se))&&(!R||!mt(j,se.overlapMode))){let pe=H[oe],ve=H[oe+1],ye=H[oe+2];if(b.push({key:se,x1:pe-ye,y1:ve-ye,x2:pe+ye,y2:ve+ye}),R)return!0}}}return!1}_queryCellCircle(e,n,h,d,y,b,S,C){let{circle:k,seenUids:R,overlapMode:j}=S,N=this.boxCells[y];if(N!==null){let H=this.bboxes;for(let ae of N)if(!R.box[ae]){R.box[ae]=!0;let oe=4*ae,se=this.boxKeys[ae];if(this._circleAndRectCollide(k.x,k.y,k.radius,H[oe+0],H[oe+1],H[oe+2],H[oe+3])&&(!C||C(se))&&!mt(j,se.overlapMode))return b.push(!0),!0}}let q=this.circleCells[y];if(q!==null){let H=this.circles;for(let ae of q)if(!R.circle[ae]){R.circle[ae]=!0;let oe=3*ae,se=this.circleKeys[ae];if(this._circlesCollide(H[oe],H[oe+1],H[oe+2],k.x,k.y,k.radius)&&(!C||C(se))&&!mt(j,se.overlapMode))return b.push(!0),!0}}}_forEachCell(e,n,h,d,y,b,S,C){let k=this._convertToXCellCoord(e),R=this._convertToYCellCoord(n),j=this._convertToXCellCoord(h),N=this._convertToYCellCoord(d);for(let q=k;q<=j;q++)for(let H=R;H<=N;H++)if(y.call(this,e,n,h,d,this.xCellCount*H+q,b,S,C))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,n,h,d,y,b){let S=d-e,C=y-n,k=h+b;return k*k>S*S+C*C}_circleAndRectCollide(e,n,h,d,y,b,S){let C=(b-d)/2,k=Math.abs(e-(d+C));if(k>C+h)return!1;let R=(S-y)/2,j=Math.abs(n-(y+R));if(j>R+h)return!1;if(k<=C||j<=R)return!0;let N=k-C,q=j-R;return N*N+q*q<=h*h}}function Dt(_,e,n){let h=a.K();if(!_){let{vecSouth:j,vecEast:N}=Gt(e),q=E();q[0]=N[0],q[1]=N[1],q[2]=j[0],q[3]=j[1],d=q,(R=(b=(y=q)[0])*(k=y[3])-(C=y[2])*(S=y[1]))&&(d[0]=k*(R=1/R),d[1]=-S*R,d[2]=-C*R,d[3]=b*R),h[0]=q[0],h[1]=q[1],h[4]=q[2],h[5]=q[3]}var d,y,b,S,C,k,R;return a.M(h,h,[1/n,1/n,1]),h}function Yt(_,e,n,h){if(_){let d=a.K();if(!e){let{vecSouth:y,vecEast:b}=Gt(n);d[0]=b[0],d[1]=b[1],d[4]=y[0],d[5]=y[1]}return a.M(d,d,[h,h,1]),d}return n.pixelsToClipSpaceMatrix}function Gt(_){let e=Math.cos(_.rollInRadians),n=Math.sin(_.rollInRadians),h=Math.cos(_.pitchInRadians),d=Math.cos(_.bearingInRadians),y=Math.sin(_.bearingInRadians),b=a.ao();b[0]=-d*h*n-y*e,b[1]=-y*h*n+d*e;let S=a.ap(b);S<1e-9?a.aq(b):a.ar(b,b,1/S);let C=a.ao();C[0]=d*h*e-y*n,C[1]=y*h*e+d*n;let k=a.ap(C);return k<1e-9?a.aq(C):a.ar(C,C,1/k),{vecEast:C,vecSouth:b}}function Ye(_,e,n,h){let d;h?(d=[_,e,h(_,e),1],a.at(d,d,n)):(d=[_,e,0,1],rn(d,d,n));let y=d[3];return{point:new a.P(d[0]/y,d[1]/y),signedDistanceFromCamera:y,isOccluded:!1}}function ri(_,e){return .5+_/e*.5}function ft(_,e){return _.x>=-e[0]&&_.x<=e[0]&&_.y>=-e[1]&&_.y<=e[1]}function Si(_,e,n,h,d,y,b,S,C,k,R,j,N){let q=n?_.textSizeData:_.iconSizeData,H=a.ak(q,e.transform.zoom),ae=[256/e.width*2+1,256/e.height*2+1],oe=n?_.text.dynamicLayoutVertexArray:_.icon.dynamicLayoutVertexArray;oe.clear();let se=_.lineVertexArray,pe=n?_.text.placedSymbolArray:_.icon.placedSymbolArray,ve=e.transform.width/e.transform.height,ye=!1;for(let we=0;we<pe.length;we++){let Le=pe.get(we);if(Le.hidden||Le.writingMode===a.al.vertical&&!ye){nn(Le.numGlyphs,oe);continue}ye=!1;let Pe=new a.P(Le.anchorX,Le.anchorY),$e={getElevation:N,pitchedLabelPlaneMatrix:h,lineVertexArray:se,pitchWithMap:y,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:e.transform,tileAnchorPoint:Pe,unwrappedTileID:C,width:k,height:R,translation:j},tt=ei(Le.anchorX,Le.anchorY,$e);if(!ft(tt.point,ae)){nn(Le.numGlyphs,oe);continue}let He=ri(e.transform.cameraToCenterDistance,tt.signedDistanceFromCamera),Ke=a.am(q,H,Le),Qe=y?Ke*e.transform.getPitchedTextCorrection(Le.anchorX,Le.anchorY,C)/He:Ke*He,vt=Nt({projectionContext:$e,pitchedLabelPlaneMatrixInverse:d,symbol:Le,fontSize:Qe,flip:!1,keepUpright:b,glyphOffsetArray:_.glyphOffsetArray,dynamicLayoutVertexArray:oe,aspectRatio:ve,rotateToLine:S});ye=vt.useVertical,(vt.notEnoughRoom||ye||vt.needsFlipping&&Nt({projectionContext:$e,pitchedLabelPlaneMatrixInverse:d,symbol:Le,fontSize:Qe,flip:!0,keepUpright:b,glyphOffsetArray:_.glyphOffsetArray,dynamicLayoutVertexArray:oe,aspectRatio:ve,rotateToLine:S}).notEnoughRoom)&&nn(Le.numGlyphs,oe)}n?_.text.dynamicLayoutVertexBuffer.updateData(oe):_.icon.dynamicLayoutVertexBuffer.updateData(oe)}function Zt(_,e,n,h,d,y,b,S){let C=y.glyphStartIndex+y.numGlyphs,k=y.lineStartIndex,R=y.lineStartIndex+y.lineLength,j=e.getoffsetX(y.glyphStartIndex),N=e.getoffsetX(C-1),q=Pi(_*j,n,h,d,y.segment,k,R,S,b);if(!q)return null;let H=Pi(_*N,n,h,d,y.segment,k,R,S,b);return H?S.projectionCache.anyProjectionOccluded?null:{first:q,last:H}:null}function ot(_,e,n,h){return _===a.al.horizontal&&Math.abs(n.y-e.y)>Math.abs(n.x-e.x)*h?{useVertical:!0}:(_===a.al.vertical?e.y<n.y:e.x>n.x)?{needsFlipping:!0}:null}function Nt(_){let{projectionContext:e,pitchedLabelPlaneMatrixInverse:n,symbol:h,fontSize:d,flip:y,keepUpright:b,glyphOffsetArray:S,dynamicLayoutVertexArray:C,aspectRatio:k,rotateToLine:R}=_,j=d/24,N=h.lineOffsetX*j,q=h.lineOffsetY*j,H;if(h.numGlyphs>1){let ae=h.glyphStartIndex+h.numGlyphs,oe=h.lineStartIndex,se=h.lineStartIndex+h.lineLength,pe=Zt(j,S,N,q,y,h,R,e);if(!pe)return{notEnoughRoom:!0};let ve=Qn(pe.first.point.x,pe.first.point.y,e,n),ye=Qn(pe.last.point.x,pe.last.point.y,e,n);if(b&&!y){let we=ot(h.writingMode,ve,ye,k);if(we)return we}H=[pe.first];for(let we=h.glyphStartIndex+1;we<ae-1;we++)H.push(Pi(j*S.getoffsetX(we),N,q,y,h.segment,oe,se,e,R));H.push(pe.last)}else{if(b&&!y){let oe=$i(e.tileAnchorPoint.x,e.tileAnchorPoint.y,e).point,se=h.lineStartIndex+h.segment+1,pe=new a.P(e.lineVertexArray.getx(se),e.lineVertexArray.gety(se)),ve=$i(pe.x,pe.y,e),ye=ve.signedDistanceFromCamera>0?ve.point:Kt(e.tileAnchorPoint,pe,oe,1,e),we=Qn(oe.x,oe.y,e,n),Le=Qn(ye.x,ye.y,e,n),Pe=ot(h.writingMode,we,Le,k);if(Pe)return Pe}let ae=Pi(j*S.getoffsetX(h.glyphStartIndex),N,q,y,h.segment,h.lineStartIndex,h.lineStartIndex+h.lineLength,e,R);if(!ae||e.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};H=[ae]}for(let ae of H)a.as(C,ae.point,ae.angle);return{}}function Kt(_,e,n,h,d){let y=_.add(_.sub(e)._unit()),b=$i(y.x,y.y,d).point,S=n.sub(b);return n.add(S._mult(h/S.mag()))}function Hi(_,e,n){let h=e.projectionCache;if(h.projections[_])return h.projections[_];let d=new a.P(e.lineVertexArray.getx(_),e.lineVertexArray.gety(_)),y=$i(d.x,d.y,e);if(y.signedDistanceFromCamera>0)return h.projections[_]=y.point,h.anyProjectionOccluded=h.anyProjectionOccluded||y.isOccluded,y.point;let b=_-n.direction;return Kt(n.distanceFromAnchor===0?e.tileAnchorPoint:new a.P(e.lineVertexArray.getx(b),e.lineVertexArray.gety(b)),d,n.previousVertex,n.absOffsetX-n.distanceFromAnchor+1,e)}function $i(_,e,n){let h=_+n.translation[0],d=e+n.translation[1],y;return n.pitchWithMap?(y=Ye(h,d,n.pitchedLabelPlaneMatrix,n.getElevation),y.isOccluded=!1):(y=n.transform.projectTileCoordinates(h,d,n.unwrappedTileID,n.getElevation),y.point.x=(.5*y.point.x+.5)*n.width,y.point.y=(.5*-y.point.y+.5)*n.height),y}function Qn(_,e,n,h){if(n.pitchWithMap){let d=[_,e,0,1];return a.at(d,d,h),n.transform.projectTileCoordinates(d[0]/d[3],d[1]/d[3],n.unwrappedTileID,n.getElevation).point}return{x:_/n.width*2-1,y:e/n.height*2-1}}function ei(_,e,n){return n.transform.projectTileCoordinates(_,e,n.unwrappedTileID,n.getElevation)}function Qo(_,e,n){return _._unit()._perp()._mult(e*n)}function We(_,e,n,h,d,y,b,S,C){if(S.projectionCache.offsets[_])return S.projectionCache.offsets[_];let k=n.add(e);if(_+C.direction<h||_+C.direction>=d)return S.projectionCache.offsets[_]=k,k;let R=Hi(_+C.direction,S,C),j=Qo(R.sub(n),b,C.direction),N=n.add(j),q=R.add(j);return S.projectionCache.offsets[_]=a.au(y,k,N,q)||k,S.projectionCache.offsets[_]}function Pi(_,e,n,h,d,y,b,S,C){let k=h?_-e:_+e,R=k>0?1:-1,j=0;h&&(R*=-1,j=Math.PI),R<0&&(j+=Math.PI);let N,q=R>0?y+d:y+d+1;S.projectionCache.cachedAnchorPoint?N=S.projectionCache.cachedAnchorPoint:(N=$i(S.tileAnchorPoint.x,S.tileAnchorPoint.y,S).point,S.projectionCache.cachedAnchorPoint=N);let H,ae,oe=N,se=N,pe=0,ve=0,ye=Math.abs(k),we=[],Le;for(;pe+ve<=ye;){if(q+=R,q<y||q>=b)return null;pe+=ve,se=oe,ae=H;let tt={absOffsetX:ye,direction:R,distanceFromAnchor:pe,previousVertex:se};if(oe=Hi(q,S,tt),n===0)we.push(se),Le=oe.sub(se);else{let He,Ke=oe.sub(se);He=Ke.mag()===0?Qo(Hi(q+R,S,tt).sub(oe),n,R):Qo(Ke,n,R),ae||(ae=se.add(He)),H=We(q,He,oe,y,b,ae,n,S,tt),we.push(ae),Le=H.sub(ae)}ve=Le.mag()}let Pe=Le._mult((ye-pe)/ve)._add(ae||se),$e=j+Math.atan2(oe.y-se.y,oe.x-se.x);return we.push(Pe),{point:Pe,angle:C?$e:0,path:we}}let tn=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function nn(_,e){for(let n=0;n<_;n++){let h=e.length;e.resize(h+4),e.float32.set(tn,3*h)}}function rn(_,e,n){let h=e[0],d=e[1];return _[0]=n[0]*h+n[4]*d+n[12],_[1]=n[1]*h+n[5]*d+n[13],_[3]=n[3]*h+n[7]*d+n[15],_}let zi=100;class on{constructor(e,n=new yt(e.width+200,e.height+200,25),h=new yt(e.width+200,e.height+200,25)){this.transform=e,this.grid=n,this.ignoredGrid=h,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+zi,this.screenBottomBoundary=e.height+zi,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,n,h,d,y,b,S,C,k,R,j,N){let q=this.projectAndGetPerspectiveRatio(e.anchorPointX+C[0],e.anchorPointY+C[1],y,R,N),H=h*q.perspectiveRatio,ae;if(b||S)ae=this._projectCollisionBox(e,H,d,y,b,S,C,q,R,j,N);else{let Le=q.x+(j?j.x*H:0),Pe=q.y+(j?j.y*H:0);ae={allPointsOccluded:!1,box:[Le+e.x1*H,Pe+e.y1*H,Le+e.x2*H,Pe+e.y2*H]}}let[oe,se,pe,ve]=ae.box,ye=b?ae.allPointsOccluded:q.isOccluded,we=ye;return we||(we=q.perspectiveRatio<this.perspectiveRatioCutoff),we||(we=!this.isInsideGrid(oe,se,pe,ve)),we||n!=="always"&&this.grid.hitTest(oe,se,pe,ve,n,k)?{box:[oe,se,pe,ve],placeable:!1,offscreen:!1,occluded:ye}:{box:[oe,se,pe,ve],placeable:!0,offscreen:this.isOffscreen(oe,se,pe,ve),occluded:ye}}placeCollisionCircles(e,n,h,d,y,b,S,C,k,R,j,N,q,H){let ae=[],oe=new a.P(n.anchorX,n.anchorY),se=this.getPerspectiveRatio(oe.x,oe.y,b,H),pe=(k?y*this.transform.getPitchedTextCorrection(n.anchorX,n.anchorY,b)/se:y*se)/a.ay,ve={getElevation:H,pitchedLabelPlaneMatrix:S,lineVertexArray:h,pitchWithMap:k,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:oe,unwrappedTileID:b,width:this.transform.width,height:this.transform.height,translation:q},ye=Zt(pe,d,n.lineOffsetX*pe,n.lineOffsetY*pe,!1,n,!1,ve),we=!1,Le=!1,Pe=!0;if(ye){let $e=.5*j*se+N,tt=new a.P(-100,-100),He=new a.P(this.screenRightBoundary,this.screenBottomBoundary),Ke=new at,Qe=ye.first,vt=ye.last,gt=[];for(let li=Qe.path.length-1;li>=1;li--)gt.push(Qe.path[li]);for(let li=1;li<vt.path.length;li++)gt.push(vt.path[li]);let ct=2.5*$e;if(k){let li=this.projectPathToScreenSpace(gt,ve);gt=li.some(Ci=>Ci.signedDistanceFromCamera<=0)?[]:li.map(Ci=>Ci.point)}let Lt=[];if(gt.length>0){let li=gt[0].clone(),Ci=gt[0].clone();for(let yn=1;yn<gt.length;yn++)li.x=Math.min(li.x,gt[yn].x),li.y=Math.min(li.y,gt[yn].y),Ci.x=Math.max(Ci.x,gt[yn].x),Ci.y=Math.max(Ci.y,gt[yn].y);Lt=li.x>=tt.x&&Ci.x<=He.x&&li.y>=tt.y&&Ci.y<=He.y?[gt]:Ci.x<tt.x||li.x>He.x||Ci.y<tt.y||li.y>He.y?[]:a.av([gt],tt.x,tt.y,He.x,He.y)}for(let li of Lt){Ke.reset(li,.25*$e);let Ci=0;Ci=Ke.length<=.5*$e?1:Math.ceil(Ke.paddedLength/ct)+1;for(let yn=0;yn<Ci;yn++){let Ki=yn/Math.max(Ci-1,1),vn=Ke.lerp(Ki),xn=vn.x+zi,Qi=vn.y+zi;ae.push(xn,Qi,$e,0);let Bi=xn-$e,nr=Qi-$e,dr=xn+$e,xr=Qi+$e;if(Pe=Pe&&this.isOffscreen(Bi,nr,dr,xr),Le=Le||this.isInsideGrid(Bi,nr,dr,xr),e!=="always"&&this.grid.hitTestCircle(xn,Qi,$e,e,R)&&(we=!0,!C))return{circles:[],offscreen:!1,collisionDetected:we}}}}return{circles:!C&&we||!Le||se<this.perspectiveRatioCutoff?[]:ae,offscreen:Pe,collisionDetected:we}}projectPathToScreenSpace(e,n){let h=function(d,y){let b=a.K();return a.an(b,y.pitchedLabelPlaneMatrix),d.map(S=>{let C=Ye(S.x,S.y,b,y.getElevation),k=y.transform.projectTileCoordinates(C.point.x,C.point.y,y.unwrappedTileID,y.getElevation);return k.point.x=(.5*k.point.x+.5)*y.width,k.point.y=(.5*-k.point.y+.5)*y.height,k})}(e,n);return function(d){let y=0,b=0,S=0,C=0;for(let k=0;k<d.length;k++)d[k].isOccluded?(S=k+1,C=0):(C++,C>b&&(b=C,y=S));return d.slice(y,y+b)}(h)}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let n=[],h=1/0,d=1/0,y=-1/0,b=-1/0;for(let R of e){let j=new a.P(R.x+zi,R.y+zi);h=Math.min(h,j.x),d=Math.min(d,j.y),y=Math.max(y,j.x),b=Math.max(b,j.y),n.push(j)}let S=this.grid.query(h,d,y,b).concat(this.ignoredGrid.query(h,d,y,b)),C={},k={};for(let R of S){let j=R.key;if(C[j.bucketInstanceId]===void 0&&(C[j.bucketInstanceId]={}),C[j.bucketInstanceId][j.featureIndex])continue;let N=[new a.P(R.x1,R.y1),new a.P(R.x2,R.y1),new a.P(R.x2,R.y2),new a.P(R.x1,R.y2)];a.aw(n,N)&&(C[j.bucketInstanceId][j.featureIndex]=!0,k[j.bucketInstanceId]===void 0&&(k[j.bucketInstanceId]=[]),k[j.bucketInstanceId].push(j.featureIndex))}return k}insertCollisionBox(e,n,h,d,y,b){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:y,collisionGroupID:b,overlapMode:n},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,n,h,d,y,b){let S=h?this.ignoredGrid:this.grid,C={bucketInstanceId:d,featureIndex:y,collisionGroupID:b,overlapMode:n};for(let k=0;k<e.length;k+=4)S.insertCircle(C,e[k],e[k+1],e[k+2])}projectAndGetPerspectiveRatio(e,n,h,d,y){if(y){let b;d?(b=[e,n,d(e,n),1],a.at(b,b,y)):(b=[e,n,0,1],rn(b,b,y));let S=b[3];return{x:(b[0]/S+1)/2*this.transform.width+zi,y:(-b[1]/S+1)/2*this.transform.height+zi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/S*.5,isOccluded:!1,signedDistanceFromCamera:S}}{let b=this.transform.projectTileCoordinates(e,n,h,d);return{x:(b.point.x+1)/2*this.transform.width+zi,y:(1-b.point.y)/2*this.transform.height+zi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/b.signedDistanceFromCamera*.5,isOccluded:b.isOccluded,signedDistanceFromCamera:b.signedDistanceFromCamera}}}getPerspectiveRatio(e,n,h,d){let y=this.transform.projectTileCoordinates(e,n,h,d);return .5+this.transform.cameraToCenterDistance/y.signedDistanceFromCamera*.5}isOffscreen(e,n,h,d){return h<zi||e>=this.screenRightBoundary||d<zi||n>this.screenBottomBoundary}isInsideGrid(e,n,h,d){return h>=0&&e<this.gridRightBoundary&&d>=0&&n<this.gridBottomBoundary}getViewportMatrix(){let e=a.ad([]);return a.L(e,e,[-100,-100,0]),e}_projectCollisionBox(e,n,h,d,y,b,S,C,k,R,j){let N=1,q=0,H=0,ae=1,oe=e.anchorPointX+S[0],se=e.anchorPointY+S[1];if(b&&!y){let gt=this.projectAndGetPerspectiveRatio(oe+1,se,d,k,j),ct=gt.x-C.x,Lt=Math.atan((gt.y-C.y)/ct)+(ct<0?Math.PI:0),li=Math.sin(Lt),Ci=Math.cos(Lt);N=Ci,q=li,H=-li,ae=Ci}else if(!b&&y){let gt=Gt(this.transform);N=gt.vecEast[0],q=gt.vecEast[1],H=gt.vecSouth[0],ae=gt.vecSouth[1]}let pe=C.x,ve=C.y,ye=n;y&&(pe=oe,ve=se,ye=Math.pow(2,-(this.transform.zoom-h.overscaledZ)),ye*=this.transform.getPitchedTextCorrection(oe,se,d),R||(ye*=a.ae(.5+C.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),R&&(pe+=N*R.x*ye+H*R.y*ye,ve+=q*R.x*ye+ae*R.y*ye);let we=e.x1*ye,Le=e.x2*ye,Pe=(we+Le)/2,$e=e.y1*ye,tt=e.y2*ye,He=($e+tt)/2,Ke=[{offsetX:we,offsetY:$e},{offsetX:Pe,offsetY:$e},{offsetX:Le,offsetY:$e},{offsetX:Le,offsetY:He},{offsetX:Le,offsetY:tt},{offsetX:Pe,offsetY:tt},{offsetX:we,offsetY:tt},{offsetX:we,offsetY:He}],Qe=[];for(let{offsetX:gt,offsetY:ct}of Ke)Qe.push(new a.P(pe+N*gt+H*ct,ve+q*gt+ae*ct));let vt=!1;if(y){let gt=Qe.map(ct=>this.projectAndGetPerspectiveRatio(ct.x,ct.y,d,k,j));vt=gt.some(ct=>!ct.isOccluded),Qe=gt.map(ct=>new a.P(ct.x,ct.y))}else vt=!0;return{box:a.ax(Qe),allPointsOccluded:!vt}}}class qt{constructor(e,n,h,d){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?n:-n))):d&&h?1:0,this.placed=h}isHidden(){return this.opacity===0&&!this.placed}}class ro{constructor(e,n,h,d,y){this.text=new qt(e?e.text:null,n,h,y),this.icon=new qt(e?e.icon:null,n,d,y)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Dn{constructor(e,n,h){this.text=e,this.icon=n,this.skipFade=h}}class Eo{constructor(e,n,h,d,y){this.bucketInstanceId=e,this.featureIndex=n,this.sourceLayerIndex=h,this.bucketIndex=d,this.tileID=y}}class kn{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){let n=++this.maxGroupID;this.collisionGroups[e]={ID:n,predicate:h=>h.collisionGroupID===n}}return this.collisionGroups[e]}}function Dr(_,e,n,h,d){let{horizontalAlign:y,verticalAlign:b}=a.aE(_);return new a.P(-(y-.5)*e+h[0]*d,-(b-.5)*n+h[1]*d)}class Lo{constructor(e,n,h,d,y){this.transform=e.clone(),this.terrain=n,this.collisionIndex=new on(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new kn(d),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){let n=this.terrain;return n?(h,d)=>n.getElevation(e,h,d):null}getBucketParts(e,n,h,d){let y=h.getBucket(n),b=h.latestFeatureIndex;if(!y||!b||n.id!==y.layerIds[0])return;let S=h.collisionBoxArray,C=y.layers[0].layout,k=y.layers[0].paint,R=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),j=h.tileSize/a.Z,N=h.tileID.toUnwrapped(),q=C.get("text-rotation-alignment")==="map",H=a.az(h,1,this.transform.zoom),ae=a.aA(this.collisionIndex.transform,h,k.get("text-translate"),k.get("text-translate-anchor")),oe=a.aA(this.collisionIndex.transform,h,k.get("icon-translate"),k.get("icon-translate-anchor")),se=Dt(q,this.transform,H);this.retainedQueryData[y.bucketInstanceId]=new Eo(y.bucketInstanceId,b,y.sourceLayerIndex,y.index,h.tileID);let pe={bucket:y,layout:C,translationText:ae,translationIcon:oe,unwrappedTileID:N,pitchedLabelPlaneMatrix:se,scale:R,textPixelRatio:j,holdingForFade:h.holdingForFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:a.ak(y.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(y.sourceID)};if(d)for(let ve of y.sortKeyRanges){let{sortKey:ye,symbolInstanceStart:we,symbolInstanceEnd:Le}=ve;e.push({sortKey:ye,symbolInstanceStart:we,symbolInstanceEnd:Le,parameters:pe})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:pe})}attemptAnchorPlacement(e,n,h,d,y,b,S,C,k,R,j,N,q,H,ae,oe,se,pe,ve,ye){let we=a.aB[e.textAnchor],Le=[e.textOffset0,e.textOffset1],Pe=Dr(we,h,d,Le,y),$e=this.collisionIndex.placeCollisionBox(n,N,C,k,R,S,b,oe,j.predicate,ve,Pe,ye);if((!pe||this.collisionIndex.placeCollisionBox(pe,N,C,k,R,S,b,se,j.predicate,ve,Pe,ye).placeable)&&$e.placeable){let tt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[q.crossTileID]&&this.prevPlacement.placements[q.crossTileID]&&this.prevPlacement.placements[q.crossTileID].text&&(tt=this.prevPlacement.variableOffsets[q.crossTileID].anchor),q.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[q.crossTileID]={textOffset:Le,width:h,height:d,anchor:we,textBoxScale:y,prevAnchor:tt},this.markUsedJustification(H,we,q,ae),H.allowVerticalPlacement&&(this.markUsedOrientation(H,ae,q),this.placedOrientations[q.crossTileID]=ae),{shift:Pe,placedGlyphBoxes:$e}}}placeLayerBucketPart(e,n,h){let{bucket:d,layout:y,translationText:b,translationIcon:S,unwrappedTileID:C,pitchedLabelPlaneMatrix:k,textPixelRatio:R,holdingForFade:j,collisionBoxArray:N,partiallyEvaluatedTextSize:q,collisionGroup:H}=e.parameters,ae=y.get("text-optional"),oe=y.get("icon-optional"),se=a.aC(y,"text-overlap","text-allow-overlap"),pe=se==="always",ve=a.aC(y,"icon-overlap","icon-allow-overlap"),ye=ve==="always",we=y.get("text-rotation-alignment")==="map",Le=y.get("text-pitch-alignment")==="map",Pe=y.get("icon-text-fit")!=="none",$e=y.get("symbol-z-order")==="viewport-y",tt=pe&&(ye||!d.hasIconData()||oe),He=ye&&(pe||!d.hasTextData()||ae);!d.collisionArrays&&N&&d.deserializeCollisionBoxes(N);let Ke=this.retainedQueryData[d.bucketInstanceId].tileID,Qe=this._getTerrainElevationFunc(Ke),vt=this.transform.getFastPathSimpleProjectionMatrix(Ke),gt=(ct,Lt,li)=>{var Ci,yn;if(n[ct.crossTileID])return;if(j)return void(this.placements[ct.crossTileID]=new Dn(!1,!1,!1));let Ki=!1,vn=!1,xn=!0,Qi=null,Bi={box:null,placeable:!1,offscreen:null,occluded:!1},nr={placeable:!1},dr=null,xr=null,Oi=null,_s=0,aa=0,ys=0;Lt.textFeatureIndex?_s=Lt.textFeatureIndex:ct.useRuntimeCollisionCircles&&(_s=ct.featureIndex),Lt.verticalTextFeatureIndex&&(aa=Lt.verticalTextFeatureIndex);let Qs=Lt.textBox;if(Qs){let lo=qn=>{let Wn=a.al.horizontal;if(d.allowVerticalPlacement&&!qn&&this.prevPlacement){let Zr=this.prevPlacement.placedOrientations[ct.crossTileID];Zr&&(this.placedOrientations[ct.crossTileID]=Zr,Wn=Zr,this.markUsedOrientation(d,Wn,ct))}return Wn},xs=(qn,Wn)=>{if(d.allowVerticalPlacement&&ct.numVerticalGlyphVertices>0&&Lt.verticalTextBox){for(let Zr of d.writingModes)if(Zr===a.al.vertical?(Bi=Wn(),nr=Bi):Bi=qn(),Bi&&Bi.placeable)break}else Bi=qn()},Na=ct.textAnchorOffsetStartIndex,bs=ct.textAnchorOffsetEndIndex;if(bs===Na){let qn=(Wn,Zr)=>{let ln=this.collisionIndex.placeCollisionBox(Wn,se,R,Ke,C,Le,we,b,H.predicate,Qe,void 0,vt);return ln&&ln.placeable&&(this.markUsedOrientation(d,Zr,ct),this.placedOrientations[ct.crossTileID]=Zr),ln};xs(()=>qn(Qs,a.al.horizontal),()=>{let Wn=Lt.verticalTextBox;return d.allowVerticalPlacement&&ct.numVerticalGlyphVertices>0&&Wn?qn(Wn,a.al.vertical):{box:null,offscreen:null}}),lo(Bi&&Bi.placeable)}else{let qn=a.aB[(yn=(Ci=this.prevPlacement)===null||Ci===void 0?void 0:Ci.variableOffsets[ct.crossTileID])===null||yn===void 0?void 0:yn.anchor],Wn=(ln,xu,kd)=>{let zd=ln.x2-ln.x1,Tf=ln.y2-ln.y1,yh=ct.textBoxScale,xc=Pe&&ve==="never"?xu:null,To=null,sa=se==="never"?1:2,So="never";qn&&sa++;for(let ja=0;ja<sa;ja++){for(let bu=Na;bu<bs;bu++){let ws=d.textAnchorOffsets.get(bu);if(qn&&ws.textAnchor!==qn)continue;let vh=this.attemptAnchorPlacement(ws,ln,zd,Tf,yh,we,Le,R,Ke,C,H,So,ct,d,kd,b,S,xc,Qe);if(vh&&(To=vh.placedGlyphBoxes,To&&To.placeable))return Ki=!0,Qi=vh.shift,To}qn?qn=null:So=se}return h&&!To&&(To={box:this.collisionIndex.placeCollisionBox(Qs,"always",R,Ke,C,Le,we,b,H.predicate,Qe,void 0,vt).box,offscreen:!1,placeable:!1,occluded:!1}),To};xs(()=>Wn(Qs,Lt.iconBox,a.al.horizontal),()=>{let ln=Lt.verticalTextBox;return d.allowVerticalPlacement&&(!Bi||!Bi.placeable)&&ct.numVerticalGlyphVertices>0&&ln?Wn(ln,Lt.verticalIconBox,a.al.vertical):{box:null,occluded:!0,offscreen:null}}),Bi&&(Ki=Bi.placeable,xn=Bi.offscreen);let Zr=lo(Bi&&Bi.placeable);if(!Ki&&this.prevPlacement){let ln=this.prevPlacement.variableOffsets[ct.crossTileID];ln&&(this.variableOffsets[ct.crossTileID]=ln,this.markUsedJustification(d,ln.anchor,ct,Zr))}}}if(dr=Bi,Ki=dr&&dr.placeable,xn=dr&&dr.offscreen,ct.useRuntimeCollisionCircles){let lo=d.text.placedSymbolArray.get(ct.centerJustifiedTextSymbolIndex),xs=a.am(d.textSizeData,q,lo),Na=y.get("text-padding");xr=this.collisionIndex.placeCollisionCircles(se,lo,d.lineVertexArray,d.glyphOffsetArray,xs,C,k,h,Le,H.predicate,ct.collisionCircleDiameter,Na,b,Qe),xr.circles.length&&xr.collisionDetected&&!h&&a.w("Collisions detected, but collision boxes are not shown"),Ki=pe||xr.circles.length>0&&!xr.collisionDetected,xn=xn&&xr.offscreen}if(Lt.iconFeatureIndex&&(ys=Lt.iconFeatureIndex),Lt.iconBox){let lo=xs=>this.collisionIndex.placeCollisionBox(xs,ve,R,Ke,C,Le,we,S,H.predicate,Qe,Pe&&Qi?Qi:void 0,vt);nr&&nr.placeable&&Lt.verticalIconBox?(Oi=lo(Lt.verticalIconBox),vn=Oi.placeable):(Oi=lo(Lt.iconBox),vn=Oi.placeable),xn=xn&&Oi.offscreen}let vc=ae||ct.numHorizontalGlyphVertices===0&&ct.numVerticalGlyphVertices===0,vs=oe||ct.numIconVertices===0;vc||vs?vs?vc||(vn=vn&&Ki):Ki=vn&&Ki:vn=Ki=vn&&Ki;let el=vn&&Oi.placeable;if(Ki&&dr.placeable&&this.collisionIndex.insertCollisionBox(dr.box,se,y.get("text-ignore-placement"),d.bucketInstanceId,nr&&nr.placeable&&aa?aa:_s,H.ID),el&&this.collisionIndex.insertCollisionBox(Oi.box,ve,y.get("icon-ignore-placement"),d.bucketInstanceId,ys,H.ID),xr&&Ki&&this.collisionIndex.insertCollisionCircles(xr.circles,se,y.get("text-ignore-placement"),d.bucketInstanceId,_s,H.ID),h&&this.storeCollisionData(d.bucketInstanceId,li,Lt,dr,Oi,xr),ct.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(d.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[ct.crossTileID]=new Dn((Ki||tt)&&!dr?.occluded,(vn||He)&&!Oi?.occluded,xn||d.justReloaded),n[ct.crossTileID]=!0};if($e){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");let ct=d.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let Lt=ct.length-1;Lt>=0;--Lt){let li=ct[Lt];gt(d.symbolInstances.get(li),d.collisionArrays[li],li)}}else for(let ct=e.symbolInstanceStart;ct<e.symbolInstanceEnd;ct++)gt(d.symbolInstances.get(ct),d.collisionArrays[ct],ct);d.justReloaded=!1}storeCollisionData(e,n,h,d,y,b){if(h.textBox||h.iconBox){let S,C;this.collisionBoxArrays.has(e)?S=this.collisionBoxArrays.get(e):(S=new Map,this.collisionBoxArrays.set(e,S)),S.has(n)?C=S.get(n):(C={text:null,icon:null},S.set(n,C)),h.textBox&&(C.text=d.box),h.iconBox&&(C.icon=y.box)}if(b){let S=this.collisionCircleArrays[e];S===void 0&&(S=this.collisionCircleArrays[e]=[]);for(let C=0;C<b.circles.length;C+=4)S.push(b.circles[C+0]-zi),S.push(b.circles[C+1]-zi),S.push(b.circles[C+2]),S.push(b.collisionDetected?1:0)}}markUsedJustification(e,n,h,d){let y;y=d===a.al.vertical?h.verticalPlacedTextSymbolIndex:{left:h.leftJustifiedTextSymbolIndex,center:h.centerJustifiedTextSymbolIndex,right:h.rightJustifiedTextSymbolIndex}[a.aD(n)];let b=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex,h.verticalPlacedTextSymbolIndex];for(let S of b)S>=0&&(e.text.placedSymbolArray.get(S).crossTileID=y>=0&&S!==y?0:h.crossTileID)}markUsedOrientation(e,n,h){let d=n===a.al.horizontal||n===a.al.horizontalOnly?n:0,y=n===a.al.vertical?n:0,b=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex];for(let S of b)e.text.placedSymbolArray.get(S).placedOrientation=d;h.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(h.verticalPlacedTextSymbolIndex).placedOrientation=y)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;let n=this.prevPlacement,h=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;let d=n?n.symbolFadeChange(e):1,y=n?n.opacities:{},b=n?n.variableOffsets:{},S=n?n.placedOrientations:{};for(let C in this.placements){let k=this.placements[C],R=y[C];R?(this.opacities[C]=new ro(R,d,k.text,k.icon),h=h||k.text!==R.text.placed||k.icon!==R.icon.placed):(this.opacities[C]=new ro(null,d,k.text,k.icon,k.skipFade),h=h||k.text||k.icon)}for(let C in y){let k=y[C];if(!this.opacities[C]){let R=new ro(k,d,!1,!1);R.isHidden()||(this.opacities[C]=R,h=h||k.text.placed||k.icon.placed)}}for(let C in b)this.variableOffsets[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.variableOffsets[C]=b[C]);for(let C in S)this.placedOrientations[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.placedOrientations[C]=S[C]);if(n&&n.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");h?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:e)}updateLayerOpacities(e,n){let h={};for(let d of n){let y=d.getBucket(e);y&&d.latestFeatureIndex&&e.id===y.layerIds[0]&&this.updateBucketOpacities(y,d.tileID,h,d.collisionBoxArray)}}updateBucketOpacities(e,n,h,d){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();let y=e.layers[0],b=y.layout,S=new ro(null,0,!1,!1,!0),C=b.get("text-allow-overlap"),k=b.get("icon-allow-overlap"),R=y._unevaluatedLayout.hasValue("text-variable-anchor")||y._unevaluatedLayout.hasValue("text-variable-anchor-offset"),j=b.get("text-rotation-alignment")==="map",N=b.get("text-pitch-alignment")==="map",q=b.get("icon-text-fit")!=="none",H=new ro(null,0,C&&(k||!e.hasIconData()||b.get("icon-optional")),k&&(C||!e.hasTextData()||b.get("text-optional")),!0);!e.collisionArrays&&d&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(d);let ae=(se,pe,ve)=>{for(let ye=0;ye<pe/4;ye++)se.opacityVertexArray.emplaceBack(ve);se.hasVisibleVertices=se.hasVisibleVertices||ve!==ko},oe=this.collisionBoxArrays.get(e.bucketInstanceId);for(let se=0;se<e.symbolInstances.length;se++){let pe=e.symbolInstances.get(se),{numHorizontalGlyphVertices:ve,numVerticalGlyphVertices:ye,crossTileID:we}=pe,Le=this.opacities[we];h[we]?Le=S:Le||(Le=H,this.opacities[we]=Le),h[we]=!0;let Pe=pe.numIconVertices>0,$e=this.placedOrientations[pe.crossTileID],tt=$e===a.al.vertical,He=$e===a.al.horizontal||$e===a.al.horizontalOnly;if(ve>0||ye>0){let Qe=pn(Le.text);ae(e.text,ve,tt?ko:Qe),ae(e.text,ye,He?ko:Qe);let vt=Le.text.isHidden();[pe.rightJustifiedTextSymbolIndex,pe.centerJustifiedTextSymbolIndex,pe.leftJustifiedTextSymbolIndex].forEach(Lt=>{Lt>=0&&(e.text.placedSymbolArray.get(Lt).hidden=vt||tt?1:0)}),pe.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(pe.verticalPlacedTextSymbolIndex).hidden=vt||He?1:0);let gt=this.variableOffsets[pe.crossTileID];gt&&this.markUsedJustification(e,gt.anchor,pe,$e);let ct=this.placedOrientations[pe.crossTileID];ct&&(this.markUsedJustification(e,"left",pe,ct),this.markUsedOrientation(e,ct,pe))}if(Pe){let Qe=pn(Le.icon),vt=!(q&&pe.verticalPlacedIconSymbolIndex&&tt);pe.placedIconSymbolIndex>=0&&(ae(e.icon,pe.numIconVertices,vt?Qe:ko),e.icon.placedSymbolArray.get(pe.placedIconSymbolIndex).hidden=Le.icon.isHidden()),pe.verticalPlacedIconSymbolIndex>=0&&(ae(e.icon,pe.numVerticalIconVertices,vt?ko:Qe),e.icon.placedSymbolArray.get(pe.verticalPlacedIconSymbolIndex).hidden=Le.icon.isHidden())}let Ke=oe&&oe.has(se)?oe.get(se):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){let Qe=e.collisionArrays[se];if(Qe){let vt=new a.P(0,0);if(Qe.textBox||Qe.verticalTextBox){let gt=!0;if(R){let ct=this.variableOffsets[we];ct?(vt=Dr(ct.anchor,ct.width,ct.height,ct.textOffset,ct.textBoxScale),j&&vt._rotate(N?-this.transform.bearingInRadians:this.transform.bearingInRadians)):gt=!1}if(Qe.textBox||Qe.verticalTextBox){let ct;Qe.textBox&&(ct=tt),Qe.verticalTextBox&&(ct=He),Ao(e.textCollisionBox.collisionVertexArray,Le.text.placed,!gt||ct,Ke.text,vt.x,vt.y)}}if(Qe.iconBox||Qe.verticalIconBox){let gt=!!(!He&&Qe.verticalIconBox),ct;Qe.iconBox&&(ct=gt),Qe.verticalIconBox&&(ct=!gt),Ao(e.iconCollisionBox.collisionVertexArray,Le.icon.placed,ct,Ke.icon,q?vt.x:0,q?vt.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,n){let h=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*h>e}setStale(){this.stale=!0}}function Ao(_,e,n,h,d,y){h&&h.length!==0||(h=[0,0,0,0]);let b=h[0]-zi,S=h[1]-zi,C=h[2]-zi,k=h[3]-zi;_.emplaceBack(e?1:0,n?1:0,d||0,y||0,b,S),_.emplaceBack(e?1:0,n?1:0,d||0,y||0,C,S),_.emplaceBack(e?1:0,n?1:0,d||0,y||0,C,k),_.emplaceBack(e?1:0,n?1:0,d||0,y||0,b,k)}let yi=Math.pow(2,25),Ai=Math.pow(2,24),mn=Math.pow(2,17),Ya=Math.pow(2,16),Ja=Math.pow(2,9),Kl=Math.pow(2,8),hi=Math.pow(2,1);function pn(_){if(_.opacity===0&&!_.placed)return 0;if(_.opacity===1&&_.placed)return 4294967295;let e=_.placed?1:0,n=Math.floor(127*_.opacity);return n*yi+e*Ai+n*mn+e*Ya+n*Ja+e*Kl+n*hi+e}let ko=0;class Qa{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,n,h,d,y){let b=this._bucketParts;for(;this._currentTileIndex<e.length;)if(n.getBucketParts(b,d,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,b.sort((S,C)=>S.sortKey-C.sortKey));this._currentPartIndex<b.length;)if(n.placeLayerBucketPart(b[this._currentPartIndex],this._seenCrossTileIDs,h),this._currentPartIndex++,y())return!0;return!1}}class Br{constructor(e,n,h,d,y,b,S,C){this.placement=new Lo(e,n,b,S,C),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(e,n,h){let d=W.now(),y=()=>!this._forceFullPlacement&&W.now()-d>2;for(;this._currentPlacementIndex>=0;){let b=n[e[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(b.type==="symbol"&&(!b.minzoom||b.minzoom<=S)&&(!b.maxzoom||b.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new Qa(b)),this._inProgressLayer.continuePlacement(h[b.source],this.placement,this._showCollisionBoxes,b,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}let va=512/a.Z/2;class es{constructor(e,n,h){this.tileID=e,this.bucketInstanceId=h,this._symbolsByKey={};let d=new Map;for(let y=0;y<n.length;y++){let b=n.get(y),S=b.key,C=d.get(S);C?C.push(b):d.set(S,[b])}for(let[y,b]of d){let S={positions:b.map(C=>({x:Math.floor(C.anchorX*va),y:Math.floor(C.anchorY*va)})),crossTileIDs:b.map(C=>C.crossTileID)};if(S.positions.length>128){let C=new a.aF(S.positions.length,16,Uint16Array);for(let{x:k,y:R}of S.positions)C.add(k,R);C.finish(),delete S.positions,S.index=C}this._symbolsByKey[y]=S}}getScaledCoordinates(e,n){let{x:h,y:d,z:y}=this.tileID.canonical,{x:b,y:S,z:C}=n.canonical,k=va/Math.pow(2,C-y),R=(S*a.Z+e.anchorY)*k,j=d*a.Z*va;return{x:Math.floor((b*a.Z+e.anchorX)*k-h*a.Z*va),y:Math.floor(R-j)}}findMatches(e,n,h){let d=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z);for(let y=0;y<e.length;y++){let b=e.get(y);if(b.crossTileID)continue;let S=this._symbolsByKey[b.key];if(!S)continue;let C=this.getScaledCoordinates(b,n);if(S.index){let k=S.index.range(C.x-d,C.y-d,C.x+d,C.y+d).sort();for(let R of k){let j=S.crossTileIDs[R];if(!h[j]){h[j]=!0,b.crossTileID=j;break}}}else if(S.positions)for(let k=0;k<S.positions.length;k++){let R=S.positions[k],j=S.crossTileIDs[k];if(Math.abs(R.x-C.x)<=d&&Math.abs(R.y-C.y)<=d&&!h[j]){h[j]=!0,b.crossTileID=j;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class xa{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class an{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){let n=Math.round((e-this.lng)/360);if(n!==0)for(let h in this.indexes){let d=this.indexes[h],y={};for(let b in d){let S=d[b];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+n),y[S.tileID.key]=S}this.indexes[h]=y}this.lng=e}addBucket(e,n,h){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let y=0;y<n.symbolInstances.length;y++)n.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});let d=this.usedCrossTileIDs[e.overscaledZ];for(let y in this.indexes){let b=this.indexes[y];if(Number(y)>e.overscaledZ)for(let S in b){let C=b[S];C.tileID.isChildOf(e)&&C.findMatches(n.symbolInstances,e,d)}else{let S=b[e.scaledTo(Number(y)).key];S&&S.findMatches(n.symbolInstances,e,d)}}for(let y=0;y<n.symbolInstances.length;y++){let b=n.symbolInstances.get(y);b.crossTileID||(b.crossTileID=h.generate(),d[b.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new es(e,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(e,n){for(let h of n.getCrossTileIDsLists())for(let d of h)delete this.usedCrossTileIDs[e][d]}removeStaleBuckets(e){let n=!1;for(let h in this.indexes){let d=this.indexes[h];for(let y in d)e[d[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,d[y]),delete d[y],n=!0)}return n}}class oo{constructor(){this.layerIndexes={},this.crossTileIDs=new xa,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,n,h){let d=this.layerIndexes[e.id];d===void 0&&(d=this.layerIndexes[e.id]=new an);let y=!1,b={};d.handleWrapJump(h);for(let S of n){let C=S.getBucket(e);C&&e.id===C.layerIds[0]&&(C.bucketInstanceId||(C.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(S.tileID,C,this.crossTileIDs)&&(y=!0),b[C.bucketInstanceId]=!0)}return d.removeStaleBuckets(b)&&(y=!0),y}pruneUnusedLayers(e){let n={};e.forEach(h=>{n[h]=!0});for(let h in this.layerIndexes)n[h]||delete this.layerIndexes[h]}}var ba="void main() {fragColor=vec4(1.0);}";let Bn={prelude:vi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:vi("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:vi("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:vi(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:vi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:vi(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:vi(ba,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:vi(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:vi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:vi("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:vi("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:vi("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:vi(ba,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:vi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:vi(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:vi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:vi(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:vi(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:vi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:vi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:vi(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;switch(u_method){case BASIC:
basic_hillshade(deriv);break;case COMBINED:
combined_hillshade(deriv);break;case IGOR:
igor_hillshade(deriv);break;case MULTIDIRECTIONAL:
multidirectional_hillshade(deriv);break;case STANDARD:
default:
standard_hillshade(deriv);break;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:vi(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:vi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:vi(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:vi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:vi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:vi(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:vi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:vi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:vi("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:vi("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:vi("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:vi("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:vi(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:vi("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function vi(_,e){let n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,h=e.match(/in ([\w]+) ([\w]+)/g),d=_.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=y?y.concat(d):d,S={};return{fragmentSource:_=_.replace(n,(C,k,R,j,N)=>(S[N]=!0,k==="define"?`
#ifndef HAS_UNIFORM_u_${N}
in ${R} ${j} ${N};
#else
uniform ${R} ${j} u_${N};
#endif
`:`
#ifdef HAS_UNIFORM_u_${N}
    ${R} ${j} ${N} = u_${N};
#endif
`)),vertexSource:e=e.replace(n,(C,k,R,j,N)=>{let q=j==="float"?"vec2":"vec4",H=N.match(/color/)?"color":q;return S[N]?k==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
in ${R} ${q} a_${N};
out ${R} ${j} ${N};
#else
uniform ${R} ${j} u_${N};
#endif
`:H==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = a_${N};
#else
    ${R} ${j} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = unpack_mix_${H}(a_${N}, u_${N}_t);
#else
    ${R} ${j} ${N} = u_${N};
#endif
`:k==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
in ${R} ${q} a_${N};
#else
uniform ${R} ${j} u_${N};
#endif
`:H==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${R} ${j} ${N} = a_${N};
#else
    ${R} ${j} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${R} ${j} ${N} = unpack_mix_${H}(a_${N}, u_${N}_t);
#else
    ${R} ${j} ${N} = u_${N};
#endif
`}),staticAttributes:h,staticUniforms:b}}class go{constructor(e,n,h){this.vertexBuffer=e,this.indexBuffer=n,this.segments=h}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var er=a.aG([{name:"a_pos",type:"Int16",components:2}]);let zo="#define PROJECTION_MERCATOR",di="mercator";class wa{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return di}get shaderDefine(){return zo}get shaderPreludeCode(){return Bn.projectionMercator}get vertexShaderPreludeCode(){return Bn.projectionMercator.vertexSource}get subdivisionGranularity(){return a.aH.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,n,h,d,y){if(this._cachedMesh)return this._cachedMesh;let b=new a.aI;b.emplaceBack(0,0),b.emplaceBack(a.Z,0),b.emplaceBack(0,a.Z),b.emplaceBack(a.Z,a.Z);let S=e.createVertexBuffer(b,er.members),C=a.aJ.simpleSegment(0,0,4,2),k=new a.aK;k.emplaceBack(1,0,2),k.emplaceBack(1,2,3);let R=e.createIndexBuffer(k);return this._cachedMesh=new go(S,R,C),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}class Ta{constructor(e=0,n=0,h=0,d=0){if(isNaN(e)||e<0||isNaN(n)||n<0||isNaN(h)||h<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=n,this.left=h,this.right=d}interpolate(e,n,h){return n.top!=null&&e.top!=null&&(this.top=a.B.number(e.top,n.top,h)),n.bottom!=null&&e.bottom!=null&&(this.bottom=a.B.number(e.bottom,n.bottom,h)),n.left!=null&&e.left!=null&&(this.left=a.B.number(e.left,n.left,h)),n.right!=null&&e.right!=null&&(this.right=a.B.number(e.right,n.right,h)),this}getCenter(e,n){let h=a.ae((this.left+e-this.right)/2,0,e),d=a.ae((this.top+n-this.bottom)/2,0,n);return new a.P(h,d)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Ta(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Ro(_,e){if(!_.renderWorldCopies||_.lngRange)return;let n=e.lng-_.center.lng;e.lng+=n>180?-360:n<-180?360:0}function yr(_){return Math.max(0,Math.floor(_))}class On{constructor(e,n,h,d,y,b){this._callbacks=e,this._tileSize=512,this._renderWorldCopies=b===void 0||!!b,this._minZoom=n||0,this._maxZoom=h||22,this._minPitch=d??0,this._maxPitch=y??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new a.Q(0,0),this._elevation=0,this._zoom=0,this._tileZoom=yr(this._zoom),this._scale=a.ac(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Ta,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,n,h){this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=yr(this._zoom),this._scale=a.ac(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new Ta(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!h&&e.autoCalculateNearFarZ,n&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){let n=a.aL(e,-180,180)*Math.PI/180;var h,d,y,b,S,C,k,R,j;this._bearingInRadians!==n&&(this._unmodified=!1,this._bearingInRadians=n,this._calcMatrices(),this._rotationMatrix=E(),h=this._rotationMatrix,y=-this._bearingInRadians,b=(d=this._rotationMatrix)[0],S=d[1],C=d[2],k=d[3],R=Math.sin(y),j=Math.cos(y),h[0]=b*j+C*R,h[1]=S*j+k*R,h[2]=b*-R+C*j,h[3]=S*-R+k*j)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){let n=a.ae(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==n&&(this._unmodified=!1,this._pitchInRadians=n,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){let n=e/180*Math.PI;this._rollInRadians!==n&&(this._unmodified=!1,this._rollInRadians=n,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return a.aM(this._fovInRadians)}setFov(e){e=a.ae(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=a.ab(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){let n=this.getConstrained(this._center,e).zoom;this._zoom!==n&&(this._unmodified=!1,this._zoom=n,this._tileZoom=Math.max(0,Math.floor(n)),this._scale=a.ac(n),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,n){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=n,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,n,h){this._unmodified=!1,this._edgeInsets.interpolate(e,n,h),this._constrain(),this._calcMatrices()}resize(e,n,h=!0){this._width=e,this._height=n,h&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new _i([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-85.051129,a.af])}getConstrained(e,n){return this._callbacks.getConstrained(e,n)}getCameraQueryGeometry(e,n){if(n.length===1)return[n[0],e];{let h=e.x,d=e.y,y=e.x,b=e.y;for(let S of n)h=Math.min(h,S.x),d=Math.min(d,S.y),y=Math.max(y,S.x),b=Math.max(b,S.y);return[new a.P(h,d),new a.P(y,d),new a.P(y,b),new a.P(h,b),new a.P(h,d)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;let e=this._unmodified,{center:n,zoom:h}=this.getConstrained(this.center,this.zoom);this.setCenter(n),this.setZoom(h),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=a.ad(new Float64Array(16));a.M(e,e,[this._width/2,-this._height/2,1]),a.L(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=a.ad(new Float64Array(16)),a.M(e,e,[1,-1,1]),a.L(e,e,[-1,-1,0]),a.M(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,n,h,d){let y=h!==void 0?h:this.bearing,b=d=d!==void 0?d:this.pitch,S=a.$.fromLngLat(e,n),C=-Math.cos(a.ab(b)),k=Math.sin(a.ab(b)),R=k*Math.sin(a.ab(y)),j=-k*Math.cos(a.ab(y)),N=this.elevation,q=n-N,H;C*q>=0||Math.abs(C)<.1?(H=1e4,N=n+H*C):H=-q/C;let ae,oe,se=a.aN(1,S.y),pe=0;do{if(pe+=1,pe>10)break;oe=H/se,ae=new a.$(S.x+R*oe,S.y+j*oe),se=1/ae.meterInMercatorCoordinateUnits()}while(Math.abs(H-oe*se)>1e-12);return{center:ae.toLngLat(),elevation:N,zoom:a.ah(this.height/2/Math.tan(this.fovInRadians/2)/oe/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;let n=a.ag(1,this.center.lat)*this.worldSize,h=this.cameraToCenterDistance/n,d=a.$.fromLngLat(this.center,this.elevation),y=Y(this.center,this.elevation,this.pitch,this.bearing,h);this._elevation=e;let b=this.calculateCenterFromCameraLngLatAlt(y.toLngLat(),a.aN(y.z,d.y),this.bearing,this.pitch);this._elevation=b.elevation,this._center=b.center,this.setZoom(b.zoom)}getCameraPoint(){let e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){let e=a.ag(1,this.center.lat)*this.worldSize;return Y(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];let n=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/n,e.canonical.y/n,1/n/a.Z,1/n/a.Z]}}class Sn{constructor(e,n){this.min=e,this.max=n,this.center=a.aO([],a.aP([],this.min,this.max),.5)}quadrant(e){let n=[e%2==0,e<2],h=a.aQ(this.min),d=a.aQ(this.max);for(let y=0;y<n.length;y++)h[y]=n[y]?this.min[y]:this.center[y],d[y]=n[y]?this.center[y]:this.max[y];return d[2]=this.max[2],new Sn(h,d)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let n=!0;for(let h=0;h<e.planes.length;h++){let d=this.intersectsPlane(e.planes[h]);if(d===0)return 0;d===1&&(n=!1)}return n?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let n=e[3],h=e[3];for(let d=0;d<3;d++)e[d]>0?(n+=e[d]*this.min[d],h+=e[d]*this.max[d]):(h+=e[d]*this.min[d],n+=e[d]*this.max[d]);return n>=0?2:h<0?0:1}}class Ut{distanceToTile2d(e,n,h,d){let y=d.distanceX([e,n]),b=d.distanceY([e,n]);return Math.hypot(y,b)}getWrap(e,n,h){return h}getTileAABB(e,n,h,d){var y,b;let S=h,C=h;if(d.terrain){let R=new a.Y(e.z,n,e.z,e.x,e.y),j=d.terrain.getMinMaxElevation(R);S=(y=j.minElevation)!==null&&y!==void 0?y:h,C=(b=j.maxElevation)!==null&&b!==void 0?b:h}let k=1<<e.z;return new Sn([n+e.x/k,e.y/k,S],[n+(e.x+1)/k,(e.y+1)/k,C])}allowVariableZoom(e,n){let h=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,d=a.ae(78.5-h/2,0,60);return!!n.terrain||e.pitch>d}allowWorldCopies(){return!0}recalculateCache(){}}class Ei{constructor(e,n,h){this.points=e,this.planes=n,this.aabb=h}static fromInvProjectionMatrix(e,n=1,h=0){let d=Math.pow(2,h),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(k=>{let R=1/(k=a.at([],k,e))[3]/n*d;return a.aR(k,k,[R,R,1/k[3],R])}),b=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(k=>{let R=a.aS([],y[k[0]],y[k[1]]),j=a.aS([],y[k[2]],y[k[1]]),N=a.aT([],a.aU([],R,j)),q=-a.aV(N,y[k[1]]);return N.concat(q)}),S=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],C=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(let k of y)for(let R=0;R<3;R++)S[R]=Math.min(S[R],k[R]),C[R]=Math.max(C[R],k[R]);return new Ei(y,b,new Sn(S,C))}}class Di{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,n,h){return this._helper.interpolatePadding(e,n,h)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,n,h=!0){this._helper.resize(e,n,h)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,n){this._helper.overrideNearFarZ(e,n)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,n){}constructor(e,n,h,d,y){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new On({calcMatrices:()=>{this._calcMatrices()},getConstrained:(b,S)=>this.getConstrained(b,S)},e,n,h,d,y),this._coveringTilesDetailsProvider=new Ut}clone(){let e=new Di;return e.apply(this),e}apply(e,n,h){this._helper.apply(e,n,h)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){let n=[new a.aW(0,e)];if(this._helper._renderWorldCopies){let h=this.screenPointToMercatorCoordinate(new a.P(0,0)),d=this.screenPointToMercatorCoordinate(new a.P(this._helper._width,0)),y=this.screenPointToMercatorCoordinate(new a.P(this._helper._width,this._helper._height)),b=this.screenPointToMercatorCoordinate(new a.P(0,this._helper._height)),S=Math.floor(Math.min(h.x,d.x,y.x,b.x)),C=Math.floor(Math.max(h.x,d.x,y.x,b.x)),k=1;for(let R=S-k;R<=C+k;R++)R!==0&&n.push(new a.aW(R,e))}return n}getCameraFrustum(){return Ei.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){let n=this.screenPointToLocation(this.centerPoint,e),h=e?e.getElevationForLngLatZoom(n,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(h)}setLocationAtPoint(e,n){let h=a.ag(this.elevation,this.center.lat),d=this.screenPointToMercatorCoordinateAtZ(n,h),y=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,h),b=a.$.fromLngLat(e),S=new a.$(b.x-(d.x-y.x),b.y-(d.y-y.y));this.setCenter(S?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,n){return n?this.coordinatePoint(a.$.fromLngLat(e),n.getElevationForLngLatZoom(e,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(a.$.fromLngLat(e))}screenPointToLocation(e,n){var h;return(h=this.screenPointToMercatorCoordinate(e,n))===null||h===void 0?void 0:h.toLngLat()}screenPointToMercatorCoordinate(e,n){if(n){let h=n.pointCoordinate(e);if(h!=null)return h}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,n){let h=n||0,d=[e.x,e.y,0,1],y=[e.x,e.y,1,1];a.at(d,d,this._pixelMatrixInverse),a.at(y,y,this._pixelMatrixInverse);let b=d[3],S=y[3],C=d[1]/b,k=y[1]/S,R=d[2]/b,j=y[2]/S,N=R===j?0:(h-R)/(j-R);return new a.$(a.B.number(d[0]/b,y[0]/S,N)/this.worldSize,a.B.number(C,k,N)/this.worldSize,h)}coordinatePoint(e,n=0,h=this._pixelMatrix){let d=[e.x*this.worldSize,e.y*this.worldSize,n,1];return a.at(d,d,h),new a.P(d[0]/d[3],d[1]/d[3])}getBounds(){let e=Math.max(0,this._helper._height/2-Re(this));return new _i().extend(this.screenPointToLocation(new a.P(0,e))).extend(this.screenPointToLocation(new a.P(this._helper._width,e))).extend(this.screenPointToLocation(new a.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new a.P(0,this._helper._height)))}isPointOnMapSurface(e,n){return n?n.pointCoordinate(e)!=null:e.y>this.height/2-Re(this)}calculatePosMatrix(e,n=!1,h){var d;let y=(d=e.key)!==null&&d!==void 0?d:a.aX(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),b=n?this._alignedPosMatrixCache:this._posMatrixCache;if(b.has(y)){let k=b.get(y);return h?k.f32:k.f64}let S=X(e,this.worldSize);a.N(S,n?this._alignedProjMatrix:this._viewProjMatrix,S);let C={f64:S,f32:new Float32Array(S)};return b.set(y,C),h?C.f32:C.f64}calculateFogMatrix(e){let n=e.key,h=this._fogMatrixCacheF32;if(h.has(n))return h.get(n);let d=X(e,this.worldSize);return a.N(d,this._fogMatrix,d),h.set(n,new Float32Array(d)),h.get(n)}getConstrained(e,n){n=a.ae(+n,this.minZoom,this.maxZoom);let h={center:new a.Q(e.lng,e.lat),zoom:n},d=this._helper._lngRange;this._helper._renderWorldCopies||d!==null||(d=[-179.9999999999,180-1e-10]);let y=this.tileSize*a.ac(h.zoom),b=0,S=y,C=0,k=y,R=0,j=0,{x:N,y:q}=this.size;if(this._helper._latRange){let ve=this._helper._latRange;b=a.S(ve[1])*y,S=a.S(ve[0])*y,S-b<q&&(R=q/(S-b))}d&&(C=a.aL(a.U(d[0])*y,0,y),k=a.aL(a.U(d[1])*y,0,y),k<C&&(k+=y),k-C<N&&(j=N/(k-C)));let{x:H,y:ae}=An(y,e),oe,se,pe=Math.max(j||0,R||0);if(pe){let ve=new a.P(j?(k+C)/2:H,R?(S+b)/2:ae);return h.center=Rn(y,ve).wrap(),h.zoom+=a.ah(pe),h}if(this._helper._latRange){let ve=q/2;ae-ve<b&&(se=b+ve),ae+ve>S&&(se=S-ve)}if(d){let ve=(C+k)/2,ye=H;this._helper._renderWorldCopies&&(ye=a.aL(H,ve-y/2,ve+y/2));let we=N/2;ye-we<C&&(oe=C+we),ye+we>k&&(oe=k-we)}if(oe!==void 0||se!==void 0){let ve=new a.P(oe??H,se??ae);h.center=Rn(y,ve).wrap()}return h}calculateCenterFromCameraLngLatAlt(e,n,h,d){return this._helper.calculateCenterFromCameraLngLatAlt(e,n,h,d)}_calculateNearFarZIfNeeded(e,n,h){if(!this._helper.autoCalculateNearFarZ)return;let d=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),y=e-d*this._helper._pixelPerMeter/Math.cos(n),b=d<0?y:e,S=Math.PI/2+this.pitchInRadians,C=a.ab(this.fov)*(Math.abs(Math.cos(a.ab(this.roll)))*this.height+Math.abs(Math.sin(a.ab(this.roll)))*this.width)/this.height*(.5+h.y/this.height),k=Math.sin(C)*b/Math.sin(a.ae(Math.PI-S-C,.01,Math.PI-.01)),R=Re(this),j=Math.atan(R/this._helper.cameraToCenterDistance),N=a.ab(.75),q=j>N?2*j*(.5+h.y/(2*R)):N,H=Math.sin(q)*b/Math.sin(a.ae(Math.PI-S-q,.01,Math.PI-.01)),ae=Math.min(k,H);this._helper._farZ=1.01*(Math.cos(Math.PI/2-n)*ae+b),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;let e=this.centerOffset,n=An(this.worldSize,this.center),h=n.x,d=n.y;this._helper._pixelPerMeter=a.ag(1,this.center.lat)*this.worldSize;let y=a.ab(Math.min(this.pitch,dn)),b=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(y)),S;this._calculateNearFarZIfNeeded(b,y,e),S=new Float64Array(16),a.aY(S,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),a.an(this._invProjMatrix,S),S[8]=2*-e.x/this._helper._width,S[9]=2*e.y/this._helper._height,this._projectionMatrix=a.aZ(S),a.M(S,S,[1,-1,1]),a.L(S,S,[0,0,-this._helper.cameraToCenterDistance]),a.a_(S,S,-this.rollInRadians),a.a$(S,S,this.pitchInRadians),a.a_(S,S,-this.bearingInRadians),a.L(S,S,[-h,-d,0]),this._mercatorMatrix=a.M([],S,[this.worldSize,this.worldSize,this.worldSize]),a.M(S,S,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=a.N(new Float64Array(16),this.clipSpaceToPixelsMatrix,S),a.L(S,S,[0,0,-this.elevation]),this._viewProjMatrix=S,this._invViewProjMatrix=a.an([],S);let C=[0,0,-1,1];a.at(C,C,this._invViewProjMatrix),this._cameraPosition=[C[0]/C[3],C[1]/C[3],C[2]/C[3]],this._fogMatrix=new Float64Array(16),a.aY(this._fogMatrix,this.fovInRadians,this.width/this.height,b,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,a.M(this._fogMatrix,this._fogMatrix,[1,-1,1]),a.L(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),a.a_(this._fogMatrix,this._fogMatrix,-this.rollInRadians),a.a$(this._fogMatrix,this._fogMatrix,this.pitchInRadians),a.a_(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),a.L(this._fogMatrix,this._fogMatrix,[-h,-d,0]),a.M(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),a.L(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=a.N(new Float64Array(16),this.clipSpaceToPixelsMatrix,S);let k=this._helper._width%2/2,R=this._helper._height%2/2,j=Math.cos(this.bearingInRadians),N=Math.sin(-this.bearingInRadians),q=h-Math.round(h)+j*k+N*R,H=d-Math.round(d)+j*R+N*k,ae=new Float64Array(S);if(a.L(ae,ae,[q>.5?q-1:q,H>.5?H-1:H,0]),this._alignedProjMatrix=ae,S=a.an(new Float64Array(16),this._pixelMatrix),!S)throw new Error("failed to invert matrix");this._pixelMatrixInverse=S,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;let e=this.screenPointToMercatorCoordinate(new a.P(0,0)),n=[e.x*this.worldSize,e.y*this.worldSize,0,1];return a.at(n,n,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){let e=a.ag(1,this.center.lat)*this.worldSize;return Y(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,n){let h=a.$.fromLngLat(e),d=[h.x*this.worldSize,h.y*this.worldSize,n,1];return a.at(d,d,this._viewProjMatrix),d[2]/d[3]}getProjectionData(e){let{overscaledTileID:n,aligned:h,applyTerrainMatrix:d}=e,y=this._helper.getMercatorTileCoordinates(n),b=n?this.calculatePosMatrix(n,h,!0):null,S;return S=n&&n.terrainRttPosMatrix32f&&d?n.terrainRttPosMatrix32f:b||a.b0(),{mainMatrix:S,tileMercatorCoords:y,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:S}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,n,h){return 1}transformLightDirection(e){return a.aQ(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,n,h,d){let y=this.calculatePosMatrix(h),b;d?(b=[e,n,d(e,n),1],a.at(b,b,y)):(b=[e,n,0,1],rn(b,b,y));let S=b[3];return{point:new a.P(b[0]/S,b[1]/S),signedDistanceFromCamera:S,isOccluded:!1}}populateCache(e){for(let n of e)this.calculatePosMatrix(n)}getMatrixForModel(e,n){let h=a.$.fromLngLat(e,n),d=h.meterInMercatorCoordinateUnits(),y=a.b1();return a.L(y,y,[h.x,h.y,h.z]),a.a_(y,y,Math.PI),a.a$(y,y,Math.PI/2),a.M(y,y,[-d,d,d]),y}getProjectionDataForCustomLayer(e=!0){let n=new a.Y(0,0,0,0,0),h=this.getProjectionData({overscaledTileID:n,applyGlobeMatrix:e}),d=X(n,this.worldSize);a.N(d,this._viewProjMatrix,d),h.tileMercatorCoords=[0,0,1,1];let y=[a.Z,a.Z,this.worldSize/this._helper.pixelsPerMeter],b=a.b2();return a.M(b,d,y),h.fallbackMatrix=b,h.mainMatrix=b,h}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function lr(){a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function vr(_){if(_.useSlerp)if(_.k<1){let e=a.b3(_.startEulerAngles.roll,_.startEulerAngles.pitch,_.startEulerAngles.bearing),n=a.b3(_.endEulerAngles.roll,_.endEulerAngles.pitch,_.endEulerAngles.bearing),h=new Float64Array(4);a.b4(h,e,n,_.k);let d=a.b5(h);_.tr.setRoll(d.roll),_.tr.setPitch(d.pitch),_.tr.setBearing(d.bearing)}else _.tr.setRoll(_.endEulerAngles.roll),_.tr.setPitch(_.endEulerAngles.pitch),_.tr.setBearing(_.endEulerAngles.bearing);else _.tr.setRoll(a.B.number(_.startEulerAngles.roll,_.endEulerAngles.roll,_.k)),_.tr.setPitch(a.B.number(_.startEulerAngles.pitch,_.endEulerAngles.pitch,_.k)),_.tr.setBearing(a.B.number(_.startEulerAngles.bearing,_.endEulerAngles.bearing,_.k))}function cr(_,e,n,h,d){let y=d.padding,b=An(d.worldSize,n.getNorthWest()),S=An(d.worldSize,n.getNorthEast()),C=An(d.worldSize,n.getSouthEast()),k=An(d.worldSize,n.getSouthWest()),R=a.ab(-h),j=b.rotate(R),N=S.rotate(R),q=C.rotate(R),H=k.rotate(R),ae=new a.P(Math.max(j.x,N.x,H.x,q.x),Math.max(j.y,N.y,H.y,q.y)),oe=new a.P(Math.min(j.x,N.x,H.x,q.x),Math.min(j.y,N.y,H.y,q.y)),se=ae.sub(oe),pe=(d.width-(y.left+y.right+e.left+e.right))/se.x,ve=(d.height-(y.top+y.bottom+e.top+e.bottom))/se.y;if(ve<0||pe<0)return void lr();let ye=Math.min(a.ah(d.scale*Math.min(pe,ve)),_.maxZoom),we=a.P.convert(_.offset),Le=new a.P((e.left-e.right)/2,(e.top-e.bottom)/2).rotate(a.ab(h)),Pe=we.add(Le).mult(d.scale/a.ac(ye));return{center:Rn(d.worldSize,b.add(C).div(2).sub(Pe)),zoom:ye,bearing:h}}class Sa{get useGlobeControls(){return!1}handlePanInertia(e,n){return{easingOffset:e,easingCenter:n.center}}handleMapControlsRollPitchBearingZoom(e,n){e.bearingDelta&&n.setBearing(n.bearing+e.bearingDelta),e.pitchDelta&&n.setPitch(n.pitch+e.pitchDelta),e.rollDelta&&n.setRoll(n.roll+e.rollDelta),e.zoomDelta&&n.setZoom(n.zoom+e.zoomDelta)}handleMapControlsPan(e,n,h){e.around.distSqr(n.centerPoint)<.01||n.setLocationAtPoint(h,e.around)}cameraForBoxAndBearing(e,n,h,d,y){return cr(e,n,h,d,y)}handleJumpToCenterZoom(e,n){e.zoom!==(n.zoom!==void 0?+n.zoom:e.zoom)&&e.setZoom(+n.zoom),n.center!==void 0&&e.setCenter(a.Q.convert(n.center))}handleEaseTo(e,n){let h=e.zoom,d=e.padding,y={roll:e.roll,pitch:e.pitch,bearing:e.bearing},b={roll:n.roll===void 0?e.roll:n.roll,pitch:n.pitch===void 0?e.pitch:n.pitch,bearing:n.bearing===void 0?e.bearing:n.bearing},S=n.zoom!==void 0,C=!e.isPaddingEqual(n.padding),k=!1,R=S?+n.zoom:e.zoom,j=e.centerPoint.add(n.offsetAsPoint),N=e.screenPointToLocation(j),{center:q,zoom:H}=e.getConstrained(a.Q.convert(n.center||N),R??h);Ro(e,q);let ae=An(e.worldSize,N),oe=An(e.worldSize,q).sub(ae),se=a.ac(H-h);return k=H!==h,{easeFunc:pe=>{if(k&&e.setZoom(a.B.number(h,H,pe)),a.b6(y,b)||vr({startEulerAngles:y,endEulerAngles:b,tr:e,k:pe,useSlerp:y.roll!=b.roll}),C&&(e.interpolatePadding(d,n.padding,pe),j=e.centerPoint.add(n.offsetAsPoint)),n.around)e.setLocationAtPoint(n.around,n.aroundPoint);else{let ve=a.ac(e.zoom-h),ye=H>h?Math.min(2,se):Math.max(.5,se),we=Math.pow(ye,1-pe),Le=Rn(e.worldSize,ae.add(oe.mult(pe*we)).mult(ve));e.setLocationAtPoint(e.renderWorldCopies?Le.wrap():Le,j)}},isZooming:k,elevationCenter:q}}handleFlyTo(e,n){let h=n.zoom!==void 0,d=e.zoom,y=e.getConstrained(a.Q.convert(n.center||n.locationAtOffset),h?+n.zoom:d),b=y.center,S=y.zoom;Ro(e,b);let C=An(e.worldSize,n.locationAtOffset),k=An(e.worldSize,b).sub(C),R=k.mag(),j=a.ac(S-d),N;if(n.minZoom!==void 0){let q=Math.min(+n.minZoom,d,S),H=e.getConstrained(b,q).zoom;N=a.ac(H-d)}return{easeFunc:(q,H,ae,oe)=>{e.setZoom(q===1?S:d+a.ah(H));let se=q===1?b:Rn(e.worldSize,C.add(k.mult(ae)).mult(H));e.setLocationAtPoint(e.renderWorldCopies?se.wrap():se,oe)},scaleOfZoom:j,targetCenter:b,scaleOfMinZoom:N,pixelPathLength:R}}}class Li{constructor(e,n,h){this.blendFunction=e,this.blendColor=n,this.mask=h}}Li.Replace=[1,0],Li.disabled=new Li(Li.Replace,a.b7.transparent,[!1,!1,!1,!1]),Li.unblended=new Li(Li.Replace,a.b7.transparent,[!0,!0,!0,!0]),Li.alphaBlended=new Li([1,771],a.b7.transparent,[!0,!0,!0,!0]);let Ji=2305;class si{constructor(e,n,h){this.enable=e,this.mode=n,this.frontFace=h}}si.disabled=new si(!1,1029,Ji),si.backCCW=new si(!0,1029,Ji),si.frontCCW=new si(!0,1028,Ji);class Bt{constructor(e,n,h){this.func=e,this.mask=n,this.range=h}}Bt.ReadOnly=!1,Bt.ReadWrite=!0,Bt.disabled=new Bt(519,Bt.ReadOnly,[0,1]);let Wr=7680;class ti{constructor(e,n,h,d,y,b){this.test=e,this.ref=n,this.mask=h,this.fail=d,this.depthFail=y,this.pass=b}}ti.disabled=new ti({func:519,mask:0},0,0,Wr,Wr,Wr);let zs=new WeakMap;function ur(_){var e;if(zs.has(_))return zs.get(_);{let n=(e=_.getParameter(_.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return zs.set(_,n),n}}class fl{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;let n=e.context,h=n.gl;this._texFormat=h.RGBA,this._texType=h.UNSIGNED_BYTE;let d=new a.aI;d.emplaceBack(-1,-1),d.emplaceBack(2,-1),d.emplaceBack(-1,2);let y=new a.aK;y.emplaceBack(0,1,2),this._fullscreenTriangle=new go(n.createVertexBuffer(d,er.members),n.createIndexBuffer(y),a.aJ.simpleSegment(0,0,d.length,y.length)),this._resultBuffer=new Uint8Array(4),n.activeTexture.set(h.TEXTURE1);let b=h.createTexture();h.bindTexture(h.TEXTURE_2D,b),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.NEAREST),h.texImage2D(h.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=n.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(b),ur(h)&&(this._pbo=h.createBuffer(),h.bindBuffer(h.PIXEL_PACK_BUFFER,this._pbo),h.bufferData(h.PIXEL_PACK_BUFFER,4,h.STREAM_READ),h.bindBuffer(h.PIXEL_PACK_BUFFER,null))}destroy(){let e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,n){let h=this._updateCount;return this._readbackQueue?h>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():h>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,n),this._updateCount++,this._measuredError}_bindFramebuffer(){let e=this._cachedRenderContext.context,n=e.gl;e.activeTexture.set(n.TEXTURE1),n.bindTexture(n.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,n){let h=this._cachedRenderContext.context,d=h.gl;if(this._bindFramebuffer(),h.viewport.set([0,0,this._texWidth,this._texHeight]),h.clear({color:a.b7.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(h,d.TRIANGLES,Bt.disabled,ti.disabled,Li.unblended,si.disabled,((y,b)=>({u_input:y,u_output_expected:b}))(e,n),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&ur(d)){d.bindBuffer(d.PIXEL_PACK_BUFFER,this._pbo),d.readBuffer(d.COLOR_ATTACHMENT0),d.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),d.bindBuffer(d.PIXEL_PACK_BUFFER,null);let y=d.fenceSync(d.SYNC_GPU_COMMANDS_COMPLETE,0);d.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:y}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){let e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&ur(e)){let n=e.clientWaitSync(this._readbackQueue.sync,0,0);if(n===e.WAIT_FAILED)return a.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(n===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=fl._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let n=0;return n+=e[0]/256,n+=e[1]/65536,n+=e[2]/16777216,e[3]<127&&(n=-n),n/128}}let Rs=a.Z/128;function Ds(_,e){let n=_.granularity!==void 0?Math.max(_.granularity,1):1,h=n+(_.generateBorders?2:0),d=n+(_.extendToNorthPole||_.generateBorders?1:0)+(_.extendToSouthPole||_.generateBorders?1:0),y=h+1,b=d+1,S=_.generateBorders?-1:0,C=_.generateBorders||_.extendToNorthPole?-1:0,k=n+(_.generateBorders?1:0),R=n+(_.generateBorders||_.extendToSouthPole?1:0),j=y*b,N=h*d*6,q=y*b>65536;if(q&&e==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");let H=q||e==="32bit",ae=new Int16Array(2*j),oe=0;for(let ve=C;ve<=R;ve++)for(let ye=S;ye<=k;ye++){let we=ye/n*a.Z;ye===-1&&(we=-64),ye===n+1&&(we=a.Z+Rs);let Le=ve/n*a.Z;ve===-1&&(Le=_.extendToNorthPole?a.b9:-64),ve===n+1&&(Le=_.extendToSouthPole?a.ba:a.Z+Rs),ae[oe++]=we,ae[oe++]=Le}let se=H?new Uint32Array(N):new Uint16Array(N),pe=0;for(let ve=0;ve<d;ve++)for(let ye=0;ye<h;ye++){let we=ye+1+ve*y,Le=ye+(ve+1)*y,Pe=ye+1+(ve+1)*y;se[pe++]=ye+ve*y,se[pe++]=Le,se[pe++]=we,se[pe++]=we,se[pe++]=Le,se[pe++]=Pe}return{vertices:ae.buffer.slice(0),indices:se.buffer.slice(0),uses32bitIndices:H}}let Pa=new a.aH({fill:new a.bb(128,2),line:new a.bb(512,0),tile:new a.bb(128,32),stencil:new a.bb(128,1),circle:3});class xi{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Bn.projectionGlobe}get vertexShaderPreludeCode(){return Bn.projectionMercator.vertexSource}get subdivisionGranularity(){return Pa}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new fl(e));let n=a.S(this._errorQueryLatitudeDegrees),h=2*Math.atan(Math.exp(Math.PI-n*Math.PI*2))-.5*Math.PI,d=this._errorMeasurement.updateErrorLoop(n,h),y=W.now();d!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=d,this._errorMeasurementLastChangeTime=y);let b=Math.min(Math.max((y-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=a.bc(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,a.bd(b))}_getMeshKey(e){return`${e.granularity.toString(36)}_${e.generateBorders?"b":""}${e.extendToNorthPole?"n":""}${e.extendToSouthPole?"s":""}`}getMeshFromTileID(e,n,h,d,y){let b=(y==="stencil"?Pa.stencil:Pa.tile).getGranularityForZoomLevel(n.z);return this._getMesh(e,{granularity:b,generateBorders:h,extendToNorthPole:n.y===0&&d,extendToSouthPole:n.y===(1<<n.z)-1&&d})}_getMesh(e,n){let h=this._getMeshKey(n);if(h in this._tileMeshCache)return this._tileMeshCache[h];let d=function(y,b){let S=Ds(b,"16bit"),C=a.aI.deserialize({arrayBuffer:S.vertices,length:S.vertices.byteLength/2/2}),k=a.aK.deserialize({arrayBuffer:S.indices,length:S.indices.byteLength/2/3});return new go(y.createVertexBuffer(C,er.members),y.createIndexBuffer(k),a.aJ.simpleSegment(0,0,C.length,k.length))}(e,n);return this._tileMeshCache[h]=d,d}recalculate(e){}hasTransition(){let e=W.now(),n=!1;return n=n||(e-this._errorMeasurementLastChangeTime)/1e3<.7,n=n||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,n}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}let Xl=new a.r({type:new a.D(a.v.projection.type)});class Mr extends a.E{constructor(e){super(),this._transitionable=new a.T(Xl),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new a.C(0)),this._mercatorProjection=new wa,this._verticalPerspectiveProjection=new xi}get transitionState(){let e=this.properties.get("type");if(typeof e=="string"&&e==="mercator")return 0;if(typeof e=="string"&&e==="vertical-perspective")return 1;if(e instanceof a.be){if(e.from==="vertical-perspective"&&e.to==="mercator")return 1-e.transition;if(e.from==="mercator"&&e.to==="vertical-perspective")return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,n,h,d,y){return this.currentProjection.getMeshFromTileID(e,n,h,d,y)}setProjection(e){this._transitionable.setValue("type",e?.type||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function Do(_){let e=Bo(_.worldSize,_.center.lat);return 2*Math.PI*e}function ea(_,e,n,h,d){let y=1/(1<<d),b=e/a.Z*y+h*y,S=a.bg((_/a.Z*y+n*y)*Math.PI*2+Math.PI,2*Math.PI),C=2*Math.atan(Math.exp(Math.PI-b*Math.PI*2))-.5*Math.PI,k=Math.cos(C),R=new Float64Array(3);return R[0]=Math.sin(S)*k,R[1]=Math.sin(C),R[2]=Math.cos(S)*k,R}function $n(_){return function(e,n){let h=Math.cos(n),d=new Float64Array(3);return d[0]=Math.sin(e)*h,d[1]=Math.sin(n),d[2]=Math.cos(e)*h,d}(_.lng*Math.PI/180,_.lat*Math.PI/180)}function Bo(_,e){return _/(2*Math.PI)/Math.cos(e*Math.PI/180)}function Bs(_){let e=Math.asin(_[1])/Math.PI*180,n=Math.sqrt(_[0]*_[0]+_[2]*_[2]);if(n>1e-6){let h=_[0]/n,d=Math.acos(_[2]/n),y=(h>0?d:-d)/Math.PI*180;return new a.Q(a.aL(y,-180,180),e)}return new a.Q(0,e)}function Oo(_){return Math.cos(_*Math.PI/180)}function Un(_,e){let n=Oo(_),h=Oo(e);return a.ah(h/n)}function ml(_,e){let n=_.rotate(e.bearingInRadians),h=e.zoom+Un(e.center.lat,0),d=a.bc(1/Oo(e.center.lat),1/Oo(Math.min(Math.abs(e.center.lat),60)),a.bf(h,7,3,0,1)),y=360/Do({worldSize:e.worldSize,center:{lat:e.center.lat}});return new a.Q(e.center.lng-n.x*y*d,a.ae(e.center.lat+n.y*y,-85.051129,a.af))}function ts(_){let e=.5*_,n=Math.sin(e),h=Math.cos(e);return Math.log(n+h)-Math.log(h-n)}function Wc(_,e,n,h){let d=_.lat+n*h;if(Math.abs(n)>1){let y=(Math.sign(_.lat+n)!==Math.sign(_.lat)?-Math.abs(_.lat):Math.abs(_.lat))*Math.PI/180,b=Math.abs(_.lat+n)*Math.PI/180,S=ts(y+h*(b-y)),C=ts(y),k=ts(b);return new a.Q(_.lng+e*((S-C)/(k-C)),d)}return new a.Q(_.lng+e*h,d)}class _o{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._aabbFactory=e}recalculateCache(){if(!this._hadAnyChanges)return;let e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileAABB(e,n,h,d){let y=`${e.z}_${e.x}_${e.y}`,b=this._cache.get(y);if(b)return b;let S=this._cachePrevious.get(y);if(S)return this._cache.set(y,S),S;let C=this._aabbFactory(e,n,h,d);return this._cache.set(y,C),this._hadAnyChanges=!0,C}}function hr(_,e,n){let h=_-e;return h<0?-h:Math.max(0,h-n)}function is(_,e,n,h,d){let y=_-n,b;return b=y<0?Math.min(-y,1+y-d):y>1?Math.min(Math.max(y-d,0),1-y):0,Math.max(b,hr(e,h,d))}class tr{constructor(){this._aabbCache=new _o(this._computeTileAABB)}recalculateCache(){this._aabbCache.recalculateCache()}distanceToTile2d(e,n,h,d){let y=1<<h.z,b=1/y,S=h.x/y,C=h.y/y,k=2;return k=Math.min(k,is(e,n,S,C,b)),k=Math.min(k,is(e,n,S+.5,-C-b,b)),k=Math.min(k,is(e,n,S+.5,2-C-b,b)),k}getWrap(e,n,h){let d=1<<n.z,y=1/d,b=n.x/d,S=hr(e.x,b,y),C=hr(e.x,b-1,y),k=hr(e.x,b+1,y),R=Math.min(S,C,k);return R===k?1:R===C?-1:0}allowVariableZoom(e,n){return Ne(e,n)>4}allowWorldCopies(){return!1}getTileAABB(e,n,h,d){return this._aabbCache.getTileAABB(e,n,h,d)}_computeTileAABB(e,n,h,d){if(e.z<=0)return new Sn([-1,-1,-1],[1,1,1]);if(e.z===1)return new Sn([e.x===0?-1:0,e.y===0?0:-1,-1],[e.x===0?0:1,e.y===0?1:0,1]);{let y=[ea(0,0,e.x,e.y,e.z),ea(a.Z,0,e.x,e.y,e.z),ea(a.Z,a.Z,e.x,e.y,e.z),ea(0,a.Z,e.x,e.y,e.z)],b=[1,1,1],S=[-1,-1,-1];for(let C of y)for(let k=0;k<3;k++)b[k]=Math.min(b[k],C[k]),S[k]=Math.max(S[k],C[k]);if(e.y===0||e.y===(1<<e.z)-1){let C=[0,e.y===0?1:-1,0];for(let k=0;k<3;k++)b[k]=Math.min(b[k],C[k]),S[k]=Math.max(S[k],C[k])}return new Sn(b,S)}}}class ta{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,n,h){return this._helper.interpolatePadding(e,n,h)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,n){this._helper.resize(e,n)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,n){this._helper.overrideNearFarZ(e,n)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(){this._cachedClippingPlane=a.bk(),this._projectionMatrix=a.b1(),this._globeViewProjMatrix32f=a.b0(),this._globeViewProjMatrixNoCorrection=a.b1(),this._globeViewProjMatrixNoCorrectionInverted=a.b1(),this._globeProjMatrixInverted=a.b1(),this._cameraPosition=a.bh(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new On({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,n)=>this.getConstrained(e,n)}),this._coveringTilesDetailsProvider=new tr}clone(){let e=new ta;return e.apply(this),e}apply(e,n){this._globeLatitudeErrorCorrectionRadians=n||0,this._helper.apply(e)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){let e=a.bh();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){let{overscaledTileID:n,applyGlobeMatrix:h}=e,d=this._helper.getMercatorTileCoordinates(n);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:d,clippingPlane:this._cachedClippingPlane,projectionTransition:h?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){let n=this.pitchInRadians,h=this.cameraToCenterDistance/e,d=Math.sin(n)*h,y=Math.cos(n)*h+1,b=1/Math.sqrt(d*d+y*y)*1,S=-d,C=y,k=Math.sqrt(S*S+C*C);S/=k,C/=k;let R=[0,S,C];a.bl(R,R,[0,0,0],-this.bearingInRadians),a.bm(R,R,[0,0,0],-1*this.center.lat*Math.PI/180),a.bn(R,R,[0,0,0],this.center.lng*Math.PI/180);let j=1/a.bo(R);return a.aO(R,R,j),[...R,-b*j]}isLocationOccluded(e){return!this.isSurfacePointVisible($n(e))}transformLightDirection(e){let n=this._helper._center.lng*Math.PI/180,h=this._helper._center.lat*Math.PI/180,d=Math.cos(h),y=[Math.sin(n)*d,Math.sin(h),Math.cos(n)*d],b=[y[2],0,-y[0]],S=[0,0,0];a.aU(S,b,y),a.aT(b,b),a.aT(S,S);let C=[0,0,0];return a.aT(C,[b[0]*e[0]+S[0]*e[1]+y[0]*e[2],b[1]*e[0]+S[1]*e[1]+y[1]*e[2],b[2]*e[0]+S[2]*e[1]+y[2]*e[2]]),C}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,n,h){let d=function(S,C,k){let R=1/(1<<k.z);return new a.$(S/a.Z*R+k.x*R,C/a.Z*R+k.y*R)}(e,n,h.canonical),y=(b=d.y,[a.bg(d.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-b*Math.PI*2))-.5*Math.PI]);var b;return this.getCircleRadiusCorrection()/Math.cos(y[1])}projectTileCoordinates(e,n,h,d){let y=h.canonical,b=ea(e,n,y.x,y.y,y.z),S=1+(d?d(e,n):0)/a.bu,C=[b[0]*S,b[1]*S,b[2]*S,1];a.at(C,C,this._globeViewProjMatrixNoCorrection);let k=this._cachedClippingPlane,R=k[0]*b[0]+k[1]*b[1]+k[2]*b[2]+k[3]<0;return{point:new a.P(C[0]/C[3],C[1]/C[3]),signedDistanceFromCamera:C[3],isOccluded:R}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;let e=Bo(this.worldSize,this.center.lat),n=a.b2(),h=a.b2();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),a.aY(n,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);let d=this.centerOffset;n[8]=2*-d.x/this._helper._width,n[9]=2*d.y/this._helper._height,this._projectionMatrix=a.aZ(n),this._globeProjMatrixInverted=a.b2(),a.an(this._globeProjMatrixInverted,n),a.L(n,n,[0,0,-this.cameraToCenterDistance]),a.a_(n,n,this.rollInRadians),a.a$(n,n,-this.pitchInRadians),a.a_(n,n,this.bearingInRadians),a.L(n,n,[0,0,-e]);let y=a.bh();y[0]=e,y[1]=e,y[2]=e,a.a$(h,n,this.center.lat*Math.PI/180),a.bp(h,h,-this.center.lng*Math.PI/180),a.M(h,h,y),this._globeViewProjMatrixNoCorrection=h,a.a$(n,n,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),a.bp(n,n,-this.center.lng*Math.PI/180),a.M(n,n,y),this._globeViewProjMatrix32f=new Float32Array(n),this._globeViewProjMatrixNoCorrectionInverted=a.b2(),a.an(this._globeViewProjMatrixNoCorrectionInverted,h);let b=a.bh();this._cameraPosition=a.bh(),this._cameraPosition[2]=this.cameraToCenterDistance/e,a.bl(this._cameraPosition,this._cameraPosition,b,-this.rollInRadians),a.bm(this._cameraPosition,this._cameraPosition,b,this.pitchInRadians),a.bl(this._cameraPosition,this._cameraPosition,b,-this.bearingInRadians),a.aP(this._cameraPosition,this._cameraPosition,[0,0,1]),a.bm(this._cameraPosition,this._cameraPosition,b,-this.center.lat*Math.PI/180),a.bn(this._cameraPosition,this._cameraPosition,b,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);let S=a.aZ(this._globeViewProjMatrixNoCorrectionInverted);a.M(S,S,[1,1,-1]),this._cachedFrustum=Ei.fromInvProjectionMatrix(S)}calculateFogMatrix(e){a.w("calculateFogMatrix is not supported on globe projection.");let n=a.b2();return a.ad(n),n}getVisibleUnwrappedCoordinates(e){return[new a.aW(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&a.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,n){if(!this._globeViewProjMatrixNoCorrection)return 1;let h=$n(e);a.aO(h,h,1+n/a.bu);let d=a.bk();return a.at(d,[h[0],h[1],h[2],1],this._globeViewProjMatrixNoCorrection),d[2]/d[3]}populateCache(e){}getBounds(){let e=.5*this.width,n=.5*this.height,h=[new a.P(0,0),new a.P(e,0),new a.P(this.width,0),new a.P(this.width,n),new a.P(this.width,this.height),new a.P(e,this.height),new a.P(0,this.height),new a.P(0,n)],d=[];for(let j of h)d.push(this.unprojectScreenPoint(j));let y=0,b=0,S=0,C=0,k=this.center;for(let j of d){let N=a.bq(k.lng,j.lng),q=a.bq(k.lat,j.lat);N<b&&(b=N),N>y&&(y=N),q<C&&(C=q),q>S&&(S=q)}let R=[k.lng+b,k.lat+C,k.lng+y,k.lat+S];return this.isSurfacePointOnScreen([0,1,0])&&(R[3]=90,R[0]=-180,R[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(R[1]=-90,R[0]=-180,R[2]=180),new _i(R)}getConstrained(e,n){let h=a.ae(e.lat,-85.051129,a.af),d=a.ae(+n,this.minZoom+Un(0,h),this.maxZoom);return{center:new a.Q(e.lng,h),zoom:d}}calculateCenterFromCameraLngLatAlt(e,n,h,d){return this._helper.calculateCenterFromCameraLngLatAlt(e,n,h,d)}setLocationAtPoint(e,n){let h=$n(this.unprojectScreenPoint(n)),d=$n(e),y=a.bh();a.br(y);let b=a.bh();a.bn(b,h,y,-this.center.lng*Math.PI/180),a.bm(b,b,y,this.center.lat*Math.PI/180);let S=d[0]*d[0]+d[2]*d[2],C=b[0]*b[0];if(S<C)return;let k=Math.sqrt(S-C),R=-k,j=a.bs(d[0],d[2],b[0],k),N=a.bs(d[0],d[2],b[0],R),q=a.bh();a.bn(q,d,y,-j);let H=a.bs(q[1],q[2],b[1],b[2]),ae=a.bh();a.bn(ae,d,y,-N);let oe=a.bs(ae[1],ae[2],b[1],b[2]),se=.5*Math.PI,pe=H>=-se&&H<=se,ve=oe>=-se&&oe<=se,ye,we;if(pe&&ve){let tt=this.center.lng*Math.PI/180,He=this.center.lat*Math.PI/180;a.bv(j,tt)+a.bv(H,He)<a.bv(N,tt)+a.bv(oe,He)?(ye=j,we=H):(ye=N,we=oe)}else if(pe)ye=j,we=H;else{if(!ve)return;ye=N,we=oe}let Le=ye/Math.PI*180,Pe=we/Math.PI*180,$e=this.center.lat;this.setCenter(new a.Q(Le,a.ae(Pe,-90,90))),this.setZoom(this.zoom+Un($e,this.center.lat))}locationToScreenPoint(e,n){let h=$n(e);if(n){let d=n.getElevationForLngLatZoom(e,this._helper._tileZoom);a.aO(h,h,1+d/a.bu)}return this._projectSurfacePointToScreen(h)}_projectSurfacePointToScreen(e){let n=a.bk();return a.at(n,[...e,1],this._globeViewProjMatrixNoCorrection),n[0]/=n[3],n[1]/=n[3],new a.P((.5*n[0]+.5)*this.width,(.5*-n[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,n){if(n){let h=n.pointCoordinate(e);if(h)return h}return a.$.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,n){var h;return(h=this.screenPointToMercatorCoordinate(e,n))===null||h===void 0?void 0:h.toLngLat()}isPointOnMapSurface(e,n){let h=this._cameraPosition,d=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(h,d)}getRayDirectionFromPixel(e){let n=a.bk();n[0]=e.x/this.width*2-1,n[1]=-1*(e.y/this.height*2-1),n[2]=1,n[3]=1,a.at(n,n,this._globeViewProjMatrixNoCorrectionInverted),n[0]/=n[3],n[1]/=n[3],n[2]/=n[3];let h=a.bh();h[0]=n[0]-this._cameraPosition[0],h[1]=n[1]-this._cameraPosition[1],h[2]=n[2]-this._cameraPosition[2];let d=a.bh();return a.aT(d,h),d}isSurfacePointVisible(e){let n=this._cachedClippingPlane;return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]+n[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;let n=a.bk();return a.at(n,[...e,1],this._globeViewProjMatrixNoCorrection),n[0]/=n[3],n[1]/=n[3],n[2]/=n[3],n[0]>-1&&n[0]<1&&n[1]>-1&&n[1]<1&&n[2]>-1&&n[2]<1}rayPlanetIntersection(e,n){let h=a.aV(e,n),d=a.bh(),y=a.bh();a.aO(y,n,h),a.aS(d,e,y);let b=1-a.aV(d,d);if(b<0)return null;let S=a.aV(e,e)-1,C=-h+(h<0?1:-1)*Math.sqrt(b),k=S/C,R=C;return{tMin:Math.min(k,R),tMax:Math.max(k,R)}}unprojectScreenPoint(e){let n=this._cameraPosition,h=this.getRayDirectionFromPixel(e),d=this.rayPlanetIntersection(n,h);if(d){let R=a.bh();a.aP(R,n,[h[0]*d.tMin,h[1]*d.tMin,h[2]*d.tMin]);let j=a.bh();return a.aT(j,R),Bs(j)}let y=this._cachedClippingPlane,b=y[0]*h[0]+y[1]*h[1]+y[2]*h[2],S=-a.bt(y,n)/b,C=a.bh();if(S>0)a.aP(C,n,[h[0]*S,h[1]*S,h[2]*S]);else{let R=a.bh();a.aP(R,n,[2*h[0],2*h[1],2*h[2]]);let j=a.bt(this._cachedClippingPlane,R);a.aS(C,R,[this._cachedClippingPlane[0]*j,this._cachedClippingPlane[1]*j,this._cachedClippingPlane[2]*j])}let k=function(R){let j=a.bh();return j[0]=R[0]*-R[3],j[1]=R[1]*-R[3],j[2]=R[2]*-R[3],{center:j,radius:Math.sqrt(1-R[3]*R[3])}}(y);return Bs(function(R,j,N){let q=a.bh();a.aS(q,N,R);let H=a.bh();return a.bi(H,R,q,j/a.bj(q)),H}(k.center,k.radius,C))}getMatrixForModel(e,n){let h=a.Q.convert(e),d=1/a.bu,y=a.b1();return a.bp(y,y,h.lng/180*Math.PI),a.a$(y,y,-h.lat/180*Math.PI),a.L(y,y,[0,0,1+n/a.bu]),a.a$(y,y,.5*Math.PI),a.M(y,y,[d,d,d]),y}getProjectionDataForCustomLayer(e=!0){let n=this.getProjectionData({overscaledTileID:new a.Y(0,0,0,0,0),applyGlobeMatrix:e});return n.tileMercatorCoords=[0,0,1,1],n}getFastPathSimpleProjectionMatrix(e){}}class ns{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,n,h){return this._helper.interpolatePadding(e,n,h)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,n,h=!0){this._helper.resize(e,n,h)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,n){this._helper.overrideNearFarZ(e,n)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,n){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=n,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().recalculateCache(),this._mercatorTransform.getCoveringTilesDetailsProvider().recalculateCache()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new On({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,n)=>this.getConstrained(e,n)}),this._globeness=1,this._mercatorTransform=new Di,this._verticalPerspectiveTransform=new ta}clone(){let e=new ns;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this),e}apply(e){this._helper.apply(e),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){let n=this._mercatorTransform.getProjectionData(e),h=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?h.mainMatrix:n.mainMatrix,clippingPlane:h.clippingPlane,tileMercatorCoords:h.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:n.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return a.bc(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return a.bc(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,n,h){let d=this._mercatorTransform.getPitchedTextCorrection(e,n,h),y=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,n,h);return a.bc(d,y,this._globeness)}projectTileCoordinates(e,n,h,d){return this.currentTransform.projectTileCoordinates(e,n,h,d)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,n){return this.currentTransform.lngLatToCameraDepth(e,n)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}getConstrained(e,n){return this.currentTransform.getConstrained(e,n)}calculateCenterFromCameraLngLatAlt(e,n,h,d){return this._helper.calculateCenterFromCameraLngLatAlt(e,n,h,d)}setLocationAtPoint(e,n){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,n),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(e,n),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(e,n){return this.currentTransform.locationToScreenPoint(e,n)}screenPointToMercatorCoordinate(e,n){return this.currentTransform.screenPointToMercatorCoordinate(e,n)}screenPointToLocation(e,n){return this.currentTransform.screenPointToLocation(e,n)}isPointOnMapSurface(e,n){return this.currentTransform.isPointOnMapSurface(e,n)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,n){return this.currentTransform.getMatrixForModel(e,n)}getProjectionDataForCustomLayer(e=!0){let n=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return n;let h=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return h.fallbackMatrix=n.mainMatrix,h}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class Cr{get useGlobeControls(){return!0}handlePanInertia(e,n){let h=ml(e,n);return Math.abs(h.lng-n.center.lng)>180&&(h.lng=n.center.lng+179.5*Math.sign(h.lng-n.center.lng)),{easingCenter:h,easingOffset:new a.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,n){let h=e.around,d=n.screenPointToLocation(h);e.bearingDelta&&n.setBearing(n.bearing+e.bearingDelta),e.pitchDelta&&n.setPitch(n.pitch+e.pitchDelta),e.rollDelta&&n.setRoll(n.roll+e.rollDelta);let y=n.zoom;e.zoomDelta&&n.setZoom(n.zoom+e.zoomDelta);let b=n.zoom-y;if(b===0)return;let S=a.bq(n.center.lng,d.lng),C=S/(Math.abs(S/180)+1),k=a.bq(n.center.lat,d.lat),R=n.getRayDirectionFromPixel(h),j=n.cameraPosition,N=-1*a.aV(j,R),q=a.bh();a.aP(q,j,[R[0]*N,R[1]*N,R[2]*N]);let H=a.bo(q)-1,ae=Math.exp(.5*-Math.max(H-.3,0)),oe=Bo(n.worldSize,n.center.lat)/Math.min(n.width,n.height),se=a.bf(oe,.9,.5,1,.25),pe=(1-a.ac(-b))*Math.min(ae,se),ve=n.center.lat,ye=n.zoom,we=new a.Q(n.center.lng+C*pe,a.ae(n.center.lat+k*pe,-85.051129,a.af));n.setLocationAtPoint(d,h);let Le=n.center,Pe=a.bf(Math.abs(S),45,85,0,1),$e=a.bf(oe,.75,.35,0,1),tt=Math.pow(Math.max(Pe,$e),.25),He=a.bq(Le.lng,we.lng),Ke=a.bq(Le.lat,we.lat);n.setCenter(new a.Q(Le.lng+He*tt,Le.lat+Ke*tt).wrap()),n.setZoom(ye+Un(ve,n.center.lat))}handleMapControlsPan(e,n,h){if(!e.panDelta)return;let d=n.center.lat,y=n.zoom;n.setCenter(ml(e.panDelta,n).wrap()),n.setZoom(y+Un(d,n.center.lat))}cameraForBoxAndBearing(e,n,h,d,y){let b=cr(e,n,h,d,y),S=n.left/y.width*2-1,C=(y.width-n.right)/y.width*2-1,k=n.top/y.height*-2+1,R=(y.height-n.bottom)/y.height*-2+1,j=a.bq(h.getWest(),h.getEast())<0,N=j?h.getEast():h.getWest(),q=j?h.getWest():h.getEast(),H=Math.max(h.getNorth(),h.getSouth()),ae=Math.min(h.getNorth(),h.getSouth()),oe=N+.5*a.bq(N,q),se=H+.5*a.bq(H,ae),pe=y.clone();pe.setCenter(b.center),pe.setBearing(b.bearing),pe.setPitch(0),pe.setRoll(0),pe.setZoom(b.zoom);let ve=pe.modelViewProjectionMatrix,ye=[$n(h.getNorthWest()),$n(h.getNorthEast()),$n(h.getSouthWest()),$n(h.getSouthEast()),$n(new a.Q(q,se)),$n(new a.Q(N,se)),$n(new a.Q(oe,H)),$n(new a.Q(oe,ae))],we=$n(b.center),Le=Number.POSITIVE_INFINITY;for(let Pe of ye)S<0&&(Le=Cr.getLesserNonNegativeNonNull(Le,Cr.solveVectorScale(Pe,we,ve,"x",S))),C>0&&(Le=Cr.getLesserNonNegativeNonNull(Le,Cr.solveVectorScale(Pe,we,ve,"x",C))),k>0&&(Le=Cr.getLesserNonNegativeNonNull(Le,Cr.solveVectorScale(Pe,we,ve,"y",k))),R<0&&(Le=Cr.getLesserNonNegativeNonNull(Le,Cr.solveVectorScale(Pe,we,ve,"y",R)));if(Number.isFinite(Le)&&Le!==0)return b.zoom=pe.zoom+a.ah(Le),b;lr()}handleJumpToCenterZoom(e,n){let h=e.center.lat,d=e.getConstrained(n.center?a.Q.convert(n.center):e.center,e.zoom).center;e.setCenter(d.wrap());let y=n.zoom!==void 0?+n.zoom:e.zoom+Un(h,d.lat);e.zoom!==y&&e.setZoom(y)}handleEaseTo(e,n){let h=e.zoom,d=e.center,y=e.padding,b={roll:e.roll,pitch:e.pitch,bearing:e.bearing},S={roll:n.roll===void 0?e.roll:n.roll,pitch:n.pitch===void 0?e.pitch:n.pitch,bearing:n.bearing===void 0?e.bearing:n.bearing},C=n.zoom!==void 0,k=!e.isPaddingEqual(n.padding),R=!1,j=n.center?a.Q.convert(n.center):d,N=e.getConstrained(j,h).center;Ro(e,N);let q=e.clone();q.setCenter(N),q.setZoom(C?+n.zoom:h+Un(d.lat,j.lat)),q.setBearing(n.bearing);let H=new a.P(a.ae(e.centerPoint.x+n.offsetAsPoint.x,0,e.width),a.ae(e.centerPoint.y+n.offsetAsPoint.y,0,e.height));q.setLocationAtPoint(N,H);let ae=(n.offset&&n.offsetAsPoint.mag())>0?q.center:N,oe=C?+n.zoom:h+Un(d.lat,ae.lat),se=h+Un(d.lat,0),pe=oe+Un(ae.lat,0),ve=a.bq(d.lng,ae.lng),ye=a.bq(d.lat,ae.lat),we=a.ac(pe-se);return R=oe!==h,{easeFunc:Le=>{if(a.b6(b,S)||vr({startEulerAngles:b,endEulerAngles:S,tr:e,k:Le,useSlerp:b.roll!=S.roll}),k&&e.interpolatePadding(y,n.padding,Le),n.around)a.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(n.around,n.aroundPoint);else{let Pe=pe>se?Math.min(2,we):Math.max(.5,we),$e=Math.pow(Pe,1-Le),tt=Wc(d,ve,ye,Le*$e);e.setCenter(tt.wrap())}if(R){let Pe=a.B.number(se,pe,Le)+Un(0,e.center.lat);e.setZoom(Pe)}},isZooming:R,elevationCenter:ae}}handleFlyTo(e,n){let h=n.zoom!==void 0,d=e.center,y=e.zoom,b=e.padding,S=!e.isPaddingEqual(n.padding),C=e.getConstrained(a.Q.convert(n.center||n.locationAtOffset),y).center,k=h?+n.zoom:e.zoom+Un(e.center.lat,C.lat),R=e.clone();R.setCenter(C),R.setZoom(k),R.setBearing(n.bearing);let j=new a.P(a.ae(e.centerPoint.x+n.offsetAsPoint.x,0,e.width),a.ae(e.centerPoint.y+n.offsetAsPoint.y,0,e.height));R.setLocationAtPoint(C,j);let N=R.center;Ro(e,N);let q=function(ye,we,Le){let Pe=$n(we),$e=$n(Le),tt=a.aV(Pe,$e),He=Math.acos(tt),Ke=Do(ye);return He/(2*Math.PI)*Ke}(e,d,N),H=y+Un(d.lat,0),ae=k+Un(N.lat,0),oe=a.ac(ae-H),se;if(typeof n.minZoom=="number"){let ye=+n.minZoom+Un(N.lat,0),we=Math.min(ye,H,ae)+Un(0,N.lat),Le=e.getConstrained(N,we).zoom+Un(N.lat,0);se=a.ac(Le-H)}let pe=a.bq(d.lng,N.lng),ve=a.bq(d.lat,N.lat);return{easeFunc:(ye,we,Le,Pe)=>{let $e=Wc(d,pe,ve,Le);S&&e.interpolatePadding(b,n.padding,ye);let tt=ye===1?N:$e;e.setCenter(tt.wrap());let He=H+a.ah(we);e.setZoom(ye===1?k:He+Un(0,tt.lat))},scaleOfZoom:oe,targetCenter:N,scaleOfMinZoom:se,pixelPathLength:q}}static solveVectorScale(e,n,h,d,y){let b=d==="x"?[h[0],h[4],h[8],h[12]]:[h[1],h[5],h[9],h[13]],S=[h[3],h[7],h[11],h[15]],C=e[0]*b[0]+e[1]*b[1]+e[2]*b[2],k=e[0]*S[0]+e[1]*S[1]+e[2]*S[2],R=n[0]*b[0]+n[1]*b[1]+n[2]*b[2],j=n[0]*S[0]+n[1]*S[1]+n[2]*S[2];return R+y*k===C+y*j||S[3]*(C-R)+b[3]*(j-k)+C*j==R*k?null:(R+b[3]-y*j-y*S[3])/(R-C-y*j+y*k)}static getLesserNonNegativeNonNull(e,n){return n!==null&&n>=0&&n<e?n:e}}class Ma{constructor(e){this._globe=e,this._mercatorCameraHelper=new Sa,this._verticalPerspectiveCameraHelper=new Cr}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,n){return this.currentHelper.handlePanInertia(e,n)}handleMapControlsRollPitchBearingZoom(e,n){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,n)}handleMapControlsPan(e,n,h){this.currentHelper.handleMapControlsPan(e,n,h)}cameraForBoxAndBearing(e,n,h,d,y){return this.currentHelper.cameraForBoxAndBearing(e,n,h,d,y)}handleJumpToCenterZoom(e,n){this.currentHelper.handleJumpToCenterZoom(e,n)}handleEaseTo(e,n){return this.currentHelper.handleEaseTo(e,n)}handleFlyTo(e,n){return this.currentHelper.handleFlyTo(e,n)}}let Os=(_,e)=>a.x(_,e&&e.filter(n=>n.identifier!=="source.canvas")),Hc=a.bw();class Yl extends a.E{constructor(e,n={}){super(),this._rtlPluginLoaded=()=>{for(let h in this.sourceCaches){let d=this.sourceCaches[h].getSource().type;d!=="vector"&&d!=="geojson"||this.sourceCaches[h].reload()}},this.map=e,this.dispatcher=new Ft(zt(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(h,d)=>this.getGlyphs(h,d)),this.dispatcher.registerMessageHandler("GI",(h,d)=>this.getImages(h,d)),this.imageManager=new Q,this.imageManager.setEventedParent(this),this.glyphManager=new de(e._requestManager,n.localIdeographFontFamily),this.lineAtlas=new Ee(256,512),this.crossTileSymbolIndex=new oo,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.bx,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",a.by()),Ot().on(Jo,this._rtlPluginLoaded),this.on("data",h=>{if(h.dataType!=="source"||h.sourceDataType!=="metadata")return;let d=this.sourceCaches[h.sourceId];if(!d)return;let y=d.getSource();if(y&&y.vectorLayerIds)for(let b in this._layers){let S=this._layers[b];S.source===y.id&&this._validateLayer(S)}})}loadURL(e,n={},h){this.fire(new a.l("dataloading",{dataType:"style"})),n.validate=typeof n.validate!="boolean"||n.validate;let d=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;let y=this._loadStyleRequest;a.j(d,this._loadStyleRequest).then(b=>{this._loadStyleRequest=null,this._load(b.data,n,h)}).catch(b=>{this._loadStyleRequest=null,b&&!y.signal.aborted&&this.fire(new a.k(b))})}loadJSON(e,n={},h){this.fire(new a.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,W.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,n.validate=n.validate!==!1,this._load(e,n,h)}).catch(()=>{})}loadEmpty(){this.fire(new a.l("dataloading",{dataType:"style"})),this._load(Hc,{validate:!1})}_load(e,n,h){var d,y;let b=n.transformStyle?n.transformStyle(h,e):e;if(!n.validate||!Os(this,a.y(b))){this._loaded=!0,this.stylesheet=b;for(let S in b.sources)this.addSource(S,b.sources[S],{validate:!1});b.sprite?this._loadSprite(b.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(b.glyphs),this._createLayers(),this.light=new Ce(this.stylesheet.light),this._setProjectionInternal(((d=this.stylesheet.projection)===null||d===void 0?void 0:d.type)||"mercator"),this.sky=new Fe(this.stylesheet.sky),this.map.setTerrain((y=this.stylesheet.terrain)!==null&&y!==void 0?y:null),this.fire(new a.l("data",{dataType:"style"})),this.fire(new a.l("style.load"))}}_createLayers(){let e=a.bz(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(n=>n.id),this._layers={},this._serializedLayers=null;for(let n of e){let h=a.bA(n);h.setEventedParent(this,{layer:{id:n.id}}),this._layers[n.id]=h}}_loadSprite(e,n=!1,h=void 0){let d;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(y,b,S,C){return a._(this,void 0,void 0,function*(){let k=pt(y),R=S>1?"@2x":"",j={},N={};for(let{id:q,url:H}of k){let ae=b.transformRequest(Pt(H,R,".json"),"SpriteJSON");j[q]=a.j(ae,C);let oe=b.transformRequest(Pt(H,R,".png"),"SpriteImage");N[q]=Se.getImage(oe,C)}return yield Promise.all([...Object.values(j),...Object.values(N)]),function(q,H){return a._(this,void 0,void 0,function*(){let ae={};for(let oe in q){ae[oe]={};let se=W.getImageCanvasContext((yield H[oe]).data),pe=(yield q[oe]).data;for(let ve in pe){let{width:ye,height:we,x:Le,y:Pe,sdf:$e,pixelRatio:tt,stretchX:He,stretchY:Ke,content:Qe,textFitWidth:vt,textFitHeight:gt}=pe[ve];ae[oe][ve]={data:null,pixelRatio:tt,sdf:$e,stretchX:He,stretchY:Ke,content:Qe,textFitWidth:vt,textFitHeight:gt,spriteData:{width:ye,height:we,x:Le,y:Pe,context:se}}}}return ae})}(j,N)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(y=>{if(this._spriteRequest=null,y)for(let b in y){this._spritesImagesIds[b]=[];let S=this._spritesImagesIds[b]?this._spritesImagesIds[b].filter(C=>!(C in y)):[];for(let C of S)this.imageManager.removeImage(C),this._changedImages[C]=!0;for(let C in y[b]){let k=b==="default"?C:`${b}:${C}`;this._spritesImagesIds[b].push(k),k in this.imageManager.images?this.imageManager.updateImage(k,y[b][C],!1):this.imageManager.addImage(k,y[b][C]),n&&(this._changedImages[k]=!0)}}}).catch(y=>{this._spriteRequest=null,d=y,this.fire(new a.k(d))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),n&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"})),h&&h(d)})}_unloadSprite(){for(let e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"}))}_validateLayer(e){let n=this.sourceCaches[e.source];if(!n)return;let h=e.sourceLayer;if(!h)return;let d=n.getSource();(d.type==="geojson"||d.vectorLayerIds&&d.vectorLayerIds.indexOf(h)===-1)&&this.fire(new a.k(new Error(`Source layer "${h}" does not exist on source "${d.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(let e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,n=!1){let h=this._serializedAllLayers();if(!e||e.length===0)return Object.values(n?a.bB(h):h);let d=[];for(let y of e)if(h[y]){let b=n?a.bB(h[y]):h[y];d.push(b)}return d}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};let n=Object.keys(this._layers);for(let h of n){let d=this._layers[h];d.type!=="custom"&&(e[h]=d.serialize())}return e}hasTransitions(){var e,n,h;if(!((e=this.light)===null||e===void 0)&&e.hasTransition()||!((n=this.sky)===null||n===void 0)&&n.hasTransition()||!((h=this.projection)===null||h===void 0)&&h.hasTransition())return!0;for(let d in this.sourceCaches)if(this.sourceCaches[d].hasTransition())return!0;for(let d in this._layers)if(this._layers[d].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;let n=this._changed;if(n){let d=Object.keys(this._updatedLayers),y=Object.keys(this._removedLayers);(d.length||y.length)&&this._updateWorkerLayers(d,y);for(let b in this._updatedSources){let S=this._updatedSources[b];if(S==="reload")this._reloadSource(b);else{if(S!=="clear")throw new Error(`Invalid action ${S}`);this._clearSource(b)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(let b in this._updatedPaintProps)this._layers[b].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}let h={};for(let d in this.sourceCaches){let y=this.sourceCaches[d];h[d]=y.used,y.used=!1}for(let d of this._order){let y=this._layers[d];y.recalculate(e,this._availableImages),!y.isHidden(e.zoom)&&y.source&&(this.sourceCaches[y.source].used=!0)}for(let d in h){let y=this.sourceCaches[d];!!h[d]!=!!y.used&&y.fire(new a.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:d}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,n&&this.fire(new a.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){let e=Object.keys(this._changedImages);if(e.length){for(let n in this.sourceCaches)this.sourceCaches[n].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(let e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,n){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:n})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,n={}){var h;this._checkLoaded();let d=this.serialize();if(e=n.transformStyle?n.transformStyle(d,e):e,((h=n.validate)===null||h===void 0||h)&&Os(this,a.y(e)))return!1;(e=a.bB(e)).layers=a.bz(e.layers);let y=a.bC(d,e),b=this._getOperationsToPerform(y);if(b.unimplemented.length>0)throw new Error(`Unimplemented: ${b.unimplemented.join(", ")}.`);if(b.operations.length===0)return!1;for(let S of b.operations)S();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){let n=[],h=[];for(let d of e)switch(d.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":n.push(()=>this.addLayer.apply(this,d.args));break;case"removeLayer":n.push(()=>this.removeLayer.apply(this,d.args));break;case"setPaintProperty":n.push(()=>this.setPaintProperty.apply(this,d.args));break;case"setLayoutProperty":n.push(()=>this.setLayoutProperty.apply(this,d.args));break;case"setFilter":n.push(()=>this.setFilter.apply(this,d.args));break;case"addSource":n.push(()=>this.addSource.apply(this,d.args));break;case"removeSource":n.push(()=>this.removeSource.apply(this,d.args));break;case"setLayerZoomRange":n.push(()=>this.setLayerZoomRange.apply(this,d.args));break;case"setLight":n.push(()=>this.setLight.apply(this,d.args));break;case"setGeoJSONSourceData":n.push(()=>this.setGeoJSONSourceData.apply(this,d.args));break;case"setGlyphs":n.push(()=>this.setGlyphs.apply(this,d.args));break;case"setSprite":n.push(()=>this.setSprite.apply(this,d.args));break;case"setTerrain":n.push(()=>this.map.setTerrain.apply(this,d.args));break;case"setSky":n.push(()=>this.setSky.apply(this,d.args));break;case"setProjection":this.setProjection.apply(this,d.args);break;case"setTransition":n.push(()=>{});break;default:h.push(d.command)}return{operations:n,unimplemented:h}}addImage(e,n){if(this.getImage(e))return this.fire(new a.k(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,n),this._afterImageUpdated(e)}updateImage(e,n){this.imageManager.updateImage(e,n)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new a.k(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,n,h={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(a.y.source,`sources.${e}`,n,null,h))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);let d=this.sourceCaches[e]=new Be(e,n,this.dispatcher);d.style=this,d.setEventedParent(this,()=>({isSourceLoaded:d.loaded(),source:d.serialize(),sourceId:e})),d.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(let h in this._layers)if(this._layers[h].source===e)return this.fire(new a.k(new Error(`Source "${e}" cannot be removed while layer "${h}" is using it.`)));let n=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],n.fire(new a.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),n.setEventedParent(null),n.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,n){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);let h=this.sourceCaches[e].getSource();if(h.type!=="geojson")throw new Error(`geojsonSource.type is ${h.type}, which is !== 'geojson`);h.setData(n),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,n,h={}){this._checkLoaded();let d=e.id;if(this.getLayer(d))return void this.fire(new a.k(new Error(`Layer "${d}" already exists on this map.`)));let y;if(e.type==="custom"){if(Os(this,a.bD(e)))return;y=a.bA(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(d,e.source),e=a.bB(e),e=a.e(e,{source:d})),this._validate(a.y.layer,`layers.${d}`,e,{arrayIndex:-1},h))return;y=a.bA(e),this._validateLayer(y),y.setEventedParent(this,{layer:{id:d}})}let b=n?this._order.indexOf(n):this._order.length;if(n&&b===-1)this.fire(new a.k(new Error(`Cannot add layer "${d}" before non-existing layer "${n}".`)));else{if(this._order.splice(b,0,d),this._layerOrderChanged=!0,this._layers[d]=y,this._removedLayers[d]&&y.source&&y.type!=="custom"){let S=this._removedLayers[d];delete this._removedLayers[d],S.type!==y.type?this._updatedSources[y.source]="clear":(this._updatedSources[y.source]="reload",this.sourceCaches[y.source].pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map)}}moveLayer(e,n){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new a.k(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===n)return;let h=this._order.indexOf(e);this._order.splice(h,1);let d=n?this._order.indexOf(n):this._order.length;n&&d===-1?this.fire(new a.k(new Error(`Cannot move layer "${e}" before non-existing layer "${n}".`))):(this._order.splice(d,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();let n=this._layers[e];if(!n)return void this.fire(new a.k(new Error(`Cannot remove non-existing layer "${e}".`)));n.setEventedParent(null);let h=this._order.indexOf(e);this._order.splice(h,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=n,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],n.onRemove&&n.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,n,h){this._checkLoaded();let d=this.getLayer(e);d?d.minzoom===n&&d.maxzoom===h||(n!=null&&(d.minzoom=n),h!=null&&(d.maxzoom=h),this._updateLayer(d)):this.fire(new a.k(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,n,h={}){this._checkLoaded();let d=this.getLayer(e);if(d){if(!a.bE(d.filter,n))return n==null?(d.filter=void 0,void this._updateLayer(d)):void(this._validate(a.y.filter,`layers.${d.id}.filter`,n,null,h)||(d.filter=a.bB(n),this._updateLayer(d)))}else this.fire(new a.k(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return a.bB(this.getLayer(e).filter)}setLayoutProperty(e,n,h,d={}){this._checkLoaded();let y=this.getLayer(e);y?a.bE(y.getLayoutProperty(n),h)||(y.setLayoutProperty(n,h,d),this._updateLayer(y)):this.fire(new a.k(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,n){let h=this.getLayer(e);if(h)return h.getLayoutProperty(n);this.fire(new a.k(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,n,h,d={}){this._checkLoaded();let y=this.getLayer(e);y?a.bE(y.getPaintProperty(n),h)||(y.setPaintProperty(n,h,d)&&this._updateLayer(y),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new a.k(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,n){return this.getLayer(e).getPaintProperty(n)}setFeatureState(e,n){this._checkLoaded();let h=e.source,d=e.sourceLayer,y=this.sourceCaches[h];if(y===void 0)return void this.fire(new a.k(new Error(`The source '${h}' does not exist in the map's style.`)));let b=y.getSource().type;b==="geojson"&&d?this.fire(new a.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):b!=="vector"||d?(e.id===void 0&&this.fire(new a.k(new Error("The feature id parameter must be provided."))),y.setFeatureState(d,e.id,n)):this.fire(new a.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,n){this._checkLoaded();let h=e.source,d=this.sourceCaches[h];if(d===void 0)return void this.fire(new a.k(new Error(`The source '${h}' does not exist in the map's style.`)));let y=d.getSource().type,b=y==="vector"?e.sourceLayer:void 0;y!=="vector"||b?n&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new a.k(new Error("A feature id is required to remove its specific state property."))):d.removeFeatureState(b,e.id,n):this.fire(new a.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();let n=e.source,h=e.sourceLayer,d=this.sourceCaches[n];if(d!==void 0)return d.getSource().type!=="vector"||h?(e.id===void 0&&this.fire(new a.k(new Error("The feature id parameter must be provided."))),d.getFeatureState(h,e.id)):void this.fire(new a.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.k(new Error(`The source '${n}' does not exist in the map's style.`)))}getTransition(){return a.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;let e=a.bF(this.sourceCaches,y=>y.serialize()),n=this._serializeByIds(this._order,!0),h=this.map.getTerrain()||void 0,d=this.stylesheet;return a.bG({version:d.version,name:d.name,metadata:d.metadata,light:d.light,sky:d.sky,center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch,sprite:d.sprite,glyphs:d.glyphs,transition:d.transition,projection:d.projection,sources:e,layers:n,terrain:h},y=>y!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){let n=b=>this._layers[b].type==="fill-extrusion",h={},d=[];for(let b=this._order.length-1;b>=0;b--){let S=this._order[b];if(n(S)){h[S]=b;for(let C of e){let k=C[S];if(k)for(let R of k)d.push(R)}}}d.sort((b,S)=>S.intersectionZ-b.intersectionZ);let y=[];for(let b=this._order.length-1;b>=0;b--){let S=this._order[b];if(n(S))for(let C=d.length-1;C>=0;C--){let k=d[C].feature;if(h[k.layer.id]<b)break;y.push(k),d.pop()}else for(let C of e){let k=C[S];if(k)for(let R of k)y.push(R.feature)}}return y}queryRenderedFeatures(e,n,h){n&&n.filter&&this._validate(a.y.filter,"queryRenderedFeatures.filter",n.filter,null,n);let d={};if(n&&n.layers){if(!(Array.isArray(n.layers)||n.layers instanceof Set))return this.fire(new a.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(let k of n.layers){let R=this._layers[k];if(!R)return this.fire(new a.k(new Error(`The layer '${k}' does not exist in the map's style and cannot be queried for features.`))),[];d[R.source]=!0}}let y=[];n.availableImages=this._availableImages;let b=this._serializedAllLayers(),S=n.layers instanceof Set?n.layers:Array.isArray(n.layers)?new Set(n.layers):null,C=Object.assign(Object.assign({},n),{layers:S});for(let k in this.sourceCaches)n.layers&&!d[k]||y.push(Jn(this.sourceCaches[k],this._layers,b,e,C,h,this.map.terrain?(R,j,N)=>this.map.terrain.getElevation(R,j,N):void 0));return this.placement&&y.push(function(k,R,j,N,q,H,ae){let oe={},se=H.queryRenderedSymbols(N),pe=[];for(let ve of Object.keys(se).map(Number))pe.push(ae[ve]);pe.sort(hn);for(let ve of pe){let ye=ve.featureIndex.lookupSymbolFeatures(se[ve.bucketInstanceId],R,ve.bucketIndex,ve.sourceLayerIndex,q.filter,q.layers,q.availableImages,k);for(let we in ye){let Le=oe[we]=oe[we]||[],Pe=ye[we];Pe.sort(($e,tt)=>{let He=ve.featureSortOrder;if(He){let Ke=He.indexOf($e.featureIndex);return He.indexOf(tt.featureIndex)-Ke}return tt.featureIndex-$e.featureIndex});for(let $e of Pe)Le.push($e)}}return function(ve,ye,we){for(let Le in ve)for(let Pe of ve[Le])Yi(Pe,we[ye[Le].source]);return ve}(oe,k,j)}(this._layers,b,this.sourceCaches,e,C,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(y)}querySourceFeatures(e,n){n&&n.filter&&this._validate(a.y.filter,"querySourceFeatures.filter",n.filter,null,n);let h=this.sourceCaches[e];return h?function(d,y){let b=d.getRenderableIds().map(k=>d.getTileByID(k)),S=[],C={};for(let k=0;k<b.length;k++){let R=b[k],j=R.tileID.canonical.key;C[j]||(C[j]=!0,R.querySourceFeatures(S,y))}return S}(h,n):[]}getLight(){return this.light.getLight()}setLight(e,n={}){this._checkLoaded();let h=this.light.getLight(),d=!1;for(let b in e)if(!a.bE(e[b],h[b])){d=!0;break}if(!d)return;let y={now:W.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,n),this.light.updateTransitions(y)}getProjection(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,n={}){this._checkLoaded();let h=this.getSky(),d=!1;if(!e&&!h)return;if(e&&!h)d=!0;else if(!e&&h)d=!0;else for(let b in e)if(!a.bE(e[b],h[b])){d=!0;break}if(!d)return;let y={now:W.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,n),this.sky.updateTransitions(y)}_setProjectionInternal(e){let n=function(h){if(Array.isArray(h)){let d=new Mr({type:h});return{projection:d,transform:new ns,cameraHelper:new Ma(d)}}switch(h){case"mercator":return{projection:new wa,transform:new Di,cameraHelper:new Sa};case"globe":{let d=new Mr({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:d,transform:new ns,cameraHelper:new Ma(d)}}case"vertical-perspective":return{projection:new xi,transform:new ta,cameraHelper:new Cr};default:return a.w(`Unknown projection name: ${h}. Falling back to mercator projection.`),{projection:new wa,transform:new Di,cameraHelper:new Sa}}}(e);this.projection=n.projection,this.map.migrateProjection(n.transform,n.cameraHelper);for(let h in this.sourceCaches)this.sourceCaches[h].reload()}_validate(e,n,h,d,y={}){return(!y||y.validate!==!1)&&Os(this,e.call(a.y,a.e({key:n,style:this.serialize(),value:h,styleSpec:a.v},d)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Ot().off(Jo,this._rtlPluginLoaded);for(let n in this._layers)this._layers[n].setEventedParent(null);for(let n in this.sourceCaches){let h=this.sourceCaches[n];h.setEventedParent(null),h.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(let n in this.sourceCaches)this.sourceCaches[n].update(e,this.map.terrain)}_generateCollisionBoxes(){for(let e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,n,h,d,y=!1){let b=!1,S=!1,C={};for(let k of this._order){let R=this._layers[k];if(R.type!=="symbol")continue;if(!C[R.source]){let N=this.sourceCaches[R.source];C[R.source]=N.getRenderableIds(!0).map(q=>N.getTileByID(q)).sort((q,H)=>H.tileID.overscaledZ-q.tileID.overscaledZ||(q.tileID.isLessThan(H.tileID)?-1:1))}let j=this.crossTileSymbolIndex.addLayer(R,C[R.source],e.center.lng);b=b||j}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((y=y||this._layerOrderChanged||h===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(W.now(),e.zoom))&&(this.pauseablePlacement=new Br(e,this.map.terrain,this._order,y,n,h,d,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,C),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(W.now()),S=!0),b&&this.pauseablePlacement.placement.setStale()),S||b)for(let k of this._order){let R=this._layers[k];R.type==="symbol"&&this.placement.updateLayerOpacities(R,C[R.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(W.now())}_releaseSymbolFadeTiles(){for(let e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,n){return a._(this,void 0,void 0,function*(){let h=yield this.imageManager.getImages(n.icons);this._updateTilesForChangedImages();let d=this.sourceCaches[n.source];return d&&d.setDependencies(n.tileID.key,n.type,n.icons),h})}getGlyphs(e,n){return a._(this,void 0,void 0,function*(){let h=yield this.glyphManager.getGlyphs(n.stacks),d=this.sourceCaches[n.source];return d&&d.setDependencies(n.tileID.key,n.type,[""]),h})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,n={}){this._checkLoaded(),e&&this._validate(a.y.glyphs,"glyphs",e,null,n)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,n,h={},d){this._checkLoaded();let y=[{id:e,url:n}],b=[...pt(this.stylesheet.sprite),...y];this._validate(a.y.sprite,"sprite",b,null,h)||(this.stylesheet.sprite=b,this._loadSprite(y,!0,d))}removeSprite(e){this._checkLoaded();let n=pt(this.stylesheet.sprite);if(n.find(h=>h.id===e)){if(this._spritesImagesIds[e])for(let h of this._spritesImagesIds[e])this.imageManager.removeImage(h),this._changedImages[h]=!0;n.splice(n.findIndex(h=>h.id===e),1),this.stylesheet.sprite=n.length>0?n:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"}))}else this.fire(new a.k(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return pt(this.stylesheet.sprite)}setSprite(e,n={},h){this._checkLoaded(),e&&this._validate(a.y.sprite,"sprite",e,null,n)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,h):(this._unloadSprite(),h&&h(null)))}}var eh=a.aG([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Jl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,n,h,d,y,b,S,C,k){this.context=e;let R=this.boundPaintVertexBuffers.length!==d.length;for(let j=0;!R&&j<d.length;j++)this.boundPaintVertexBuffers[j]!==d[j]&&(R=!0);!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==h||R||this.boundIndexBuffer!==y||this.boundVertexOffset!==b||this.boundDynamicVertexBuffer!==S||this.boundDynamicVertexBuffer2!==C||this.boundDynamicVertexBuffer3!==k?this.freshBind(n,h,d,y,b,S,C,k):(e.bindVertexArray.set(this.vao),S&&S.bind(),y&&y.dynamicDraw&&y.bind(),C&&C.bind(),k&&k.bind())}freshBind(e,n,h,d,y,b,S,C){let k=e.numAttributes,R=this.context,j=R.gl;this.vao&&this.destroy(),this.vao=R.createVertexArray(),R.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=d,this.boundVertexOffset=y,this.boundDynamicVertexBuffer=b,this.boundDynamicVertexBuffer2=S,this.boundDynamicVertexBuffer3=C,n.enableAttributes(j,e);for(let N of h)N.enableAttributes(j,e);b&&b.enableAttributes(j,e),S&&S.enableAttributes(j,e),C&&C.enableAttributes(j,e),n.bind(),n.setVertexAttribPointers(j,e,y);for(let N of h)N.bind(),N.setVertexAttribPointers(j,e,y);b&&(b.bind(),b.setVertexAttribPointers(j,e,y)),d&&d.bind(),S&&(S.bind(),S.setVertexAttribPointers(j,e,y)),C&&(C.bind(),C.setVertexAttribPointers(j,e,y)),R.currentNumAttributes=k}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}let th=(_,e,n,h,d)=>({u_texture:0,u_ele_delta:_,u_fog_matrix:e,u_fog_color:n?n.properties.get("fog-color"):a.b7.white,u_fog_ground_blend:n?n.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:d?0:n?n.calculateFogBlendOpacity(h):0,u_horizon_color:n?n.properties.get("horizon-color"):a.b7.white,u_horizon_fog_blend:n?n.properties.get("horizon-fog-blend"):1,u_is_globe_mode:d?1:0}),Fs={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Ca(_){let e=[];for(let n=0;n<_.length;n++){if(_[n]===null)continue;let h=_[n].split(" ");e.push(h.pop())}return e}class Ia{constructor(e,n,h,d,y,b,S,C,k=[]){let R=e.gl;this.program=R.createProgram();let j=Ca(n.staticAttributes),N=h?h.getBinderAttributes():[],q=j.concat(N),H=Bn.prelude.staticUniforms?Ca(Bn.prelude.staticUniforms):[],ae=S.staticUniforms?Ca(S.staticUniforms):[],oe=n.staticUniforms?Ca(n.staticUniforms):[],se=h?h.getBinderUniforms():[],pe=H.concat(ae).concat(oe).concat(se),ve=[];for(let He of pe)ve.indexOf(He)<0&&ve.push(He);let ye=h?h.defines():[];ur(R)&&ye.unshift("#version 300 es"),y&&ye.push("#define OVERDRAW_INSPECTOR;"),b&&ye.push("#define TERRAIN3D;"),C&&ye.push(C),k&&ye.push(...k);let we=ye.concat(Bn.prelude.fragmentSource,S.fragmentSource,n.fragmentSource).join(`
`),Le=ye.concat(Bn.prelude.vertexSource,S.vertexSource,n.vertexSource).join(`
`);ur(R)||(we=function(He){return He.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(we),Le=function(He){return He.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(Le));let Pe=R.createShader(R.FRAGMENT_SHADER);if(R.isContextLost())return void(this.failedToCreate=!0);if(R.shaderSource(Pe,we),R.compileShader(Pe),!R.getShaderParameter(Pe,R.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${R.getShaderInfoLog(Pe)}`);R.attachShader(this.program,Pe);let $e=R.createShader(R.VERTEX_SHADER);if(R.isContextLost())return void(this.failedToCreate=!0);if(R.shaderSource($e,Le),R.compileShader($e),!R.getShaderParameter($e,R.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${R.getShaderInfoLog($e)}`);R.attachShader(this.program,$e),this.attributes={};let tt={};this.numAttributes=q.length;for(let He=0;He<this.numAttributes;He++)q[He]&&(R.bindAttribLocation(this.program,He,q[He]),this.attributes[q[He]]=He);if(R.linkProgram(this.program),!R.getProgramParameter(this.program,R.LINK_STATUS))throw new Error(`Program failed to link: ${R.getProgramInfoLog(this.program)}`);R.deleteShader($e),R.deleteShader(Pe);for(let He=0;He<ve.length;He++){let Ke=ve[He];if(Ke&&!tt[Ke]){let Qe=R.getUniformLocation(this.program,Ke);Qe&&(tt[Ke]=Qe)}}this.fixedUniforms=d(e,tt),this.terrainUniforms=((He,Ke)=>({u_depth:new a.bH(He,Ke.u_depth),u_terrain:new a.bH(He,Ke.u_terrain),u_terrain_dim:new a.b8(He,Ke.u_terrain_dim),u_terrain_matrix:new a.bJ(He,Ke.u_terrain_matrix),u_terrain_unpack:new a.bK(He,Ke.u_terrain_unpack),u_terrain_exaggeration:new a.b8(He,Ke.u_terrain_exaggeration)}))(e,tt),this.projectionUniforms=((He,Ke)=>({u_projection_matrix:new a.bJ(He,Ke.u_projection_matrix),u_projection_tile_mercator_coords:new a.bK(He,Ke.u_projection_tile_mercator_coords),u_projection_clipping_plane:new a.bK(He,Ke.u_projection_clipping_plane),u_projection_transition:new a.b8(He,Ke.u_projection_transition),u_projection_fallback_matrix:new a.bJ(He,Ke.u_projection_fallback_matrix)}))(e,tt),this.binderUniforms=h?h.getUniforms(e,tt):[]}draw(e,n,h,d,y,b,S,C,k,R,j,N,q,H,ae,oe,se,pe,ve){let ye=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(h),e.setStencilMode(d),e.setColorMode(y),e.setCullFace(b),C){e.activeTexture.set(ye.TEXTURE2),ye.bindTexture(ye.TEXTURE_2D,C.depthTexture),e.activeTexture.set(ye.TEXTURE3),ye.bindTexture(ye.TEXTURE_2D,C.texture);for(let Le in this.terrainUniforms)this.terrainUniforms[Le].set(C[Le])}if(k)for(let Le in k)this.projectionUniforms[Fs[Le]].set(k[Le]);if(S)for(let Le in this.fixedUniforms)this.fixedUniforms[Le].set(S[Le]);oe&&oe.setUniforms(e,this.binderUniforms,H,{zoom:ae});let we=0;switch(n){case ye.LINES:we=2;break;case ye.TRIANGLES:we=3;break;case ye.LINE_STRIP:we=1}for(let Le of q.get()){let Pe=Le.vaos||(Le.vaos={});(Pe[R]||(Pe[R]=new Jl)).bind(e,this,j,oe?oe.getPaintVertexBuffers():[],N,Le.vertexOffset,se,pe,ve),ye.drawElements(n,Le.primitiveLength*we,ye.UNSIGNED_SHORT,Le.primitiveOffset*we*2)}}}function yo(_,e,n){let h=1/a.az(n,1,e.transform.tileZoom),d=Math.pow(2,n.tileID.overscaledZ),y=n.tileSize*Math.pow(2,e.transform.tileZoom)/d,b=y*(n.tileID.canonical.x+n.tileID.wrap*d),S=y*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[h,_.fromScale,_.toScale],u_fade:_.t,u_pixel_coord_upper:[b>>16,S>>16],u_pixel_coord_lower:[65535&b,65535&S]}}let gl=(_,e,n,h)=>{let d=_.style.light,y=d.properties.get("position"),b=[y.x,y.y,y.z],S=a.bN();d.properties.get("anchor")==="viewport"&&a.bO(S,_.transform.bearingInRadians),a.bP(b,b,S);let C=_.transform.transformLightDirection(b),k=d.properties.get("color");return{u_lightpos:b,u_lightpos_globe:C,u_lightintensity:d.properties.get("intensity"),u_lightcolor:[k.r,k.g,k.b],u_vertical_gradient:+e,u_opacity:n,u_fill_translate:h}},Ir=(_,e,n,h,d,y,b)=>a.e(gl(_,e,n,h),yo(y,_,b),{u_height_factor:-Math.pow(2,d.overscaledZ)/b.tileSize/8}),Or=(_,e,n,h)=>a.e(yo(e,_,n),{u_fill_translate:h}),_l=(_,e)=>({u_world:_,u_fill_translate:e}),rs=(_,e,n,h,d)=>a.e(Or(_,e,n,d),{u_world:h}),Ns=(_,e,n,h,d)=>{let y=_.transform,b,S,C=0;if(n.paint.get("circle-pitch-alignment")==="map"){let k=a.az(e,1,y.zoom);b=!0,S=[k,k],C=k/(a.Z*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*d}else b=!1,S=y.pixelsToGLUnits;return{u_camera_to_center_distance:y.cameraToCenterDistance,u_scale_with_map:+(n.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+b,u_device_pixel_ratio:_.pixelRatio,u_extrude_scale:S,u_globe_extrude_scale:C,u_translate:h}},Ql=_=>({u_pixel_extrude_scale:[1/_.width,1/_.height]}),os=_=>({u_viewport_size:[_.width,_.height]}),Kc=(_,e=1)=>({u_color:_,u_overlay:0,u_overlay_scale:e}),Ea=(_,e,n,h)=>{let d=a.az(_,1,e)/(a.Z*Math.pow(2,_.tileID.overscaledZ))*2*Math.PI*h;return{u_extrude_scale:a.az(_,1,e),u_intensity:n,u_globe_extrude_scale:d}},ec=(_,e,n,h)=>{let d=a.K();a.bQ(d,0,_.width,_.height,0,0,1);let y=_.context.gl;return{u_matrix:d,u_world:[y.drawingBufferWidth,y.drawingBufferHeight],u_image:n,u_color_ramp:h,u_opacity:e.paint.get("heatmap-opacity")}},Xc=(_,e,n)=>{let h=n.paint.get("hillshade-accent-color"),d;switch(n.paint.get("hillshade-method")){case"basic":d=4;break;case"combined":d=1;break;case"igor":d=2;break;case"multidirectional":d=3;break;default:d=0}let y=n.getIlluminationProperties();for(let b=0;b<y.directionRadians.length;b++)n.paint.get("hillshade-illumination-anchor")==="viewport"&&(y.directionRadians[b]+=_.transform.bearingInRadians);return{u_image:0,u_latrange:La(0,e.tileID),u_exaggeration:n.paint.get("hillshade-exaggeration"),u_altitudes:y.altitudeRadians,u_azimuths:y.directionRadians,u_accent:h,u_method:d,u_highlights:y.highlightColor,u_shadows:y.shadowColor}},ao=(_,e)=>{let n=e.stride,h=a.K();return a.bQ(h,0,a.Z,-8192,0,0,1),a.L(h,h,[0,-8192,0]),{u_matrix:h,u_image:1,u_dimension:[n,n],u_zoom:_.overscaledZ,u_unpack:e.getUnpackVector()}};function La(_,e){let n=Math.pow(2,e.canonical.z),h=e.canonical.y;return[new a.$(0,h/n).toLngLat().lat,new a.$(0,(h+1)/n).toLngLat().lat]}let js=(_,e,n,h)=>{let d=_.transform;return{u_translation:Hr(_,e,n),u_ratio:h/a.az(e,1,d.zoom),u_device_pixel_ratio:_.pixelRatio,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},vo=(_,e,n,h,d)=>a.e(js(_,e,n,h),{u_image:0,u_image_height:d}),Yc=(_,e,n,h,d)=>{let y=_.transform,b=tc(e,y);return{u_translation:Hr(_,e,n),u_texsize:e.imageAtlasTexture.size,u_ratio:h/a.az(e,1,y.zoom),u_device_pixel_ratio:_.pixelRatio,u_image:0,u_scale:[b,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},Aa=(_,e,n,h,d,y)=>{let b=_.lineAtlas,S=tc(e,_.transform),C=n.layout.get("line-cap")==="round",k=b.getDash(d.from,C),R=b.getDash(d.to,C),j=k.width*y.fromScale,N=R.width*y.toScale;return a.e(js(_,e,n,h),{u_patternscale_a:[S/j,-k.height/2],u_patternscale_b:[S/N,-R.height/2],u_sdfgamma:b.width/(256*Math.min(j,N)*_.pixelRatio)/2,u_image:0,u_tex_y_a:k.y,u_tex_y_b:R.y,u_mix:y.t})};function tc(_,e){return 1/a.az(_,1,e.tileZoom)}function Hr(_,e,n){return a.aA(_.transform,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}let ic=(_,e,n,h,d)=>{return{u_tl_parent:_,u_scale_parent:e,u_buffer_scale:1,u_fade_t:n.mix,u_opacity:n.opacity*h.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:h.paint.get("raster-brightness-min"),u_brightness_high:h.paint.get("raster-brightness-max"),u_saturation_factor:(b=h.paint.get("raster-saturation"),b>0?1-1/(1.001-b):-b),u_contrast_factor:(y=h.paint.get("raster-contrast"),y>0?1/(1-y):1+y),u_spin_weights:$s(h.paint.get("raster-hue-rotate")),u_coords_top:[d[0].x,d[0].y,d[1].x,d[1].y],u_coords_bottom:[d[3].x,d[3].y,d[2].x,d[2].y]};var y,b};function $s(_){_*=Math.PI/180;let e=Math.sin(_),n=Math.cos(_);return[(2*n+1)/3,(-Math.sqrt(3)*e-n+1)/3,(Math.sqrt(3)*e-n+1)/3]}let as=(_,e,n,h,d,y,b,S,C,k,R,j,N)=>{let q=b.transform;return{u_is_size_zoom_constant:+(_==="constant"||_==="source"),u_is_size_feature_constant:+(_==="constant"||_==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:q.cameraToCenterDistance,u_pitch:q.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:q.width/q.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_label_plane_matrix:S,u_coord_matrix:C,u_is_text:+R,u_pitch_with_map:+h,u_is_along_line:d,u_is_variable_anchor:y,u_texsize:j,u_texture:0,u_translation:k,u_pitched_scale:N}},Fo=(_,e,n,h,d,y,b,S,C,k,R,j,N,q)=>{let H=b.transform;return a.e(as(_,e,n,h,d,y,b,S,C,k,R,j,q),{u_gamma_scale:h?Math.cos(H.pitch*Math.PI/180)*H.cameraToCenterDistance:1,u_device_pixel_ratio:b.pixelRatio,u_is_halo:1})},ka=(_,e,n,h,d,y,b,S,C,k,R,j,N)=>a.e(Fo(_,e,n,h,d,y,b,S,C,k,!0,R,0,N),{u_texsize_icon:j,u_texture_icon:1}),ih=(_,e)=>({u_opacity:_,u_color:e}),nc=(_,e,n,h,d)=>a.e(function(y,b,S,C){let k=S.imageManager.getPattern(y.from.toString()),R=S.imageManager.getPattern(y.to.toString()),{width:j,height:N}=S.imageManager.getPixelSize(),q=Math.pow(2,C.tileID.overscaledZ),H=C.tileSize*Math.pow(2,S.transform.tileZoom)/q,ae=H*(C.tileID.canonical.x+C.tileID.wrap*q),oe=H*C.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:k.tl,u_pattern_br_a:k.br,u_pattern_tl_b:R.tl,u_pattern_br_b:R.br,u_texsize:[j,N],u_mix:b.t,u_pattern_size_a:k.displaySize,u_pattern_size_b:R.displaySize,u_scale_a:b.fromScale,u_scale_b:b.toScale,u_tile_units_to_pixels:1/a.az(C,1,S.transform.tileZoom),u_pixel_coord_upper:[ae>>16,oe>>16],u_pixel_coord_lower:[65535&ae,65535&oe]}}(n,d,e,h),{u_opacity:_}),rc=(_,e)=>{},xo={fillExtrusion:(_,e)=>({u_lightpos:new a.bL(_,e.u_lightpos),u_lightpos_globe:new a.bL(_,e.u_lightpos_globe),u_lightintensity:new a.b8(_,e.u_lightintensity),u_lightcolor:new a.bL(_,e.u_lightcolor),u_vertical_gradient:new a.b8(_,e.u_vertical_gradient),u_opacity:new a.b8(_,e.u_opacity),u_fill_translate:new a.bM(_,e.u_fill_translate)}),fillExtrusionPattern:(_,e)=>({u_lightpos:new a.bL(_,e.u_lightpos),u_lightpos_globe:new a.bL(_,e.u_lightpos_globe),u_lightintensity:new a.b8(_,e.u_lightintensity),u_lightcolor:new a.bL(_,e.u_lightcolor),u_vertical_gradient:new a.b8(_,e.u_vertical_gradient),u_height_factor:new a.b8(_,e.u_height_factor),u_opacity:new a.b8(_,e.u_opacity),u_fill_translate:new a.bM(_,e.u_fill_translate),u_image:new a.bH(_,e.u_image),u_texsize:new a.bM(_,e.u_texsize),u_pixel_coord_upper:new a.bM(_,e.u_pixel_coord_upper),u_pixel_coord_lower:new a.bM(_,e.u_pixel_coord_lower),u_scale:new a.bL(_,e.u_scale),u_fade:new a.b8(_,e.u_fade)}),fill:(_,e)=>({u_fill_translate:new a.bM(_,e.u_fill_translate)}),fillPattern:(_,e)=>({u_image:new a.bH(_,e.u_image),u_texsize:new a.bM(_,e.u_texsize),u_pixel_coord_upper:new a.bM(_,e.u_pixel_coord_upper),u_pixel_coord_lower:new a.bM(_,e.u_pixel_coord_lower),u_scale:new a.bL(_,e.u_scale),u_fade:new a.b8(_,e.u_fade),u_fill_translate:new a.bM(_,e.u_fill_translate)}),fillOutline:(_,e)=>({u_world:new a.bM(_,e.u_world),u_fill_translate:new a.bM(_,e.u_fill_translate)}),fillOutlinePattern:(_,e)=>({u_world:new a.bM(_,e.u_world),u_image:new a.bH(_,e.u_image),u_texsize:new a.bM(_,e.u_texsize),u_pixel_coord_upper:new a.bM(_,e.u_pixel_coord_upper),u_pixel_coord_lower:new a.bM(_,e.u_pixel_coord_lower),u_scale:new a.bL(_,e.u_scale),u_fade:new a.b8(_,e.u_fade),u_fill_translate:new a.bM(_,e.u_fill_translate)}),circle:(_,e)=>({u_camera_to_center_distance:new a.b8(_,e.u_camera_to_center_distance),u_scale_with_map:new a.bH(_,e.u_scale_with_map),u_pitch_with_map:new a.bH(_,e.u_pitch_with_map),u_extrude_scale:new a.bM(_,e.u_extrude_scale),u_device_pixel_ratio:new a.b8(_,e.u_device_pixel_ratio),u_globe_extrude_scale:new a.b8(_,e.u_globe_extrude_scale),u_translate:new a.bM(_,e.u_translate)}),collisionBox:(_,e)=>({u_pixel_extrude_scale:new a.bM(_,e.u_pixel_extrude_scale)}),collisionCircle:(_,e)=>({u_viewport_size:new a.bM(_,e.u_viewport_size)}),debug:(_,e)=>({u_color:new a.bI(_,e.u_color),u_overlay:new a.bH(_,e.u_overlay),u_overlay_scale:new a.b8(_,e.u_overlay_scale)}),depth:rc,clippingMask:rc,heatmap:(_,e)=>({u_extrude_scale:new a.b8(_,e.u_extrude_scale),u_intensity:new a.b8(_,e.u_intensity),u_globe_extrude_scale:new a.b8(_,e.u_globe_extrude_scale)}),heatmapTexture:(_,e)=>({u_matrix:new a.bJ(_,e.u_matrix),u_world:new a.bM(_,e.u_world),u_image:new a.bH(_,e.u_image),u_color_ramp:new a.bH(_,e.u_color_ramp),u_opacity:new a.b8(_,e.u_opacity)}),hillshade:(_,e)=>({u_image:new a.bH(_,e.u_image),u_latrange:new a.bM(_,e.u_latrange),u_exaggeration:new a.b8(_,e.u_exaggeration),u_altitudes:new a.bS(_,e.u_altitudes),u_azimuths:new a.bS(_,e.u_azimuths),u_accent:new a.bI(_,e.u_accent),u_method:new a.bH(_,e.u_method),u_shadows:new a.bR(_,e.u_shadows),u_highlights:new a.bR(_,e.u_highlights)}),hillshadePrepare:(_,e)=>({u_matrix:new a.bJ(_,e.u_matrix),u_image:new a.bH(_,e.u_image),u_dimension:new a.bM(_,e.u_dimension),u_zoom:new a.b8(_,e.u_zoom),u_unpack:new a.bK(_,e.u_unpack)}),line:(_,e)=>({u_translation:new a.bM(_,e.u_translation),u_ratio:new a.b8(_,e.u_ratio),u_device_pixel_ratio:new a.b8(_,e.u_device_pixel_ratio),u_units_to_pixels:new a.bM(_,e.u_units_to_pixels)}),lineGradient:(_,e)=>({u_translation:new a.bM(_,e.u_translation),u_ratio:new a.b8(_,e.u_ratio),u_device_pixel_ratio:new a.b8(_,e.u_device_pixel_ratio),u_units_to_pixels:new a.bM(_,e.u_units_to_pixels),u_image:new a.bH(_,e.u_image),u_image_height:new a.b8(_,e.u_image_height)}),linePattern:(_,e)=>({u_translation:new a.bM(_,e.u_translation),u_texsize:new a.bM(_,e.u_texsize),u_ratio:new a.b8(_,e.u_ratio),u_device_pixel_ratio:new a.b8(_,e.u_device_pixel_ratio),u_image:new a.bH(_,e.u_image),u_units_to_pixels:new a.bM(_,e.u_units_to_pixels),u_scale:new a.bL(_,e.u_scale),u_fade:new a.b8(_,e.u_fade)}),lineSDF:(_,e)=>({u_translation:new a.bM(_,e.u_translation),u_ratio:new a.b8(_,e.u_ratio),u_device_pixel_ratio:new a.b8(_,e.u_device_pixel_ratio),u_units_to_pixels:new a.bM(_,e.u_units_to_pixels),u_patternscale_a:new a.bM(_,e.u_patternscale_a),u_patternscale_b:new a.bM(_,e.u_patternscale_b),u_sdfgamma:new a.b8(_,e.u_sdfgamma),u_image:new a.bH(_,e.u_image),u_tex_y_a:new a.b8(_,e.u_tex_y_a),u_tex_y_b:new a.b8(_,e.u_tex_y_b),u_mix:new a.b8(_,e.u_mix)}),raster:(_,e)=>({u_tl_parent:new a.bM(_,e.u_tl_parent),u_scale_parent:new a.b8(_,e.u_scale_parent),u_buffer_scale:new a.b8(_,e.u_buffer_scale),u_fade_t:new a.b8(_,e.u_fade_t),u_opacity:new a.b8(_,e.u_opacity),u_image0:new a.bH(_,e.u_image0),u_image1:new a.bH(_,e.u_image1),u_brightness_low:new a.b8(_,e.u_brightness_low),u_brightness_high:new a.b8(_,e.u_brightness_high),u_saturation_factor:new a.b8(_,e.u_saturation_factor),u_contrast_factor:new a.b8(_,e.u_contrast_factor),u_spin_weights:new a.bL(_,e.u_spin_weights),u_coords_top:new a.bK(_,e.u_coords_top),u_coords_bottom:new a.bK(_,e.u_coords_bottom)}),symbolIcon:(_,e)=>({u_is_size_zoom_constant:new a.bH(_,e.u_is_size_zoom_constant),u_is_size_feature_constant:new a.bH(_,e.u_is_size_feature_constant),u_size_t:new a.b8(_,e.u_size_t),u_size:new a.b8(_,e.u_size),u_camera_to_center_distance:new a.b8(_,e.u_camera_to_center_distance),u_pitch:new a.b8(_,e.u_pitch),u_rotate_symbol:new a.bH(_,e.u_rotate_symbol),u_aspect_ratio:new a.b8(_,e.u_aspect_ratio),u_fade_change:new a.b8(_,e.u_fade_change),u_label_plane_matrix:new a.bJ(_,e.u_label_plane_matrix),u_coord_matrix:new a.bJ(_,e.u_coord_matrix),u_is_text:new a.bH(_,e.u_is_text),u_pitch_with_map:new a.bH(_,e.u_pitch_with_map),u_is_along_line:new a.bH(_,e.u_is_along_line),u_is_variable_anchor:new a.bH(_,e.u_is_variable_anchor),u_texsize:new a.bM(_,e.u_texsize),u_texture:new a.bH(_,e.u_texture),u_translation:new a.bM(_,e.u_translation),u_pitched_scale:new a.b8(_,e.u_pitched_scale)}),symbolSDF:(_,e)=>({u_is_size_zoom_constant:new a.bH(_,e.u_is_size_zoom_constant),u_is_size_feature_constant:new a.bH(_,e.u_is_size_feature_constant),u_size_t:new a.b8(_,e.u_size_t),u_size:new a.b8(_,e.u_size),u_camera_to_center_distance:new a.b8(_,e.u_camera_to_center_distance),u_pitch:new a.b8(_,e.u_pitch),u_rotate_symbol:new a.bH(_,e.u_rotate_symbol),u_aspect_ratio:new a.b8(_,e.u_aspect_ratio),u_fade_change:new a.b8(_,e.u_fade_change),u_label_plane_matrix:new a.bJ(_,e.u_label_plane_matrix),u_coord_matrix:new a.bJ(_,e.u_coord_matrix),u_is_text:new a.bH(_,e.u_is_text),u_pitch_with_map:new a.bH(_,e.u_pitch_with_map),u_is_along_line:new a.bH(_,e.u_is_along_line),u_is_variable_anchor:new a.bH(_,e.u_is_variable_anchor),u_texsize:new a.bM(_,e.u_texsize),u_texture:new a.bH(_,e.u_texture),u_gamma_scale:new a.b8(_,e.u_gamma_scale),u_device_pixel_ratio:new a.b8(_,e.u_device_pixel_ratio),u_is_halo:new a.bH(_,e.u_is_halo),u_translation:new a.bM(_,e.u_translation),u_pitched_scale:new a.b8(_,e.u_pitched_scale)}),symbolTextAndIcon:(_,e)=>({u_is_size_zoom_constant:new a.bH(_,e.u_is_size_zoom_constant),u_is_size_feature_constant:new a.bH(_,e.u_is_size_feature_constant),u_size_t:new a.b8(_,e.u_size_t),u_size:new a.b8(_,e.u_size),u_camera_to_center_distance:new a.b8(_,e.u_camera_to_center_distance),u_pitch:new a.b8(_,e.u_pitch),u_rotate_symbol:new a.bH(_,e.u_rotate_symbol),u_aspect_ratio:new a.b8(_,e.u_aspect_ratio),u_fade_change:new a.b8(_,e.u_fade_change),u_label_plane_matrix:new a.bJ(_,e.u_label_plane_matrix),u_coord_matrix:new a.bJ(_,e.u_coord_matrix),u_is_text:new a.bH(_,e.u_is_text),u_pitch_with_map:new a.bH(_,e.u_pitch_with_map),u_is_along_line:new a.bH(_,e.u_is_along_line),u_is_variable_anchor:new a.bH(_,e.u_is_variable_anchor),u_texsize:new a.bM(_,e.u_texsize),u_texsize_icon:new a.bM(_,e.u_texsize_icon),u_texture:new a.bH(_,e.u_texture),u_texture_icon:new a.bH(_,e.u_texture_icon),u_gamma_scale:new a.b8(_,e.u_gamma_scale),u_device_pixel_ratio:new a.b8(_,e.u_device_pixel_ratio),u_is_halo:new a.bH(_,e.u_is_halo),u_translation:new a.bM(_,e.u_translation),u_pitched_scale:new a.b8(_,e.u_pitched_scale)}),background:(_,e)=>({u_opacity:new a.b8(_,e.u_opacity),u_color:new a.bI(_,e.u_color)}),backgroundPattern:(_,e)=>({u_opacity:new a.b8(_,e.u_opacity),u_image:new a.bH(_,e.u_image),u_pattern_tl_a:new a.bM(_,e.u_pattern_tl_a),u_pattern_br_a:new a.bM(_,e.u_pattern_br_a),u_pattern_tl_b:new a.bM(_,e.u_pattern_tl_b),u_pattern_br_b:new a.bM(_,e.u_pattern_br_b),u_texsize:new a.bM(_,e.u_texsize),u_mix:new a.b8(_,e.u_mix),u_pattern_size_a:new a.bM(_,e.u_pattern_size_a),u_pattern_size_b:new a.bM(_,e.u_pattern_size_b),u_scale_a:new a.b8(_,e.u_scale_a),u_scale_b:new a.b8(_,e.u_scale_b),u_pixel_coord_upper:new a.bM(_,e.u_pixel_coord_upper),u_pixel_coord_lower:new a.bM(_,e.u_pixel_coord_lower),u_tile_units_to_pixels:new a.b8(_,e.u_tile_units_to_pixels)}),terrain:(_,e)=>({u_texture:new a.bH(_,e.u_texture),u_ele_delta:new a.b8(_,e.u_ele_delta),u_fog_matrix:new a.bJ(_,e.u_fog_matrix),u_fog_color:new a.bI(_,e.u_fog_color),u_fog_ground_blend:new a.b8(_,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new a.b8(_,e.u_fog_ground_blend_opacity),u_horizon_color:new a.bI(_,e.u_horizon_color),u_horizon_fog_blend:new a.b8(_,e.u_horizon_fog_blend),u_is_globe_mode:new a.b8(_,e.u_is_globe_mode)}),terrainDepth:(_,e)=>({u_ele_delta:new a.b8(_,e.u_ele_delta)}),terrainCoords:(_,e)=>({u_texture:new a.bH(_,e.u_texture),u_terrain_coords_id:new a.b8(_,e.u_terrain_coords_id),u_ele_delta:new a.b8(_,e.u_ele_delta)}),projectionErrorMeasurement:(_,e)=>({u_input:new a.b8(_,e.u_input),u_output_expected:new a.b8(_,e.u_output_expected)}),atmosphere:(_,e)=>({u_sun_pos:new a.bL(_,e.u_sun_pos),u_atmosphere_blend:new a.b8(_,e.u_atmosphere_blend),u_globe_position:new a.bL(_,e.u_globe_position),u_globe_radius:new a.b8(_,e.u_globe_radius),u_inv_proj_matrix:new a.bJ(_,e.u_inv_proj_matrix)}),sky:(_,e)=>({u_sky_color:new a.bI(_,e.u_sky_color),u_horizon_color:new a.bI(_,e.u_horizon_color),u_horizon:new a.bM(_,e.u_horizon),u_horizon_normal:new a.bM(_,e.u_horizon_normal),u_sky_horizon_blend:new a.b8(_,e.u_sky_horizon_blend),u_sky_blend:new a.b8(_,e.u_sky_blend)})};class Jc{constructor(e,n,h){this.context=e;let d=e.gl;this.buffer=d.createBuffer(),this.dynamicDraw=!!h,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){let n=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}let ia={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Qc{constructor(e,n,h,d){this.length=n.length,this.attributes=h,this.itemSize=n.bytesPerElement,this.dynamicDraw=d,this.context=e;let y=e.gl;this.buffer=y.createBuffer(),e.bindVertexBuffer.set(this.buffer),y.bufferData(y.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);let n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,n){for(let h=0;h<this.attributes.length;h++){let d=n.attributes[this.attributes[h].name];d!==void 0&&e.enableVertexAttribArray(d)}}setVertexAttribPointers(e,n,h){for(let d=0;d<this.attributes.length;d++){let y=this.attributes[d],b=n.attributes[y.name];b!==void 0&&e.vertexAttribPointer(b,y.components,e[ia[y.type]],!1,this.itemSize,y.offset+this.itemSize*(h||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class oi{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Kr extends oi{getDefault(){return a.b7.transparent}set(e){let n=this.current;(e.r!==n.r||e.g!==n.g||e.b!==n.b||e.a!==n.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class yl extends oi{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Us extends oi{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class ss extends oi{getDefault(){return[!0,!0,!0,!0]}set(e){let n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||e[3]!==n[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class vl extends oi{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class ls extends oi{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Xr extends oi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){let n=this.current;(e.func!==n.func||e.ref!==n.ref||e.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class cs extends oi{getDefault(){let e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){let n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class oc extends oi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;e?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=e,this.dirty=!1}}class eu extends oi{getDefault(){return[0,1]}set(e){let n=this.current;(e[0]!==n[0]||e[1]!==n[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class nh extends oi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;e?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=e,this.dirty=!1}}class xl extends oi{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class tu extends oi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;e?n.enable(n.BLEND):n.disable(n.BLEND),this.current=e,this.dirty=!1}}class iu extends oi{getDefault(){let e=this.gl;return[e.ONE,e.ZERO]}set(e){let n=this.current;(e[0]!==n[0]||e[1]!==n[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class nu extends oi{getDefault(){return a.b7.transparent}set(e){let n=this.current;(e.r!==n.r||e.g!==n.g||e.b!==n.b||e.a!==n.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Zs extends oi{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class bl extends oi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;e?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=e,this.dirty=!1}}class Fr extends oi{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class us extends oi{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class za extends oi{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class Ra extends oi{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class hs extends oi{getDefault(){let e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){let n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||e[3]!==n[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Nr extends oi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class ru extends oi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class ds extends oi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;n.bindTexture(n.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class ac extends oi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Yr extends oi{getDefault(){return null}set(e){let n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Vs extends oi{getDefault(){return null}set(e){var n;if(e===this.current&&!this.dirty)return;let h=this.gl;ur(h)?h.bindVertexArray(e):(n=h.getExtension("OES_vertex_array_object"))===null||n===void 0||n.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class Gs extends oi{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class qs extends oi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Jr extends oi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Ws extends oi{constructor(e,n){super(e),this.context=e,this.parent=n}getDefault(){return null}}class Da extends Ws{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class bo extends Ws{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class ou extends Ws{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}let Ba="Framebuffer is not complete";class ii{constructor(e,n,h,d,y){this.context=e,this.width=n,this.height=h;let b=e.gl,S=this.framebuffer=b.createFramebuffer();if(this.colorAttachment=new Da(e,S),d)this.depthAttachment=y?new ou(e,S):new bo(e,S);else if(y)throw new Error("Stencil cannot be set without depth");if(b.checkFramebufferStatus(b.FRAMEBUFFER)!==b.FRAMEBUFFER_COMPLETE)throw new Error(Ba)}destroy(){let e=this.context.gl,n=this.colorAttachment.get();if(n&&e.deleteTexture(n),this.depthAttachment){let h=this.depthAttachment.get();h&&e.deleteRenderbuffer(h)}e.deleteFramebuffer(this.framebuffer)}}class Hs{constructor(e){var n,h;if(this.gl=e,this.clearColor=new Kr(this),this.clearDepth=new yl(this),this.clearStencil=new Us(this),this.colorMask=new ss(this),this.depthMask=new vl(this),this.stencilMask=new ls(this),this.stencilFunc=new Xr(this),this.stencilOp=new cs(this),this.stencilTest=new oc(this),this.depthRange=new eu(this),this.depthTest=new nh(this),this.depthFunc=new xl(this),this.blend=new tu(this),this.blendFunc=new iu(this),this.blendColor=new nu(this),this.blendEquation=new Zs(this),this.cullFace=new bl(this),this.cullFaceSide=new Fr(this),this.frontFace=new us(this),this.program=new za(this),this.activeTexture=new Ra(this),this.viewport=new hs(this),this.bindFramebuffer=new Nr(this),this.bindRenderbuffer=new ru(this),this.bindTexture=new ds(this),this.bindVertexBuffer=new ac(this),this.bindElementBuffer=new Yr(this),this.bindVertexArray=new Vs(this),this.pixelStoreUnpack=new Gs(this),this.pixelStoreUnpackPremultiplyAlpha=new qs(this),this.pixelStoreUnpackFlipY=new Jr(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),ur(e)){this.HALF_FLOAT=e.HALF_FLOAT;let d=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(n=e.RGBA16F)!==null&&n!==void 0?n:d?.RGBA16F_EXT,this.RGB16F=(h=e.RGB16F)!==null&&h!==void 0?h:d?.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");let d=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=d?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,n){return new Jc(this,e,n)}createVertexBuffer(e,n,h){return new Qc(this,e,n,h)}createRenderbuffer(e,n,h){let d=this.gl,y=d.createRenderbuffer();return this.bindRenderbuffer.set(y),d.renderbufferStorage(d.RENDERBUFFER,e,n,h),this.bindRenderbuffer.set(null),y}createFramebuffer(e,n,h,d){return new ii(this,e,n,h,d)}clear({color:e,depth:n,stencil:h}){let d=this.gl,y=0;e&&(y|=d.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),n!==void 0&&(y|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),h!==void 0&&(y|=d.STENCIL_BUFFER_BIT,this.clearStencil.set(h),this.stencilMask.set(255)),d.clear(y)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){a.bE(e.blendFunction,Li.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return ur(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var n;return ur(this.gl)?this.gl.deleteVertexArray(e):(n=this.gl.getExtension("OES_vertex_array_object"))===null||n===void 0?void 0:n.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let Ks;function sc(_,e,n,h,d){let y=_.context,b=_.transform,S=y.gl,C=_.useProgram("collisionBox"),k=[],R=0,j=0;for(let se=0;se<h.length;se++){let pe=h[se],ve=e.getTile(pe).getBucket(n);if(!ve)continue;let ye=d?ve.textCollisionBox:ve.iconCollisionBox,we=ve.collisionCircleArray;we.length>0&&(k.push({circleArray:we,circleOffset:j,coord:pe}),R+=we.length/4,j=R),ye&&C.draw(y,S.LINES,Bt.disabled,ti.disabled,_.colorModeForRenderPass(),si.disabled,Ql(_.transform),_.style.map.terrain&&_.style.map.terrain.getTerrainData(pe),b.getProjectionData({overscaledTileID:pe,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),n.id,ye.layoutVertexBuffer,ye.indexBuffer,ye.segments,null,_.transform.zoom,null,null,ye.collisionVertexBuffer)}if(!d||!k.length)return;let N=_.useProgram("collisionCircle"),q=new a.bT;q.resize(4*R),q._trim();let H=0;for(let se of k)for(let pe=0;pe<se.circleArray.length/4;pe++){let ve=4*pe,ye=se.circleArray[ve+0],we=se.circleArray[ve+1],Le=se.circleArray[ve+2],Pe=se.circleArray[ve+3];q.emplace(H++,ye,we,Le,Pe,0),q.emplace(H++,ye,we,Le,Pe,1),q.emplace(H++,ye,we,Le,Pe,2),q.emplace(H++,ye,we,Le,Pe,3)}(!Ks||Ks.length<2*R)&&(Ks=function(se){let pe=2*se,ve=new a.bV;ve.resize(pe),ve._trim();for(let ye=0;ye<pe;ye++){let we=6*ye;ve.uint16[we+0]=4*ye+0,ve.uint16[we+1]=4*ye+1,ve.uint16[we+2]=4*ye+2,ve.uint16[we+3]=4*ye+2,ve.uint16[we+4]=4*ye+3,ve.uint16[we+5]=4*ye+0}return ve}(R));let ae=y.createIndexBuffer(Ks,!0),oe=y.createVertexBuffer(q,a.bU.members,!0);for(let se of k){let pe=os(_.transform);N.draw(y,S.TRIANGLES,Bt.disabled,ti.disabled,_.colorModeForRenderPass(),si.disabled,pe,_.style.map.terrain&&_.style.map.terrain.getTerrainData(se.coord),null,n.id,oe,ae,a.aJ.simpleSegment(0,2*se.circleOffset,se.circleArray.length,se.circleArray.length/2),null,_.transform.zoom,null,null,null)}oe.destroy(),ae.destroy()}let ps=a.ad(new Float32Array(16));function au(_,e,n,h,d,y){let{horizontalAlign:b,verticalAlign:S}=a.aE(_);return new a.P((-(b-.5)*e/d+h[0])*y,(-(S-.5)*n/d+h[1])*y)}function su(_,e,n,h,d,y){let b=e.tileAnchorPoint.add(new a.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let S=h.mult(y);n||(S=S.rotate(-d));let C=b.add(S);return Ye(C.x,C.y,e.pitchedLabelPlaneMatrix,e.getElevation).point}if(n){let S=$i(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(_),C=Math.atan(S.y/S.x)+(S.x<0?Math.PI:0);return _.add(h.rotate(C))}return _.add(h)}function lc(_,e,n,h,d,y,b,S,C,k,R,j){let N=_.text.placedSymbolArray,q=_.text.dynamicLayoutVertexArray,H=_.icon.dynamicLayoutVertexArray,ae={};q.clear();for(let oe=0;oe<N.length;oe++){let se=N.get(oe),pe=se.hidden||!se.crossTileID||_.allowVerticalPlacement&&!se.placedOrientation?null:h[se.crossTileID];if(pe){let ve=new a.P(se.anchorX,se.anchorY),ye={getElevation:j,width:d.width,height:d.height,pitchedLabelPlaneMatrix:y,pitchWithMap:n,transform:d,tileAnchorPoint:ve,translation:k,unwrappedTileID:R},we=n?ei(ve.x,ve.y,ye):$i(ve.x,ve.y,ye),Le=ri(d.cameraToCenterDistance,we.signedDistanceFromCamera),Pe=a.am(_.textSizeData,S,se)*Le/a.ay;n&&(Pe*=_.tilePixelRatio/b);let{width:$e,height:tt,anchor:He,textOffset:Ke,textBoxScale:Qe}=pe,vt=au(He,$e,tt,Ke,Qe,Pe),gt=d.getPitchedTextCorrection(ve.x+k[0],ve.y+k[1],R),ct=su(we.point,ye,e,vt,-d.bearingInRadians,gt),Lt=_.allowVerticalPlacement&&se.placedOrientation===a.al.vertical?Math.PI/2:0;for(let li=0;li<se.numGlyphs;li++)a.as(q,ct,Lt);C&&se.associatedIconIndex>=0&&(ae[se.associatedIconIndex]={shiftedAnchor:ct,angle:Lt})}else nn(se.numGlyphs,q)}if(C){H.clear();let oe=_.icon.placedSymbolArray;for(let se=0;se<oe.length;se++){let pe=oe.get(se);if(pe.hidden)nn(pe.numGlyphs,H);else{let ve=ae[se];if(ve)for(let ye=0;ye<pe.numGlyphs;ye++)a.as(H,ve.shiftedAnchor,ve.angle);else nn(pe.numGlyphs,H)}}_.icon.dynamicLayoutVertexBuffer.updateData(H)}_.text.dynamicLayoutVertexBuffer.updateData(q)}function lu(_,e,n){return n.iconsInText&&e?"symbolTextAndIcon":_?"symbolSDF":"symbolIcon"}function wl(_,e,n,h,d,y,b,S,C,k,R,j,N){let q=_.context,H=q.gl,ae=_.transform,oe=S==="map",se=C==="map",pe=S!=="viewport"&&n.layout.get("symbol-placement")!=="point",ve=oe&&!se&&!pe,ye=!n.layout.get("symbol-sort-key").isConstant(),we=!1,Le=_.getDepthModeForSublayer(0,Bt.ReadOnly),Pe=n._unevaluatedLayout.hasValue("text-variable-anchor")||n._unevaluatedLayout.hasValue("text-variable-anchor-offset"),$e=[],tt=ae.getCircleRadiusCorrection();for(let He of h){let Ke=e.getTile(He),Qe=Ke.getBucket(n);if(!Qe)continue;let vt=d?Qe.text:Qe.icon;if(!vt||!vt.segments.get().length||!vt.hasVisibleVertices)continue;let gt=vt.programConfigurations.get(n.id),ct=d||Qe.sdfIcons,Lt=d?Qe.textSizeData:Qe.iconSizeData,li=se||ae.pitch!==0,Ci=_.useProgram(lu(ct,d,Qe),gt),yn=a.ak(Lt,ae.zoom),Ki=_.style.map.terrain&&_.style.map.terrain.getTerrainData(He),vn,xn,Qi,Bi,nr=[0,0],dr=null;if(d)xn=Ke.glyphAtlasTexture,Qi=H.LINEAR,vn=Ke.glyphAtlasTexture.size,Qe.iconsInText&&(nr=Ke.imageAtlasTexture.size,dr=Ke.imageAtlasTexture,Bi=li||_.options.rotating||_.options.zooming||Lt.kind==="composite"||Lt.kind==="camera"?H.LINEAR:H.NEAREST);else{let qn=n.layout.get("icon-size").constantOr(0)!==1||Qe.iconsNeedLinear;xn=Ke.imageAtlasTexture,Qi=ct||_.options.rotating||_.options.zooming||qn||li?H.LINEAR:H.NEAREST,vn=Ke.imageAtlasTexture.size}let xr=a.az(Ke,1,_.transform.zoom),Oi=Dt(oe,_.transform,xr),_s=a.K();a.an(_s,Oi);let aa=Yt(se,oe,_.transform,xr),ys=a.aA(ae,Ke,y,b),Qs=ae.getProjectionData({overscaledTileID:He,applyGlobeMatrix:!N,applyTerrainMatrix:!0}),vc=Pe&&Qe.hasTextData(),vs=n.layout.get("icon-text-fit")!=="none"&&vc&&Qe.hasIconData();if(pe){let qn=_.style.map.terrain?(Zr,ln)=>_.style.map.terrain.getElevation(He,Zr,ln):null,Wn=n.layout.get("text-rotation-alignment")==="map";Si(Qe,_,d,Oi,_s,se,k,Wn,He.toUnwrapped(),ae.width,ae.height,ys,qn)}let el=d&&Pe||vs,lo=pe||el?ps:se?Oi:_.transform.clipSpaceToPixelsMatrix,xs=ct&&n.paint.get(d?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Na;Na=ct?Qe.iconsInText?ka(Lt.kind,yn,ve,se,pe,el,_,lo,aa,ys,vn,nr,tt):Fo(Lt.kind,yn,ve,se,pe,el,_,lo,aa,ys,d,vn,0,tt):as(Lt.kind,yn,ve,se,pe,el,_,lo,aa,ys,d,vn,tt);let bs={program:Ci,buffers:vt,uniformValues:Na,projectionData:Qs,atlasTexture:xn,atlasTextureIcon:dr,atlasInterpolation:Qi,atlasInterpolationIcon:Bi,isSDF:ct,hasHalo:xs};if(ye&&Qe.canOverlap){we=!0;let qn=vt.segments.get();for(let Wn of qn)$e.push({segments:new a.aJ([Wn]),sortKey:Wn.sortKey,state:bs,terrainData:Ki})}else $e.push({segments:vt.segments,sortKey:0,state:bs,terrainData:Ki})}we&&$e.sort((He,Ke)=>He.sortKey-Ke.sortKey);for(let He of $e){let Ke=He.state;if(q.activeTexture.set(H.TEXTURE0),Ke.atlasTexture.bind(Ke.atlasInterpolation,H.CLAMP_TO_EDGE),Ke.atlasTextureIcon&&(q.activeTexture.set(H.TEXTURE1),Ke.atlasTextureIcon&&Ke.atlasTextureIcon.bind(Ke.atlasInterpolationIcon,H.CLAMP_TO_EDGE)),Ke.isSDF){let Qe=Ke.uniformValues;Ke.hasHalo&&(Qe.u_is_halo=1,fs(Ke.buffers,He.segments,n,_,Ke.program,Le,R,j,Qe,Ke.projectionData,He.terrainData)),Qe.u_is_halo=0}fs(Ke.buffers,He.segments,n,_,Ke.program,Le,R,j,Ke.uniformValues,Ke.projectionData,He.terrainData)}}function fs(_,e,n,h,d,y,b,S,C,k,R){let j=h.context;d.draw(j,j.gl.TRIANGLES,y,b,S,si.backCCW,C,R,k,n.id,_.layoutVertexBuffer,_.indexBuffer,e,n.paint,h.transform.zoom,_.programConfigurations.get(n.id),_.dynamicLayoutVertexBuffer,_.opacityVertexBuffer)}function Xs(_,e,n,h,d){let y=_.context,b=y.gl,S=ti.disabled,C=new Li([b.ONE,b.ONE],a.b7.transparent,[!0,!0,!0,!0]),k=e.getBucket(n);if(!k)return;let R=h.key,j=n.heatmapFbos.get(R);j||(j=c(y,e.tileSize,e.tileSize),n.heatmapFbos.set(R,j)),y.bindFramebuffer.set(j.framebuffer),y.viewport.set([0,0,e.tileSize,e.tileSize]),y.clear({color:a.b7.transparent});let N=k.programConfigurations.get(n.id),q=_.useProgram("heatmap",N,!d),H=_.transform.getProjectionData({overscaledTileID:e.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ae=_.style.map.terrain.getTerrainData(h);q.draw(y,b.TRIANGLES,Bt.disabled,S,C,si.disabled,Ea(e,_.transform.zoom,n.paint.get("heatmap-intensity"),1),ae,H,n.id,k.layoutVertexBuffer,k.indexBuffer,k.segments,n.paint,_.transform.zoom,N)}function cc(_,e,n,h,d){let y=_.context,b=y.gl,S=_.transform;y.setColorMode(_.colorModeForRenderPass());let C=g(y,e),k=n.key,R=e.heatmapFbos.get(k);if(!R)return;y.activeTexture.set(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,R.colorAttachment.get()),y.activeTexture.set(b.TEXTURE1),C.bind(b.LINEAR,b.CLAMP_TO_EDGE);let j=S.getProjectionData({overscaledTileID:n,applyTerrainMatrix:d,applyGlobeMatrix:!h});_.useProgram("heatmapTexture").draw(y,b.TRIANGLES,Bt.disabled,ti.disabled,_.colorModeForRenderPass(),si.disabled,ec(_,e,0,1),null,j,e.id,_.rasterBoundsBuffer,_.quadTriangleIndexBuffer,_.rasterBoundsSegments,e.paint,S.zoom),R.destroy(),e.heatmapFbos.delete(k)}function c(_,e,n){var h,d;let y=_.gl,b=y.createTexture();y.bindTexture(y.TEXTURE_2D,b),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,y.CLAMP_TO_EDGE),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,y.CLAMP_TO_EDGE),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,y.LINEAR),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,y.LINEAR);let S=(h=_.HALF_FLOAT)!==null&&h!==void 0?h:y.UNSIGNED_BYTE,C=(d=_.RGBA16F)!==null&&d!==void 0?d:y.RGBA;y.texImage2D(y.TEXTURE_2D,0,C,e,n,0,y.RGBA,S,null);let k=_.createFramebuffer(e,n,!1,!1);return k.colorAttachment.set(b),k}function g(_,e){return e.colorRampTexture||(e.colorRampTexture=new kt(_,e.colorRamp,_.gl.RGBA)),e.colorRampTexture}function T(_,e,n,h,d){if(!n||!h||!h.imageAtlas)return;let y=h.imageAtlas.patternPositions,b=y[n.to.toString()],S=y[n.from.toString()];if(!b&&S&&(b=S),!S&&b&&(S=b),!b||!S){let C=d.getPaintProperty(e);b=y[C],S=y[C]}b&&S&&_.setConstantPatternPositions(b,S)}function A(_,e,n,h,d,y,b,S){let C=_.context.gl,k="fill-pattern",R=n.paint.get(k),j=R&&R.constantOr(1),N=n.getCrossfadeParameters(),q,H,ae,oe,se,pe=_.transform,ve=n.paint.get("fill-translate"),ye=n.paint.get("fill-translate-anchor");b?(H=j&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",q=C.LINES):(H=j?"fillPattern":"fill",q=C.TRIANGLES);let we=R.constantOr(null);for(let Le of h){let Pe=e.getTile(Le);if(j&&!Pe.patternsLoaded())continue;let $e=Pe.getBucket(n);if(!$e)continue;let tt=$e.programConfigurations.get(n.id),He=_.useProgram(H,tt),Ke=_.style.map.terrain&&_.style.map.terrain.getTerrainData(Le);j&&(_.context.activeTexture.set(C.TEXTURE0),Pe.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),tt.updatePaintBuffers(N)),T(tt,k,we,Pe,n);let Qe=pe.getProjectionData({overscaledTileID:Le,applyGlobeMatrix:!S,applyTerrainMatrix:!0}),vt=a.aA(pe,Pe,ve,ye);if(b){oe=$e.indexBuffer2,se=$e.segments2;let ct=[C.drawingBufferWidth,C.drawingBufferHeight];ae=H==="fillOutlinePattern"&&j?rs(_,N,Pe,ct,vt):_l(ct,vt)}else oe=$e.indexBuffer,se=$e.segments,ae=j?Or(_,N,Pe,vt):{u_fill_translate:vt};let gt=_.stencilModeForClipping(Le);He.draw(_.context,q,d,gt,y,si.backCCW,ae,Ke,Qe,n.id,$e.layoutVertexBuffer,oe,se,n.paint,_.transform.zoom,tt)}}function F(_,e,n,h,d,y,b,S){let C=_.context,k=C.gl,R="fill-extrusion-pattern",j=n.paint.get(R),N=j.constantOr(1),q=n.getCrossfadeParameters(),H=n.paint.get("fill-extrusion-opacity"),ae=j.constantOr(null),oe=_.transform;for(let se of h){let pe=e.getTile(se),ve=pe.getBucket(n);if(!ve)continue;let ye=_.style.map.terrain&&_.style.map.terrain.getTerrainData(se),we=ve.programConfigurations.get(n.id),Le=_.useProgram(N?"fillExtrusionPattern":"fillExtrusion",we);N&&(_.context.activeTexture.set(k.TEXTURE0),pe.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),we.updatePaintBuffers(q));let Pe=oe.getProjectionData({overscaledTileID:se,applyGlobeMatrix:!S,applyTerrainMatrix:!0});T(we,R,ae,pe,n);let $e=a.aA(oe,pe,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),tt=n.paint.get("fill-extrusion-vertical-gradient"),He=N?Ir(_,tt,H,$e,se,q,pe):gl(_,tt,H,$e);Le.draw(C,C.gl.TRIANGLES,d,y,b,si.backCCW,He,ye,Pe,n.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segments,n.paint,_.transform.zoom,we,_.style.map.terrain&&ve.centroidVertexBuffer)}}function J(_,e,n,h,d,y,b,S,C){var k;let R=_.style.projection,j=_.context,N=_.transform,q=j.gl,H=[`#define NUM_ILLUMINATION_SOURCES ${n.paint.get("hillshade-highlight-color").values.length}`],ae=_.useProgram("hillshade",null,!1,H),oe=!_.options.moving;for(let se of h){let pe=e.getTile(se),ve=pe.fbo;if(!ve)continue;let ye=R.getMeshFromTileID(j,se.canonical,S,!0,"raster"),we=(k=_.style.map.terrain)===null||k===void 0?void 0:k.getTerrainData(se);j.activeTexture.set(q.TEXTURE0),q.bindTexture(q.TEXTURE_2D,ve.colorAttachment.get());let Le=N.getProjectionData({overscaledTileID:se,aligned:oe,applyGlobeMatrix:!C,applyTerrainMatrix:!0});ae.draw(j,q.TRIANGLES,y,d[se.overscaledZ],b,si.backCCW,Xc(_,pe,n),we,Le,n.id,ye.vertexBuffer,ye.indexBuffer,ye.segments)}}let xe=[new a.P(0,0),new a.P(a.Z,0),new a.P(a.Z,a.Z),new a.P(0,a.Z)];function je(_,e,n,h,d,y,b,S,C=!1,k=!1){let R=h[h.length-1].overscaledZ,j=_.context,N=j.gl,q=_.useProgram("raster"),H=_.transform,ae=_.style.projection,oe=_.colorModeForRenderPass(),se=!_.options.moving;for(let pe of h){let ve=_.getDepthModeForSublayer(pe.overscaledZ-R,n.paint.get("raster-opacity")===1?Bt.ReadWrite:Bt.ReadOnly,N.LESS),ye=e.getTile(pe);ye.registerFadeDuration(n.paint.get("raster-fade-duration"));let we=e.findLoadedParent(pe,0),Le=e.findLoadedSibling(pe),Pe=Je(ye,we||Le||null,e,n,_.transform,_.style.map.terrain),$e,tt,He=n.paint.get("raster-resampling")==="nearest"?N.NEAREST:N.LINEAR;j.activeTexture.set(N.TEXTURE0),ye.texture.bind(He,N.CLAMP_TO_EDGE,N.LINEAR_MIPMAP_NEAREST),j.activeTexture.set(N.TEXTURE1),we?(we.texture.bind(He,N.CLAMP_TO_EDGE,N.LINEAR_MIPMAP_NEAREST),$e=Math.pow(2,we.tileID.overscaledZ-ye.tileID.overscaledZ),tt=[ye.tileID.canonical.x*$e%1,ye.tileID.canonical.y*$e%1]):ye.texture.bind(He,N.CLAMP_TO_EDGE,N.LINEAR_MIPMAP_NEAREST),ye.texture.useMipmap&&j.extTextureFilterAnisotropic&&_.transform.pitch>20&&N.texParameterf(N.TEXTURE_2D,j.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,j.extTextureFilterAnisotropicMax);let Ke=_.style.map.terrain&&_.style.map.terrain.getTerrainData(pe),Qe=H.getProjectionData({overscaledTileID:pe,aligned:se,applyGlobeMatrix:!k,applyTerrainMatrix:!0}),vt=ic(tt||[0,0],$e||1,Pe,n,S),gt=ae.getMeshFromTileID(j,pe.canonical,y,b,"raster");q.draw(j,N.TRIANGLES,ve,d?d[pe.overscaledZ]:ti.disabled,oe,C?si.frontCCW:si.backCCW,vt,Ke,Qe,n.id,gt.vertexBuffer,gt.indexBuffer,gt.segments)}}function Je(_,e,n,h,d,y){let b=h.paint.get("raster-fade-duration");if(!y&&b>0){let S=W.now(),C=(S-_.timeAdded)/b,k=e?(S-e.timeAdded)/b:-1,R=n.getSource(),j=Ne(d,{tileSize:R.tileSize,roundZoom:R.roundZoom}),N=!e||Math.abs(e.tileID.overscaledZ-j)>Math.abs(_.tileID.overscaledZ-j),q=N&&_.refreshedUponExpiration?1:a.ae(N?C:1-k,0,1);return _.refreshedUponExpiration&&C>=1&&(_.refreshedUponExpiration=!1),e?{opacity:1,mix:1-q}:{opacity:q,mix:0}}return{opacity:1,mix:0}}let ut=new a.b7(1,0,0,1),Mt=new a.b7(0,1,0,1),Xt=new a.b7(0,0,1,1),pi=new a.b7(1,0,1,1),Zn=new a.b7(0,1,1,1);function Pn(_,e,n,h){Vn(_,0,e+n/2,_.transform.width,n,h)}function jr(_,e,n,h){Vn(_,e-n/2,0,n,_.transform.height,h)}function Vn(_,e,n,h,d,y){let b=_.context,S=b.gl;S.enable(S.SCISSOR_TEST),S.scissor(e*_.pixelRatio,n*_.pixelRatio,h*_.pixelRatio,d*_.pixelRatio),b.clear({color:y}),S.disable(S.SCISSOR_TEST)}function qi(_,e,n){let h=_.context,d=h.gl,y=_.useProgram("debug"),b=Bt.disabled,S=ti.disabled,C=_.colorModeForRenderPass(),k="$debug",R=_.style.map.terrain&&_.style.map.terrain.getTerrainData(n);h.activeTexture.set(d.TEXTURE0);let j=e.getTileByID(n.key).latestRawTileData,N=Math.floor((j&&j.byteLength||0)/1024),q=e.getTile(n).tileSize,H=512/Math.min(q,512)*(n.overscaledZ/_.transform.zoom)*.5,ae=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(ae+=` => ${n.overscaledZ}`),function(se,pe){se.initDebugOverlayCanvas();let ve=se.debugOverlayCanvas,ye=se.context.gl,we=se.debugOverlayCanvas.getContext("2d");we.clearRect(0,0,ve.width,ve.height),we.shadowColor="white",we.shadowBlur=2,we.lineWidth=1.5,we.strokeStyle="white",we.textBaseline="top",we.font="bold 36px Open Sans, sans-serif",we.fillText(pe,5,5),we.strokeText(pe,5,5),se.debugOverlayTexture.update(ve),se.debugOverlayTexture.bind(ye.LINEAR,ye.CLAMP_TO_EDGE)}(_,`${ae} ${N}kB`);let oe=_.transform.getProjectionData({overscaledTileID:n,applyGlobeMatrix:!0,applyTerrainMatrix:!0});y.draw(h,d.TRIANGLES,b,S,Li.alphaBlended,si.disabled,Kc(a.b7.transparent,H),null,oe,k,_.debugBuffer,_.quadTriangleIndexBuffer,_.debugSegments),y.draw(h,d.LINE_STRIP,b,S,C,si.disabled,Kc(a.b7.red),R,oe,k,_.debugBuffer,_.tileBorderIndexBuffer,_.debugSegments)}function na(_,e,n,h){let{isRenderingGlobe:d}=h,y=_.context,b=y.gl,S=_.transform,C=_.colorModeForRenderPass(),k=_.getDepthModeFor3D(),R=_.useProgram("terrain");y.bindFramebuffer.set(null),y.viewport.set([0,0,_.width,_.height]);for(let j of n){let N=e.getTerrainMesh(j.tileID),q=_.renderToTexture.getTexture(j),H=e.getTerrainData(j.tileID);y.activeTexture.set(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,q.texture);let ae=e.getMeshFrameDelta(S.zoom),oe=S.calculateFogMatrix(j.tileID.toUnwrapped()),se=th(ae,oe,_.style.sky,S.pitch,d),pe=S.getProjectionData({overscaledTileID:j.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});R.draw(y,b.TRIANGLES,k,ti.disabled,C,si.backCCW,se,H,pe,"terrain",N.vertexBuffer,N.indexBuffer,N.segments)}}function $r(_,e){if(!e.mesh){let n=new a.aI;n.emplaceBack(-1,-1),n.emplaceBack(1,-1),n.emplaceBack(1,1),n.emplaceBack(-1,1);let h=new a.aK;h.emplaceBack(0,1,2),h.emplaceBack(0,2,3),e.mesh=new go(_.createVertexBuffer(n,er.members),_.createIndexBuffer(h),a.aJ.simpleSegment(0,0,n.length,h.length))}return e.mesh}class uc{constructor(e,n){this.context=new Hs(e),this.transform=n,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.ad(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Be.maxUnderzooming+Be.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new oo}resize(e,n,h){if(this.width=Math.floor(e*h),this.height=Math.floor(n*h),this.pixelRatio=h,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let d of this.style._order)this.style._layers[d].resize()}setup(){let e=this.context,n=new a.aI;n.emplaceBack(0,0),n.emplaceBack(a.Z,0),n.emplaceBack(0,a.Z),n.emplaceBack(a.Z,a.Z),this.tileExtentBuffer=e.createVertexBuffer(n,er.members),this.tileExtentSegments=a.aJ.simpleSegment(0,0,4,2);let h=new a.aI;h.emplaceBack(0,0),h.emplaceBack(a.Z,0),h.emplaceBack(0,a.Z),h.emplaceBack(a.Z,a.Z),this.debugBuffer=e.createVertexBuffer(h,er.members),this.debugSegments=a.aJ.simpleSegment(0,0,4,5);let d=new a.b_;d.emplaceBack(0,0,0,0),d.emplaceBack(a.Z,0,a.Z,0),d.emplaceBack(0,a.Z,0,a.Z),d.emplaceBack(a.Z,a.Z,a.Z,a.Z),this.rasterBoundsBuffer=e.createVertexBuffer(d,eh.members),this.rasterBoundsSegments=a.aJ.simpleSegment(0,0,4,2);let y=new a.aI;y.emplaceBack(0,0),y.emplaceBack(a.Z,0),y.emplaceBack(0,a.Z),y.emplaceBack(a.Z,a.Z),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(y,er.members),this.rasterBoundsSegmentsPosOnly=a.aJ.simpleSegment(0,0,4,5);let b=new a.aI;b.emplaceBack(0,0),b.emplaceBack(1,0),b.emplaceBack(0,1),b.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(b,er.members),this.viewportSegments=a.aJ.simpleSegment(0,0,4,2);let S=new a.b$;S.emplaceBack(0),S.emplaceBack(1),S.emplaceBack(3),S.emplaceBack(2),S.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(S);let C=new a.aK;C.emplaceBack(1,0,2),C.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(C);let k=this.context.gl;this.stencilClearMode=new ti({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO),this.tileExtentMesh=new go(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){let e=this.context,n=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;let h=a.K();a.bQ(h,0,this.width,this.height,0,0,1),a.M(h,h,[n.drawingBufferWidth,n.drawingBufferHeight,0]);let d={mainMatrix:h,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:h};this.useProgram("clippingMask",null,!0).draw(e,n.TRIANGLES,Bt.disabled,this.stencilClearMode,Li.disabled,si.disabled,null,null,d,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,n,h){if(this.currentStencilSource===e.source||!e.isTileClipped()||!n||!n.length)return;this.currentStencilSource=e.source,this.nextStencilID+n.length>256&&this.clearStencil();let d=this.context;d.setColorMode(Li.disabled),d.setDepthMode(Bt.disabled);let y={};for(let b of n)y[b.key]=this.nextStencilID++;this._renderTileMasks(y,n,h,!0),this._renderTileMasks(y,n,h,!1),this._tileClippingMaskIDs=y}_renderTileMasks(e,n,h,d){let y=this.context,b=y.gl,S=this.style.projection,C=this.transform,k=this.useProgram("clippingMask");for(let R of n){let j=e[R.key],N=this.style.map.terrain&&this.style.map.terrain.getTerrainData(R),q=S.getMeshFromTileID(this.context,R.canonical,d,!0,"stencil"),H=C.getProjectionData({overscaledTileID:R,applyGlobeMatrix:!h,applyTerrainMatrix:!0});k.draw(y,b.TRIANGLES,Bt.disabled,new ti({func:b.ALWAYS,mask:0},j,255,b.KEEP,b.KEEP,b.REPLACE),Li.disabled,h?si.disabled:si.backCCW,null,N,H,"$clipping",q.vertexBuffer,q.indexBuffer,q.segments)}}_renderTilesDepthBuffer(){let e=this.context,n=e.gl,h=this.style.projection,d=this.transform,y=this.useProgram("depth"),b=this.getDepthModeFor3D(),S=ke(d,{tileSize:d.tileSize});for(let C of S){let k=this.style.map.terrain&&this.style.map.terrain.getTerrainData(C),R=h.getMeshFromTileID(this.context,C.canonical,!0,!0,"raster"),j=d.getProjectionData({overscaledTileID:C,applyGlobeMatrix:!0,applyTerrainMatrix:!0});y.draw(e,n.TRIANGLES,b,ti.disabled,Li.disabled,si.backCCW,null,k,j,"$clipping",R.vertexBuffer,R.indexBuffer,R.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let e=this.nextStencilID++,n=this.context.gl;return new ti({func:n.NOTEQUAL,mask:255},e,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(e){let n=this.context.gl;return new ti({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,n.KEEP,n.KEEP,n.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){let n=this.context.gl,h=e.sort((b,S)=>S.overscaledZ-b.overscaledZ),d=h[h.length-1].overscaledZ,y=h[0].overscaledZ-d+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();let b={};for(let S=0;S<y;S++)b[S+d]=new ti({func:n.GEQUAL,mask:255},S+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=y,[b,h]}return[{[d]:ti.disabled},h]}stencilConfigForOverlapTwoPass(e){let n=this.context.gl,h=e.sort((b,S)=>S.overscaledZ-b.overscaledZ),d=h[h.length-1].overscaledZ,y=h[0].overscaledZ-d+1;if(this.clearStencil(),y>1){let b={},S={};for(let C=0;C<y;C++)b[C+d]=new ti({func:n.GREATER,mask:255},y+1+C,255,n.KEEP,n.KEEP,n.REPLACE),S[C+d]=new ti({func:n.GREATER,mask:255},1+C,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID=2*y+1,[b,S,h]}return this.nextStencilID=3,[{[d]:new ti({func:n.GREATER,mask:255},2,255,n.KEEP,n.KEEP,n.REPLACE)},{[d]:new ti({func:n.GREATER,mask:255},1,255,n.KEEP,n.KEEP,n.REPLACE)},h]}colorModeForRenderPass(){let e=this.context.gl;return this._showOverdrawInspector?new Li([e.CONSTANT_COLOR,e.ONE],new a.b7(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Li.unblended:Li.alphaBlended}getDepthModeForSublayer(e,n,h){if(!this.opaquePassEnabledForLayer())return Bt.disabled;let d=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Bt(h||this.context.gl.LEQUAL,n,[d,d])}getDepthModeFor3D(){return new Bt(this.context.gl.LEQUAL,Bt.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,n){var h,d;this.style=e,this.options=n,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(W.now()),this.imageManager.beginFrame();let y=this.style._order,b=this.style.sourceCaches,S={},C={},k={},R={isRenderingToTexture:!1,isRenderingGlobe:((h=e.projection)===null||h===void 0?void 0:h.transitionState)>0};for(let N in b){let q=b[N];q.used&&q.prepare(this.context),S[N]=q.getVisibleCoordinates(!1),C[N]=S[N].slice().reverse(),k[N]=q.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let N=0;N<y.length;N++)if(this.style._layers[y[N]].is3D()){this.opaquePassCutoff=N;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(let N of y){let q=this.style._layers[N];if(!q.hasOffscreenPass()||q.isHidden(this.transform.zoom))continue;let H=C[q.source];(q.type==="custom"||H.length)&&this.renderLayer(this,b[q.source],q,H,R)}if((d=this.style.projection)===null||d===void 0||d.updateGPUdependent({context:this.context,useProgram:N=>this.useProgram(N)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?a.b7.black:a.b7.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(N,q){let H=N.context,ae=H.gl,oe=((Le,Pe,$e)=>{let tt=Math.cos(Pe.rollInRadians),He=Math.sin(Pe.rollInRadians),Ke=Re(Pe),Qe=Pe.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:Le.properties.get("sky-color"),u_horizon_color:Le.properties.get("horizon-color"),u_horizon:[(Pe.width/2-Ke*He)*$e,(Pe.height/2+Ke*tt)*$e],u_horizon_normal:[-He,tt],u_sky_horizon_blend:Le.properties.get("sky-horizon-blend")*Pe.height/2*$e,u_sky_blend:Qe}})(q,N.style.map.transform,N.pixelRatio),se=new Bt(ae.LEQUAL,Bt.ReadWrite,[0,1]),pe=ti.disabled,ve=N.colorModeForRenderPass(),ye=N.useProgram("sky"),we=$r(H,q);ye.draw(H,ae.TRIANGLES,se,pe,ve,si.disabled,oe,null,void 0,"sky",we.vertexBuffer,we.indexBuffer,we.segments)}(this,this.style.sky),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=y.length-1;this.currentLayer>=0;this.currentLayer--){let N=this.style._layers[y[this.currentLayer]],q=b[N.source],H=S[N.source];this._renderTileClippingMasks(N,H,!1),this.renderLayer(this,q,N,H,R)}this.renderPass="translucent";let j=!1;for(this.currentLayer=0;this.currentLayer<y.length;this.currentLayer++){let N=this.style._layers[y[this.currentLayer]],q=b[N.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(N,R))continue;this.opaquePassEnabledForLayer()||j||(j=!0,R.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());let H=(N.type==="symbol"?k:C)[N.source];this._renderTileClippingMasks(N,S[N.source],!!this.renderToTexture),this.renderLayer(this,q,N,H,R)}if(R.isRenderingGlobe&&function(N,q,H){let ae=N.context,oe=ae.gl,se=N.useProgram("atmosphere"),pe=new Bt(oe.LEQUAL,Bt.ReadOnly,[0,1]),ve=N.transform,ye=function(Qe,vt){let gt=Qe.properties.get("position"),ct=[-gt.x,-gt.y,-gt.z],Lt=a.ad(new Float64Array(16));return Qe.properties.get("anchor")==="map"&&(a.a_(Lt,Lt,vt.rollInRadians),a.a$(Lt,Lt,-vt.pitchInRadians),a.a_(Lt,Lt,vt.bearingInRadians),a.a$(Lt,Lt,vt.center.lat*Math.PI/180),a.bp(Lt,Lt,-vt.center.lng*Math.PI/180)),a.bZ(ct,ct,Lt),ct}(H,N.transform),we=ve.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Le=q.properties.get("atmosphere-blend")*we.projectionTransition;if(Le===0)return;let Pe=Bo(ve.worldSize,ve.center.lat),$e=ve.inverseProjectionMatrix,tt=new Float64Array(4);tt[3]=1,a.at(tt,tt,ve.modelViewProjectionMatrix),tt[0]/=tt[3],tt[1]/=tt[3],tt[2]/=tt[3],tt[3]=1,a.at(tt,tt,$e),tt[0]/=tt[3],tt[1]/=tt[3],tt[2]/=tt[3],tt[3]=1;let He=((Qe,vt,gt,ct,Lt)=>({u_sun_pos:Qe,u_atmosphere_blend:vt,u_globe_position:gt,u_globe_radius:ct,u_inv_proj_matrix:Lt}))(ye,Le,[tt[0],tt[1],tt[2]],Pe,$e),Ke=$r(ae,q);se.draw(ae,oe.TRIANGLES,pe,ti.disabled,Li.alphaBlended,si.disabled,He,null,null,"atmosphere",Ke.vertexBuffer,Ke.indexBuffer,Ke.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){let N=function(q,H){let ae=null,oe=Object.values(q._layers).flatMap(ye=>ye.source&&!ye.isHidden(H)?[q.sourceCaches[ye.source]]:[]),se=oe.filter(ye=>ye.getSource().type==="vector"),pe=oe.filter(ye=>ye.getSource().type!=="vector"),ve=ye=>{(!ae||ae.getSource().maxzoom<ye.getSource().maxzoom)&&(ae=ye)};return se.forEach(ye=>ve(ye)),ae||pe.forEach(ye=>ve(ye)),ae}(this.style,this.transform.zoom);N&&function(q,H,ae){for(let oe=0;oe<ae.length;oe++)qi(q,H,ae[oe])}(this,N,N.getVisibleCoordinates())}this.options.showPadding&&function(N){let q=N.transform.padding;Pn(N,N.transform.height-(q.top||0),3,ut),Pn(N,q.bottom||0,3,Mt),jr(N,q.left||0,3,Xt),jr(N,N.transform.width-(q.right||0),3,pi);let H=N.transform.centerPoint;(function(ae,oe,se,pe){Vn(ae,oe-1,se-10,2,20,pe),Vn(ae,oe-10,se-1,20,2,pe)})(N,H.x,N.transform.height-H.y,Zn)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;let n=this.terrainFacilitator.matrix,h=this.transform.modelViewProjectionMatrix,d=this.terrainFacilitator.dirty;d||(d=e?!a.c0(n,h):!a.c1(n,h)),d||(d=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),d&&(a.c2(n,h),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(y,b){let S=y.context,C=S.gl,k=y.transform,R=Li.unblended,j=new Bt(C.LEQUAL,Bt.ReadWrite,[0,1]),N=b.sourceCache.getRenderableTiles(),q=y.useProgram("terrainDepth");S.bindFramebuffer.set(b.getFramebuffer("depth").framebuffer),S.viewport.set([0,0,y.width/devicePixelRatio,y.height/devicePixelRatio]),S.clear({color:a.b7.transparent,depth:1});for(let H of N){let ae=b.getTerrainMesh(H.tileID),oe=b.getTerrainData(H.tileID),se=k.getProjectionData({overscaledTileID:H.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),pe={u_ele_delta:b.getMeshFrameDelta(k.zoom)};q.draw(S,C.TRIANGLES,j,ti.disabled,R,si.backCCW,pe,oe,se,"terrain",ae.vertexBuffer,ae.indexBuffer,ae.segments)}S.bindFramebuffer.set(null),S.viewport.set([0,0,y.width,y.height])}(this,this.style.map.terrain),function(y,b){let S=y.context,C=S.gl,k=y.transform,R=Li.unblended,j=new Bt(C.LEQUAL,Bt.ReadWrite,[0,1]),N=b.getCoordsTexture(),q=b.sourceCache.getRenderableTiles(),H=y.useProgram("terrainCoords");S.bindFramebuffer.set(b.getFramebuffer("coords").framebuffer),S.viewport.set([0,0,y.width/devicePixelRatio,y.height/devicePixelRatio]),S.clear({color:a.b7.transparent,depth:1}),b.coordsIndex=[];for(let ae of q){let oe=b.getTerrainMesh(ae.tileID),se=b.getTerrainData(ae.tileID);S.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,N.texture);let pe={u_terrain_coords_id:(255-b.coordsIndex.length)/255,u_texture:0,u_ele_delta:b.getMeshFrameDelta(k.zoom)},ve=k.getProjectionData({overscaledTileID:ae.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});H.draw(S,C.TRIANGLES,j,ti.disabled,R,si.backCCW,pe,se,ve,"terrain",oe.vertexBuffer,oe.indexBuffer,oe.segments),b.coordsIndex.push(ae.tileID.key)}S.bindFramebuffer.set(null),S.viewport.set([0,0,y.width,y.height])}(this,this.style.map.terrain))}renderLayer(e,n,h,d,y){h.isHidden(this.transform.zoom)||(h.type==="background"||h.type==="custom"||(d||[]).length)&&(this.id=h.id,a.c3(h)?function(b,S,C,k,R,j){if(b.renderPass!=="translucent")return;let{isRenderingToTexture:N}=j,q=ti.disabled,H=b.colorModeForRenderPass();(C._unevaluatedLayout.hasValue("text-variable-anchor")||C._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(ae,oe,se,pe,ve,ye,we,Le,Pe){let $e=oe.transform,tt=oe.style.map.terrain,He=ve==="map",Ke=ye==="map";for(let Qe of ae){let vt=pe.getTile(Qe),gt=vt.getBucket(se);if(!gt||!gt.text||!gt.text.segments.get().length)continue;let ct=a.ak(gt.textSizeData,$e.zoom),Lt=a.az(vt,1,oe.transform.zoom),li=Dt(He,oe.transform,Lt),Ci=se.layout.get("icon-text-fit")!=="none"&&gt.hasIconData();if(ct){let yn=Math.pow(2,$e.zoom-vt.tileID.overscaledZ),Ki=tt?(vn,xn)=>tt.getElevation(Qe,vn,xn):null;lc(gt,He,Ke,Pe,$e,li,yn,ct,Ci,a.aA($e,vt,we,Le),Qe.toUnwrapped(),Ki)}}}(k,b,C,S,C.layout.get("text-rotation-alignment"),C.layout.get("text-pitch-alignment"),C.paint.get("text-translate"),C.paint.get("text-translate-anchor"),R),C.paint.get("icon-opacity").constantOr(1)!==0&&wl(b,S,C,k,!1,C.paint.get("icon-translate"),C.paint.get("icon-translate-anchor"),C.layout.get("icon-rotation-alignment"),C.layout.get("icon-pitch-alignment"),C.layout.get("icon-keep-upright"),q,H,N),C.paint.get("text-opacity").constantOr(1)!==0&&wl(b,S,C,k,!0,C.paint.get("text-translate"),C.paint.get("text-translate-anchor"),C.layout.get("text-rotation-alignment"),C.layout.get("text-pitch-alignment"),C.layout.get("text-keep-upright"),q,H,N),S.map.showCollisionBoxes&&(sc(b,S,C,k,!0),sc(b,S,C,k,!1))}(e,n,h,d,this.style.placement.variableOffsets,y):a.c4(h)?function(b,S,C,k,R){if(b.renderPass!=="translucent")return;let{isRenderingToTexture:j}=R,N=C.paint.get("circle-opacity"),q=C.paint.get("circle-stroke-width"),H=C.paint.get("circle-stroke-opacity"),ae=!C.layout.get("circle-sort-key").isConstant();if(N.constantOr(1)===0&&(q.constantOr(1)===0||H.constantOr(1)===0))return;let oe=b.context,se=oe.gl,pe=b.transform,ve=b.getDepthModeForSublayer(0,Bt.ReadOnly),ye=ti.disabled,we=b.colorModeForRenderPass(),Le=[],Pe=pe.getCircleRadiusCorrection();for(let $e=0;$e<k.length;$e++){let tt=k[$e],He=S.getTile(tt),Ke=He.getBucket(C);if(!Ke)continue;let Qe=C.paint.get("circle-translate"),vt=C.paint.get("circle-translate-anchor"),gt=a.aA(pe,He,Qe,vt),ct=Ke.programConfigurations.get(C.id),Lt=b.useProgram("circle",ct),li=Ke.layoutVertexBuffer,Ci=Ke.indexBuffer,yn=b.style.map.terrain&&b.style.map.terrain.getTerrainData(tt),Ki={programConfiguration:ct,program:Lt,layoutVertexBuffer:li,indexBuffer:Ci,uniformValues:Ns(b,He,C,gt,Pe),terrainData:yn,projectionData:pe.getProjectionData({overscaledTileID:tt,applyGlobeMatrix:!j,applyTerrainMatrix:!0})};if(ae){let vn=Ke.segments.get();for(let xn of vn)Le.push({segments:new a.aJ([xn]),sortKey:xn.sortKey,state:Ki})}else Le.push({segments:Ke.segments,sortKey:0,state:Ki})}ae&&Le.sort(($e,tt)=>$e.sortKey-tt.sortKey);for(let $e of Le){let{programConfiguration:tt,program:He,layoutVertexBuffer:Ke,indexBuffer:Qe,uniformValues:vt,terrainData:gt,projectionData:ct}=$e.state;He.draw(oe,se.TRIANGLES,ve,ye,we,si.backCCW,vt,gt,ct,C.id,Ke,Qe,$e.segments,C.paint,b.transform.zoom,tt)}}(e,n,h,d,y):a.c5(h)?function(b,S,C,k,R){if(C.paint.get("heatmap-opacity")===0)return;let j=b.context,{isRenderingToTexture:N,isRenderingGlobe:q}=R;if(b.style.map.terrain){for(let H of k){let ae=S.getTile(H);S.hasRenderableParent(H)||(b.renderPass==="offscreen"?Xs(b,ae,C,H,q):b.renderPass==="translucent"&&cc(b,C,H,N,q))}j.viewport.set([0,0,b.width,b.height])}else b.renderPass==="offscreen"?function(H,ae,oe,se){let pe=H.context,ve=pe.gl,ye=H.transform,we=ti.disabled,Le=new Li([ve.ONE,ve.ONE],a.b7.transparent,[!0,!0,!0,!0]);(function(Pe,$e,tt){let He=Pe.gl;Pe.activeTexture.set(He.TEXTURE1),Pe.viewport.set([0,0,$e.width/4,$e.height/4]);let Ke=tt.heatmapFbos.get(a.bW);Ke?(He.bindTexture(He.TEXTURE_2D,Ke.colorAttachment.get()),Pe.bindFramebuffer.set(Ke.framebuffer)):(Ke=c(Pe,$e.width/4,$e.height/4),tt.heatmapFbos.set(a.bW,Ke))})(pe,H,oe),pe.clear({color:a.b7.transparent});for(let Pe=0;Pe<se.length;Pe++){let $e=se[Pe];if(ae.hasRenderableParent($e))continue;let tt=ae.getTile($e),He=tt.getBucket(oe);if(!He)continue;let Ke=He.programConfigurations.get(oe.id),Qe=H.useProgram("heatmap",Ke),vt=ye.getProjectionData({overscaledTileID:$e,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),gt=ye.getCircleRadiusCorrection();Qe.draw(pe,ve.TRIANGLES,Bt.disabled,we,Le,si.backCCW,Ea(tt,ye.zoom,oe.paint.get("heatmap-intensity"),gt),null,vt,oe.id,He.layoutVertexBuffer,He.indexBuffer,He.segments,oe.paint,ye.zoom,Ke)}pe.viewport.set([0,0,H.width,H.height])}(b,S,C,k):b.renderPass==="translucent"&&function(H,ae){let oe=H.context,se=oe.gl;oe.setColorMode(H.colorModeForRenderPass());let pe=ae.heatmapFbos.get(a.bW);pe&&(oe.activeTexture.set(se.TEXTURE0),se.bindTexture(se.TEXTURE_2D,pe.colorAttachment.get()),oe.activeTexture.set(se.TEXTURE1),g(oe,ae).bind(se.LINEAR,se.CLAMP_TO_EDGE),H.useProgram("heatmapTexture").draw(oe,se.TRIANGLES,Bt.disabled,ti.disabled,H.colorModeForRenderPass(),si.disabled,ec(H,ae,0,1),null,null,ae.id,H.viewportBuffer,H.quadTriangleIndexBuffer,H.viewportSegments,ae.paint,H.transform.zoom))}(b,C)}(e,n,h,d,y):a.c6(h)?function(b,S,C,k,R){if(b.renderPass!=="translucent")return;let{isRenderingToTexture:j}=R,N=C.paint.get("line-opacity"),q=C.paint.get("line-width");if(N.constantOr(1)===0||q.constantOr(1)===0)return;let H=b.getDepthModeForSublayer(0,Bt.ReadOnly),ae=b.colorModeForRenderPass(),oe=C.paint.get("line-dasharray"),se=C.paint.get("line-pattern"),pe=se.constantOr(1),ve=C.paint.get("line-gradient"),ye=C.getCrossfadeParameters(),we=pe?"linePattern":oe?"lineSDF":ve?"lineGradient":"line",Le=b.context,Pe=Le.gl,$e=b.transform,tt=!0;for(let He of k){let Ke=S.getTile(He);if(pe&&!Ke.patternsLoaded())continue;let Qe=Ke.getBucket(C);if(!Qe)continue;let vt=Qe.programConfigurations.get(C.id),gt=b.context.program.get(),ct=b.useProgram(we,vt),Lt=tt||ct.program!==gt,li=b.style.map.terrain&&b.style.map.terrain.getTerrainData(He),Ci=se.constantOr(null);if(Ci&&Ke.imageAtlas){let Qi=Ke.imageAtlas,Bi=Qi.patternPositions[Ci.to.toString()],nr=Qi.patternPositions[Ci.from.toString()];Bi&&nr&&vt.setConstantPatternPositions(Bi,nr)}let yn=$e.getProjectionData({overscaledTileID:He,applyGlobeMatrix:!j,applyTerrainMatrix:!0}),Ki=$e.getPixelScale(),vn=pe?Yc(b,Ke,C,Ki,ye):oe?Aa(b,Ke,C,Ki,oe,ye):ve?vo(b,Ke,C,Ki,Qe.lineClipsArray.length):js(b,Ke,C,Ki);if(pe)Le.activeTexture.set(Pe.TEXTURE0),Ke.imageAtlasTexture.bind(Pe.LINEAR,Pe.CLAMP_TO_EDGE),vt.updatePaintBuffers(ye);else if(oe&&(Lt||b.lineAtlas.dirty))Le.activeTexture.set(Pe.TEXTURE0),b.lineAtlas.bind(Le);else if(ve){let Qi=Qe.gradients[C.id],Bi=Qi.texture;if(C.gradientVersion!==Qi.version){let nr=256;if(C.stepInterpolant){let dr=S.getSource().maxzoom,xr=He.canonical.z===dr?Math.ceil(1<<b.transform.maxZoom-He.canonical.z):1;nr=a.ae(a.bX(Qe.maxLineLength/a.Z*1024*xr),256,Le.maxTextureSize)}Qi.gradient=a.bY({expression:C.gradientExpression(),evaluationKey:"lineProgress",resolution:nr,image:Qi.gradient||void 0,clips:Qe.lineClipsArray}),Qi.texture?Qi.texture.update(Qi.gradient):Qi.texture=new kt(Le,Qi.gradient,Pe.RGBA),Qi.version=C.gradientVersion,Bi=Qi.texture}Le.activeTexture.set(Pe.TEXTURE0),Bi.bind(C.stepInterpolant?Pe.NEAREST:Pe.LINEAR,Pe.CLAMP_TO_EDGE)}let xn=b.stencilModeForClipping(He);ct.draw(Le,Pe.TRIANGLES,H,xn,ae,si.disabled,vn,li,yn,C.id,Qe.layoutVertexBuffer,Qe.indexBuffer,Qe.segments,C.paint,b.transform.zoom,vt,Qe.layoutVertexBuffer2),tt=!1}}(e,n,h,d,y):a.c7(h)?function(b,S,C,k,R){let j=C.paint.get("fill-color"),N=C.paint.get("fill-opacity");if(N.constantOr(1)===0)return;let{isRenderingToTexture:q}=R,H=b.colorModeForRenderPass(),ae=C.paint.get("fill-pattern"),oe=b.opaquePassEnabledForLayer()&&!ae.constantOr(1)&&j.constantOr(a.b7.transparent).a===1&&N.constantOr(0)===1?"opaque":"translucent";if(b.renderPass===oe){let se=b.getDepthModeForSublayer(1,b.renderPass==="opaque"?Bt.ReadWrite:Bt.ReadOnly);A(b,S,C,k,se,H,!1,q)}if(b.renderPass==="translucent"&&C.paint.get("fill-antialias")){let se=b.getDepthModeForSublayer(C.getPaintProperty("fill-outline-color")?2:0,Bt.ReadOnly);A(b,S,C,k,se,H,!0,q)}}(e,n,h,d,y):a.c8(h)?function(b,S,C,k,R){let j=C.paint.get("fill-extrusion-opacity");if(j===0)return;let{isRenderingToTexture:N}=R;if(b.renderPass==="translucent"){let q=new Bt(b.context.gl.LEQUAL,Bt.ReadWrite,b.depthRangeFor3D);if(j!==1||C.paint.get("fill-extrusion-pattern").constantOr(1))F(b,S,C,k,q,ti.disabled,Li.disabled,N),F(b,S,C,k,q,b.stencilModeFor3D(),b.colorModeForRenderPass(),N);else{let H=b.colorModeForRenderPass();F(b,S,C,k,q,ti.disabled,H,N)}}}(e,n,h,d,y):a.c9(h)?function(b,S,C,k,R){if(b.renderPass!=="offscreen"&&b.renderPass!=="translucent")return;let{isRenderingToTexture:j}=R,N=b.context,q=b.style.projection.useSubdivision,H=b.getDepthModeForSublayer(0,Bt.ReadOnly),ae=b.colorModeForRenderPass();if(b.renderPass==="offscreen")(function(oe,se,pe,ve,ye,we,Le){let Pe=oe.context,$e=Pe.gl;for(let tt of pe){let He=se.getTile(tt),Ke=He.dem;if(!Ke||!Ke.data||!He.needsHillshadePrepare)continue;let Qe=Ke.dim,vt=Ke.stride,gt=Ke.getPixels();if(Pe.activeTexture.set($e.TEXTURE1),Pe.pixelStoreUnpackPremultiplyAlpha.set(!1),He.demTexture=He.demTexture||oe.getTileTexture(vt),He.demTexture){let Lt=He.demTexture;Lt.update(gt,{premultiply:!1}),Lt.bind($e.NEAREST,$e.CLAMP_TO_EDGE)}else He.demTexture=new kt(Pe,gt,$e.RGBA,{premultiply:!1}),He.demTexture.bind($e.NEAREST,$e.CLAMP_TO_EDGE);Pe.activeTexture.set($e.TEXTURE0);let ct=He.fbo;if(!ct){let Lt=new kt(Pe,{width:Qe,height:Qe,data:null},$e.RGBA);Lt.bind($e.LINEAR,$e.CLAMP_TO_EDGE),ct=He.fbo=Pe.createFramebuffer(Qe,Qe,!0,!1),ct.colorAttachment.set(Lt.texture)}Pe.bindFramebuffer.set(ct.framebuffer),Pe.viewport.set([0,0,Qe,Qe]),oe.useProgram("hillshadePrepare").draw(Pe,$e.TRIANGLES,ye,we,Le,si.disabled,ao(He.tileID,Ke),null,null,ve.id,oe.rasterBoundsBuffer,oe.quadTriangleIndexBuffer,oe.rasterBoundsSegments),He.needsHillshadePrepare=!1}})(b,S,k,C,H,ti.disabled,ae),N.viewport.set([0,0,b.width,b.height]);else if(b.renderPass==="translucent")if(q){let[oe,se,pe]=b.stencilConfigForOverlapTwoPass(k);J(b,S,C,pe,oe,H,ae,!1,j),J(b,S,C,pe,se,H,ae,!0,j)}else{let[oe,se]=b.getStencilConfigForOverlapAndUpdateStencilID(k);J(b,S,C,se,oe,H,ae,!1,j)}}(e,n,h,d,y):a.ca(h)?function(b,S,C,k,R){if(b.renderPass!=="translucent"||C.paint.get("raster-opacity")===0||!k.length)return;let{isRenderingToTexture:j}=R,N=S.getSource(),q=b.style.projection.useSubdivision;if(N instanceof jn)je(b,S,C,k,null,!1,!1,N.tileCoords,N.flippedWindingOrder,j);else if(q){let[H,ae,oe]=b.stencilConfigForOverlapTwoPass(k);je(b,S,C,oe,H,!1,!0,xe,!1,j),je(b,S,C,oe,ae,!0,!0,xe,!1,j)}else{let[H,ae]=b.getStencilConfigForOverlapAndUpdateStencilID(k);je(b,S,C,ae,H,!1,!0,xe,!1,j)}}(e,n,h,d,y):a.cb(h)?function(b,S,C,k,R){let j=C.paint.get("background-color"),N=C.paint.get("background-opacity");if(N===0)return;let{isRenderingToTexture:q}=R,H=b.context,ae=H.gl,oe=b.style.projection,se=b.transform,pe=se.tileSize,ve=C.paint.get("background-pattern");if(b.isPatternMissing(ve))return;let ye=!ve&&j.a===1&&N===1&&b.opaquePassEnabledForLayer()?"opaque":"translucent";if(b.renderPass!==ye)return;let we=ti.disabled,Le=b.getDepthModeForSublayer(0,ye==="opaque"?Bt.ReadWrite:Bt.ReadOnly),Pe=b.colorModeForRenderPass(),$e=b.useProgram(ve?"backgroundPattern":"background"),tt=k||ke(se,{tileSize:pe,terrain:b.style.map.terrain});ve&&(H.activeTexture.set(ae.TEXTURE0),b.imageManager.bind(b.context));let He=C.getCrossfadeParameters();for(let Ke of tt){let Qe=se.getProjectionData({overscaledTileID:Ke,applyGlobeMatrix:!q,applyTerrainMatrix:!0}),vt=ve?nc(N,b,ve,{tileID:Ke,tileSize:pe},He):ih(N,j),gt=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Ke),ct=oe.getMeshFromTileID(H,Ke.canonical,!1,!0,"raster");$e.draw(H,ae.TRIANGLES,Le,we,Pe,si.backCCW,vt,gt,Qe,C.id,ct.vertexBuffer,ct.indexBuffer,ct.segments)}}(e,0,h,d,y):a.cc(h)&&function(b,S,C,k){let{isRenderingGlobe:R}=k,j=b.context,N=C.implementation,q=b.style.projection,H=b.transform,ae=H.getProjectionDataForCustomLayer(R),oe={farZ:H.farZ,nearZ:H.nearZ,fov:H.fov*Math.PI/180,modelViewProjectionMatrix:H.modelViewProjectionMatrix,projectionMatrix:H.projectionMatrix,shaderData:{variantName:q.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${q.shaderPreludeCode.vertexSource}`,define:q.shaderDefine},defaultProjectionData:ae},se=N.renderingMode?N.renderingMode:"2d";if(b.renderPass==="offscreen"){let pe=N.prerender;pe&&(b.setCustomLayerDefaults(),j.setColorMode(b.colorModeForRenderPass()),pe.call(N,j.gl,oe),j.setDirty(),b.setBaseState())}else if(b.renderPass==="translucent"){b.setCustomLayerDefaults(),j.setColorMode(b.colorModeForRenderPass()),j.setStencilMode(ti.disabled);let pe=se==="3d"?b.getDepthModeFor3D():b.getDepthModeForSublayer(0,Bt.ReadOnly);j.setDepthMode(pe),N.render(j.gl,oe),j.setDirty(),b.setBaseState(),j.bindFramebuffer.set(null)}}(e,0,h,y))}saveTileTexture(e){let n=this._tileTextures[e.size[0]];n?n.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){let n=this._tileTextures[e];return n&&n.length>0?n.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;let n=this.imageManager.getPattern(e.from.toString()),h=this.imageManager.getPattern(e.to.toString());return!n||!h}useProgram(e,n,h=!1,d=[]){this.cache=this.cache||{};let y=!!this.style.map.terrain,b=this.style.projection,S=h?Bn.projectionMercator:b.shaderPreludeCode,C=h?zo:b.shaderDefine,k=e+(n?n.cacheKey:"")+`/${h?di:b.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(y?"/terrain":"")+(d?`/${d.join("/")}`:"");return this.cache[k]||(this.cache[k]=new Ia(this.context,Bn[e],n,xo[e],this._showOverdrawInspector,y,S,C,d)),this.cache[k]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new kt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){let{drawingBufferWidth:e,drawingBufferHeight:n}=this.context.gl;return this.width!==e||this.height!==n}}function ms(_,e){let n,h=!1,d=null,y=null,b=()=>{d=null,h&&(_.apply(y,n),d=setTimeout(b,e),h=!1)};return(...S)=>(h=!0,y=this,n=S,d||b(),d)}class hc{constructor(e){this._getCurrentHash=()=>{let n=window.location.hash.replace("#","");if(this._hashName){let h;return n.split("&").map(d=>d.split("=")).forEach(d=>{d[0]===this._hashName&&(h=d)}),(h&&h[1]||"").split("/")}return n.split("/")},this._onHashChange=()=>{let n=this._getCurrentHash();if(!this._isValidHash(n))return!1;let h=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:h,pitch:+(n[4]||0)}),!0},this._updateHashUnthrottled=()=>{let n=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,n)},this._removeHash=()=>{let n=this._getCurrentHash();if(n.length===0)return;let h=n.join("/"),d=h;d.split("&").length>0&&(d=d.split("&")[0]),this._hashName&&(d=`${this._hashName}=${h}`);let y=window.location.hash.replace(d,"");y.startsWith("#&")?y=y.slice(0,1)+y.slice(2):y==="#"&&(y="");let b=window.location.href.replace(/(#.+)?$/,y);b=b.replace("&&","&"),window.history.replaceState(window.history.state,null,b)},this._updateHash=ms(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){let n=this._map.getCenter(),h=Math.round(100*this._map.getZoom())/100,d=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,d),b=Math.round(n.lng*y)/y,S=Math.round(n.lat*y)/y,C=this._map.getBearing(),k=this._map.getPitch(),R="";if(R+=e?`/${b}/${S}/${h}`:`${h}/${S}/${b}`,(C||k)&&(R+="/"+Math.round(10*C)/10),k&&(R+=`/${Math.round(k)}`),this._hashName){let j=this._hashName,N=!1,q=window.location.hash.slice(1).split("&").map(H=>{let ae=H.split("=")[0];return ae===j?(N=!0,`${ae}=${R}`):H}).filter(H=>H);return N||q.push(`${j}=${R}`),`#${q.join("&")}`}return`#${R}`}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new a.Q(+e[2],+e[1])}catch{return!1}let n=+e[0],h=+(e[3]||0),d=+(e[4]||0);return n>=this._map.getMinZoom()&&n<=this._map.getMaxZoom()&&h>=-180&&h<=180&&d>=this._map.getMinPitch()&&d<=this._map.getMaxPitch()}}let so={linearity:.3,easing:a.cd(0,0,.3,1)},gn=a.e({deceleration:2500,maxSpeed:1400},so),ra=a.e({deceleration:20,maxSpeed:1400},so),dc=a.e({deceleration:1e3,maxSpeed:360},so),cu=a.e({deceleration:1e3,maxSpeed:90},so),uu=a.e({deceleration:1e3,maxSpeed:360},so);class Tl{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:W.now(),settings:e})}_drainInertiaBuffer(){let e=this._inertiaBuffer,n=W.now();for(;e.length>0&&n-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;let n={zoom:0,bearing:0,pitch:0,roll:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:y}of this._inertiaBuffer)n.zoom+=y.zoomDelta||0,n.bearing+=y.bearingDelta||0,n.pitch+=y.pitchDelta||0,n.roll+=y.rollDelta||0,y.panDelta&&n.pan._add(y.panDelta),y.around&&(n.around=y.around),y.pinchAround&&(n.pinchAround=y.pinchAround);let h=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,d={};if(n.pan.mag()){let y=gs(n.pan.mag(),h,a.e({},gn,e||{})),b=n.pan.mult(y.amount/n.pan.mag()),S=this._map.cameraHelper.handlePanInertia(b,this._map.transform);d.center=S.easingCenter,d.offset=S.easingOffset,Oa(d,y)}if(n.zoom){let y=gs(n.zoom,h,ra);d.zoom=this._map.transform.zoom+y.amount,Oa(d,y)}if(n.bearing){let y=gs(n.bearing,h,dc);d.bearing=this._map.transform.bearing+a.ae(y.amount,-179,179),Oa(d,y)}if(n.pitch){let y=gs(n.pitch,h,cu);d.pitch=this._map.transform.pitch+y.amount,Oa(d,y)}if(n.roll){let y=gs(n.roll,h,uu);d.roll=this._map.transform.roll+a.ae(y.amount,-179,179),Oa(d,y)}if(d.zoom||d.bearing){let y=n.pinchAround===void 0?n.around:n.pinchAround;d.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),a.e(d,{noMoveStart:!0})}}function Oa(_,e){(!_.duration||_.duration<e.duration)&&(_.duration=e.duration,_.easing=e.easing)}function gs(_,e,n){let{maxSpeed:h,linearity:d,deceleration:y}=n,b=a.ae(_*d/(e/1e3),-h,h),S=Math.abs(b)/(y*d);return{easing:n.easing,duration:1e3*S,amount:b*(S/2)}}class ir extends a.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,h,d={}){h=h instanceof MouseEvent?h:new MouseEvent(e,h);let y=V.mousePos(n.getCanvas(),h),b=n.unproject(y);super(e,a.e({point:y,lngLat:b,originalEvent:h},d)),this._defaultPrevented=!1,this.target=n}}class Sl extends a.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,h){let d=e==="touchend"?h.changedTouches:h.touches,y=V.touchPos(n.getCanvasContainer(),d),b=y.map(C=>n.unproject(C)),S=y.reduce((C,k,R,j)=>C.add(k.div(j.length)),new a.P(0,0));super(e,{points:y,point:S,lngLats:b,lngLat:n.unproject(S),originalEvent:h}),this._defaultPrevented=!1}}class rh extends a.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,h){super(e,{originalEvent:h}),this._defaultPrevented=!1}}class bd{constructor(e,n){this._map=e,this._clickTolerance=n.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new rh(e.type,this._map,e))}mousedown(e,n){return this._mousedownPos=n,this._firePreventable(new ir(e.type,this._map,e))}mouseup(e){this._map.fire(new ir(e.type,this._map,e))}click(e,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||this._map.fire(new ir(e.type,this._map,e))}dblclick(e){return this._firePreventable(new ir(e.type,this._map,e))}mouseover(e){this._map.fire(new ir(e.type,this._map,e))}mouseout(e){this._map.fire(new ir(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Sl(e.type,this._map,e))}touchmove(e){this._map.fire(new Sl(e.type,this._map,e))}touchend(e){this._map.fire(new Sl(e.type,this._map,e))}touchcancel(e){this._map.fire(new Sl(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class wd{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new ir(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ir("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new ir(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Pl{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(a.P.convert(e),this._map.terrain)}}class oh{constructor(e,n){this._map=e,this._tr=new Pl(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,n){this.isEnabled()&&e.shiftKey&&e.button===0&&(V.disableDrag(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(e,n){if(!this._active)return;let h=n;if(this._lastPos.equals(h)||!this._box&&h.dist(this._startPos)<this._clickTolerance)return;let d=this._startPos;this._lastPos=h,this._box||(this._box=V.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));let y=Math.min(d.x,h.x),b=Math.max(d.x,h.x),S=Math.min(d.y,h.y),C=Math.max(d.y,h.y);V.setTransform(this._box,`translate(${y}px,${S}px)`),this._box.style.width=b-y+"px",this._box.style.height=C-S+"px"}mouseupWindow(e,n){if(!this._active||e.button!==0)return;let h=this._startPos,d=n;if(this.reset(),V.suppressClick(),h.x!==d.x||h.y!==d.y)return this._map.fire(new a.l("boxzoomend",{originalEvent:e})),{cameraAnimation:y=>y.fitScreenCoordinates(h,d,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(V.remove(this._box),this._box=null),V.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,n){return this._map.fire(new a.l(e,{originalEvent:n}))}}function hu(_,e){if(_.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${_.length}, points ${e.length}`);let n={};for(let h=0;h<_.length;h++)n[_[h].identifier]=e[h];return n}class Td{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,n,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),h.length===this.numTouches&&(this.centroid=function(d){let y=new a.P(0,0);for(let b of d)y._add(b);return y.div(d.length)}(n),this.touches=hu(h,n)))}touchmove(e,n,h){if(this.aborted||!this.centroid)return;let d=hu(h,n);for(let y in this.touches){let b=d[y];(!b||b.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(e,n,h){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){let d=!this.aborted&&this.centroid;if(this.reset(),d)return d}}}class Ml{constructor(e){this.singleTap=new Td(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,n,h){this.singleTap.touchstart(e,n,h)}touchmove(e,n,h){this.singleTap.touchmove(e,n,h)}touchend(e,n,h){let d=this.singleTap.touchend(e,n,h);if(d){let y=e.timeStamp-this.lastTime<500,b=!this.lastTap||this.lastTap.dist(d)<30;if(y&&b||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}}}class Sd{constructor(e){this._tr=new Pl(e),this._zoomIn=new Ml({numTouches:1,numTaps:2}),this._zoomOut=new Ml({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,n,h){this._zoomIn.touchstart(e,n,h),this._zoomOut.touchstart(e,n,h)}touchmove(e,n,h){this._zoomIn.touchmove(e,n,h),this._zoomOut.touchmove(e,n,h)}touchend(e,n,h){let d=this._zoomIn.touchend(e,n,h),y=this._zoomOut.touchend(e,n,h),b=this._tr;return d?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:b.zoom+1,around:b.unproject(d)},{originalEvent:e})}):y?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:b.zoom-1,around:b.unproject(y)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Er{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){let n=this._moveFunction(...e);if(n.bearingDelta||n.pitchDelta||n.rollDelta||n.around||n.panDelta)return this._active=!0,n}dragStart(e,n){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(n)?n[0]:n,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,n){if(!this.isEnabled())return;let h=this._lastPoint;if(!h)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);let d=Array.isArray(n)?n[0]:n;return!this._moved&&d.dist(h)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=d,this._move(h,d))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&V.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}let No={0:1,2:2};class Cl{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){let n=V.mouseButton(e);this._eventButton=n}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(n,h){let d=No[h];return n.buttons===void 0||(n.buttons&d)!==d}(e,this._eventButton)}isValidEndEvent(e){return V.mouseButton(e)===this._eventButton}}class jo{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class Il{constructor(e=new Cl({checkCorrectEvent:()=>!0}),n=new jo){this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=n}_executeRelevantHandler(e,n,h){return e instanceof MouseEvent?n(e):typeof TouchEvent<"u"&&e instanceof TouchEvent?h(e):void 0}startMove(e){this._executeRelevantHandler(e,n=>this.mouseMoveStateManager.startMove(n),n=>this.oneFingerTouchMoveStateManager.startMove(n))}endMove(e){this._executeRelevantHandler(e,n=>this.mouseMoveStateManager.endMove(n),n=>this.oneFingerTouchMoveStateManager.endMove(n))}isValidStartEvent(e){return this._executeRelevantHandler(e,n=>this.mouseMoveStateManager.isValidStartEvent(n),n=>this.oneFingerTouchMoveStateManager.isValidStartEvent(n))}isValidMoveEvent(e){return this._executeRelevantHandler(e,n=>this.mouseMoveStateManager.isValidMoveEvent(n),n=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(n))}isValidEndEvent(e){return this._executeRelevantHandler(e,n=>this.mouseMoveStateManager.isValidEndEvent(n),n=>this.oneFingerTouchMoveStateManager.isValidEndEvent(n))}}let du=_=>{_.mousedown=_.dragStart,_.mousemoveWindow=_.dragMove,_.mouseup=_.dragEnd,_.contextmenu=e=>{e.preventDefault()}};class _f{constructor(e,n){this._clickTolerance=e.clickTolerance||1,this._map=n,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,n,h){return this._calculateTransform(e,n,h)}touchmove(e,n,h){if(this._active){if(!this._shouldBePrevented(h.length))return e.preventDefault(),this._calculateTransform(e,n,h);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,n,h){this._calculateTransform(e,n,h),this._active&&this._shouldBePrevented(h.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,n,h){h.length>0&&(this._active=!0);let d=hu(h,n),y=new a.P(0,0),b=new a.P(0,0),S=0;for(let k in d){let R=d[k],j=this._touches[k];j&&(y._add(R),b._add(R.sub(j)),S++,d[k]=R)}if(this._touches=d,this._shouldBePrevented(S)||!b.mag())return;let C=b.div(S);return this._sum._add(C),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(S),panDelta:C}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ah{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,n,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([n[0],n[1]]))}touchmove(e,n,h){if(!this._firstTwoTouches)return;e.preventDefault();let[d,y]=this._firstTwoTouches,b=pu(h,n,d),S=pu(h,n,y);if(!b||!S)return;let C=this._aroundCenter?null:b.add(S).div(2);return this._move([b,S],C,e)}touchend(e,n,h){if(!this._firstTwoTouches)return;let[d,y]=this._firstTwoTouches,b=pu(h,n,d),S=pu(h,n,y);b&&S||(this._active&&V.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function pu(_,e,n){for(let h=0;h<_.length;h++)if(_[h].identifier===n)return e[h]}function sh(_,e){return Math.log(_/e)/Math.LN2}class El extends ah{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,n){let h=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(sh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:sh(this._distance,h),pinchAround:n}}}function oa(_,e){return 180*_.angleWith(e)/Math.PI}class wt extends ah{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,n,h){let d=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:oa(this._vector,d),pinchAround:n}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());let n=25/(Math.PI*this._minDiameter)*360,h=oa(e,this._startVector);return Math.abs(h)<n}}function fu(_){return Math.abs(_.y)>Math.abs(_.x)}class mu extends ah{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,n,h){super.touchstart(e,n,h),this._currentTouchCount=h.length}_start(e){this._lastPoints=e,fu(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,n,h){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;let d=e[0].sub(this._lastPoints[0]),y=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(d,y,h.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(d.y+y.y)/2*-.5}):void 0}gestureBeginsVertically(e,n,h){if(this._valid!==void 0)return this._valid;let d=e.mag()>=2,y=n.mag()>=2;if(!d&&!y)return;if(!d||!y)return this._firstMove===void 0&&(this._firstMove=h),h-this._firstMove<100&&void 0;let b=e.y>0==n.y>0;return fu(e)&&fu(n)&&b}}let Pd={panStep:100,bearingStep:15,pitchStep:10};class Ll{constructor(e){this._tr=new Pl(e);let n=Pd;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let n=0,h=0,d=0,y=0,b=0;switch(e.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:e.shiftKey?h=-1:(e.preventDefault(),y=-1);break;case 39:e.shiftKey?h=1:(e.preventDefault(),y=1);break;case 38:e.shiftKey?d=1:(e.preventDefault(),b=-1);break;case 40:e.shiftKey?d=-1:(e.preventDefault(),b=1);break;default:return}return this._rotationDisabled&&(h=0,d=0),{cameraAnimation:S=>{let C=this._tr;S.easeTo({duration:300,easeId:"keyboardHandler",easing:pc,zoom:n?Math.round(C.zoom)+n*(e.shiftKey?2:1):C.zoom,bearing:C.bearing+h*this._bearingStep,pitch:C.pitch+d*this._pitchStep,offset:[-y*this._panStep,-b*this._panStep],center:C.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function pc(_){return _*(2-_)}let lh=4.000244140625;class bi{constructor(e,n){this._onTimeout=h=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(h)},this._map=e,this._tr=new Pl(e),this._triggerRenderFrame=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let n=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY,h=W.now(),d=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,n!==0&&n%lh==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(d*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),e.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=e,this._delta-=n,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let n=V.mousePos(this._map.getCanvas(),e),h=this._tr;this._aroundPoint=this._aroundCenter?h.transform.locationToScreenPoint(a.Q.convert(h.center)):n,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let e=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){let S=e.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=S),typeof this._targetZoom=="number"&&(this._targetZoom+=S)}if(this._delta!==0){let S=this._type==="wheel"&&Math.abs(this._delta)>lh?this._wheelZoomRate:this._defaultZoomRate,C=2/(1+Math.exp(-Math.abs(this._delta*S)));this._delta<0&&C!==0&&(C=1/C);let k=typeof this._targetZoom!="number"?e.scale:a.ac(this._targetZoom);this._targetZoom=e.getConstrained(e.getCameraLngLat(),a.ah(k*C)).zoom,this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}let n=typeof this._targetZoom!="number"?e.zoom:this._targetZoom,h=this._startZoom,d=this._easing,y,b=!1;if(this._type==="wheel"&&h&&d){let S=W.now()-this._lastWheelEventTime,C=Math.min((S+5)/200,1),k=d(C);y=a.B.number(h,n,k),C<1?this._frameId||(this._frameId=!0):b=!0}else y=n,b=!0;return this._active=!0,b&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=y,{noInertia:!0,needsRenderFrame:!b,zoomDelta:y-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let n=a.cf;if(this._prevEase){let h=this._prevEase,d=(W.now()-h.start)/h.duration,y=h.easing(d+.01)-h.easing(d),b=.27/Math.sqrt(y*y+1e-4)*.01,S=Math.sqrt(.0729-b*b);n=a.cd(b,S,.25,1)}return this._prevEase={start:W.now(),duration:e,easing:n},n}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class gu{constructor(e,n){this._clickZoom=e,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class yf{constructor(e){this._tr=new Pl(e),this.reset()}reset(){this._active=!1}dblclick(e,n){return e.preventDefault(),{cameraAnimation:h=>{h.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(n)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ch{constructor(){this._tap=new Ml({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,n,h){if(!this._swipePoint)if(this._tapTime){let d=n[0],y=e.timeStamp-this._tapTime<500,b=this._tapPoint.dist(d)<30;y&&b?h.length>0&&(this._swipePoint=d,this._swipeTouch=h[0].identifier):this.reset()}else this._tap.touchstart(e,n,h)}touchmove(e,n,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;let d=n[0],y=d.y-this._swipePoint.y;return this._swipePoint=d,e.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(e,n,h)}touchend(e,n,h){if(this._tapTime)this._swipePoint&&h.length===0&&this.reset();else{let d=this._tap.touchend(e,n,h);d&&(this._tapTime=e.timeStamp,this._tapPoint=d)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Md{constructor(e,n,h){this._el=e,this._mousePan=n,this._touchPan=h}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Cd{constructor(e,n,h,d){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=n,this._mousePitch=h,this._mouseRoll=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class uh{constructor(e,n,h,d){this._el=e,this._touchZoom=n,this._touchRotate=h,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class _u{constructor(e,n){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=n,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;let e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=V.create("div","maplibregl-cooperative-gesture-screen",e);let n=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(n=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));let h=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),d=document.createElement("div");d.className="maplibregl-desktop-message",d.textContent=n,this._container.appendChild(d);let y=document.createElement("div");y.className="maplibregl-mobile-message",y.textContent=h,this._container.appendChild(y),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(V.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,n){this._enabled&&(this._map.fire(new a.l("cooperativegestureprevented",{gestureType:e,originalEvent:n})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}let fc=_=>_.zoom||_.drag||_.roll||_.pitch||_.rotate;class vf extends a.l{}function yu(_){return _.panDelta&&_.panDelta.mag()||_.zoomDelta||_.bearingDelta||_.pitchDelta||_.rollDelta}class xf{constructor(e,n){this.handleWindowEvent=d=>{this.handleEvent(d,`${d.type}Window`)},this.handleEvent=(d,y)=>{if(d.type==="blur")return void this.stop(!0);this._updatingCamera=!0;let b=d.type==="renderFrame"?void 0:d,S={needsRenderFrame:!1},C={},k={};for(let{handlerName:N,handler:q,allowed:H}of this._handlers){if(!q.isEnabled())continue;let ae;if(this._blockedByActive(k,H,N))q.reset();else if(q[y||d.type]){if(a.cg(d,y||d.type)){let oe=V.mousePos(this._map.getCanvas(),d);ae=q[y||d.type](d,oe)}else if(a.ch(d,y||d.type)){let oe=this._getMapTouches(d.touches),se=V.touchPos(this._map.getCanvas(),oe);ae=q[y||d.type](d,se,oe)}else a.ci(y||d.type)||(ae=q[y||d.type](d));this.mergeHandlerResult(S,C,ae,N,b),ae&&ae.needsRenderFrame&&this._triggerRenderFrame()}(ae||q.isActive())&&(k[N]=q)}let R={};for(let N in this._previousActiveHandlers)k[N]||(R[N]=b);this._previousActiveHandlers=k,(Object.keys(R).length||yu(S))&&(this._changes.push([S,C,R]),this._triggerRenderFrame()),(Object.keys(k).length||yu(S))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:j}=S;j&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],j(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Tl(e),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(n);let h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[window,"blur",void 0]];for(let[d,y,b]of this._listeners)V.addEventListener(d,y,d===document?this.handleWindowEvent:this.handleEvent,b)}destroy(){for(let[e,n,h]of this._listeners)V.removeEventListener(e,n,e===document?this.handleWindowEvent:this.handleEvent,h)}_addDefaultHandlers(e){let n=this._map,h=n.getCanvasContainer();this._add("mapEvent",new bd(n,e));let d=n.boxZoom=new oh(n,e);this._add("boxZoom",d),e.interactive&&e.boxZoom&&d.enable();let y=n.cooperativeGestures=new _u(n,e.cooperativeGestures);this._add("cooperativeGestures",y),e.cooperativeGestures&&y.enable();let b=new Sd(n),S=new yf(n);n.doubleClickZoom=new gu(S,b),this._add("tapZoom",b),this._add("clickZoom",S),e.interactive&&e.doubleClickZoom&&n.doubleClickZoom.enable();let C=new ch;this._add("tapDragZoom",C);let k=n.touchPitch=new mu(n);this._add("touchPitch",k),e.interactive&&e.touchPitch&&n.touchPitch.enable(e.touchPitch);let R=()=>n.project(n.getCenter()),j=function({enable:ye,clickTolerance:we,aroundCenter:Le=!0,minPixelCenterThreshold:Pe=100,rotateDegreesPerPixelMoved:$e=.8},tt){let He=new Cl({checkCorrectEvent:Ke=>V.mouseButton(Ke)===0&&Ke.ctrlKey||V.mouseButton(Ke)===2&&!Ke.ctrlKey});return new Er({clickTolerance:we,move:(Ke,Qe)=>{let vt=tt();if(Le&&Math.abs(vt.y-Ke.y)>Pe)return{bearingDelta:a.ce(new a.P(Ke.x,Qe.y),Qe,vt)};let gt=(Qe.x-Ke.x)*$e;return Le&&Qe.y<vt.y&&(gt=-gt),{bearingDelta:gt}},moveStateManager:He,enable:ye,assignEvents:du})}(e,R),N=function({enable:ye,clickTolerance:we,pitchDegreesPerPixelMoved:Le=-.5}){let Pe=new Cl({checkCorrectEvent:$e=>V.mouseButton($e)===0&&$e.ctrlKey||V.mouseButton($e)===2});return new Er({clickTolerance:we,move:($e,tt)=>({pitchDelta:(tt.y-$e.y)*Le}),moveStateManager:Pe,enable:ye,assignEvents:du})}(e),q=function({enable:ye,clickTolerance:we,rollDegreesPerPixelMoved:Le=.3},Pe){let $e=new Cl({checkCorrectEvent:tt=>V.mouseButton(tt)===2&&tt.ctrlKey});return new Er({clickTolerance:we,move:(tt,He)=>{let Ke=Pe(),Qe=(He.x-tt.x)*Le;return He.y<Ke.y&&(Qe=-Qe),{rollDelta:Qe}},moveStateManager:$e,enable:ye,assignEvents:du})}(e,R);n.dragRotate=new Cd(e,j,N,q),this._add("mouseRotate",j,["mousePitch"]),this._add("mousePitch",N,["mouseRotate","mouseRoll"]),this._add("mouseRoll",q,["mousePitch"]),e.interactive&&e.dragRotate&&n.dragRotate.enable();let H=function({enable:ye,clickTolerance:we}){let Le=new Cl({checkCorrectEvent:Pe=>V.mouseButton(Pe)===0&&!Pe.ctrlKey});return new Er({clickTolerance:we,move:(Pe,$e)=>({around:$e,panDelta:$e.sub(Pe)}),activateOnStart:!0,moveStateManager:Le,enable:ye,assignEvents:du})}(e),ae=new _f(e,n);n.dragPan=new Md(h,H,ae),this._add("mousePan",H),this._add("touchPan",ae,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&n.dragPan.enable(e.dragPan);let oe=new wt,se=new El;n.touchZoomRotate=new uh(h,se,oe,C),this._add("touchRotate",oe,["touchPan","touchZoom"]),this._add("touchZoom",se,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&n.touchZoomRotate.enable(e.touchZoomRotate);let pe=n.scrollZoom=new bi(n,()=>this._triggerRenderFrame());this._add("scrollZoom",pe,["mousePan"]),e.interactive&&e.scrollZoom&&n.scrollZoom.enable(e.scrollZoom);let ve=n.keyboard=new Ll(n);this._add("keyboard",ve),e.interactive&&e.keyboard&&n.keyboard.enable(),this._add("blockableMapEvent",new wd(n))}_add(e,n,h){this._handlers.push({handlerName:e,handler:n,allowed:h}),this._handlersById[e]=n}stop(e){if(!this._updatingCamera){for(let{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(let{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!fc(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,n,h){for(let d in e)if(d!==h&&(!n||n.indexOf(d)<0))return!0;return!1}_getMapTouches(e){let n=[];for(let h of e)this._el.contains(h.target)&&n.push(h);return n}mergeHandlerResult(e,n,h,d,y){if(!h)return;a.e(e,h);let b={handlerName:d,originalEvent:h.originalEvent||y};h.zoomDelta!==void 0&&(n.zoom=b),h.panDelta!==void 0&&(n.drag=b),h.rollDelta!==void 0&&(n.roll=b),h.pitchDelta!==void 0&&(n.pitch=b),h.bearingDelta!==void 0&&(n.rotate=b)}_applyChanges(){let e={},n={},h={};for(let[d,y,b]of this._changes)d.panDelta&&(e.panDelta=(e.panDelta||new a.P(0,0))._add(d.panDelta)),d.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+d.zoomDelta),d.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+d.bearingDelta),d.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+d.pitchDelta),d.rollDelta&&(e.rollDelta=(e.rollDelta||0)+d.rollDelta),d.around!==void 0&&(e.around=d.around),d.pinchAround!==void 0&&(e.pinchAround=d.pinchAround),d.noInertia&&(e.noInertia=d.noInertia),a.e(n,y),a.e(h,b);this._updateMapTransform(e,n,h),this._changes=[]}_updateMapTransform(e,n,h){let d=this._map,y=d._getTransformForUpdate(),b=d.terrain;if(!(yu(e)||b&&this._terrainMovement))return this._fireEvents(n,h,!0);d._stop(!0);let{panDelta:S,zoomDelta:C,bearingDelta:k,pitchDelta:R,rollDelta:j,around:N,pinchAround:q}=e;q!==void 0&&(N=q),N=N||d.transform.centerPoint,b&&!y.isPointOnMapSurface(N)&&(N=y.centerPoint);let H={panDelta:S,zoomDelta:C,rollDelta:j,pitchDelta:R,bearingDelta:k,around:N};this._map.cameraHelper.useGlobeControls&&!y.isPointOnMapSurface(N)&&(N=y.centerPoint);let ae=N.distSqr(y.centerPoint)<.01?y.center:y.screenPointToLocation(S?N.sub(S):N);b?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(H,y),this._terrainMovement||!n.drag&&!n.zoom?n.drag&&this._terrainMovement?y.setCenter(y.screenPointToLocation(y.centerPoint.sub(S))):this._map.cameraHelper.handleMapControlsPan(H,y,ae):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(H,y,ae))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(H,y),this._map.cameraHelper.handleMapControlsPan(H,y,ae)),d._applyUpdatedTransform(y),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(n,h,!0)}_fireEvents(e,n,h){let d=fc(this._eventsInProgress),y=fc(e),b={};for(let j in e){let{originalEvent:N}=e[j];this._eventsInProgress[j]||(b[`${j}start`]=N),this._eventsInProgress[j]=e[j]}!d&&y&&this._fireEvent("movestart",y.originalEvent);for(let j in b)this._fireEvent(j,b[j]);y&&this._fireEvent("move",y.originalEvent);for(let j in e){let{originalEvent:N}=e[j];this._fireEvent(j,N)}let S={},C;for(let j in this._eventsInProgress){let{handlerName:N,originalEvent:q}=this._eventsInProgress[j];this._handlersById[N].isActive()||(delete this._eventsInProgress[j],C=n[N]||q,S[`${j}end`]=C)}for(let j in S)this._fireEvent(j,S[j]);let k=fc(this._eventsInProgress),R=(d||y)&&!k;if(R&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;let j=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&j.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(j)}if(h&&R){this._updatingCamera=!0;let j=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),N=q=>q!==0&&-this._bearingSnap<q&&q<this._bearingSnap;!j||!j.essential&&W.prefersReducedMotion?(this._map.fire(new a.l("moveend",{originalEvent:C})),N(this._map.getBearing())&&this._map.resetNorth()):(N(j.bearing||this._map.getBearing())&&(j.bearing=0),j.freezeElevation=!0,this._map.easeTo(j,{originalEvent:C})),this._updatingCamera=!1}}_fireEvent(e,n){this._map.fire(new a.l(e,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new vf("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class bf extends a.E{constructor(e,n,h){super(),this._renderFrameCallback=()=>{let d=Math.min((W.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(d)),d<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=h.bearingSnap,this.cameraHelper=n,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(e,n){e.apply(this.transform),this.transform=e,this.cameraHelper=n}getCenter(){return new a.Q(this.transform.center.lng,this.transform.center.lat)}setCenter(e,n){return this.jumpTo({center:e},n)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,n){return this.jumpTo({elevation:e},n),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,n,h){return e=a.P.convert(e).mult(-1),this.panTo(this.transform.center,a.e({offset:e},n),h)}panTo(e,n,h){return this.easeTo(a.e({center:e},n),h)}getZoom(){return this.transform.zoom}setZoom(e,n){return this.jumpTo({zoom:e},n),this}zoomTo(e,n,h){return this.easeTo(a.e({zoom:e},n),h)}zoomIn(e,n){return this.zoomTo(this.getZoom()+1,e,n),this}zoomOut(e,n){return this.zoomTo(this.getZoom()-1,e,n),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,n){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new a.l("movestart",n)).fire(new a.l("move",n)).fire(new a.l("moveend",n))),this}getBearing(){return this.transform.bearing}setBearing(e,n){return this.jumpTo({bearing:e},n),this}getPadding(){return this.transform.padding}setPadding(e,n){return this.jumpTo({padding:e},n),this}rotateTo(e,n,h){return this.easeTo(a.e({bearing:e},n),h)}resetNorth(e,n){return this.rotateTo(0,a.e({duration:1e3},e),n),this}resetNorthPitch(e,n){return this.easeTo(a.e({bearing:0,pitch:0,roll:0,duration:1e3},e),n),this}snapToNorth(e,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,n):this}getPitch(){return this.transform.pitch}setPitch(e,n){return this.jumpTo({pitch:e},n),this}getRoll(){return this.transform.roll}setRoll(e,n){return this.jumpTo({roll:e},n),this}cameraForBounds(e,n){e=_i.convert(e).adjustAntiMeridian();let h=n&&n.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),h,n)}_cameraForBoxAndBearing(e,n,h,d){let y={top:0,bottom:0,right:0,left:0};if(typeof(d=a.e({padding:y,offset:[0,0],maxZoom:this.transform.maxZoom},d)).padding=="number"){let k=d.padding;d.padding={top:k,bottom:k,right:k,left:k}}let b=a.e(y,d.padding);d.padding=b;let S=this.transform,C=new _i(e,n);return this.cameraHelper.cameraForBoxAndBearing(d,b,C,h,S)}fitBounds(e,n,h){return this._fitInternal(this.cameraForBounds(e,n),n,h)}fitScreenCoordinates(e,n,h,d,y){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(a.P.convert(e)),this.transform.screenPointToLocation(a.P.convert(n)),h,d),d,y)}_fitInternal(e,n,h){return e?(delete(n=a.e(e,n)).padding,n.linear?this.easeTo(n,h):this.flyTo(n,h)):this}jumpTo(e,n){this.stop();let h=this._getTransformForUpdate(),d=!1,y=!1,b=!1,S=h.zoom;this.cameraHelper.handleJumpToCenterZoom(h,e);let C=h.zoom!==S;return"elevation"in e&&h.elevation!==+e.elevation&&h.setElevation(+e.elevation),"bearing"in e&&h.bearing!==+e.bearing&&(d=!0,h.setBearing(+e.bearing)),"pitch"in e&&h.pitch!==+e.pitch&&(y=!0,h.setPitch(+e.pitch)),"roll"in e&&h.roll!==+e.roll&&(b=!0,h.setRoll(+e.roll)),e.padding==null||h.isPaddingEqual(e.padding)||h.setPadding(e.padding),this._applyUpdatedTransform(h),this.fire(new a.l("movestart",n)).fire(new a.l("move",n)),C&&this.fire(new a.l("zoomstart",n)).fire(new a.l("zoom",n)).fire(new a.l("zoomend",n)),d&&this.fire(new a.l("rotatestart",n)).fire(new a.l("rotate",n)).fire(new a.l("rotateend",n)),y&&this.fire(new a.l("pitchstart",n)).fire(new a.l("pitch",n)).fire(new a.l("pitchend",n)),b&&this.fire(new a.l("rollstart",n)).fire(new a.l("roll",n)).fire(new a.l("rollend",n)),this.fire(new a.l("moveend",n))}calculateCameraOptionsFromTo(e,n,h,d=0){let y=a.$.fromLngLat(e,n),b=a.$.fromLngLat(h,d),S=b.x-y.x,C=b.y-y.y,k=b.z-y.z,R=Math.hypot(S,C,k);if(R===0)throw new Error("Can't calculate camera options with same From and To");let j=Math.hypot(S,C),N=a.ah(this.transform.cameraToCenterDistance/R/this.transform.tileSize),q=180*Math.atan2(S,-C)/Math.PI,H=180*Math.acos(j/R)/Math.PI;return H=k<0?90-H:90+H,{center:b.toLngLat(),elevation:d,zoom:N,pitch:H,bearing:q}}calculateCameraOptionsFromCameraLngLatAltRotation(e,n,h,d,y){let b=this.transform.calculateCenterFromCameraLngLatAlt(e,n,h,d);return{center:b.center,elevation:b.elevation,zoom:b.zoom,bearing:h,pitch:d,roll:y}}easeTo(e,n){this._stop(!1,e.easeId),((e=a.e({offset:[0,0],duration:500,easing:a.cf},e)).animate===!1||!e.essential&&W.prefersReducedMotion)&&(e.duration=0);let h=this._getTransformForUpdate(),d=this.getBearing(),y=h.pitch,b=h.roll,S="bearing"in e?this._normalizeBearing(e.bearing,d):d,C="pitch"in e?+e.pitch:y,k="roll"in e?this._normalizeBearing(e.roll,b):b,R="padding"in e?e.padding:h.padding,j=a.P.convert(e.offset),N,q;e.around&&(N=a.Q.convert(e.around),q=h.locationToScreenPoint(N));let H={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},ae=this.cameraHelper.handleEaseTo(h,{bearing:S,pitch:C,roll:k,padding:R,around:N,aroundPoint:q,offsetAsPoint:j,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||d!==S,this._pitching=this._pitching||C!==y,this._rolling=this._rolling||k!==b,this._padding=!h.isPaddingEqual(R),this._zooming=this._zooming||ae.isZooming,this._easeId=e.easeId,this._prepareEase(n,e.noMoveStart,H),this.terrain&&this._prepareElevation(ae.elevationCenter),this._ease(oe=>{ae.easeFunc(oe),this.terrain&&!e.freezeElevation&&this._updateElevation(oe),this._applyUpdatedTransform(h),this._fireMoveEvents(n)},oe=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(n,oe)},e),this}_prepareEase(e,n,h={}){this._moving=!0,n||h.moving||this.fire(new a.l("movestart",e)),this._zooming&&!h.zooming&&this.fire(new a.l("zoomstart",e)),this._rotating&&!h.rotating&&this.fire(new a.l("rotatestart",e)),this._pitching&&!h.pitching&&this.fire(new a.l("pitchstart",e)),this._rolling&&!h.rolling&&this.fire(new a.l("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));let n=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&n!==this._elevationTarget){let h=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(h-(n-(h*e+this._elevationStart))/(1-e)),this._elevationTarget=n}this.transform.setElevation(a.B.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};let n=e.getCameraLngLat(),h=e.getCameraAltitude(),d=this.terrain?this.terrain.getElevationForLngLatZoom(n,e.zoom):0;if(h<d){let y=this.calculateCameraOptionsFromTo(n,d,e.center,e.elevation);return{pitch:y.pitch,zoom:y.zoom}}return{}}_applyUpdatedTransform(e){let n=[];if(n.push(d=>this._elevateCameraIfInsideTerrain(d)),this.transformCameraUpdate&&n.push(d=>this.transformCameraUpdate(d)),!n.length)return;let h=e.clone();for(let d of n){let y=h.clone(),{center:b,zoom:S,roll:C,pitch:k,bearing:R,elevation:j}=d(y);b&&y.setCenter(b),j!==void 0&&y.setElevation(j),S!==void 0&&y.setZoom(S),C!==void 0&&y.setRoll(C),k!==void 0&&y.setPitch(k),R!==void 0&&y.setBearing(R),h.apply(y)}this.transform.apply(h)}_fireMoveEvents(e){this.fire(new a.l("move",e)),this._zooming&&this.fire(new a.l("zoom",e)),this._rotating&&this.fire(new a.l("rotate",e)),this._pitching&&this.fire(new a.l("pitch",e)),this._rolling&&this.fire(new a.l("roll",e))}_afterEase(e,n){if(this._easeId&&n&&this._easeId===n)return;delete this._easeId;let h=this._zooming,d=this._rotating,y=this._pitching,b=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,h&&this.fire(new a.l("zoomend",e)),d&&this.fire(new a.l("rotateend",e)),y&&this.fire(new a.l("pitchend",e)),b&&this.fire(new a.l("rollend",e)),this.fire(new a.l("moveend",e))}flyTo(e,n){if(!e.essential&&W.prefersReducedMotion){let Qe=a.O(e,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(Qe,n)}this.stop(),e=a.e({offset:[0,0],speed:1.2,curve:1.42,easing:a.cf},e);let h=this._getTransformForUpdate(),d=h.bearing,y=h.pitch,b=h.roll,S=h.padding,C="bearing"in e?this._normalizeBearing(e.bearing,d):d,k="pitch"in e?+e.pitch:y,R="roll"in e?this._normalizeBearing(e.roll,b):b,j="padding"in e?e.padding:h.padding,N=a.P.convert(e.offset),q=h.centerPoint.add(N),H=h.screenPointToLocation(q),ae=this.cameraHelper.handleFlyTo(h,{bearing:C,pitch:k,roll:R,padding:j,locationAtOffset:H,offsetAsPoint:N,center:e.center,minZoom:e.minZoom,zoom:e.zoom}),oe=e.curve,se=Math.max(h.width,h.height),pe=se/ae.scaleOfZoom,ve=ae.pixelPathLength;typeof ae.scaleOfMinZoom=="number"&&(oe=Math.sqrt(se/ae.scaleOfMinZoom/ve*2));let ye=oe*oe;function we(Qe){let vt=(pe*pe-se*se+(Qe?-1:1)*ye*ye*ve*ve)/(2*(Qe?pe:se)*ye*ve);return Math.log(Math.sqrt(vt*vt+1)-vt)}function Le(Qe){return(Math.exp(Qe)-Math.exp(-Qe))/2}function Pe(Qe){return(Math.exp(Qe)+Math.exp(-Qe))/2}let $e=we(!1),tt=function(Qe){return Pe($e)/Pe($e+oe*Qe)},He=function(Qe){return se*((Pe($e)*(Le(vt=$e+oe*Qe)/Pe(vt))-Le($e))/ye)/ve;var vt},Ke=(we(!0)-$e)/oe;if(Math.abs(ve)<2e-6||!isFinite(Ke)){if(Math.abs(se-pe)<1e-6)return this.easeTo(e,n);let Qe=pe<se?-1:1;Ke=Math.abs(Math.log(pe/se))/oe,He=()=>0,tt=vt=>Math.exp(Qe*oe*vt)}return e.duration="duration"in e?+e.duration:1e3*Ke/("screenSpeed"in e?+e.screenSpeed/oe:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=d!==C,this._pitching=k!==y,this._rolling=R!==b,this._padding=!h.isPaddingEqual(j),this._prepareEase(n,!1),this.terrain&&this._prepareElevation(ae.targetCenter),this._ease(Qe=>{let vt=Qe*Ke,gt=1/tt(vt),ct=He(vt);this._rotating&&h.setBearing(a.B.number(d,C,Qe)),this._pitching&&h.setPitch(a.B.number(y,k,Qe)),this._rolling&&h.setRoll(a.B.number(b,R,Qe)),this._padding&&(h.interpolatePadding(S,j,Qe),q=h.centerPoint.add(N)),ae.easeFunc(Qe,gt,ct,q),this.terrain&&!e.freezeElevation&&this._updateElevation(Qe),this._applyUpdatedTransform(h),this._fireMoveEvents(n)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(n)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,n){var h;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){let d=this._onEaseEnd;delete this._onEaseEnd,d.call(this,n)}return e||(h=this.handlers)===null||h===void 0||h.stop(!1),this}_ease(e,n,h){h.animate===!1||h.duration===0?(e(1),n()):(this._easeStart=W.now(),this._easeOptions=h,this._onEaseFrame=e,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,n){e=a.aL(e,-180,180);let h=Math.abs(e-n);return Math.abs(e-360-n)<h&&(e-=360),Math.abs(e+360-n)<h&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(a.Q.convert(e),this.transform.tileZoom):null}}let Fa={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class sn{constructor(e=Fa){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=n=>{!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"&&n.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=V.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=V.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=V.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){V.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,n){let h=this._map._getUIString(`AttributionControl.${n}`);e.title=h,e.setAttribute("aria-label",h)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(d=>typeof d!="string"?"":d)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){let d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}let n=this._map.style.sourceCaches;for(let d in n){let y=n[d];if(y.used||y.usedForTerrain){let b=y.getSource();b.attribution&&e.indexOf(b.attribution)<0&&e.push(b.attribution)}}e=e.filter(d=>String(d).trim()),e.sort((d,y)=>d.length-y.length),e=e.filter((d,y)=>{for(let b=y+1;b<e.length;b++)if(e[b].indexOf(d)>=0)return!1;return!0});let h=e.join(" | ");h!==this._attribHTML&&(this._attribHTML=h,e.length?(this._innerContainer.innerHTML=V.sanitize(h),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class mc{constructor(e={}){this._updateCompact=()=>{let n=this._container.children;if(n.length){let h=n[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&h.classList.add("maplibregl-compact"):h.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=V.create("div","maplibregl-ctrl");let n=V.create("a","maplibregl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://maplibre.org/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){V.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class hh{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){let n=++this._id;return this._queue.push({callback:e,id:n,cancelled:!1}),n}remove(e){let n=this._currentlyRunning,h=n?this._queue.concat(n):this._queue;for(let d of h)if(d.id===e)return void(d.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");let n=this._currentlyRunning=this._queue;this._queue=[];for(let h of n)if(!h.cancelled&&(h.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Id=a.aG([{name:"a_pos3d",type:"Int16",components:3}]);class Ed extends a.E{constructor(e){super(),this._lastTilesetChange=W.now(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,n){this.sourceCache.update(e,n),this._renderableTilesKeys=[];let h={};for(let d of ke(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:n,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))h[d.key]=!0,this._renderableTilesKeys.push(d.key),this._tiles[d.key]||(d.terrainRttPosMatrix32f=new Float64Array(16),a.bQ(d.terrainRttPosMatrix32f,0,a.Z,a.Z,0,0,1),this._tiles[d.key]=new qr(d,this.tileSize),this._lastTilesetChange=W.now());for(let d in this._tiles)h[d]||delete this._tiles[d]}freeRtt(e){for(let n in this._tiles){let h=this._tiles[n];(!e||h.tileID.equals(e)||h.tileID.isChildOf(e)||e.isChildOf(h.tileID))&&(h.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e,n){return n?this._getTerrainCoordsForTileRanges(e,n):this._getTerrainCoordsForRegularTile(e)}_getTerrainCoordsForRegularTile(e){let n={};for(let h of this._renderableTilesKeys){let d=this._tiles[h].tileID,y=e.clone(),b=a.b2();if(d.canonical.equals(e.canonical))a.bQ(b,0,a.Z,a.Z,0,0,1);else if(d.canonical.isChildOf(e.canonical)){let S=d.canonical.z-e.canonical.z,C=d.canonical.x-(d.canonical.x>>S<<S),k=d.canonical.y-(d.canonical.y>>S<<S),R=a.Z>>S;a.bQ(b,0,R,R,0,0,1),a.L(b,b,[-C*R,-k*R,0])}else{if(!e.canonical.isChildOf(d.canonical))continue;{let S=e.canonical.z-d.canonical.z,C=e.canonical.x-(e.canonical.x>>S<<S),k=e.canonical.y-(e.canonical.y>>S<<S),R=a.Z>>S;a.bQ(b,0,a.Z,a.Z,0,0,1),a.L(b,b,[C*R,k*R,0]),a.M(b,b,[1/2**S,1/2**S,0])}}y.terrainRttPosMatrix32f=new Float32Array(b),n[h]=y}return n}_getTerrainCoordsForTileRanges(e,n){let h={};for(let d of this._renderableTilesKeys){let y=this._tiles[d].tileID;if(!this._isWithinTileRanges(y,n))continue;let b=e.clone(),S=a.b2();if(y.canonical.z===e.canonical.z){let C=e.canonical.x-y.canonical.x,k=e.canonical.y-y.canonical.y;a.bQ(S,0,a.Z,a.Z,0,0,1),a.L(S,S,[C*a.Z,k*a.Z,0])}else if(y.canonical.z>e.canonical.z){let C=y.canonical.z-e.canonical.z,k=y.canonical.x-(y.canonical.x>>C<<C),R=y.canonical.y-(y.canonical.y>>C<<C),j=e.canonical.x-(y.canonical.x>>C),N=e.canonical.y-(y.canonical.y>>C),q=a.Z>>C;a.bQ(S,0,q,q,0,0,1),a.L(S,S,[-k*q+j*a.Z,-R*q+N*a.Z,0])}else{let C=e.canonical.z-y.canonical.z,k=e.canonical.x-(e.canonical.x>>C<<C),R=e.canonical.y-(e.canonical.y>>C<<C),j=(e.canonical.x>>C)-y.canonical.x,N=(e.canonical.y>>C)-y.canonical.y,q=a.Z<<C;a.bQ(S,0,q,q,0,0,1),a.L(S,S,[k*a.Z+j*q,R*a.Z+N*q,0])}b.terrainRttPosMatrix32f=new Float32Array(S),h[d]=b}return h}getSourceTile(e,n){let h=this.sourceCache._source,d=e.overscaledZ-this.deltaZoom;if(d>h.maxzoom&&(d=h.maxzoom),d<h.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(d).key);let y=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!y||!y.dem)&&n)for(;d>=h.minzoom&&(!y||!y.dem);)y=this.sourceCache.getTileByID(e.scaledTo(d--).key);return y}anyTilesAfterTime(e=Date.now()){return this._lastTilesetChange>=e}_isWithinTileRanges(e,n){return n[e.canonical.z]&&e.canonical.x>=n[e.canonical.z].minTileX&&e.canonical.x<=n[e.canonical.z].maxTileX&&e.canonical.y>=n[e.canonical.z].minTileY&&e.canonical.y<=n[e.canonical.z].maxTileY}}class Ld{constructor(e,n,h){this._meshCache={},this.painter=e,this.sourceCache=new Ed(n),this.options=h,this.exaggeration=typeof h.exaggeration=="number"?h.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,n,h,d=a.Z){var y;if(!(n>=0&&n<d&&h>=0&&h<d))return 0;let b=this.getTerrainData(e),S=(y=b.tile)===null||y===void 0?void 0:y.dem;if(!S)return 0;let C=a.cj([],[n/d*a.Z,h/d*a.Z],b.u_terrain_matrix),k=[C[0]*S.dim,C[1]*S.dim],R=Math.floor(k[0]),j=Math.floor(k[1]),N=k[0]-R,q=k[1]-j;return S.get(R,j)*(1-N)*(1-q)+S.get(R+1,j)*N*(1-q)+S.get(R,j+1)*(1-N)*q+S.get(R+1,j+1)*N*q}getElevationForLngLatZoom(e,n){if(!a.ck(n,e.wrap()))return 0;let{tileID:h,mercatorX:d,mercatorY:y}=this._getOverscaledTileIDFromLngLatZoom(e,n);return this.getElevation(h,d%a.Z,y%a.Z,a.Z)}getElevation(e,n,h,d=a.Z){return this.getDEMElevation(e,n,h,d)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){let d=this.painter.context,y=new a.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new kt(d,y,d.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new kt(d,new a.R({width:1,height:1}),d.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(d.gl.NEAREST,d.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.ad([])}let n=this.sourceCache.getSourceTile(e,!0);if(n&&n.dem&&(!n.demTexture||n.needsTerrainPrepare)){let d=this.painter.context;n.demTexture=this.painter.getTileTexture(n.dem.stride),n.demTexture?n.demTexture.update(n.dem.getPixels(),{premultiply:!1}):n.demTexture=new kt(d,n.dem.getPixels(),d.gl.RGBA,{premultiply:!1}),n.demTexture.bind(d.gl.NEAREST,d.gl.CLAMP_TO_EDGE),n.needsTerrainPrepare=!1}let h=n&&n+n.tileID.key+e.key;if(h&&!this._demMatrixCache[h]){let d=this.sourceCache.sourceCache._source.maxzoom,y=e.canonical.z-n.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=d?y=e.canonical.z-d:a.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));let b=e.canonical.x-(e.canonical.x>>y<<y),S=e.canonical.y-(e.canonical.y>>y<<y),C=a.cl(new Float64Array(16),[1/(a.Z<<y),1/(a.Z<<y),0]);a.L(C,C,[b*a.Z,S*a.Z,0]),this._demMatrixCache[e.key]={matrix:C,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:n&&n.dem&&n.dem.dim||1,u_terrain_matrix:h?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:n&&n.dem&&n.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(n&&n.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:n}}getFramebuffer(e){let n=this.painter,h=n.width/devicePixelRatio,d=n.height/devicePixelRatio;return!this._fbo||this._fbo.width===h&&this._fbo.height===d||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new kt(n.context,{width:h,height:d,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new kt(n.context,{width:h,height:d,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=n.context.createFramebuffer(h,d,!0,!1),this._fbo.depthAttachment.set(n.context.createRenderbuffer(n.context.gl.DEPTH_COMPONENT16,h,d))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){let e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;let n=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let y=0,b=0;y<this._coordsTextureSize;y++)for(let S=0;S<this._coordsTextureSize;S++,b+=4)n[b+0]=255&S,n[b+1]=255&y,n[b+2]=S>>8<<4|y>>8,n[b+3]=0;let h=new a.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(n.buffer)),d=new kt(e,h,e.gl.RGBA,{premultiply:!1});return d.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=d,d}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);let n=new Uint8Array(4),h=this.painter.context,d=h.gl,y=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),b=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),S=Math.round(this.painter.height/devicePixelRatio);h.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),d.readPixels(y,S-b-1,1,1,d.RGBA,d.UNSIGNED_BYTE,n),h.bindFramebuffer.set(null);let C=n[0]+(n[2]>>4<<8),k=n[1]+((15&n[2])<<8),R=this.coordsIndex[255-n[3]],j=R&&this.sourceCache.getTileByID(R);if(!j)return null;let N=this._coordsTextureSize,q=(1<<j.tileID.canonical.z)*N;return new a.$((j.tileID.canonical.x*N+C)/q+j.tileID.wrap,(j.tileID.canonical.y*N+k)/q,this.getElevation(j.tileID,C,k,N))}depthAtPoint(e){let n=new Uint8Array(4),h=this.painter.context,d=h.gl;return h.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),d.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,d.RGBA,d.UNSIGNED_BYTE,n),h.bindFramebuffer.set(null),(n[0]/16777216+n[1]/65536+n[2]/256+n[3])/256}getTerrainMesh(e){var n;let h=((n=this.painter.style.projection)===null||n===void 0?void 0:n.transitionState)>0,d=h&&e.canonical.y===0,y=h&&e.canonical.y===(1<<e.canonical.z)-1,b=`m_${d?"n":""}_${y?"s":""}`;if(this._meshCache[b])return this._meshCache[b];let S=this.painter.context,C=new a.cm,k=new a.aK,R=this.meshSize,j=a.Z/R,N=R*R;for(let Pe=0;Pe<=R;Pe++)for(let $e=0;$e<=R;$e++)C.emplaceBack($e*j,Pe*j,0);for(let Pe=0;Pe<N;Pe+=R+1)for(let $e=0;$e<R;$e++)k.emplaceBack($e+Pe,R+$e+Pe+1,R+$e+Pe+2),k.emplaceBack($e+Pe,R+$e+Pe+2,$e+Pe+1);let q=C.length,H=q+(R+1),ae=(R+1)*R,oe=d?a.b9:0,se=d?0:1,pe=y?a.ba:a.Z,ve=y?0:1;for(let Pe=0;Pe<=R;Pe++)C.emplaceBack(Pe*j,oe,se);for(let Pe=0;Pe<=R;Pe++)C.emplaceBack(Pe*j,pe,ve);for(let Pe=0;Pe<R;Pe++)k.emplaceBack(ae+Pe,H+Pe,H+Pe+1),k.emplaceBack(ae+Pe,H+Pe+1,ae+Pe+1),k.emplaceBack(0+Pe,q+Pe+1,q+Pe),k.emplaceBack(0+Pe,0+Pe+1,q+Pe+1);let ye=C.length,we=ye+2*(R+1);for(let Pe of[0,1])for(let $e=0;$e<=R;$e++)for(let tt of[0,1])C.emplaceBack(Pe*a.Z,$e*j,tt);for(let Pe=0;Pe<2*R;Pe+=2)k.emplaceBack(ye+Pe,ye+Pe+1,ye+Pe+3),k.emplaceBack(ye+Pe,ye+Pe+3,ye+Pe+2),k.emplaceBack(we+Pe,we+Pe+3,we+Pe+1),k.emplaceBack(we+Pe,we+Pe+2,we+Pe+3);let Le=new go(S.createVertexBuffer(C,Id.members),S.createIndexBuffer(k),a.aJ.simpleSegment(0,0,C.length,k.length));return this._meshCache[b]=Le,Le}getMeshFrameDelta(e){return 2*Math.PI*a.bu/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,n){var h;let{tileID:d}=this._getOverscaledTileIDFromLngLatZoom(e,n);return(h=this.getMinMaxElevation(d).minElevation)!==null&&h!==void 0?h:0}getMinMaxElevation(e){let n=this.getTerrainData(e).tile,h={minElevation:null,maxElevation:null};return n&&n.dem&&(h.minElevation=n.dem.min*this.exaggeration,h.maxElevation=n.dem.max*this.exaggeration),h}_getOverscaledTileIDFromLngLatZoom(e,n){let h=a.$.fromLngLat(e.wrap()),d=(1<<n)*a.Z,y=h.x*d,b=h.y*d,S=Math.floor(y/a.Z),C=Math.floor(b/a.Z);return{tileID:new a.Y(n,0,n,S,C),mercatorX:y,mercatorY:b}}}class wf{constructor(e,n,h){this._context=e,this._size=n,this._tileSize=h,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(let e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){let n=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),h=new kt(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return h.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),n.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),n.colorAttachment.set(h.texture),{id:e,fbo:n,texture:h,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(n=>e.id!==n),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(let n of this._recentlyUsed)if(!this._objects[n].inUse)return this._objects[n];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");let e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(let e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}let Ur={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class vu{constructor(e,n){this.painter=e,this.terrain=n,this.pool=new wf(e.context,30,n.sourceCache.tileSize*n.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,n){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(h=>!e._layers[h].isHidden(n)),this._coordsAscending={};for(let h in e.sourceCaches){this._coordsAscending[h]={};let d=e.sourceCaches[h].getVisibleCoordinates(),y=e.sourceCaches[h].getSource(),b=y instanceof jn?y.terrainTileRanges:null;for(let S of d){let C=this.terrain.sourceCache.getTerrainCoords(S,b);for(let k in C)this._coordsAscending[h][k]||(this._coordsAscending[h][k]=[]),this._coordsAscending[h][k].push(C[k])}}this._coordsAscendingStr={};for(let h of e._order){let d=e._layers[h],y=d.source;if(Ur[d.type]&&!this._coordsAscendingStr[y]){this._coordsAscendingStr[y]={};for(let b in this._coordsAscending[y])this._coordsAscendingStr[y][b]=this._coordsAscending[y][b].map(S=>S.key).sort().join()}}for(let h of this._renderableTiles)for(let d in this._coordsAscendingStr){let y=this._coordsAscendingStr[d][h.tileID.key];y&&y!==h.rttCoords[d]&&(h.rtt=[])}}renderLayer(e,n){if(e.isHidden(this.painter.transform.zoom))return!1;let h=Object.assign(Object.assign({},n),{isRenderingToTexture:!0}),d=e.type,y=this.painter,b=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(Ur[d]&&(this._prevType&&Ur[this._prevType]||this._stacks.push([]),this._prevType=d,this._stacks[this._stacks.length-1].push(e.id),!b))return!0;if(Ur[this._prevType]||Ur[d]&&b){this._prevType=d;let S=this._stacks.length-1,C=this._stacks[S]||[];for(let k of this._renderableTiles){if(this.pool.isFull()&&(na(this.painter,this.terrain,this._rttTiles,h),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(k),k.rtt[S]){let j=this.pool.getObjectForId(k.rtt[S].id);if(j.stamp===k.rtt[S].stamp){this.pool.useObject(j);continue}}let R=this.pool.getOrCreateFreeObject();this.pool.useObject(R),this.pool.stampObject(R),k.rtt[S]={id:R.id,stamp:R.stamp},y.context.bindFramebuffer.set(R.fbo.framebuffer),y.context.clear({color:a.b7.transparent,stencil:0}),y.currentStencilSource=void 0;for(let j=0;j<C.length;j++){let N=y.style._layers[C[j]],q=N.source?this._coordsAscending[N.source][k.tileID.key]:[k.tileID];y.context.viewport.set([0,0,R.fbo.width,R.fbo.height]),y._renderTileClippingMasks(N,q,!0),y.renderLayer(y,y.style.sourceCaches[N.source],N,q,h),N.source&&(k.rttCoords[N.source]=this._coordsAscendingStr[N.source][k.tileID.key])}}return na(this.painter,this.terrain,this._rttTiles,h),this._rttTiles=[],this.pool.freeAllObjects(),Ur[d]}return!1}}let Rt={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use \u2318 + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Wt=P,gc={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Fa,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:a.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},dh={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class ph{constructor(e,n,h=!1){this.mousedown=y=>{this.startMove(y,V.mousePos(this.element,y)),V.addEventListener(window,"mousemove",this.mousemove),V.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=y=>{this.move(y,V.mousePos(this.element,y))},this.mouseup=y=>{this._rotatePitchHanlder.dragEnd(y),this.offTemp()},this.touchstart=y=>{y.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=V.touchPos(this.element,y.targetTouches)[0],this.startMove(y,this._startPos),V.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),V.addEventListener(window,"touchend",this.touchend))},this.touchmove=y=>{y.targetTouches.length!==1?this.reset():(this._lastPos=V.touchPos(this.element,y.targetTouches)[0],this.move(y,this._lastPos))},this.touchend=y=>{y.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHanlder.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=n;let d=new Il;this._rotatePitchHanlder=new Er({clickTolerance:3,move:(y,b)=>{let S=n.getBoundingClientRect(),C=new a.P((S.bottom-S.top)/2,(S.right-S.left)/2);return{bearingDelta:a.ce(new a.P(y.x,b.y),b,C),pitchDelta:h?-.5*(b.y-y.y):void 0}},moveStateManager:d,enable:!0,assignEvents:()=>{}}),this.map=e,V.addEventListener(n,"mousedown",this.mousedown),V.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),V.addEventListener(n,"touchcancel",this.reset)}startMove(e,n){this._rotatePitchHanlder.dragStart(e,n),V.disableDrag()}move(e,n){let h=this.map,{bearingDelta:d,pitchDelta:y}=this._rotatePitchHanlder.dragMove(e,n)||{};d&&h.setBearing(h.getBearing()+d),y&&h.setPitch(h.getPitch()+y)}off(){let e=this.element;V.removeEventListener(e,"mousedown",this.mousedown),V.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),V.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),V.removeEventListener(window,"touchend",this.touchend),V.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){V.enableDrag(),V.removeEventListener(window,"mousemove",this.mousemove),V.removeEventListener(window,"mouseup",this.mouseup),V.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),V.removeEventListener(window,"touchend",this.touchend)}}let Gn;function fh(_,e,n,h=!1){if(h||!n.getCoveringTilesDetailsProvider().allowWorldCopies())return _?.wrap();let d=new a.Q(_.lng,_.lat);if(_=new a.Q(_.lng,_.lat),e){let y=new a.Q(_.lng-360,_.lat),b=new a.Q(_.lng+360,_.lat),S=n.locationToScreenPoint(_).distSqr(e);n.locationToScreenPoint(y).distSqr(e)<S?_=y:n.locationToScreenPoint(b).distSqr(e)<S&&(_=b)}for(;Math.abs(_.lng-n.center.lng)>180;){let y=n.locationToScreenPoint(_);if(y.x>=0&&y.y>=0&&y.x<=n.width&&y.y<=n.height)break;_.lng>n.center.lng?_.lng-=360:_.lng+=360}return _.lng!==d.lng&&n.isPointOnMapSurface(n.locationToScreenPoint(_))?_:d}let wo={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ad(_,e,n){let h=_.classList;for(let d in wo)h.remove(`maplibregl-${n}-anchor-${d}`);h.add(`maplibregl-${n}-anchor-${e}`)}class Ys extends a.E{constructor(e){if(super(),this._onKeyPress=n=>{let h=n.code,d=n.charCode||n.keyCode;h!=="Space"&&h!=="Enter"&&d!==32&&d!==13||this.togglePopup()},this._onMapClick=n=>{let h=n.originalEvent.target,d=this._element;this._popup&&(h===d||d.contains(h))&&this.togglePopup()},this._update=n=>{if(!this._map)return;let h=this._map.loaded()&&!this._map.isMoving();(n?.type==="terrain"||n?.type==="render"&&!h)&&this._map.once("render",this._update),this._lngLat=fh(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let d="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?d=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(d=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let y="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?y="rotateX(0deg)":this._pitchAlignment==="map"&&(y=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||n&&n.type!=="moveend"||(this._pos=this._pos.round()),V.setTransform(this._element,`${wo[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${y} ${d}`),W.frameAsync(new AbortController).then(()=>{this._updateOpacity(n&&n.type==="moveend")}).catch(()=>{})},this._onMove=n=>{if(!this._isDragging){let h=this._clickTolerance||this._map._clickTolerance;this._isDragging=n.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=n.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.l("dragstart"))),this.fire(new a.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.l("dragend")),this._state="inactive"},this._addDragHandler=n=>{this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(this._pos).add(this._offset),this._pointerdownPos=n.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(e?.opacity,e?.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=a.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=V.create("div");let n=V.createNS("http://www.w3.org/2000/svg","svg"),h=41,d=27;n.setAttributeNS(null,"display","block"),n.setAttributeNS(null,"height",`${h}px`),n.setAttributeNS(null,"width",`${d}px`),n.setAttributeNS(null,"viewBox",`0 0 ${d} ${h}`);let y=V.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"stroke","none"),y.setAttributeNS(null,"stroke-width","1"),y.setAttributeNS(null,"fill","none"),y.setAttributeNS(null,"fill-rule","evenodd");let b=V.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"fill-rule","nonzero");let S=V.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"transform","translate(3.0, 29.0)"),S.setAttributeNS(null,"fill","#000000");let C=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(let se of C){let pe=V.createNS("http://www.w3.org/2000/svg","ellipse");pe.setAttributeNS(null,"opacity","0.04"),pe.setAttributeNS(null,"cx","10.5"),pe.setAttributeNS(null,"cy","5.80029008"),pe.setAttributeNS(null,"rx",se.rx),pe.setAttributeNS(null,"ry",se.ry),S.appendChild(pe)}let k=V.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"fill",this._color);let R=V.createNS("http://www.w3.org/2000/svg","path");R.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),k.appendChild(R);let j=V.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"opacity","0.25"),j.setAttributeNS(null,"fill","#000000");let N=V.createNS("http://www.w3.org/2000/svg","path");N.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),j.appendChild(N);let q=V.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"transform","translate(6.0, 7.0)"),q.setAttributeNS(null,"fill","#FFFFFF");let H=V.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"transform","translate(8.0, 8.0)");let ae=V.createNS("http://www.w3.org/2000/svg","circle");ae.setAttributeNS(null,"fill","#000000"),ae.setAttributeNS(null,"opacity","0.25"),ae.setAttributeNS(null,"cx","5.5"),ae.setAttributeNS(null,"cy","5.5"),ae.setAttributeNS(null,"r","5.4999962");let oe=V.createNS("http://www.w3.org/2000/svg","circle");oe.setAttributeNS(null,"fill","#FFFFFF"),oe.setAttributeNS(null,"cx","5.5"),oe.setAttributeNS(null,"cy","5.5"),oe.setAttributeNS(null,"r","5.4999962"),H.appendChild(ae),H.appendChild(oe),b.appendChild(S),b.appendChild(k),b.appendChild(j),b.appendChild(q),b.appendChild(H),n.appendChild(b),n.setAttributeNS(null,"height",h*this._scale+"px"),n.setAttributeNS(null,"width",d*this._scale+"px"),this._element.appendChild(n),this._offset=a.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",n=>{n.preventDefault()}),this._element.addEventListener("mousedown",n=>{n.preventDefault()}),Ad(this._element,this._anchor,"marker"),e&&e.className)for(let n of e.className.split(" "))this._element.classList.add(n);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),V.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=a.Q.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){let d=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(38.1-13.5+d)],"bottom-right":[-d,-1*(38.1-13.5+d)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){let e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var n,h;let d=(n=this._map)===null||n===void 0?void 0:n.terrain,y=this._map.transform.isLocationOccluded(this._lngLat);if(!d||y){let q=y?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==q&&(this._element.style.opacity=q))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}let b=this._map,S=b.terrain.depthAtPoint(this._pos),C=b.terrain.getElevationForLngLatZoom(this._lngLat,b.transform.tileZoom);if(b.transform.lngLatToCameraDepth(this._lngLat,C)-S<.006)return void(this._element.style.opacity=this._opacity);let k=-this._offset.y/b.transform.pixelsPerMeter,R=Math.sin(b.getPitch()*Math.PI/180)*k,j=b.terrain.depthAtPoint(new a.P(this._pos.x,this._pos.y-this._offset.y)),N=b.transform.lngLatToCameraDepth(this._lngLat,C+R)-j>.006;!((h=this._popup)===null||h===void 0)&&h.isOpen()&&N&&this._popup.remove(),this._element.style.opacity=N?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=a.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,n){return(this._opacity===void 0||e===void 0&&n===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),n!==void 0&&(this._opacityWhenCovered=n),this._map&&this._updateOpacity(!0),this}}let Mn={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},_n=0,Al=!1,_c={maxWidth:100,unit:"metric"};function yc(_,e,n){let h=n&&n.maxWidth||100,d=_._container.clientHeight/2,y=_._container.clientWidth/2,b=_.unproject([y-h/2,d]),S=_.unproject([y+h/2,d]),C=Math.round(_.project(S).x-_.project(b).x),k=Math.min(h,C,_._container.clientWidth),R=b.distanceTo(S);if(n&&n.unit==="imperial"){let j=3.2808*R;j>5280?Js(e,k,j/5280,_._getUIString("ScaleControl.Miles")):Js(e,k,j,_._getUIString("ScaleControl.Feet"))}else n&&n.unit==="nautical"?Js(e,k,R/1852,_._getUIString("ScaleControl.NauticalMiles")):R>=1e3?Js(e,k,R/1e3,_._getUIString("ScaleControl.Kilometers")):Js(e,k,R,_._getUIString("ScaleControl.Meters"))}function Js(_,e,n,h){let d=function(y){let b=Math.pow(10,`${Math.floor(y)}`.length-1),S=y/b;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(C){let k=Math.pow(10,Math.ceil(-Math.log(C)/Math.LN10));return Math.round(C*k)/k}(S),b*S}(n);_.style.width=e*(d/n)+"px",_.innerHTML=`${d}&nbsp;${h}`}let mh={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},gh=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function kl(_){if(_){if(typeof _=="number"){let e=Math.round(Math.abs(_)/Math.SQRT2);return{center:new a.P(0,0),top:new a.P(0,_),"top-left":new a.P(e,e),"top-right":new a.P(-e,e),bottom:new a.P(0,-_),"bottom-left":new a.P(e,-e),"bottom-right":new a.P(-e,-e),left:new a.P(_,0),right:new a.P(-_,0)}}if(_ instanceof a.P||Array.isArray(_)){let e=a.P.convert(_);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:a.P.convert(_.center||[0,0]),top:a.P.convert(_.top||[0,0]),"top-left":a.P.convert(_["top-left"]||[0,0]),"top-right":a.P.convert(_["top-right"]||[0,0]),bottom:a.P.convert(_.bottom||[0,0]),"bottom-left":a.P.convert(_["bottom-left"]||[0,0]),"bottom-right":a.P.convert(_["bottom-right"]||[0,0]),left:a.P.convert(_.left||[0,0]),right:a.P.convert(_.right||[0,0])}}return kl(new a.P(0,0))}let _h=P;f.AJAXError=a.cq,f.Event=a.l,f.Evented=a.E,f.LngLat=a.Q,f.MercatorCoordinate=a.$,f.Point=a.P,f.addProtocol=a.cr,f.config=a.a,f.removeProtocol=a.cs,f.AttributionControl=sn,f.BoxZoomHandler=oh,f.CanvasSource=mo,f.CooperativeGesturesHandler=_u,f.DoubleClickZoomHandler=gu,f.DragPanHandler=Md,f.DragRotateHandler=Cd,f.EdgeInsets=Ta,f.FullscreenControl=class extends a.E{constructor(_={}){super(),this._onFullscreenChange=()=>{var e;let n=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=n?.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)n=n.shadowRoot.fullscreenElement;n===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,_&&_.container&&(_.container instanceof HTMLElement?this._container=_.container:a.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(_){return this._map=_,this._container||(this._container=this._map.getContainer()),this._controlContainer=V.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){V.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){let _=this._fullscreenButton=V.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);V.create("span","maplibregl-ctrl-icon",_).setAttribute("aria-hidden","true"),_.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){let _=this._getTitle();this._fullscreenButton.setAttribute("aria-label",_),this._fullscreenButton.title=_}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new a.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new a.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},f.GeoJSONSource=Io,f.GeolocateControl=class extends a.E{constructor(_){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new a.l("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new a.l("geolocate",e)),this._finish()}},this._updateCamera=e=>{let n=new a.Q(e.coords.longitude,e.coords.latitude),h=e.coords.accuracy,d=this._map.getBearing(),y=a.e({bearing:d},this.options.fitBoundsOptions),b=_i.fromLngLat(n,h);this._map.fitBounds(b,y,{geolocateSource:!0})},this._updateMarker=e=>{if(e){let n=new a.Q(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&Al)return;this.options.trackUserLocation&&this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new a.l("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=V.create("button","maplibregl-ctrl-geolocate",this._container),V.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");let n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}else{let n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=V.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Ys({element:this._dotElement}),this._circleElement=V.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ys({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new a.l("trackuserlocationend")),this.fire(new a.l("userlocationlostfocus")))})}},this.options=a.e({},Mn,_)}onAdd(_){return this._map=_,this._container=V.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return a._(this,arguments,void 0,function*(e=!1){if(Gn!==void 0&&!e)return Gn;if(window.navigator.permissions===void 0)return Gn=!!window.navigator.geolocation,Gn;try{Gn=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Gn=!!window.navigator.geolocation}return Gn})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),V.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,_n=0,Al=!1}_isOutOfMapMaxBounds(_){let e=this._map.getMaxBounds(),n=_.coords;return e&&(n.longitude<e.getWest()||n.longitude>e.getEast()||n.latitude<e.getSouth()||n.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){let _=this._map.getBounds(),e=_.getSouthEast(),n=_.getNorthEast(),h=e.distanceTo(n),d=Math.ceil(this._accuracy/(h/this._map._container.clientHeight)*2);this._circleElement.style.width=`${d}px`,this._circleElement.style.height=`${d}px`}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":_n--,Al=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new a.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.l("trackuserlocationstart")),this.fire(new a.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let _;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),_n++,_n>1?(_={maximumAge:6e5,timeout:0},Al=!0):(_=this.options.positionOptions,Al=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,_)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},f.GlobeControl=class{constructor(){this._toggleProjection=()=>{var _;let e=(_=this._map.getProjection())===null||_===void 0?void 0:_.type;this._map.setProjection(e!=="mercator"&&e?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var _;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((_=this._map.getProjection())===null||_===void 0?void 0:_.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(_){return this._map=_,this._container=V.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=V.create("button","maplibregl-ctrl-globe",this._container),V.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){V.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},f.Hash=hc,f.ImageSource=jn,f.KeyboardHandler=Ll,f.LngLatBounds=_i,f.LogoControl=mc,f.Map=class extends bf{constructor(_){var e,n;a.cn.mark(a.co.create);let h=Object.assign(Object.assign(Object.assign({},gc),_),{canvasContextAttributes:Object.assign(Object.assign({},gc.canvasContextAttributes),_.canvasContextAttributes)});if(h.minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");let d=new Di,y=new Sa;if(h.minZoom!==void 0&&d.setMinZoom(h.minZoom),h.maxZoom!==void 0&&d.setMaxZoom(h.maxZoom),h.minPitch!==void 0&&d.setMinPitch(h.minPitch),h.maxPitch!==void 0&&d.setMaxPitch(h.maxPitch),h.renderWorldCopies!==void 0&&d.setRenderWorldCopies(h.renderWorldCopies),super(d,y,{bearingSnap:h.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new hh,this._controls=[],this._mapId=a.a4(),this._contextLost=S=>{S.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new a.l("webglcontextlost",{originalEvent:S}))},this._contextRestored=S=>{this._setupPainter(),this.resize(),this._update(),this.fire(new a.l("webglcontextrestored",{originalEvent:S}))},this._onMapScroll=S=>{if(S.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=h.interactive,this._maxTileCacheSize=h.maxTileCacheSize,this._maxTileCacheZoomLevels=h.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},h.canvasContextAttributes),this._trackResize=h.trackResize===!0,this._bearingSnap=h.bearingSnap,this._centerClampedToGround=h.centerClampedToGround,this._refreshExpiredTiles=h.refreshExpiredTiles===!0,this._fadeDuration=h.fadeDuration,this._crossSourceCollisions=h.crossSourceCollisions===!0,this._collectResourceTiming=h.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Rt),h.locale),this._clickTolerance=h.clickTolerance,this._overridePixelRatio=h.pixelRatio,this._maxCanvasSize=h.maxCanvasSize,this.transformCameraUpdate=h.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=h.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=Se.addThrottleControl(()=>this.isMoving()),this._requestManager=new nt(h.transformRequest),typeof h.container=="string"){if(this._container=document.getElementById(h.container),!this._container)throw new Error(`Container '${h.container}' not found.`)}else{if(!(h.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(h.maxBounds&&this.setMaxBounds(h.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let S=!1,C=ms(k=>{this._trackResize&&!this._removed&&(this.resize(k),this.redraw())},50);this._resizeObserver=new ResizeObserver(k=>{S?C(k):S=!0}),this._resizeObserver.observe(this._container)}this.handlers=new xf(this,h),this._hash=h.hash&&new hc(typeof h.hash=="string"&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,elevation:h.elevation,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch,roll:h.roll}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,a.e({},h.fitBoundsOptions,{duration:0}))));let b=typeof h.style=="string"||((n=(e=h.style)===null||e===void 0?void 0:e.projection)===null||n===void 0?void 0:n.type)!=="globe";this.resize(null,b),this._localIdeographFontFamily=h.localIdeographFontFamily,this._validateStyle=h.validateStyle,h.style&&this.setStyle(h.style,{localIdeographFontFamily:h.localIdeographFontFamily}),h.attributionControl&&this.addControl(new sn(typeof h.attributionControl=="boolean"?void 0:h.attributionControl)),h.maplibreLogo&&this.addControl(new mc,h.logoPosition),this.on("style.load",()=>{if(b||this._resizeTransform(),this.transform.unmodified){let S=a.O(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(S)}}),this.on("data",S=>{this._update(S.dataType==="style"),this.fire(new a.l(`${S.dataType}data`,S))}),this.on("dataloading",S=>{this.fire(new a.l(`${S.dataType}dataloading`,S))}),this.on("dataabort",S=>{this.fire(new a.l("sourcedataabort",S))})}_getMapId(){return this._mapId}addControl(_,e){if(e===void 0&&(e=_.getDefaultPosition?_.getDefaultPosition():"top-right"),!_||!_.onAdd)return this.fire(new a.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let n=_.onAdd(this);this._controls.push(_);let h=this._controlPositions[e];return e.indexOf("bottom")!==-1?h.insertBefore(n,h.firstChild):h.appendChild(n),this}removeControl(_){if(!_||!_.onRemove)return this.fire(new a.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let e=this._controls.indexOf(_);return e>-1&&this._controls.splice(e,1),_.onRemove(this),this}hasControl(_){return this._controls.indexOf(_)>-1}calculateCameraOptionsFromTo(_,e,n,h){return h==null&&this.terrain&&(h=this.terrain.getElevationForLngLatZoom(n,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(_,e,n,h)}resize(_,e=!0){let[n,h]=this._containerDimensions(),d=this._getClampedPixelRatio(n,h);if(this._resizeCanvas(n,h,d),this.painter.resize(n,h,d),this.painter.overLimit()){let b=this.painter.context.gl;this._maxCanvasSize=[b.drawingBufferWidth,b.drawingBufferHeight];let S=this._getClampedPixelRatio(n,h);this._resizeCanvas(n,h,S),this.painter.resize(n,h,S)}this._resizeTransform(e);let y=!this._moving;return y&&(this.stop(),this.fire(new a.l("movestart",_)).fire(new a.l("move",_))),this.fire(new a.l("resize",_)),y&&this.fire(new a.l("moveend",_)),this}_resizeTransform(_=!0){var e;let[n,h]=this._containerDimensions();this.transform.resize(n,h,_),(e=this._requestedCameraState)===null||e===void 0||e.resize(n,h,_)}_getClampedPixelRatio(_,e){let{0:n,1:h}=this._maxCanvasSize,d=this.getPixelRatio(),y=_*d,b=e*d;return Math.min(y>n?n/y:1,b>h?h/b:1)*d}getPixelRatio(){var _;return(_=this._overridePixelRatio)!==null&&_!==void 0?_:devicePixelRatio}setPixelRatio(_){this._overridePixelRatio=_,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(_){return this.transform.setMaxBounds(_i.convert(_)),this._update()}setMinZoom(_){if((_=_??-2)>=-2&&_<=this.transform.maxZoom)return this.transform.setMinZoom(_),this._update(),this.getZoom()<_&&this.setZoom(_),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(_){if((_=_??22)>=this.transform.minZoom)return this.transform.setMaxZoom(_),this._update(),this.getZoom()>_&&this.setZoom(_),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(_){if((_=_??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(_>=0&&_<=this.transform.maxPitch)return this.transform.setMinPitch(_),this._update(),this.getPitch()<_&&this.setPitch(_),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(_){if((_=_??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(_>=this.transform.minPitch)return this.transform.setMaxPitch(_),this._update(),this.getPitch()>_&&this.setPitch(_),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(_){return this.transform.setRenderWorldCopies(_),this._update()}project(_){return this.transform.locationToScreenPoint(a.Q.convert(_),this.style&&this.terrain)}unproject(_){return this.transform.screenPointToLocation(a.P.convert(_),this.terrain)}isMoving(){var _;return this._moving||((_=this.handlers)===null||_===void 0?void 0:_.isMoving())}isZooming(){var _;return this._zooming||((_=this.handlers)===null||_===void 0?void 0:_.isZooming())}isRotating(){var _;return this._rotating||((_=this.handlers)===null||_===void 0?void 0:_.isRotating())}_createDelegatedListener(_,e,n){if(_==="mouseenter"||_==="mouseover"){let h=!1;return{layers:e,listener:n,delegates:{mousemove:y=>{let b=e.filter(C=>this.getLayer(C)),S=b.length!==0?this.queryRenderedFeatures(y.point,{layers:b}):[];S.length?h||(h=!0,n.call(this,new ir(_,this,y.originalEvent,{features:S}))):h=!1},mouseout:()=>{h=!1}}}}if(_==="mouseleave"||_==="mouseout"){let h=!1;return{layers:e,listener:n,delegates:{mousemove:b=>{let S=e.filter(C=>this.getLayer(C));(S.length!==0?this.queryRenderedFeatures(b.point,{layers:S}):[]).length?h=!0:h&&(h=!1,n.call(this,new ir(_,this,b.originalEvent)))},mouseout:b=>{h&&(h=!1,n.call(this,new ir(_,this,b.originalEvent)))}}}}{let h=d=>{let y=e.filter(S=>this.getLayer(S)),b=y.length!==0?this.queryRenderedFeatures(d.point,{layers:y}):[];b.length&&(d.features=b,n.call(this,d),delete d.features)};return{layers:e,listener:n,delegates:{[_]:h}}}}_saveDelegatedListener(_,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[_]=this._delegatedListeners[_]||[],this._delegatedListeners[_].push(e)}_removeDelegatedListener(_,e,n){if(!this._delegatedListeners||!this._delegatedListeners[_])return;let h=this._delegatedListeners[_];for(let d=0;d<h.length;d++){let y=h[d];if(y.listener===n&&y.layers.length===e.length&&y.layers.every(b=>e.includes(b))){for(let b in y.delegates)this.off(b,y.delegates[b]);return void h.splice(d,1)}}}on(_,e,n){if(n===void 0)return super.on(_,e);let h=typeof e=="string"?[e]:e,d=this._createDelegatedListener(_,h,n);this._saveDelegatedListener(_,d);for(let y in d.delegates)this.on(y,d.delegates[y]);return{unsubscribe:()=>{this._removeDelegatedListener(_,h,n)}}}once(_,e,n){if(n===void 0)return super.once(_,e);let h=typeof e=="string"?[e]:e,d=this._createDelegatedListener(_,h,n);for(let y in d.delegates){let b=d.delegates[y];d.delegates[y]=(...S)=>{this._removeDelegatedListener(_,h,n),b(...S)}}this._saveDelegatedListener(_,d);for(let y in d.delegates)this.once(y,d.delegates[y]);return this}off(_,e,n){return n===void 0?super.off(_,e):(this._removeDelegatedListener(_,typeof e=="string"?[e]:e,n),this)}queryRenderedFeatures(_,e){if(!this.style)return[];let n,h=_ instanceof a.P||Array.isArray(_),d=h?_:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(h?{}:_)||{},d instanceof a.P||typeof d[0]=="number")n=[a.P.convert(d)];else{let y=a.P.convert(d[0]),b=a.P.convert(d[1]);n=[y,new a.P(b.x,y.y),b,new a.P(y.x,b.y),y]}return this.style.queryRenderedFeatures(n,e,this.transform)}querySourceFeatures(_,e){return this.style.querySourceFeatures(_,e)}setStyle(_,e){return(e=a.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&_?(this._diffStyle(_,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(_,e))}setTransformRequest(_){return this._requestManager.setTransformRequest(_),this}_getUIString(_){let e=this._locale[_];if(e==null)throw new Error(`Missing UI string '${_}'`);return e}_updateStyle(_,e){var n,h;if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(_,e));let d=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!_)),_?(this.style=new Yl(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof _=="string"?this.style.loadURL(_,e,d):this.style.loadJSON(_,e,d),this):((h=(n=this.style)===null||n===void 0?void 0:n.projection)===null||h===void 0||h.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Yl(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(_,e){if(typeof _=="string"){let n=this._requestManager.transformRequest(_,"Style");a.j(n,new AbortController).then(h=>{this._updateDiff(h.data,e)}).catch(h=>{h&&this.fire(new a.k(h))})}else typeof _=="object"&&this._updateDiff(_,e)}_updateDiff(_,e){try{this.style.setState(_,e)&&this._update(!0)}catch(n){a.w(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(_,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.w("There is no style added to the map.")}addSource(_,e){return this._lazyInitEmptyStyle(),this.style.addSource(_,e),this._update(!0)}isSourceLoaded(_){let e=this.style&&this.style.sourceCaches[_];if(e!==void 0)return e.loaded();this.fire(new a.k(new Error(`There is no source with ID '${_}'`)))}setTerrain(_){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),_){let e=this.style.sourceCaches[_.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${_.source}`);this.terrain===null&&e.reload();for(let n in this.style._layers){let h=this.style._layers[n];h.type==="hillshade"&&h.source===_.source&&a.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Ld(this.painter,e,_),this.painter.renderToTexture=new vu(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=n=>{var h;n.dataType==="style"?this.terrain.sourceCache.freeRtt():n.dataType==="source"&&n.tile&&(n.sourceId!==_.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((h=n.source)===null||h===void 0?void 0:h.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(n.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new a.l("terrain",{terrain:_})),this}getTerrain(){var _,e;return(e=(_=this.terrain)===null||_===void 0?void 0:_.options)!==null&&e!==void 0?e:null}areTilesLoaded(){let _=this.style&&this.style.sourceCaches;for(let e in _){let n=_[e]._tiles;for(let h in n){let d=n[h];if(d.state!=="loaded"&&d.state!=="errored")return!1}}return!0}removeSource(_){return this.style.removeSource(_),this._update(!0)}getSource(_){return this.style.getSource(_)}setSourceTileLodParams(_,e,n){if(n){let h=this.getSource(n);if(!h)throw new Error(`There is no source with ID "${n}", cannot set LOD parameters`);h.calculateTileZoom=Te(Math.max(1,_),Math.max(1,e))}else for(let h in this.style.sourceCaches)this.style.sourceCaches[h].getSource().calculateTileZoom=Te(Math.max(1,_),Math.max(1,e));return this._update(!0),this}refreshTiles(_,e){let n=this.style.sourceCaches[_];if(!n)throw new Error(`There is no source cache with ID "${_}", cannot refresh tile`);e===void 0?n.reload():n.refreshTiles(e.map(h=>new a.a1(h.z,h.x,h.y)))}addImage(_,e,n={}){let{pixelRatio:h=1,sdf:d=!1,stretchX:y,stretchY:b,content:S,textFitWidth:C,textFitHeight:k}=n;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||a.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new a.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{let{width:R,height:j,data:N}=e,q=e;return this.style.addImage(_,{data:new a.R({width:R,height:j},new Uint8Array(N)),pixelRatio:h,stretchX:y,stretchY:b,content:S,textFitWidth:C,textFitHeight:k,sdf:d,version:0,userImage:q}),q.onAdd&&q.onAdd(this,_),this}}{let{width:R,height:j,data:N}=W.getImageData(e);this.style.addImage(_,{data:new a.R({width:R,height:j},N),pixelRatio:h,stretchX:y,stretchY:b,content:S,textFitWidth:C,textFitHeight:k,sdf:d,version:0})}}updateImage(_,e){let n=this.style.getImage(_);if(!n)return this.fire(new a.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let h=e instanceof HTMLImageElement||a.b(e)?W.getImageData(e):e,{width:d,height:y,data:b}=h;if(d===void 0||y===void 0)return this.fire(new a.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(d!==n.data.width||y!==n.data.height)return this.fire(new a.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));let S=!(e instanceof HTMLImageElement||a.b(e));return n.data.replace(b,S),this.style.updateImage(_,n),this}getImage(_){return this.style.getImage(_)}hasImage(_){return _?!!this.style.getImage(_):(this.fire(new a.k(new Error("Missing required image id"))),!1)}removeImage(_){this.style.removeImage(_)}loadImage(_){return Se.getImage(this._requestManager.transformRequest(_,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(_,e){return this._lazyInitEmptyStyle(),this.style.addLayer(_,e),this._update(!0)}moveLayer(_,e){return this.style.moveLayer(_,e),this._update(!0)}removeLayer(_){return this.style.removeLayer(_),this._update(!0)}getLayer(_){return this.style.getLayer(_)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(_,e,n){return this.style.setLayerZoomRange(_,e,n),this._update(!0)}setFilter(_,e,n={}){return this.style.setFilter(_,e,n),this._update(!0)}getFilter(_){return this.style.getFilter(_)}setPaintProperty(_,e,n,h={}){return this.style.setPaintProperty(_,e,n,h),this._update(!0)}getPaintProperty(_,e){return this.style.getPaintProperty(_,e)}setLayoutProperty(_,e,n,h={}){return this.style.setLayoutProperty(_,e,n,h),this._update(!0)}getLayoutProperty(_,e){return this.style.getLayoutProperty(_,e)}setGlyphs(_,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(_,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(_,e,n={}){return this._lazyInitEmptyStyle(),this.style.addSprite(_,e,n,h=>{h||this._update(!0)}),this}removeSprite(_){return this._lazyInitEmptyStyle(),this.style.removeSprite(_),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(_,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(_,e,n=>{n||this._update(!0)}),this}setLight(_,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(_,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(_,e={}){return this._lazyInitEmptyStyle(),this.style.setSky(_,e),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(_,e){return this.style.setFeatureState(_,e),this._update()}removeFeatureState(_,e){return this.style.removeFeatureState(_,e),this._update()}getFeatureState(_){return this.style.getFeatureState(_)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let _=0,e=0;return this._container&&(_=this._container.clientWidth||400,e=this._container.clientHeight||300),[_,e]}_setupContainer(){let _=this._container;_.classList.add("maplibregl-map");let e=this._canvasContainer=V.create("div","maplibregl-canvas-container",_);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=V.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");let n=this._containerDimensions(),h=this._getClampedPixelRatio(n[0],n[1]);this._resizeCanvas(n[0],n[1],h);let d=this._controlContainer=V.create("div","maplibregl-control-container",_),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(b=>{y[b]=V.create("div",`maplibregl-ctrl-${b} `,d)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(_,e,n){this._canvas.width=Math.floor(n*_),this._canvas.height=Math.floor(n*e),this._canvas.style.width=`${_}px`,this._canvas.style.height=`${e}px`}_setupPainter(){let _=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0}),e=null;this._canvas.addEventListener("webglcontextcreationerror",h=>{e={requestedAttributes:_},h&&(e.statusMessage=h.statusMessage,e.type=h.type)},{once:!0});let n=null;if(n=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,_):this._canvas.getContext("webgl2",_)||this._canvas.getContext("webgl",_),!n){let h="Failed to initialize WebGL";throw e?(e.message=h,new Error(JSON.stringify(e))):new Error(h)}this.painter=new uc(n,this.transform),he.testSupport(n)}migrateProjection(_,e){super.migrateProjection(_,e),this.painter.transform=_,this.fire(new a.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(_){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||_,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(_){return this._update(),this._renderTaskQueue.add(_)}_cancelRenderFrame(_){this._renderTaskQueue.remove(_)}_render(_){var e,n,h,d,y;let b=this._idleTriggered?this._fadeDuration:0,S=((e=this.style.projection)===null||e===void 0?void 0:e.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(_),this._removed)return;let C=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;let j=this.transform.zoom,N=W.now();this.style.zoomHistory.update(j,N);let q=new a.C(j,{now:N,fadeDuration:b,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),H=q.crossFadingFactor();H===1&&H===this._crossFadingFactor||(C=!0,this._crossFadingFactor=H),this.style.update(q)}let k=((n=this.style.projection)===null||n===void 0?void 0:n.transitionState)>0!==S;(h=this.style.projection)===null||h===void 0||h.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((d=this.style.projection)===null||d===void 0?void 0:d.transitionState,(y=this.style.projection)===null||y===void 0?void 0:y.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||k)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,b,this._crossSourceCollisions,k),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:b,showPadding:this.showPadding}),this.fire(new a.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.cn.mark(a.co.load),this.fire(new a.l("load"))),this.style&&(this.style.hasTransitions()||C)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();let R=this._sourcesDirty||this._styleDirty||this._placementDirty;return R||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.l("idle")),!this._loaded||this._fullyLoaded||R||(this._fullyLoaded=!0,a.cn.mark(a.co.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var _;this._hash&&this._hash.remove();for(let n of this._controls)n.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Se.removeThrottleControl(this._imageQueueHandle),(_=this._resizeObserver)===null||_===void 0||_.disconnect();let e=this.painter.context.gl.getExtension("WEBGL_lose_context");e?.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),V.remove(this._canvasContainer),V.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),a.cn.clearMetrics(),this._removed=!0,this.fire(new a.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,W.frame(this._frameRequest,_=>{a.cn.frame(_),this._frameRequest=null;try{this._render(_)}catch(e){if(!a.cp(e)&&!function(n){return n.message===Ba}(e))throw e}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(_){this._showTileBoundaries!==_&&(this._showTileBoundaries=_,this._update())}get showPadding(){return!!this._showPadding}set showPadding(_){this._showPadding!==_&&(this._showPadding=_,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(_){this._showCollisionBoxes!==_&&(this._showCollisionBoxes=_,_?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(_){this._showOverdrawInspector!==_&&(this._showOverdrawInspector=_,this._update())}get repaint(){return!!this._repaint}set repaint(_){this._repaint!==_&&(this._repaint=_,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(_){this._vertices=_,this._update()}get version(){return Wt}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(_){return this._lazyInitEmptyStyle(),this.style.setProjection(_),this._update(!0)}},f.MapMouseEvent=ir,f.MapTouchEvent=Sl,f.MapWheelEvent=rh,f.Marker=Ys,f.NavigationControl=class{constructor(_){this._updateZoomButtons=()=>{let e=this._map.getZoom(),n=e===this._map.getMaxZoom(),h=e===this._map.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(e,n)=>{let h=this._map._getUIString(`NavigationControl.${n}`);e.title=h,e.setAttribute("aria-label",h)},this.options=a.e({},dh,_),this._container=V.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),V.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),V.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=V.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(_){return this._map=_,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ph(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){V.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(_,e){let n=V.create("button",_,this._container);return n.type="button",n.addEventListener("click",e),n}},f.Popup=class extends a.E{constructor(_){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:void 0)},this.remove=()=>(this._content&&V.remove(this._content),this._container&&(V.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new a.l("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=V.create("div","maplibregl-popup",this._map.getContainer()),this._tip=V.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(let b of this.options.className.split(" "))this._container.classList.add(b);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=fh(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!e)return;let n=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let h=this.options.anchor,d=kl(this.options.offset);if(!h){let b=this._container.offsetWidth,S=this._container.offsetHeight,C;C=n.y+d.bottom.y<S?["top"]:n.y>this._map.transform.height-S?["bottom"]:[],n.x<b/2?C.push("left"):n.x>this._map.transform.width-b/2&&C.push("right"),h=C.length===0?"bottom":C.join("-")}let y=n.add(d[h]);this.options.subpixelPositioning||(y=y.round()),V.setTransform(this._container,`${wo[h]} translate(${y.x}px,${y.y}px)`),Ad(this._container,h,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=a.e(Object.create(mh),_)}addTo(_){return this._map&&this.remove(),this._map=_,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new a.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(_){return this._lngLat=a.Q.convert(_),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(_){return this.setDOMContent(document.createTextNode(_))}setHTML(_){let e=document.createDocumentFragment(),n=document.createElement("body"),h;for(n.innerHTML=_;h=n.firstChild,h;)e.appendChild(h);return this.setDOMContent(e)}getMaxWidth(){var _;return(_=this._container)===null||_===void 0?void 0:_.style.maxWidth}setMaxWidth(_){return this.options.maxWidth=_,this._update(),this}setDOMContent(_){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=V.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(_),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(_){return this._container&&this._container.classList.add(_),this}removeClassName(_){return this._container&&this._container.classList.remove(_),this}setOffset(_){return this.options.offset=_,this._update(),this}toggleClassName(_){if(this._container)return this._container.classList.toggle(_)}setSubpixelPositioning(_){this.options.subpixelPositioning=_}_createCloseButton(){this.options.closeButton&&(this._closeButton=V.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let _=this._container.querySelector(gh);_&&_.focus()}},f.RasterDEMTileSource=to,f.RasterTileSource=ui,f.ScaleControl=class{constructor(_){this._onMove=()=>{yc(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,yc(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},_c),_)}getDefaultPosition(){return"bottom-left"}onAdd(_){return this._map=_,this._container=V.create("div","maplibregl-ctrl maplibregl-ctrl-scale",_.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){V.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},f.ScrollZoomHandler=bi,f.Style=Yl,f.TerrainControl=class{constructor(_){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=_}onAdd(_){return this._map=_,this._container=V.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=V.create("button","maplibregl-ctrl-terrain",this._container),V.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){V.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},f.TwoFingersTouchPitchHandler=mu,f.TwoFingersTouchRotateHandler=wt,f.TwoFingersTouchZoomHandler=El,f.TwoFingersTouchZoomRotateHandler=uh,f.VectorTileSource=Zi,f.VideoSource=Pr,f.addSourceType=(_,e)=>a._(void 0,void 0,void 0,function*(){if(no(_))throw new Error(`A source type called "${_}" already exists.`);((n,h)=>{io[n]=h})(_,e)}),f.clearPrewarmedResources=function(){let _=Et;_&&(_.isPreloaded()&&_.numActive()===1?(_.release(qe),Et=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},f.createTileMesh=Ds,f.getMaxParallelImageRequests=function(){return a.a.MAX_PARALLEL_IMAGE_REQUESTS},f.getRTLTextPluginStatus=function(){return Ot().getRTLTextPluginStatus()},f.getVersion=function(){return _h},f.getWorkerCount=function(){return xt.workerCount},f.getWorkerUrl=function(){return a.a.WORKER_URL},f.importScriptInWorkers=function(_){return Qt().broadcast("IS",_)},f.prewarm=function(){zt().acquire(qe)},f.setMaxParallelImageRequests=function(_){a.a.MAX_PARALLEL_IMAGE_REQUESTS=_},f.setRTLTextPlugin=function(_,e){return Ot().setRTLTextPlugin(_,e)},f.setWorkerCount=function(_){xt.workerCount=_},f.setWorkerUrl=function(_){a.a.WORKER_URL=_}});var m=s;return m})});var C0=Jd((ZC,Sm)=>{"use strict";var Fu=typeof Reflect=="object"?Reflect:null,_0=Fu&&typeof Fu.apply=="function"?Fu.apply:function(i,l,m){return Function.prototype.apply.call(i,l,m)},cp;Fu&&typeof Fu.ownKeys=="function"?cp=Fu.ownKeys:Object.getOwnPropertySymbols?cp=function(i){return Object.getOwnPropertyNames(i).concat(Object.getOwnPropertySymbols(i))}:cp=function(i){return Object.getOwnPropertyNames(i)};function Nw(s){console&&console.warn&&console.warn(s)}var v0=Number.isNaN||function(i){return i!==i};function un(){un.init.call(this)}Sm.exports=un;Sm.exports.once=Zw;un.EventEmitter=un;un.prototype._events=void 0;un.prototype._eventsCount=0;un.prototype._maxListeners=void 0;var y0=10;function up(s){if(typeof s!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof s)}Object.defineProperty(un,"defaultMaxListeners",{enumerable:!0,get:function(){return y0},set:function(s){if(typeof s!="number"||s<0||v0(s))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+s+".");y0=s}});un.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};un.prototype.setMaxListeners=function(i){if(typeof i!="number"||i<0||v0(i))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+i+".");return this._maxListeners=i,this};function x0(s){return s._maxListeners===void 0?un.defaultMaxListeners:s._maxListeners}un.prototype.getMaxListeners=function(){return x0(this)};un.prototype.emit=function(i){for(var l=[],m=1;m<arguments.length;m++)l.push(arguments[m]);var f=i==="error",a=this._events;if(a!==void 0)f=f&&a.error===void 0;else if(!f)return!1;if(f){var P;if(l.length>0&&(P=l[0]),P instanceof Error)throw P;var E=new Error("Unhandled error."+(P?" ("+P.message+")":""));throw E.context=P,E}var O=a[i];if(O===void 0)return!1;if(typeof O=="function")_0(O,this,l);else for(var B=O.length,W=P0(O,B),m=0;m<B;++m)_0(W[m],this,l);return!0};function b0(s,i,l,m){var f,a,P;if(up(l),a=s._events,a===void 0?(a=s._events=Object.create(null),s._eventsCount=0):(a.newListener!==void 0&&(s.emit("newListener",i,l.listener?l.listener:l),a=s._events),P=a[i]),P===void 0)P=a[i]=l,++s._eventsCount;else if(typeof P=="function"?P=a[i]=m?[l,P]:[P,l]:m?P.unshift(l):P.push(l),f=x0(s),f>0&&P.length>f&&!P.warned){P.warned=!0;var E=new Error("Possible EventEmitter memory leak detected. "+P.length+" "+String(i)+" listeners added. Use emitter.setMaxListeners() to increase limit");E.name="MaxListenersExceededWarning",E.emitter=s,E.type=i,E.count=P.length,Nw(E)}return s}un.prototype.addListener=function(i,l){return b0(this,i,l,!1)};un.prototype.on=un.prototype.addListener;un.prototype.prependListener=function(i,l){return b0(this,i,l,!0)};function jw(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function w0(s,i,l){var m={fired:!1,wrapFn:void 0,target:s,type:i,listener:l},f=jw.bind(m);return f.listener=l,m.wrapFn=f,f}un.prototype.once=function(i,l){return up(l),this.on(i,w0(this,i,l)),this};un.prototype.prependOnceListener=function(i,l){return up(l),this.prependListener(i,w0(this,i,l)),this};un.prototype.removeListener=function(i,l){var m,f,a,P,E;if(up(l),f=this._events,f===void 0)return this;if(m=f[i],m===void 0)return this;if(m===l||m.listener===l)--this._eventsCount===0?this._events=Object.create(null):(delete f[i],f.removeListener&&this.emit("removeListener",i,m.listener||l));else if(typeof m!="function"){for(a=-1,P=m.length-1;P>=0;P--)if(m[P]===l||m[P].listener===l){E=m[P].listener,a=P;break}if(a<0)return this;a===0?m.shift():$w(m,a),m.length===1&&(f[i]=m[0]),f.removeListener!==void 0&&this.emit("removeListener",i,E||l)}return this};un.prototype.off=un.prototype.removeListener;un.prototype.removeAllListeners=function(i){var l,m,f;if(m=this._events,m===void 0)return this;if(m.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):m[i]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete m[i]),this;if(arguments.length===0){var a=Object.keys(m),P;for(f=0;f<a.length;++f)P=a[f],P!=="removeListener"&&this.removeAllListeners(P);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(l=m[i],typeof l=="function")this.removeListener(i,l);else if(l!==void 0)for(f=l.length-1;f>=0;f--)this.removeListener(i,l[f]);return this};function T0(s,i,l){var m=s._events;if(m===void 0)return[];var f=m[i];return f===void 0?[]:typeof f=="function"?l?[f.listener||f]:[f]:l?Uw(f):P0(f,f.length)}un.prototype.listeners=function(i){return T0(this,i,!0)};un.prototype.rawListeners=function(i){return T0(this,i,!1)};un.listenerCount=function(s,i){return typeof s.listenerCount=="function"?s.listenerCount(i):S0.call(s,i)};un.prototype.listenerCount=S0;function S0(s){var i=this._events;if(i!==void 0){var l=i[s];if(typeof l=="function")return 1;if(l!==void 0)return l.length}return 0}un.prototype.eventNames=function(){return this._eventsCount>0?cp(this._events):[]};function P0(s,i){for(var l=new Array(i),m=0;m<i;++m)l[m]=s[m];return l}function $w(s,i){for(;i+1<s.length;i++)s[i]=s[i+1];s.pop()}function Uw(s){for(var i=new Array(s.length),l=0;l<i.length;++l)i[l]=s[l].listener||s[l];return i}function Zw(s,i){return new Promise(function(l,m){function f(P){s.removeListener(i,a),m(P)}function a(){typeof s.removeListener=="function"&&s.removeListener("error",f),l([].slice.call(arguments))}M0(s,i,a,{once:!0}),i!=="error"&&Vw(s,f,{once:!0})})}function Vw(s,i,l){typeof s.on=="function"&&M0(s,"error",i,l)}function M0(s,i,l,m){if(typeof s.on=="function")m.once?s.once(i,l):s.on(i,l);else if(typeof s.addEventListener=="function")s.addEventListener(i,function f(a){m.once&&s.removeEventListener(i,f),l(a)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof s)}});var Co=Ec(Ru()),WE=Ec(u0());var Yn=Ec(Ru(),1);var $t=Ec(d0(),1);function Aw(){return typeof self<"u"?fetch.bind(self):typeof global<"u"&&global.fetch?global.fetch:null}var Tm=class{constructor(){this._apiKey="",this._fetch=Aw(),this.tileCacheSize=200}set apiKey(i){this._apiKey=i}get apiKey(){return this._apiKey}set fetch(i){this._fetch=i}get fetch(){return this._fetch}},Lc=new Tm,kw={AUTO:{code:null,flag:"auto",name:"Auto",latin:!1,isMode:!0,geocoding:!0},LATIN:{code:"latin",flag:"name:latin",name:"Latin",latin:!0,isMode:!1,geocoding:!1},NON_LATIN:{code:"nonlatin",flag:"name:nonlatin",name:"Non Latin",latin:!1,isMode:!1,geocoding:!1},LOCAL:{code:null,flag:"name",name:"Local",latin:!0,isMode:!1,geocoding:!1}},zw={ALBANIAN:{code:"sq",flag:"name:sq",name:"Albanian",latin:!0,isMode:!1,geocoding:!0},AMHARIC:{code:"am",flag:"name:am",name:"Amharic",latin:!1,isMode:!1,geocoding:!0},ARABIC:{code:"ar",flag:"name:ar",name:"Arabic",latin:!1,isMode:!1,geocoding:!0},ARMENIAN:{code:"hy",flag:"name:hy",name:"Armenian",latin:!1,isMode:!1,geocoding:!0},AZERBAIJANI:{code:"az",flag:"name:az",name:"Azerbaijani",latin:!0,isMode:!1,geocoding:!0},BASQUE:{code:"eu",flag:"name:eu",name:"Basque",latin:!0,isMode:!1,geocoding:!0},BELARUSIAN:{code:"be",flag:"name:be",name:"Belarusian",latin:!1,isMode:!1,geocoding:!0},BENGALI:{code:"bn",flag:"name:bn",name:"Bengali",latin:!0,isMode:!1,geocoding:!0},BOSNIAN:{code:"bs",flag:"name:bs",name:"Bosnian",latin:!0,isMode:!1,geocoding:!0},BRETON:{code:"br",flag:"name:br",name:"Breton",latin:!0,isMode:!1,geocoding:!0},BULGARIAN:{code:"bg",flag:"bg",name:"Bulgarian",latin:!1,isMode:!1,geocoding:!0},CATALAN:{code:"ca",flag:"name:ca",name:"Catalan",latin:!0,isMode:!1,geocoding:!0},CHINESE:{code:"zh",flag:"name:zh",name:"Chinese",latin:!1,isMode:!1,geocoding:!0},TRADITIONAL_CHINESE:{code:"zh-Hant",flag:"name:zh-Hant",name:"Chinese (traditional)",latin:!1,isMode:!1,geocoding:!1},SIMPLIFIED_CHINESE:{code:"zh-Hans",flag:"name:zh-Hans",name:"Chinese (simplified)",latin:!1,isMode:!1,geocoding:!1},CORSICAN:{code:"co",flag:"name:co",name:"Corsican",latin:!0,isMode:!1,geocoding:!0},CROATIAN:{code:"hr",flag:"name:hr",name:"Croatian",latin:!0,isMode:!1,geocoding:!0},CZECH:{code:"cs",flag:"name:cs",name:"Czech",latin:!0,isMode:!1,geocoding:!0},DANISH:{code:"da",flag:"name:da",name:"Danish",latin:!0,isMode:!1,geocoding:!0},DUTCH:{code:"nl",flag:"name:nl",name:"Dutch",latin:!0,isMode:!1,geocoding:!0},GERMAN:{code:"de",flag:"name:de",name:"German",latin:!0,isMode:!1,geocoding:!0},GREEK:{code:"el",flag:"name:el",name:"Greek",latin:!1,isMode:!1,geocoding:!0},ENGLISH:{code:"en",flag:"name:en",name:"English",latin:!0,isMode:!1,geocoding:!0},ESPERANTO:{code:"eo",flag:"name:eo",name:"Esperanto",latin:!0,isMode:!1,geocoding:!0},ESTONIAN:{code:"et",flag:"name:et",name:"Estonian",latin:!0,isMode:!1,geocoding:!0},FINNISH:{code:"fi",flag:"name:fi",name:"Finnish",latin:!0,isMode:!1,geocoding:!0},FRENCH:{code:"fr",flag:"name:fr",name:"French",latin:!0,isMode:!1,geocoding:!0},FRISIAN:{code:"fy",flag:"name:fy",name:"Frisian (West)",latin:!0,isMode:!1,geocoding:!0},GEORGIAN:{code:"ka",flag:"name:ka",name:"Georgian",latin:!1,isMode:!1,geocoding:!0},HEBREW:{code:"he",flag:"name:he",name:"Hebrew",latin:!1,isMode:!1,geocoding:!0},HINDI:{code:"hi",flag:"name:hi",name:"Hindi",latin:!1,isMode:!1,geocoding:!0},HUNGARIAN:{code:"hu",flag:"name:hu",name:"Hungarian",latin:!0,isMode:!1,geocoding:!0},ICELANDIC:{code:"is",flag:"name:is",name:"Icelandic",latin:!0,isMode:!1,geocoding:!0},INDONESIAN:{code:"id",flag:"name:id",name:"Indonesian",latin:!0,isMode:!1,geocoding:!0},IRISH:{code:"ga",flag:"name:ga",name:"Irish",latin:!0,isMode:!1,geocoding:!0},ITALIAN:{code:"it",flag:"name:it",name:"Italian",latin:!0,isMode:!1,geocoding:!0},JAPANESE:{code:"ja",flag:"name:ja",name:"Japanese",latin:!1,isMode:!1,geocoding:!0},JAPANESE_HIRAGANA:{code:"ja-Hira",flag:"name:ja-Hira",name:"Japanese Hiragana form",latin:!1,isMode:!1,geocoding:!1},JAPANESE_2018:{code:"ja-Latn",flag:"name:ja-Latn",name:"Japanese (Latin 2018)",latin:!0,isMode:!1,geocoding:!1},JAPANESE_KANA:{code:"ja_kana",flag:"name:ja_kana",name:"Japanese (Kana)",latin:!1,isMode:!1,geocoding:!1},JAPANESE_LATIN:{code:"ja_rm",flag:"name:ja_rm",name:"Japanese (Latin script)",latin:!0,isMode:!1,geocoding:!1},KANNADA:{code:"kn",flag:"name:kn",name:"Kannada",latin:!0,isMode:!1,geocoding:!0},KAZAKH:{code:"kk",flag:"name:kk",name:"Kazakh",latin:!1,isMode:!1,geocoding:!0},KOREAN:{code:"ko",flag:"name:ko",name:"Korean",latin:!1,isMode:!1,geocoding:!0},KOREAN_LATIN:{code:"ko-Latn",flag:"name:ko-Latn",name:"Korean (Latin script)",latin:!0,isMode:!1,geocoding:!1},KURDISH:{code:"ku",flag:"name:ku",name:"Kurdish",latin:!0,isMode:!1,geocoding:!0},CLASSICAL_LATIN:{code:"la",flag:"name:la",name:"Latin",latin:!0,isMode:!1,geocoding:!0},LATVIAN:{code:"lv",flag:"name:lv",name:"Latvian",latin:!0,isMode:!1,geocoding:!0},LITHUANIAN:{code:"lt",flag:"name:lt",name:"Lithuanian",latin:!0,isMode:!1,geocoding:!0},LUXEMBOURGISH:{code:"lb",flag:"name:lb",name:"Luxembourgish",latin:!0,isMode:!1,geocoding:!0},MACEDONIAN:{code:"mk",flag:"name:mk",name:"Macedonian",latin:!1,isMode:!1,geocoding:!0},MALAYALAM:{code:"ml",flag:"name:ml",name:"Malayalam",latin:!1,isMode:!1,geocoding:!0},MALTESE:{code:"mt",flag:"name:mt",name:"Maltese",latin:!0,isMode:!1,geocoding:!0},NORWEGIAN:{code:"no",flag:"name:no",name:"Norwegian",latin:!0,isMode:!1,geocoding:!0},OCCITAN:{code:"oc",flag:"name:oc",name:"Occitan",latin:!0,isMode:!1,geocoding:!0},PERSIAN:{code:"fa",flag:"name:fa",name:"Persian",latin:!1,isMode:!1,geocoding:!0},POLISH:{code:"pl",flag:"name:pl",name:"Polish",latin:!0,isMode:!1,geocoding:!0},PORTUGUESE:{code:"pt",flag:"name:pt",name:"Portuguese",latin:!0,isMode:!1,geocoding:!0},PUNJABI:{code:"pa",flag:"name:pa",name:"Punjabi",latin:!1,isMode:!1,geocoding:!0},WESTERN_PUNJABI:{code:"pnb",flag:"name:pnb",name:"Western Punjabi",latin:!1,isMode:!1,geocoding:!1},ROMANIAN:{code:"ro",flag:"name:ro",name:"Romanian",latin:!0,isMode:!1,geocoding:!0},ROMANSH:{code:"rm",flag:"name:rm",name:"Romansh",latin:!0,isMode:!1,geocoding:!0},RUSSIAN:{code:"ru",flag:"name:ru",name:"Russian",latin:!1,isMode:!1,geocoding:!0},SERBIAN_CYRILLIC:{code:"sr",flag:"name:sr",name:"Serbian (Cyrillic script)",latin:!1,isMode:!1,geocoding:!0},SERBIAN_LATIN:{code:"sr-Latn",flag:"name:sr-Latn",name:"Serbian (Latin script)",latin:!0,isMode:!1,geocoding:!1},SCOTTISH_GAELIC:{code:"gd",flag:"name:gd",name:"Scottish Gaelic",latin:!0,isMode:!1,geocoding:!0},SLOVAK:{code:"sk",flag:"name:sk",name:"Slovak",latin:!0,isMode:!1,geocoding:!0},SLOVENE:{code:"sl",flag:"name:sl",name:"Slovene",latin:!0,isMode:!1,geocoding:!0},SPANISH:{code:"es",flag:"name:es",name:"Spanish",latin:!0,isMode:!1,geocoding:!0},SWEDISH:{code:"sv",flag:"name:sv",name:"Swedish",latin:!0,isMode:!1,geocoding:!0},TAMIL:{code:"ta",flag:"name:ta",name:"Tamil",latin:!1,isMode:!1,geocoding:!0},TELUGU:{code:"te",flag:"name:te",name:"Telugu",latin:!1,isMode:!1,geocoding:!0},THAI:{code:"th",flag:"name:th",name:"Thai",latin:!1,isMode:!1,geocoding:!0},TURKISH:{code:"tr",flag:"name:tr",name:"Turkish",latin:!0,isMode:!1,geocoding:!0},UKRAINIAN:{code:"uk",flag:"name:uk",name:"Ukrainian",latin:!1,isMode:!1,geocoding:!0},VIETNAMESE:{code:"vi",flag:"name:vi",name:"Vietnamese (Latin script)",latin:!0,isMode:!1,geocoding:!0},WELSH:{code:"cy",flag:"name:cy",name:"Welsh",latin:!0,isMode:!1,geocoding:!0}},Ou=ai(ai({},kw),zw);function f0(s,i=Ou){return s in i?s[s]:null}function jh(s,i=Ou){for(let l of Object.values(i))if(l.code===s)return l;return null}function Nh(s,i=Ou){for(let l of Object.values(i))if(l.flag===s)return l;return null}function m0(s){return s!==null&&typeof s=="object"&&"code"in s&&"flag"in s&&"name"in s&&"latin"in s&&"isMode"in s&&"geocoding"in s&&(typeof s.code=="string"||s.code===null)&&typeof s.flag=="string"&&typeof s.name=="string"&&typeof s.latin=="boolean"&&typeof s.isMode=="boolean"&&typeof s.geocoding=="boolean"}function ap(s,i=Ou){return m0(s)?Nh(s.flag,i):typeof s!="string"?null:f0(s,i)||jh(s,i)||Nh(s,i)||null}async function Rw(s,i={}){if(Lc.fetch===null)throw new Error("The fetch function was not found. If on NodeJS < 18 please specify the fetch function with config.fetch");if(new URL(s).searchParams.get("key").trim()==="")throw new Error("The MapTiler Cloud API key is missing. Set it in `config.apiKey` or get one for free at https://maptiler.com");return Lc.fetch(s,i)}var g0={maptilerApiURL:"https://api.maptiler.com/",mapStyle:"streets-v2"};Object.freeze(g0);var op=class extends Error{constructor(i,l=""){super(`Call to enpoint ${i.url} failed with the status code ${i.status}. ${l}`),this.res=i}};var p0={403:"Key is missing, invalid or restricted"};async function Dw(s={}){let i=new URL("geolocation/ip.json",g0.maptilerApiURL);i.searchParams.set("key",s.apiKey??Lc.apiKey);let l=i.toString(),m=await Rw(l);if(!m.ok)throw new op(m,m.status in p0?p0[m.status]:"");return await m.json()}var sp={info:Dw};function lp(s){let i=/^maptiler:\/\/(.*)/,l,m=s.trim(),f;return m.startsWith("http://")||m.startsWith("https://")?f=m:(l=i.exec(m))!==null?f=`https://api.maptiler.com/maps/${l[1]}/style.json`:f=`https://api.maptiler.com/maps/${m}/style.json`,f}var Du=class{constructor(i,l,m,f,a,P,E=!1){this.name=i,this.variantType=l,this.id=m,this.referenceStyle=f,this.description=a,this.imageURL=P,this.deprecated=E}getName(){return this.name}getFullName(){return`${this.referenceStyle.getName()} ${this.name}`}getType(){return this.variantType}getId(){return this.id}getDescription(){return this.description}getReferenceStyle(){return this.referenceStyle}hasVariant(i){return this.referenceStyle.hasVariant(i)}getVariant(i){let l=this.referenceStyle.getVariant(i);return this.warnIfDeprecated(l),l}getVariants(){return this.referenceStyle.getVariants().filter(i=>i!==this).map(i=>(this.warnIfDeprecated(i),i))}getImageURL(){return this.imageURL}getExpandedStyleURL(){return lp(this.getId())}warnIfDeprecated(i=this){if(!i.deprecated)return i;let l=i.getFullName();return console.warn(`Style "${l}" is deprecated and will be removed in a future version.`),i}},Bu=class{constructor(i,l){this.name=i,this.id=l,this.variants={},this.orderedVariants=[]}getName(){return this.name}getId(){return this.id}addVariant(i){this.variants[i.getType()]=i,this.orderedVariants.push(i)}hasVariant(i){return i in this.variants}getVariant(i){return i in this.variants?this.variants[i]:this.orderedVariants[0]}getVariants(){return Object.values(this.variants)}getDefaultVariant(){return this.orderedVariants[0].warnIfDeprecated()}},Ac=[{referenceStyleID:"STREETS",name:"Streets",description:"",variants:[{id:"streets-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"streets-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"streets-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"streets-v2-night",name:"Night",variantType:"NIGHT",description:"",imageURL:""},{id:"streets-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OUTDOOR",name:"Outdoor",description:"",variants:[{id:"outdoor-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"outdoor-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"WINTER",name:"Winter",description:"",variants:[{id:"winter-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"winter-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"SATELLITE",name:"Satellite",description:"",variants:[{id:"satellite",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"HYBRID",name:"Hybrid",description:"",variants:[{id:"hybrid",deprecated:!0,name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"BASIC",name:"Basic",description:"",variants:[{id:"basic-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"basic-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"basic-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"BRIGHT",name:"Bright",description:"",variants:[{id:"bright-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"bright-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"bright-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"bright-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OPENSTREETMAP",name:"OpenStreetMap",description:"",variants:[{id:"openstreetmap",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"TOPO",name:"Topo",description:"",variants:[{id:"topo-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"topo-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"topo-v2-shiny",name:"Shiny",deprecated:!0,variantType:"SHINY",description:"",imageURL:""},{id:"topo-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""},{id:"topo-v2-topographique",name:"Topographique",variantType:"TOPOGRAPHIQUE",description:"",imageURL:""}]},{referenceStyleID:"VOYAGER",name:"Voyager",description:"",variants:[{id:"voyager-v2",name:"Default",deprecated:!0,variantType:"DEFAULT",description:"",imageURL:""},{id:"voyager-v2-darkmatter",name:"Darkmatter",deprecated:!0,variantType:"DARK",description:"",imageURL:""},{id:"voyager-v2-positron",name:"Positron",deprecated:!0,variantType:"LIGHT",description:"",imageURL:""},{id:"voyager-v2-vintage",name:"Vintage",deprecated:!0,variantType:"VINTAGE",description:"",imageURL:""}]},{referenceStyleID:"TONER",name:"Toner",description:"",variants:[{id:"toner-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"toner-v2-background",name:"Background",variantType:"BACKGROUND",deprecated:!0,description:"",imageURL:""},{id:"toner-v2-lite",name:"Lite",variantType:"LITE",description:"",imageURL:""},{id:"toner-v2-lines",name:"Lines",variantType:"LINES",deprecated:!0,description:"",imageURL:""}]},{referenceStyleID:"DATAVIZ",name:"Dataviz",description:"",variants:[{id:"dataviz",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"dataviz-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"dataviz-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"BACKDROP",name:"Backdrop",description:"",variants:[{id:"backdrop",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"backdrop-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"backdrop-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"OCEAN",name:"Ocean",description:"",variants:[{id:"ocean",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"AQUARELLE",name:"Aquarelle",description:"Watercolor map for creative use",variants:[{id:"aquarelle",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"aquarelle-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"aquarelle-vivid",name:"Vivid",variantType:"VIVID",description:"",imageURL:""}]},{referenceStyleID:"LANDSCAPE",name:"Landscape",description:"Terrain map for data overlays and visualisations",variants:[{id:"landscape",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"landscape-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"landscape-vivid",name:"Vivid",variantType:"VIVID",description:"",imageURL:""}]}];function Bw(s){return new Proxy(s,{get(i,l,m){return i.hasVariant(l)?i.getVariant(l):l.toString().toUpperCase()===l?s.getDefaultVariant():Reflect.get(i,l,m)}})}function Ow(){let s={};for(let i=0;i<Ac.length;i+=1){let l=Ac[i],m=Bw(new Bu(l.name,l.referenceStyleID));for(let f=0;f<l.variants.length;f+=1){let a=l.variants[f],P=new Du(a.name,a.variantType,a.id,m,a.description,a.imageURL,a.deprecated);m.addVariant(P)}s[l.referenceStyleID]=m}return s}var Fl=Ow();var Fw=63710088e-1,jC=2*Math.PI*Fw;var Gv=Ec(C0(),1);var z0="3.7.7",Gw=z0,ju=typeof Buffer=="function",I0=typeof TextDecoder=="function"?new TextDecoder:void 0,E0=typeof TextEncoder=="function"?new TextEncoder:void 0,qw="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",$h=Array.prototype.slice.call(qw),hp=(s=>{let i={};return s.forEach((l,m)=>i[l]=m),i})($h),Ww=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,Gr=String.fromCharCode.bind(String),L0=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):s=>new Uint8Array(Array.prototype.slice.call(s,0)),R0=s=>s.replace(/=/g,"").replace(/[+\/]/g,i=>i=="+"?"-":"_"),D0=s=>s.replace(/[^A-Za-z0-9\+\/]/g,""),B0=s=>{let i,l,m,f,a="",P=s.length%3;for(let E=0;E<s.length;){if((l=s.charCodeAt(E++))>255||(m=s.charCodeAt(E++))>255||(f=s.charCodeAt(E++))>255)throw new TypeError("invalid character found");i=l<<16|m<<8|f,a+=$h[i>>18&63]+$h[i>>12&63]+$h[i>>6&63]+$h[i&63]}return P?a.slice(0,P-3)+"===".substring(P):a},Cm=typeof btoa=="function"?s=>btoa(s):ju?s=>Buffer.from(s,"binary").toString("base64"):B0,Pm=ju?s=>Buffer.from(s).toString("base64"):s=>{let l=[];for(let m=0,f=s.length;m<f;m+=4096)l.push(Gr.apply(null,s.subarray(m,m+4096)));return Cm(l.join(""))},dp=(s,i=!1)=>i?R0(Pm(s)):Pm(s),Hw=s=>{if(s.length<2){var i=s.charCodeAt(0);return i<128?s:i<2048?Gr(192|i>>>6)+Gr(128|i&63):Gr(224|i>>>12&15)+Gr(128|i>>>6&63)+Gr(128|i&63)}else{var i=65536+(s.charCodeAt(0)-55296)*1024+(s.charCodeAt(1)-56320);return Gr(240|i>>>18&7)+Gr(128|i>>>12&63)+Gr(128|i>>>6&63)+Gr(128|i&63)}},Kw=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,O0=s=>s.replace(Kw,Hw),A0=ju?s=>Buffer.from(s,"utf8").toString("base64"):E0?s=>Pm(E0.encode(s)):s=>Cm(O0(s)),Nu=(s,i=!1)=>i?R0(A0(s)):A0(s),k0=s=>Nu(s,!0),Xw=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,Yw=s=>{switch(s.length){case 4:var i=(7&s.charCodeAt(0))<<18|(63&s.charCodeAt(1))<<12|(63&s.charCodeAt(2))<<6|63&s.charCodeAt(3),l=i-65536;return Gr((l>>>10)+55296)+Gr((l&1023)+56320);case 3:return Gr((15&s.charCodeAt(0))<<12|(63&s.charCodeAt(1))<<6|63&s.charCodeAt(2));default:return Gr((31&s.charCodeAt(0))<<6|63&s.charCodeAt(1))}},F0=s=>s.replace(Xw,Yw),N0=s=>{if(s=s.replace(/\s+/g,""),!Ww.test(s))throw new TypeError("malformed base64.");s+="==".slice(2-(s.length&3));let i,l="",m,f;for(let a=0;a<s.length;)i=hp[s.charAt(a++)]<<18|hp[s.charAt(a++)]<<12|(m=hp[s.charAt(a++)])<<6|(f=hp[s.charAt(a++)]),l+=m===64?Gr(i>>16&255):f===64?Gr(i>>16&255,i>>8&255):Gr(i>>16&255,i>>8&255,i&255);return l},Im=typeof atob=="function"?s=>atob(D0(s)):ju?s=>Buffer.from(s,"base64").toString("binary"):N0,j0=ju?s=>L0(Buffer.from(s,"base64")):s=>L0(Im(s).split("").map(i=>i.charCodeAt(0))),$0=s=>j0(U0(s)),Jw=ju?s=>Buffer.from(s,"base64").toString("utf8"):I0?s=>I0.decode(j0(s)):s=>F0(Im(s)),U0=s=>D0(s.replace(/[-_]/g,i=>i=="-"?"+":"/")),Mm=s=>Jw(U0(s)),Qw=s=>{if(typeof s!="string")return!1;let i=s.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(i)||!/[^\s0-9a-zA-Z\-_]/.test(i)},Z0=s=>({value:s,enumerable:!1,writable:!0,configurable:!0}),V0=function(){let s=(i,l)=>Object.defineProperty(String.prototype,i,Z0(l));s("fromBase64",function(){return Mm(this)}),s("toBase64",function(i){return Nu(this,i)}),s("toBase64URI",function(){return Nu(this,!0)}),s("toBase64URL",function(){return Nu(this,!0)}),s("toUint8Array",function(){return $0(this)})},G0=function(){let s=(i,l)=>Object.defineProperty(Uint8Array.prototype,i,Z0(l));s("toBase64",function(i){return dp(this,i)}),s("toBase64URI",function(){return dp(this,!0)}),s("toBase64URL",function(){return dp(this,!0)})},e2=()=>{V0(),G0()},q0={version:z0,VERSION:Gw,atob:Im,atobPolyfill:N0,btoa:Cm,btoaPolyfill:B0,fromBase64:Mm,toBase64:Nu,encode:Nu,encodeURI:k0,encodeURL:k0,utob:O0,btou:F0,decode:Mm,isValid:Qw,fromUint8Array:dp,toUint8Array:$0,extendString:V0,extendUint8Array:G0,extendBuiltins:e2};var t2=Object.defineProperty,Vv=s=>{throw TypeError(s)},i2=(s,i,l)=>i in s?t2(s,i,{enumerable:!0,configurable:!0,writable:!0,value:l}):s[i]=l,mi=(s,i,l)=>i2(s,typeof i!="symbol"?i+"":i,l),Tg=(s,i,l)=>i.has(s)||Vv("Cannot "+l),Ni=(s,i,l)=>(Tg(s,i,"read from private field"),l?l.call(s):i.get(s)),kc=(s,i,l)=>i.has(s)?Vv("Cannot add the same private member more than once"):i instanceof WeakSet?i.add(s):i.set(s,l),$u=(s,i,l,m)=>(Tg(s,i,"write to private field"),m?m.call(s,l):i.set(s,l),l),qo=(s,i,l)=>(Tg(s,i,"access private method"),l),Fi=ai({VISITOR:{code:null,flag:"visitor",name:"Visitor",latin:!0,isMode:!0,geocoding:!1},VISITOR_ENGLISH:{code:null,flag:"visitor_en",name:"Visitor English",latin:!0,isMode:!0,geocoding:!1},STYLE:{code:null,flag:"style",name:"Style",latin:!1,isMode:!0,geocoding:!1},STYLE_LOCK:{code:null,flag:"style_lock",name:"Style Lock",latin:!1,isMode:!0,geocoding:!1}},Ou);function W0(){if(typeof navigator>"u"){let s=Intl.DateTimeFormat().resolvedOptions().locale.split("-")[0];return jh(s)||Fi.ENGLISH}return Array.from(new Set(navigator.languages.map(s=>s.split("-")[0]))).map(s=>jh(s)).filter(s=>s)[0]??Fi.LOCAL}var fo={maptilerLogoURL:"https://api.maptiler.com/resources/logo.svg",maptilerURL:"https://www.maptiler.com/",maptilerApiHost:"api.maptiler.com",telemetryURL:"https://api.maptiler.com/metrics",rtlPluginURL:"https://cdn.maptiler.com/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.min.js",primaryLanguage:Fi.STYLE,secondaryLanguage:Fi.LOCAL,terrainSourceURL:"https://api.maptiler.com/tiles/terrain-rgb-v2/tiles.json",terrainSourceId:"maptiler-terrain"};Object.freeze(fo);var Sg=s0(),Fm=class extends Gv.default{constructor(){super(...arguments),mi(this,"primaryLanguage",fo.primaryLanguage),mi(this,"secondaryLanguage"),mi(this,"session",!0),mi(this,"caching",!0),mi(this,"telemetry",!0),mi(this,"_unit","metric"),mi(this,"_apiKey","")}set unit(i){this._unit=i,this.emit("unit",i)}get unit(){return this._unit}set apiKey(i){this._apiKey=i,Lc.apiKey=i,this.emit("apiKey",i)}get apiKey(){return this._apiKey}set fetch(i){Lc.fetch=i}get fetch(){return Lc.fetch}},Kn=new Fm,Nm="localcache_source",jm="localcache",n2="maptiler_sdk",r2=1e3,o2=100,$m=typeof caches<"u",{addProtocol:H0}=$t.default;function a2(s,i){if($m&&Kn.caching&&Kn.session&&s.host===fo.maptilerApiHost){if(i==="Source"&&s.href.includes("tiles.json"))return s.href.replace("https://",`${Nm}://`);if(i==="Tile"||i==="Glyphs")return s.href.replace("https://",`${jm}://`)}return s.href}var Em;async function qv(){return Em||(Em=await caches.open(n2)),Em}var K0=0;async function s2(){let s=await qv(),i=await s.keys(),l=i.slice(0,Math.max(i.length-r2,0));for(let m of l)s.delete(m)}function l2(){H0(Nm,async(s,i)=>{if(!s.url)throw new Error("");s.url=s.url.replace(`${Nm}://`,"https://");let l=s;l.signal=i.signal;let m=await fetch(s.url,l),f=await m.json();return f.tiles&&f.tiles.length>0&&(f.tiles[0]+=`&last-modified=${m.headers.get("Last-Modified")}`),{data:f,cacheControl:m.headers.get("Cache-Control"),expires:m.headers.get("Expires")}}),H0(jm,async(s,i)=>{if(!s.url)throw new Error("");s.url=s.url.replace(`${jm}://`,"https://");let l=new URL(s.url),m=new URL(l);m.searchParams.delete("mtsid"),m.searchParams.delete("key");let f=m.toString(),a=new URL(l);a.searchParams.delete("last-modified");let P=a.toString(),E=async he=>({data:await he.arrayBuffer(),cacheControl:he.headers.get("Cache-Control"),expires:he.headers.get("Expires")}),O=await qv(),B=await O.match(f);if(B)return E(B);let W=s;W.signal=i.signal;let V=await fetch(P,W);return V.status>=200&&V.status<300&&(O.put(f,V.clone()).catch(()=>{}),++K0>o2&&(s2(),K0=0)),E(V)})}function c2(){if(typeof window>"u")return;let s=$t.default.getRTLTextPluginStatus();if(s==="unavailable"||s==="requested")try{$t.default.setRTLTextPlugin(fo.rtlPluginURL,!0)}catch{}}function u2(s,i){for(let l of s)typeof i[l]=="function"&&(i[l]=i[l].bind(i))}function X0(s,i){let l=null;try{l=new URL(s)}catch{return{url:s}}return l.host===fo.maptilerApiHost&&(l.searchParams.has("key")||l.searchParams.append("key",Kn.apiKey),Kn.session&&l.searchParams.append("mtsid",Sg)),{url:a2(l,i)}}function Y0(s){return(i,l)=>{if(s!=null){let m=s(i,l),f=X0(m?.url??"",l);return ai(ai({},m),f)}return X0(i,l)}}function Wv(){return Math.random().toString(36).substring(2)}function Fp(s){return/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/gi.test(s)}function h2(s){try{return JSON.parse(s)}catch{}return null}function d2(){return document.createElement("canvas").getContext("webgl2")?null:typeof WebGL2RenderingContext<"u"?"Graphic rendering with WebGL2 has been disabled or is not supported by your graphic card. The map cannot be displayed.":"Your browser does not support graphic rendering with WebGL2. The map cannot be displayed."}function p2(s){let i=d2();if(!i)return;let l=null;if(typeof s=="string"?l=document.getElementById(s):s instanceof HTMLElement&&(l=s),!l)throw new Error("The Map container must be provided.");let m=document.createElement("div");throw m.innerHTML=i,m.classList.add("webgl-warning-div"),l.appendChild(m),new Error(i)}function J0(s,i){return!(!Array.isArray(s)||s.length!==2||s[0]!=="get"||typeof s[1]!="string"||i&&!s[1].startsWith("name:")||!i&&s[1]!=="name")}function f2(s,i,l){let m=structuredClone(s),f=a=>{if(typeof a!="string")for(let P=0;P<a.length;P+=1)J0(a[P],l)?a[P]=structuredClone(i):f(a[P])};return J0(m,l)?i:(f(m),m)}function m2(s,i){let l=i?/\{name:\S+\}/:/\{name\}/;return{contains:l.test(s),exactMatch:new RegExp(`^${l.source}$`).test(s)}}function g2(s,i,l){let m=l?/\{name:\S+\}/:/\{name\}/,f=s.split(m);return["concat",...f.flatMap((a,P)=>P===f.length-1?[a]:[a,i])]}function _2(s){var i;let l=/\{name(?::(?<language>\S+))?\}/g,m=[];for(;;){let f=l.exec(s);if(!f)break;let a=((i=f.groups)==null?void 0:i.language)??null;m.push(a)}return m}function y2(s){return!Array.isArray(s)||s.length!==2||s[0]!=="get"||typeof s[1]!="string"?null:s[1].trim()==="name"?{isLanguage:!0,localization:null}:s[1].trim().startsWith("name:")?{isLanguage:!0,localization:s[1].trim().split(":").pop()}:null}function v2(s){let i=[],l=structuredClone(s),m=f=>{if(typeof f!="string")for(let a=0;a<f.length;a+=1){let P=y2(f[a]);P?i.push(P.localization):m(f[a])}};return m([l]),i}function x2(s,i){let l=[];for(let a of s){if(a.type!=="symbol")continue;let P=a,{id:E,layout:O}=P;if(!O||!("text-field"in O))continue;let B=i.getLayoutProperty(E,"text-field");if(B)if(typeof B=="string"){let W=_2(B);l.push(W)}else{let W=v2(B);l.push(W)}}let m=l.flat(),f={unlocalized:0,localized:{}};for(let a of m)a===null?f.unlocalized+=1:(a in f.localized||(f.localized[a]=0),f.localized[a]+=1);return f}var cI=class extends $t.default.Marker{addTo(s){return super.addTo(s)}},Q0=class extends $t.default.Popup{addTo(i){return super.addTo(i)}},ev=class extends $t.default.Style{constructor(i,l={}){super(i,l)}},tv=class extends $t.default.CanvasSource{onAdd(i){super.onAdd(i)}},iv=class extends $t.default.GeoJSONSource{onAdd(i){super.onAdd(i)}},nv=class extends $t.default.ImageSource{onAdd(i){super.onAdd(i)}},rv=class extends $t.default.RasterTileSource{onAdd(i){super.onAdd(i)}},ov=class extends $t.default.RasterDEMTileSource{onAdd(i){super.onAdd(i)}},av=class extends $t.default.VectorTileSource{onAdd(i){super.onAdd(i)}},sv=class extends $t.default.VideoSource{onAdd(i){super.onAdd(i)}},Um=class extends $t.default.NavigationControl{onAdd(i){return super.onAdd(i)}},Zm=class extends $t.default.GeolocateControl{onAdd(i){return super.onAdd(i)}},lv=class extends $t.default.AttributionControl{onAdd(i){return super.onAdd(i)}},Vm=class extends $t.default.LogoControl{onAdd(i){return super.onAdd(i)}},Gm=class extends $t.default.ScaleControl{onAdd(i){return super.onAdd(i)}},qm=class extends $t.default.FullscreenControl{onAdd(i){return super.onAdd(i)}},cv=class extends $t.default.TerrainControl{onAdd(i){return super.onAdd(i)}},uv=class extends $t.default.BoxZoomHandler{constructor(i,l){super(i,l)}},hv=class extends $t.default.ScrollZoomHandler{constructor(i,l){super(i,l)}},dv=class extends $t.default.CooperativeGesturesHandler{constructor(i,l){super(i,l)}},pv=class extends $t.default.KeyboardHandler{constructor(i){super(i)}},fv=class extends $t.default.TwoFingersTouchPitchHandler{constructor(i){super(i)}},mv=class extends $t.default.MapWheelEvent{constructor(i,l,m){super(i,l,m)}},gv=class extends $t.default.MapTouchEvent{constructor(i,l,m){super(i,l,m)}},_v=class extends $t.default.MapMouseEvent{constructor(i,l,m,f={}){super(i,l,m,f)}},xp=class extends Vm{constructor(i={}){super(i),mi(this,"logoURL",""),mi(this,"linkURL",""),this.logoURL=i.logoURL??fo.maptilerLogoURL,this.linkURL=i.linkURL??fo.maptilerURL}onAdd(i){this._map=i,this._compact=this.options.compact??!1,this._container=window.document.createElement("div"),this._container.className="maplibregl-ctrl";let l=window.document.createElement("a");return l.style.backgroundRepeat="no-repeat",l.style.cursor="pointer",l.style.display="block",l.style.height="23px",l.style.margin="0 0 -4px -4px",l.style.overflow="hidden",l.style.width="88px",l.style.backgroundImage=`url(${this.logoURL})`,l.style.backgroundSize="100px 30px",l.style.width="100px",l.style.height="30px",l.target="_blank",l.rel="noopener",l.href=this.linkURL,l.setAttribute("aria-label","MapTiler logo"),l.setAttribute("rel","noopener"),this._container.appendChild(l),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}},b2=8,w2={version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},T2={"*":{type:"source"}},S2=["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],P2={type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},M2={type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},C2={type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},I2={type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},E2={type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},L2={type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},A2={id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},k2=["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],z2={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},R2={"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},D2={"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},B2={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},O2={"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},F2={"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},N2={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},j2={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},$2={type:"array",value:"*"},U2={type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},Z2={type:"enum",values:{Point:{},LineString:{},Polygon:{}}},V2={type:"array",minimum:0,maximum:24,value:["number","color"],length:2},G2={type:"array",value:"*",minimum:1},q2={anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},W2={"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},H2={source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},K2={type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},X2=["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],Y2={"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},J2={"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},Q2={"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},eT={"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},tT={"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},iT={"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},nT={"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},rT={"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},oT={duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},aT={"*":{type:"string"}},sT={$version:b2,$root:w2,sources:T2,source:S2,source_vector:P2,source_raster:M2,source_raster_dem:C2,source_geojson:I2,source_video:E2,source_image:L2,layer:A2,layout:k2,layout_background:z2,layout_fill:R2,layout_circle:D2,layout_heatmap:B2,"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:O2,layout_symbol:F2,layout_raster:N2,layout_hillshade:j2,"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:$2,filter_operator:U2,geometry_type:Z2,function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:V2,expression:G2,light:q2,sky:W2,terrain:H2,projection:K2,paint:X2,paint_fill:Y2,"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:J2,paint_circle:Q2,paint_heatmap:eT,paint_symbol:tT,paint_raster:iT,paint_hillshade:nT,"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:rT,transition:oT,"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:aT},_t=class{constructor(i,l,m,f){this.message=(i?`${i}: `:"")+m,f&&(this.identifier=f),l!=null&&l.__line__&&(this.line=l.__line__)}};function bp(s,...i){for(let l of i)for(let m in l)s[m]=l[m];return s}var ua=class extends Error{constructor(i,l){super(l),this.message=l,this.key=i}},Wm=class s{constructor(i,l=[]){this.parent=i,this.bindings={};for(let[m,f]of l)this.bindings[m]=f}concat(i){return new s(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return this.bindings[i]?!0:this.parent?this.parent.has(i):!1}},Np={kind:"null"},bt={kind:"number"},Ii={kind:"string"},wi={kind:"boolean"},Ms={kind:"color"},jp={kind:"projectionDefinition"},Oc={kind:"object"},fi={kind:"value"},lT={kind:"error"},$p={kind:"collator"},Up={kind:"formatted"},Zp={kind:"padding"},Gh={kind:"colorArray"},Vp={kind:"numberArray"},rd={kind:"resolvedImage"},Gp={kind:"variableAnchorOffsetCollection"};function Ho(s,i){return{kind:"array",itemType:s,N:i}}function zn(s){if(s.kind==="array"){let i=zn(s.itemType);return typeof s.N=="number"?`array<${i}, ${s.N}>`:s.itemType.kind==="value"?"array":`array<${i}>`}else return s.kind}var cT=[Np,bt,Ii,wi,Ms,jp,Up,Oc,Ho(fi),Zp,Vp,Gh,rd,Gp];function qh(s,i){if(i.kind==="error")return null;if(s.kind==="array"){if(i.kind==="array"&&(i.N===0&&i.itemType.kind==="value"||!qh(s.itemType,i.itemType))&&(typeof s.N!="number"||s.N===i.N))return null}else{if(s.kind===i.kind)return null;if(s.kind==="value"){for(let l of cT)if(!qh(l,i))return null}}return`Expected ${zn(s)} but found ${zn(i)} instead.`}function Pg(s,i){return i.some(l=>l.kind===s.kind)}function Fc(s,i){return i.some(l=>l==="null"?s===null:l==="array"?Array.isArray(s):l==="object"?s&&!Array.isArray(s)&&typeof s=="object":l===typeof s)}function Nl(s,i){return s.kind==="array"&&i.kind==="array"?s.itemType.kind===i.itemType.kind&&typeof s.N=="number":s.kind===i.kind}var Hv=.96422,Kv=1,Xv=.82521,Yv=4/29,Vu=6/29,Jv=3*Vu*Vu,uT=Vu*Vu*Vu,hT=Math.PI/180,dT=180/Math.PI;function Qv(s){return s=s%360,s<0&&(s+=360),s}function e1([s,i,l,m]){s=Lm(s),i=Lm(i),l=Lm(l);let f,a,P=Am((.2225045*s+.7168786*i+.0606169*l)/Kv);s===i&&i===l?f=a=P:(f=Am((.4360747*s+.3850649*i+.1430804*l)/Hv),a=Am((.0139322*s+.0971045*i+.7141733*l)/Xv));let E=116*P-16;return[E<0?0:E,500*(f-P),200*(P-a),m]}function Lm(s){return s<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function Am(s){return s>uT?Math.pow(s,1/3):s/Jv+Yv}function t1([s,i,l,m]){let f=(s+16)/116,a=isNaN(i)?f:f+i/500,P=isNaN(l)?f:f-l/200;return f=Kv*zm(f),a=Hv*zm(a),P=Xv*zm(P),[km(3.1338561*a-1.6168667*f-.4906146*P),km(-.9787684*a+1.9161415*f+.033454*P),km(.0719453*a-.2289914*f+1.4052427*P),m]}function km(s){return s=s<=.00304?12.92*s:1.055*Math.pow(s,1/2.4)-.055,s<0?0:s>1?1:s}function zm(s){return s>Vu?s*s*s:Jv*(s-Yv)}function pT(s){let[i,l,m,f]=e1(s),a=Math.sqrt(l*l+m*m);return[Math.round(a*1e4)?Qv(Math.atan2(m,l)*dT):NaN,a,i,f]}function fT([s,i,l,m]){return s=isNaN(s)?0:s*hT,t1([l,Math.cos(s)*i,Math.sin(s)*i,m])}function mT([s,i,l,m]){s=Qv(s),i/=100,l/=100;function f(a){let P=(a+s/30)%12,E=i*Math.min(l,1-l);return l-E*Math.max(-1,Math.min(P-3,9-P,1))}return[f(0),f(8),f(4),m]}var gT=Object.hasOwn||function(s,i){return Object.prototype.hasOwnProperty.call(s,i)};function Uh(s,i){return gT(s,i)?s[i]:void 0}function _T(s){if(s=s.toLowerCase().trim(),s==="transparent")return[0,0,0,0];let i=Uh(yT,s);if(i){let[f,a,P]=i;return[f/255,a/255,P/255,1]}if(s.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(s)){let f=s.length<6?1:2,a=1;return[pp(s.slice(a,a+=f)),pp(s.slice(a,a+=f)),pp(s.slice(a,a+=f)),pp(s.slice(a,a+f)||"ff")]}if(s.startsWith("rgb")){let f=/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,a=s.match(f);if(a){let[P,E,O,B,W,V,he,ue,be,ze,Xe,Ve]=a,Se=[B||" ",he||" ",ze].join("");if(Se==="  "||Se==="  /"||Se===",,"||Se===",,,"){let nt=[O,V,be].join(""),pt=nt==="%%%"?100:nt===""?255:0;if(pt){let Pt=[Uu(+E/pt,0,1),Uu(+W/pt,0,1),Uu(+ue/pt,0,1),Xe?yv(+Xe,Ve):1];if(vv(Pt))return Pt}}return}}let l=/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,m=s.match(l);if(m){let[f,a,P,E,O,B,W,V,he]=m,ue=[P||" ",O||" ",W].join("");if(ue==="  "||ue==="  /"||ue===",,"||ue===",,,"){let be=[+a,Uu(+E,0,100),Uu(+B,0,100),V?yv(+V,he):1];if(vv(be))return mT(be)}}}function pp(s){return parseInt(s.padEnd(2,s),16)/255}function yv(s,i){return Uu(i?s/100:s,0,1)}function Uu(s,i,l){return Math.min(Math.max(i,s),l)}function vv(s){return!s.some(Number.isNaN)}var yT={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Nc(s,i,l){return s+l*(i-s)}function Wh(s,i,l){return s.map((m,f)=>Nc(m,i[f],l))}var fn=class s{constructor(i,l,m,f=1,a=!0){this.r=i,this.g=l,this.b=m,this.a=f,a||(this.r*=f,this.g*=f,this.b*=f,f||this.overwriteGetter("rgb",[i,l,m,f]))}static parse(i){if(i instanceof s)return i;if(typeof i!="string")return;let l=_T(i);if(l)return new s(...l,!1)}get rgb(){let{r:i,g:l,b:m,a:f}=this,a=f||1/0;return this.overwriteGetter("rgb",[i/a,l/a,m/a,f])}get hcl(){return this.overwriteGetter("hcl",pT(this.rgb))}get lab(){return this.overwriteGetter("lab",e1(this.rgb))}overwriteGetter(i,l){return Object.defineProperty(this,i,{value:l}),l}toString(){let[i,l,m,f]=this.rgb;return`rgba(${[i,l,m].map(a=>Math.round(a*255)).join(",")},${f})`}static interpolate(i,l,m,f="rgb"){switch(f){case"rgb":{let[a,P,E,O]=Wh(i.rgb,l.rgb,m);return new s(a,P,E,O,!1)}case"hcl":{let[a,P,E,O]=i.hcl,[B,W,V,he]=l.hcl,ue,be;if(!isNaN(a)&&!isNaN(B)){let nt=B-a;B>a&&nt>180?nt-=360:B<a&&a-B>180&&(nt+=360),ue=a+m*nt}else isNaN(a)?isNaN(B)?ue=NaN:(ue=B,(E===1||E===0)&&(be=W)):(ue=a,(V===1||V===0)&&(be=P));let[ze,Xe,Ve,Se]=fT([ue,be??Nc(P,W,m),Nc(E,V,m),Nc(O,he,m)]);return new s(ze,Xe,Ve,Se,!1)}case"lab":{let[a,P,E,O]=t1(Wh(i.lab,l.lab,m));return new s(a,P,E,O,!1)}}}};fn.black=new fn(0,0,0,1);fn.white=new fn(1,1,1,1);fn.transparent=new fn(0,0,0,0);fn.red=new fn(1,0,0,1);var Hh=class{constructor(i,l,m){i?this.sensitivity=l?"variant":"case":this.sensitivity=l?"accent":"base",this.locale=m,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,l){return this.collator.compare(i,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}},vT=["bottom","center","top"],Kh=class{constructor(i,l,m,f,a,P){this.text=i,this.image=l,this.scale=m,this.fontStack=f,this.textColor=a,this.verticalAlign=P}},$c=class s{constructor(i){this.sections=i}static fromString(i){return new s([new Kh(i,null,null,null,null,null)])}isEmpty(){return this.sections.length===0?!0:!this.sections.some(i=>i.text.length!==0||i.image&&i.image.name.length!==0)}static factory(i){return i instanceof s?i:s.fromString(i)}toString(){return this.sections.length===0?"":this.sections.map(i=>i.text).join("")}},ol=class s{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof s)return i;if(typeof i=="number")return new s([i,i,i,i]);if(Array.isArray(i)&&!(i.length<1||i.length>4)){for(let l of i)if(typeof l!="number")return;switch(i.length){case 1:i=[i[0],i[0],i[0],i[0]];break;case 2:i=[i[0],i[1],i[0],i[1]];break;case 3:i=[i[0],i[1],i[2],i[1]];break}return new s(i)}}toString(){return JSON.stringify(this.values)}static interpolate(i,l,m){return new s(Wh(i.values,l.values,m))}},al=class s{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof s)return i;if(typeof i=="number")return new s([i]);if(Array.isArray(i)){for(let l of i)if(typeof l!="number")return;return new s(i)}}toString(){return JSON.stringify(this.values)}static interpolate(i,l,m){return new s(Wh(i.values,l.values,m))}},qa=class s{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof s)return i;if(typeof i=="string"){let m=fn.parse(i);return m?new s([m]):void 0}if(!Array.isArray(i))return;let l=[];for(let m of i){if(typeof m!="string")return;let f=fn.parse(m);if(!f)return;l.push(f)}return new s(l)}toString(){return JSON.stringify(this.values)}static interpolate(i,l,m,f="rgb"){let a=[];if(i.values.length!=l.values.length)throw new Error(`colorArray: Arrays have mismatched length (${i.values.length} vs. ${l.values.length}), cannot interpolate.`);for(let P=0;P<i.values.length;P++)a.push(fn.interpolate(i.values[P],l.values[P],m,f));return new s(a)}},In=class extends Error{constructor(i){super(i),this.name="RuntimeError"}toJSON(){return this.message}},xT=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]),sl=class s{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof s)return i;if(!(!Array.isArray(i)||i.length<1||i.length%2!==0)){for(let l=0;l<i.length;l+=2){let m=i[l],f=i[l+1];if(typeof m!="string"||!xT.has(m)||!Array.isArray(f)||f.length!==2||typeof f[0]!="number"||typeof f[1]!="number")return}return new s(i)}}toString(){return JSON.stringify(this.values)}static interpolate(i,l,m){let f=i.values,a=l.values;if(f.length!==a.length)throw new In(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${l.toString()}`);let P=[];for(let E=0;E<f.length;E+=2){if(f[E]!==a[E])throw new In(`Cannot interpolate values containing mismatched anchors. from[${E}]: ${f[E]}, to[${E}]: ${a[E]}`);P.push(f[E]);let[O,B]=f[E+1],[W,V]=a[E+1];P.push([Nc(O,W,m),Nc(B,V,m)])}return new s(P)}},Ul=class s{constructor(i){this.name=i.name,this.available=i.available}toString(){return this.name}static fromString(i){return i?new s({name:i,available:!1}):null}},Uc=class s{constructor(i,l,m){this.from=i,this.to=l,this.transition=m}static interpolate(i,l,m){return new s(i,l,m)}static parse(i){if(i instanceof s)return i;if(Array.isArray(i)&&i.length===3&&typeof i[0]=="string"&&typeof i[1]=="string"&&typeof i[2]=="number")return new s(i[0],i[1],i[2]);if(typeof i=="object"&&typeof i.from=="string"&&typeof i.to=="string"&&typeof i.transition=="number")return new s(i.from,i.to,i.transition);if(typeof i=="string")return new s(i,i,1)}};function i1(s,i,l,m){return typeof s=="number"&&s>=0&&s<=255&&typeof i=="number"&&i>=0&&i<=255&&typeof l=="number"&&l>=0&&l<=255?typeof m>"u"||typeof m=="number"&&m>=0&&m<=1?null:`Invalid rgba value [${[s,i,l,m].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof m=="number"?[s,i,l,m]:[s,i,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Xh(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof Uc||s instanceof fn||s instanceof Hh||s instanceof $c||s instanceof ol||s instanceof al||s instanceof qa||s instanceof sl||s instanceof Ul)return!0;if(Array.isArray(s)){for(let i of s)if(!Xh(i))return!1;return!0}else if(typeof s=="object"){for(let i in s)if(!Xh(s[i]))return!1;return!0}else return!1}function _r(s){if(s===null)return Np;if(typeof s=="string")return Ii;if(typeof s=="boolean")return wi;if(typeof s=="number")return bt;if(s instanceof fn)return Ms;if(s instanceof Uc)return jp;if(s instanceof Hh)return $p;if(s instanceof $c)return Up;if(s instanceof ol)return Zp;if(s instanceof al)return Vp;if(s instanceof qa)return Gh;if(s instanceof sl)return Gp;if(s instanceof Ul)return rd;if(Array.isArray(s)){let i=s.length,l;for(let m of s){let f=_r(m);if(!l)l=f;else{if(l===f)continue;l=fi;break}}return Ho(l||fi,i)}else return Oc}function Zh(s){let i=typeof s;return s===null?"":i==="string"||i==="number"||i==="boolean"?String(s):s instanceof fn||s instanceof Uc||s instanceof $c||s instanceof ol||s instanceof al||s instanceof qa||s instanceof sl||s instanceof Ul?s.toString():JSON.stringify(s)}var Gu=class s{constructor(i,l){this.type=i,this.value=l}static parse(i,l){if(i.length!==2)return l.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!Xh(i[1]))return l.error("invalid value");let m=i[1],f=_r(m),a=l.expectedType;return f.kind==="array"&&f.N===0&&a&&a.kind==="array"&&(typeof a.N!="number"||a.N===0)&&(f=a),new s(f,m)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}},fp={string:Ii,number:bt,boolean:wi,object:Oc},Ga=class s{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");let m=1,f,a=i[0];if(a==="array"){let E;if(i.length>2){let B=i[1];if(typeof B!="string"||!(B in fp)||B==="object")return l.error('The item type argument of "array" must be one of string, number, boolean',1);E=fp[B],m++}else E=fi;let O;if(i.length>3){if(i[2]!==null&&(typeof i[2]!="number"||i[2]<0||i[2]!==Math.floor(i[2])))return l.error('The length argument to "array" must be a positive integer literal',2);O=i[2],m++}f=Ho(E,O)}else{if(!fp[a])throw new Error(`Types doesn't contain name = ${a}`);f=fp[a]}let P=[];for(;m<i.length;m++){let E=l.parse(i[m],m,fi);if(!E)return null;P.push(E)}return new s(f,P)}evaluate(i){for(let l=0;l<this.args.length;l++){let m=this.args[l].evaluate(i);if(qh(this.type,_r(m))){if(l===this.args.length-1)throw new In(`Expected value to be of type ${zn(this.type)}, but found ${zn(_r(m))} instead.`)}else return m}throw new Error}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}},xv={"to-boolean":wi,"to-color":Ms,"to-number":bt,"to-string":Ii},jl=class s{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");let m=i[0];if(!xv[m])throw new Error(`Can't parse ${m} as it is not part of the known types`);if((m==="to-boolean"||m==="to-string")&&i.length!==2)return l.error("Expected one argument.");let f=xv[m],a=[];for(let P=1;P<i.length;P++){let E=l.parse(i[P],P,fi);if(!E)return null;a.push(E)}return new s(f,a)}evaluate(i){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(i);case"color":{let l,m;for(let f of this.args){if(l=f.evaluate(i),m=null,l instanceof fn)return l;if(typeof l=="string"){let a=i.parseColor(l);if(a)return a}else if(Array.isArray(l)&&(l.length<3||l.length>4?m=`Invalid rgba value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:m=i1(l[0],l[1],l[2],l[3]),!m))return new fn(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new In(m||`Could not parse color from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"padding":{let l;for(let m of this.args){l=m.evaluate(i);let f=ol.parse(l);if(f)return f}throw new In(`Could not parse padding from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"numberArray":{let l;for(let m of this.args){l=m.evaluate(i);let f=al.parse(l);if(f)return f}throw new In(`Could not parse numberArray from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"colorArray":{let l;for(let m of this.args){l=m.evaluate(i);let f=qa.parse(l);if(f)return f}throw new In(`Could not parse colorArray from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"variableAnchorOffsetCollection":{let l;for(let m of this.args){l=m.evaluate(i);let f=sl.parse(l);if(f)return f}throw new In(`Could not parse variableAnchorOffsetCollection from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"number":{let l=null;for(let m of this.args){if(l=m.evaluate(i),l===null)return 0;let f=Number(l);if(!isNaN(f))return f}throw new In(`Could not convert ${JSON.stringify(l)} to number.`)}case"formatted":return $c.fromString(Zh(this.args[0].evaluate(i)));case"resolvedImage":return Ul.fromString(Zh(this.args[0].evaluate(i)));case"projectionDefinition":return this.args[0].evaluate(i);default:return Zh(this.args[0].evaluate(i))}}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}},bT=["Unknown","Point","LineString","Polygon"],wp=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?bT[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(i){let l=this._parseColorCache.get(i);return l||(l=fn.parse(i),this._parseColorCache.set(i,l)),l}},Tp=class s{constructor(i,l,m=[],f,a=new Wm,P=[]){this.registry=i,this.path=m,this.key=m.map(E=>`[${E}]`).join(""),this.scope=a,this.errors=P,this.expectedType=f,this._isConstant=l}parse(i,l,m,f,a={}){return l?this.concat(l,m,f)._parse(i,a):this._parse(i,a)}_parse(i,l){(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number")&&(i=["literal",i]);function m(f,a,P){return P==="assert"?new Ga(a,[f]):P==="coerce"?new jl(a,[f]):f}if(Array.isArray(i)){if(i.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let f=i[0];if(typeof f!="string")return this.error(`Expression name must be a string, but found ${typeof f} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;let a=this.registry[f];if(a){let P=a.parse(i,this);if(!P)return null;if(this.expectedType){let E=this.expectedType,O=P.type;if((E.kind==="string"||E.kind==="number"||E.kind==="boolean"||E.kind==="object"||E.kind==="array")&&O.kind==="value")P=m(P,E,l.typeAnnotation||"assert");else if(E.kind==="projectionDefinition"&&["string","array"].includes(O.kind)||["color","formatted","resolvedImage"].includes(E.kind)&&["value","string"].includes(O.kind)||["padding","numberArray"].includes(E.kind)&&["value","number","array"].includes(O.kind)||E.kind==="colorArray"&&["value","string","array"].includes(O.kind)||E.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(O.kind))P=m(P,E,l.typeAnnotation||"coerce");else if(this.checkSubtype(E,O))return null}if(!(P instanceof Gu)&&P.type.kind!=="resolvedImage"&&this._isConstant(P)){let E=new wp;try{P=new Gu(P.type,P.evaluate(E))}catch(O){return this.error(O.message),null}}return P}return this.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0)}else return typeof i>"u"?this.error("'undefined' value invalid. Use null instead."):typeof i=="object"?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(`Expected an array, but found ${typeof i} instead.`)}concat(i,l,m){let f=typeof i=="number"?this.path.concat(i):this.path,a=m?this.scope.concat(m):this.scope;return new s(this.registry,this._isConstant,f,l||null,a,this.errors)}error(i,...l){let m=`${this.key}${l.map(f=>`[${f}]`).join("")}`;this.errors.push(new ua(m,i))}checkSubtype(i,l){let m=qh(i,l);return m&&this.error(m),m}},Sp=class s{constructor(i,l){this.type=l.type,this.bindings=[].concat(i),this.result=l}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(let l of this.bindings)i(l[1]);i(this.result)}static parse(i,l){if(i.length<4)return l.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);let m=[];for(let a=1;a<i.length-1;a+=2){let P=i[a];if(typeof P!="string")return l.error(`Expected string, but found ${typeof P} instead.`,a);if(/[^a-zA-Z0-9_]/.test(P))return l.error("Variable names must contain only alphanumeric characters or '_'.",a);let E=l.parse(i[a+1],a+1);if(!E)return null;m.push([P,E])}let f=l.parse(i[i.length-1],i.length-1,l.expectedType,m);return f?new s(m,f):null}outputDefined(){return this.result.outputDefined()}},Pp=class s{constructor(i,l){this.type=l.type,this.name=i,this.boundExpression=l}static parse(i,l){if(i.length!==2||typeof i[1]!="string")return l.error("'var' expression requires exactly one string literal argument.");let m=i[1];return l.scope.has(m)?new s(m,l.scope.get(m)):l.error(`Unknown variable "${m}". Make sure "${m}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}},Hm=class s{constructor(i,l,m){this.type=i,this.index=l,this.input=m}static parse(i,l){if(i.length!==3)return l.error(`Expected 2 arguments, but found ${i.length-1} instead.`);let m=l.parse(i[1],1,bt),f=l.parse(i[2],2,Ho(l.expectedType||fi));if(!m||!f)return null;let a=f.type;return new s(a.itemType,m,f)}evaluate(i){let l=this.index.evaluate(i),m=this.input.evaluate(i);if(l<0)throw new In(`Array index out of bounds: ${l} < 0.`);if(l>=m.length)throw new In(`Array index out of bounds: ${l} > ${m.length-1}.`);if(l!==Math.floor(l))throw new In(`Array index must be an integer, but found ${l} instead.`);return m[l]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}},Km=class s{constructor(i,l){this.type=wi,this.needle=i,this.haystack=l}static parse(i,l){if(i.length!==3)return l.error(`Expected 2 arguments, but found ${i.length-1} instead.`);let m=l.parse(i[1],1,fi),f=l.parse(i[2],2,fi);return!m||!f?null:Pg(m.type,[wi,Ii,bt,Np,fi])?new s(m,f):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${zn(m.type)} instead`)}evaluate(i){let l=this.needle.evaluate(i),m=this.haystack.evaluate(i);if(!m)return!1;if(!Fc(l,["boolean","string","number","null"]))throw new In(`Expected first argument to be of type boolean, string, number or null, but found ${zn(_r(l))} instead.`);if(!Fc(m,["string","array"]))throw new In(`Expected second argument to be of type array or string, but found ${zn(_r(m))} instead.`);return m.indexOf(l)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}},Xm=class s{constructor(i,l,m){this.type=bt,this.needle=i,this.haystack=l,this.fromIndex=m}static parse(i,l){if(i.length<=2||i.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);let m=l.parse(i[1],1,fi),f=l.parse(i[2],2,fi);if(!m||!f)return null;if(!Pg(m.type,[wi,Ii,bt,Np,fi]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${zn(m.type)} instead`);if(i.length===4){let a=l.parse(i[3],3,bt);return a?new s(m,f,a):null}else return new s(m,f)}evaluate(i){let l=this.needle.evaluate(i),m=this.haystack.evaluate(i);if(!Fc(l,["boolean","string","number","null"]))throw new In(`Expected first argument to be of type boolean, string, number or null, but found ${zn(_r(l))} instead.`);let f;if(this.fromIndex&&(f=this.fromIndex.evaluate(i)),Fc(m,["string"])){let a=m.indexOf(l,f);return a===-1?-1:[...m.slice(0,a)].length}else{if(Fc(m,["array"]))return m.indexOf(l,f);throw new In(`Expected second argument to be of type array or string, but found ${zn(_r(m))} instead.`)}}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}},Ym=class s{constructor(i,l,m,f,a,P){this.inputType=i,this.type=l,this.input=m,this.cases=f,this.outputs=a,this.otherwise=P}static parse(i,l){if(i.length<5)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!==1)return l.error("Expected an even number of arguments.");let m,f;l.expectedType&&l.expectedType.kind!=="value"&&(f=l.expectedType);let a={},P=[];for(let B=2;B<i.length-1;B+=2){let W=i[B],V=i[B+1];Array.isArray(W)||(W=[W]);let he=l.concat(B);if(W.length===0)return he.error("Expected at least one branch label.");for(let be of W){if(typeof be!="number"&&typeof be!="string")return he.error("Branch labels must be numbers or strings.");if(typeof be=="number"&&Math.abs(be)>Number.MAX_SAFE_INTEGER)return he.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof be=="number"&&Math.floor(be)!==be)return he.error("Numeric branch labels must be integer values.");if(!m)m=_r(be);else if(he.checkSubtype(m,_r(be)))return null;if(typeof a[String(be)]<"u")return he.error("Branch labels must be unique.");a[String(be)]=P.length}let ue=l.parse(V,B,f);if(!ue)return null;f=f||ue.type,P.push(ue)}let E=l.parse(i[1],1,fi);if(!E)return null;let O=l.parse(i[i.length-1],i.length-1,f);return!O||E.type.kind!=="value"&&l.concat(1).checkSubtype(m,E.type)?null:new s(m,f,E,a,P,O)}evaluate(i){let l=this.input.evaluate(i);return(_r(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}},Jm=class s{constructor(i,l,m){this.type=i,this.branches=l,this.otherwise=m}static parse(i,l){if(i.length<4)return l.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!==0)return l.error("Expected an odd number of arguments.");let m;l.expectedType&&l.expectedType.kind!=="value"&&(m=l.expectedType);let f=[];for(let P=1;P<i.length-1;P+=2){let E=l.parse(i[P],P,wi);if(!E)return null;let O=l.parse(i[P+1],P+1,m);if(!O)return null;f.push([E,O]),m=m||O.type}let a=l.parse(i[i.length-1],i.length-1,m);if(!a)return null;if(!m)throw new Error("Can't infer output type");return new s(m,f,a)}evaluate(i){for(let[l,m]of this.branches)if(l.evaluate(i))return m.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(let[l,m]of this.branches)i(l),i(m);i(this.otherwise)}outputDefined(){return this.branches.every(([i,l])=>l.outputDefined())&&this.otherwise.outputDefined()}},Qm=class s{constructor(i,l,m,f){this.type=i,this.input=l,this.beginIndex=m,this.endIndex=f}static parse(i,l){if(i.length<=2||i.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);let m=l.parse(i[1],1,fi),f=l.parse(i[2],2,bt);if(!m||!f)return null;if(!Pg(m.type,[Ho(fi),Ii,fi]))return l.error(`Expected first argument to be of type array or string, but found ${zn(m.type)} instead`);if(i.length===4){let a=l.parse(i[3],3,bt);return a?new s(m.type,m,f,a):null}else return new s(m.type,m,f)}evaluate(i){let l=this.input.evaluate(i),m=this.beginIndex.evaluate(i),f;if(this.endIndex&&(f=this.endIndex.evaluate(i)),Fc(l,["string"]))return[...l].slice(m,f).join("");if(Fc(l,["array"]))return l.slice(m,f);throw new In(`Expected first argument to be of type array or string, but found ${zn(_r(l))} instead.`)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}};function n1(s,i){let l=s.length-1,m=0,f=l,a=0,P,E;for(;m<=f;)if(a=Math.floor((m+f)/2),P=s[a],E=s[a+1],P<=i){if(a===l||i<E)return a;m=a+1}else if(P>i)f=a-1;else throw new In("Input is not a number.");return 0}var Mp=class s{constructor(i,l,m){this.type=i,this.input=l,this.labels=[],this.outputs=[];for(let[f,a]of m)this.labels.push(f),this.outputs.push(a)}static parse(i,l){if(i.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!==0)return l.error("Expected an even number of arguments.");let m=l.parse(i[1],1,bt);if(!m)return null;let f=[],a=null;l.expectedType&&l.expectedType.kind!=="value"&&(a=l.expectedType);for(let P=1;P<i.length;P+=2){let E=P===1?-1/0:i[P],O=i[P+1],B=P,W=P+1;if(typeof E!="number")return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',B);if(f.length&&f[f.length-1][0]>=E)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',B);let V=l.parse(O,W,a);if(!V)return null;a=a||V.type,f.push([E,V])}return new s(a,m,f)}evaluate(i){let l=this.labels,m=this.outputs;if(l.length===1)return m[0].evaluate(i);let f=this.input.evaluate(i);if(f<=l[0])return m[0].evaluate(i);let a=l.length;if(f>=l[a-1])return m[a-1].evaluate(i);let P=n1(l,f);return m[P].evaluate(i)}eachChild(i){i(this.input);for(let l of this.outputs)i(l)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}};function wT(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var Rm,bv;function TT(){if(bv)return Rm;bv=1,Rm=s;function s(i,l,m,f){this.cx=3*i,this.bx=3*(m-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(f-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=l,this.p2x=m,this.p2y=f}return s.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,l){if(l===void 0&&(l=1e-6),i<0)return 0;if(i>1)return 1;for(var m=i,f=0;f<8;f++){var a=this.sampleCurveX(m)-i;if(Math.abs(a)<l)return m;var P=this.sampleCurveDerivativeX(m);if(Math.abs(P)<1e-6)break;m=m-a/P}var E=0,O=1;for(m=i,f=0;f<20&&(a=this.sampleCurveX(m),!(Math.abs(a-i)<l));f++)i>a?E=m:O=m,m=(O-E)*.5+E;return m},solve:function(i,l){return this.sampleCurveY(this.solveCurveX(i,l))}},Rm}var ST=TT(),PT=wT(ST),nl=class s{constructor(i,l,m,f,a){this.type=i,this.operator=l,this.interpolation=m,this.input=f,this.labels=[],this.outputs=[];for(let[P,E]of a)this.labels.push(P),this.outputs.push(E)}static interpolationFactor(i,l,m,f){let a=0;if(i.name==="exponential")a=Dm(l,i.base,m,f);else if(i.name==="linear")a=Dm(l,1,m,f);else if(i.name==="cubic-bezier"){let P=i.controlPoints;a=new PT(P[0],P[1],P[2],P[3]).solve(Dm(l,1,m,f))}return a}static parse(i,l){let[m,f,a,...P]=i;if(!Array.isArray(f)||f.length===0)return l.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){let B=f[1];if(typeof B!="number")return l.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:B}}else if(f[0]==="cubic-bezier"){let B=f.slice(1);if(B.length!==4||B.some(W=>typeof W!="number"||W<0||W>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:B}}else return l.error(`Unknown interpolation type ${String(f[0])}`,1,0);if(i.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!==0)return l.error("Expected an even number of arguments.");if(a=l.parse(a,2,bt),!a)return null;let E=[],O=null;(m==="interpolate-hcl"||m==="interpolate-lab")&&l.expectedType!=Gh?O=Ms:l.expectedType&&l.expectedType.kind!=="value"&&(O=l.expectedType);for(let B=0;B<P.length;B+=2){let W=P[B],V=P[B+1],he=B+3,ue=B+4;if(typeof W!="number")return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',he);if(E.length&&E[E.length-1][0]>=W)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',he);let be=l.parse(V,ue,O);if(!be)return null;O=O||be.type,E.push([W,be])}return!Nl(O,bt)&&!Nl(O,jp)&&!Nl(O,Ms)&&!Nl(O,Zp)&&!Nl(O,Vp)&&!Nl(O,Gh)&&!Nl(O,Gp)&&!Nl(O,Ho(bt))?l.error(`Type ${zn(O)} is not interpolatable.`):new s(O,m,f,a,E)}evaluate(i){let l=this.labels,m=this.outputs;if(l.length===1)return m[0].evaluate(i);let f=this.input.evaluate(i);if(f<=l[0])return m[0].evaluate(i);let a=l.length;if(f>=l[a-1])return m[a-1].evaluate(i);let P=n1(l,f),E=l[P],O=l[P+1],B=s.interpolationFactor(this.interpolation,f,E,O),W=m[P].evaluate(i),V=m[P+1].evaluate(i);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Nc(W,V,B);case"color":return fn.interpolate(W,V,B);case"padding":return ol.interpolate(W,V,B);case"colorArray":return qa.interpolate(W,V,B);case"numberArray":return al.interpolate(W,V,B);case"variableAnchorOffsetCollection":return sl.interpolate(W,V,B);case"array":return Wh(W,V,B);case"projectionDefinition":return Uc.interpolate(W,V,B)}case"interpolate-hcl":switch(this.type.kind){case"color":return fn.interpolate(W,V,B,"hcl");case"colorArray":return qa.interpolate(W,V,B,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return fn.interpolate(W,V,B,"lab");case"colorArray":return qa.interpolate(W,V,B,"lab")}}}eachChild(i){i(this.input);for(let l of this.outputs)i(l)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}};function Dm(s,i,l,m){let f=m-l,a=s-l;return f===0?0:i===1?a/f:(Math.pow(i,a)-1)/(Math.pow(i,f)-1)}fn.interpolate,ol.interpolate,al.interpolate,qa.interpolate,sl.interpolate;var Cp=class s{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");let m=null,f=l.expectedType;f&&f.kind!=="value"&&(m=f);let a=[];for(let P of i.slice(1)){let E=l.parse(P,1+a.length,m,void 0,{typeAnnotation:"omit"});if(!E)return null;m=m||E.type,a.push(E)}if(!m)throw new Error("No output type");return f&&a.some(P=>qh(f,P.type))?new s(fi,a):new s(m,a)}evaluate(i){let l=null,m=0,f;for(let a of this.args)if(m++,l=a.evaluate(i),l&&l instanceof Ul&&!l.available&&(f||(f=l.name),l=null,m===this.args.length&&(l=f)),l!==null)break;return l}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}};function wv(s,i){return s==="=="||s==="!="?i.kind==="boolean"||i.kind==="string"||i.kind==="number"||i.kind==="null"||i.kind==="value":i.kind==="string"||i.kind==="number"||i.kind==="value"}function MT(s,i,l){return i===l}function CT(s,i,l){return i!==l}function IT(s,i,l){return i<l}function ET(s,i,l){return i>l}function LT(s,i,l){return i<=l}function AT(s,i,l){return i>=l}function r1(s,i,l,m){return m.compare(i,l)===0}function kT(s,i,l,m){return!r1(s,i,l,m)}function zT(s,i,l,m){return m.compare(i,l)<0}function RT(s,i,l,m){return m.compare(i,l)>0}function DT(s,i,l,m){return m.compare(i,l)<=0}function BT(s,i,l,m){return m.compare(i,l)>=0}function Wu(s,i,l){let m=s!=="=="&&s!=="!=";return class o1{constructor(a,P,E){this.type=wi,this.lhs=a,this.rhs=P,this.collator=E,this.hasUntypedArgument=a.type.kind==="value"||P.type.kind==="value"}static parse(a,P){if(a.length!==3&&a.length!==4)return P.error("Expected two or three arguments.");let E=a[0],O=P.parse(a[1],1,fi);if(!O)return null;if(!wv(E,O.type))return P.concat(1).error(`"${E}" comparisons are not supported for type '${zn(O.type)}'.`);let B=P.parse(a[2],2,fi);if(!B)return null;if(!wv(E,B.type))return P.concat(2).error(`"${E}" comparisons are not supported for type '${zn(B.type)}'.`);if(O.type.kind!==B.type.kind&&O.type.kind!=="value"&&B.type.kind!=="value")return P.error(`Cannot compare types '${zn(O.type)}' and '${zn(B.type)}'.`);m&&(O.type.kind==="value"&&B.type.kind!=="value"?O=new Ga(B.type,[O]):O.type.kind!=="value"&&B.type.kind==="value"&&(B=new Ga(O.type,[B])));let W=null;if(a.length===4){if(O.type.kind!=="string"&&B.type.kind!=="string"&&O.type.kind!=="value"&&B.type.kind!=="value")return P.error("Cannot use collator to compare non-string types.");if(W=P.parse(a[3],3,$p),!W)return null}return new o1(O,B,W)}evaluate(a){let P=this.lhs.evaluate(a),E=this.rhs.evaluate(a);if(m&&this.hasUntypedArgument){let O=_r(P),B=_r(E);if(O.kind!==B.kind||!(O.kind==="string"||O.kind==="number"))throw new In(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${O.kind}, ${B.kind}) instead.`)}if(this.collator&&!m&&this.hasUntypedArgument){let O=_r(P),B=_r(E);if(O.kind!=="string"||B.kind!=="string")return i(a,P,E)}return this.collator?l(a,P,E,this.collator.evaluate(a)):i(a,P,E)}eachChild(a){a(this.lhs),a(this.rhs),this.collator&&a(this.collator)}outputDefined(){return!0}}}var OT=Wu("==",MT,r1),FT=Wu("!=",CT,kT),NT=Wu("<",IT,zT),jT=Wu(">",ET,RT),$T=Wu("<=",LT,DT),UT=Wu(">=",AT,BT),Ip=class s{constructor(i,l,m){this.type=$p,this.locale=m,this.caseSensitive=i,this.diacriticSensitive=l}static parse(i,l){if(i.length!==2)return l.error("Expected one argument.");let m=i[1];if(typeof m!="object"||Array.isArray(m))return l.error("Collator options argument must be an object.");let f=l.parse(m["case-sensitive"]===void 0?!1:m["case-sensitive"],1,wi);if(!f)return null;let a=l.parse(m["diacritic-sensitive"]===void 0?!1:m["diacritic-sensitive"],1,wi);if(!a)return null;let P=null;return m.locale&&(P=l.parse(m.locale,1,Ii),!P)?null:new s(f,a,P)}evaluate(i){return new Hh(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}},eg=class s{constructor(i,l,m,f,a){this.type=Ii,this.number=i,this.locale=l,this.currency=m,this.minFractionDigits=f,this.maxFractionDigits=a}static parse(i,l){if(i.length!==3)return l.error("Expected two arguments.");let m=l.parse(i[1],1,bt);if(!m)return null;let f=i[2];if(typeof f!="object"||Array.isArray(f))return l.error("NumberFormat options argument must be an object.");let a=null;if(f.locale&&(a=l.parse(f.locale,1,Ii),!a))return null;let P=null;if(f.currency&&(P=l.parse(f.currency,1,Ii),!P))return null;let E=null;if(f["min-fraction-digits"]&&(E=l.parse(f["min-fraction-digits"],1,bt),!E))return null;let O=null;return f["max-fraction-digits"]&&(O=l.parse(f["max-fraction-digits"],1,bt),!O)?null:new s(m,a,P,E,O)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}},tg=class s{constructor(i){this.type=Up,this.sections=i}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");let m=i[1];if(!Array.isArray(m)&&typeof m=="object")return l.error("First argument must be an image or text section.");let f=[],a=!1;for(let P=1;P<=i.length-1;++P){let E=i[P];if(a&&typeof E=="object"&&!Array.isArray(E)){a=!1;let O=null;if(E["font-scale"]&&(O=l.parse(E["font-scale"],1,bt),!O))return null;let B=null;if(E["text-font"]&&(B=l.parse(E["text-font"],1,Ho(Ii)),!B))return null;let W=null;if(E["text-color"]&&(W=l.parse(E["text-color"],1,Ms),!W))return null;let V=null;if(E["vertical-align"]){if(typeof E["vertical-align"]=="string"&&!vT.includes(E["vertical-align"]))return l.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${E["vertical-align"]}' instead.`);if(V=l.parse(E["vertical-align"],1,Ii),!V)return null}let he=f[f.length-1];he.scale=O,he.font=B,he.textColor=W,he.verticalAlign=V}else{let O=l.parse(i[P],1,fi);if(!O)return null;let B=O.type.kind;if(B!=="string"&&B!=="value"&&B!=="null"&&B!=="resolvedImage")return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");a=!0,f.push({content:O,scale:null,font:null,textColor:null,verticalAlign:null})}}return new s(f)}evaluate(i){let l=m=>{let f=m.content.evaluate(i);return _r(f)===rd?new Kh("",f,null,null,null,m.verticalAlign?m.verticalAlign.evaluate(i):null):new Kh(Zh(f),null,m.scale?m.scale.evaluate(i):null,m.font?m.font.evaluate(i).join(","):null,m.textColor?m.textColor.evaluate(i):null,m.verticalAlign?m.verticalAlign.evaluate(i):null)};return new $c(this.sections.map(l))}eachChild(i){for(let l of this.sections)i(l.content),l.scale&&i(l.scale),l.font&&i(l.font),l.textColor&&i(l.textColor),l.verticalAlign&&i(l.verticalAlign)}outputDefined(){return!1}},ig=class s{constructor(i){this.type=rd,this.input=i}static parse(i,l){if(i.length!==2)return l.error("Expected two arguments.");let m=l.parse(i[1],1,Ii);return m?new s(m):l.error("No image name provided.")}evaluate(i){let l=this.input.evaluate(i),m=Ul.fromString(l);return m&&i.availableImages&&(m.available=i.availableImages.indexOf(l)>-1),m}eachChild(i){i(this.input)}outputDefined(){return!1}},ng=class s{constructor(i){this.type=bt,this.input=i}static parse(i,l){if(i.length!==2)return l.error(`Expected 1 argument, but found ${i.length-1} instead.`);let m=l.parse(i[1],1);return m?m.type.kind!=="array"&&m.type.kind!=="string"&&m.type.kind!=="value"?l.error(`Expected argument of type string or array, but found ${zn(m.type)} instead.`):new s(m):null}evaluate(i){let l=this.input.evaluate(i);if(typeof l=="string")return[...l].length;if(Array.isArray(l))return l.length;throw new In(`Expected value to be of type string or array, but found ${zn(_r(l))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}},Cs=8192;function ZT(s,i){let l=VT(s[0]),m=qT(s[1]),f=Math.pow(2,i.z);return[Math.round(l*f*Cs),Math.round(m*f*Cs)]}function Mg(s,i){let l=Math.pow(2,i.z),m=(s[0]/Cs+i.x)/l,f=(s[1]/Cs+i.y)/l;return[GT(m),WT(f)]}function VT(s){return(180+s)/360}function GT(s){return s*360-180}function qT(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function WT(s){return 360/Math.PI*Math.atan(Math.exp((180-s*360)*Math.PI/180))-90}function od(s,i){s[0]=Math.min(s[0],i[0]),s[1]=Math.min(s[1],i[1]),s[2]=Math.max(s[2],i[0]),s[3]=Math.max(s[3],i[1])}function Yh(s,i){return!(s[0]<=i[0]||s[2]>=i[2]||s[1]<=i[1]||s[3]>=i[3])}function HT(s,i,l){return i[1]>s[1]!=l[1]>s[1]&&s[0]<(l[0]-i[0])*(s[1]-i[1])/(l[1]-i[1])+i[0]}function KT(s,i,l){let m=s[0]-i[0],f=s[1]-i[1],a=s[0]-l[0],P=s[1]-l[1];return m*P-a*f===0&&m*a<=0&&f*P<=0}function qp(s,i,l,m){let f=[i[0]-s[0],i[1]-s[1]],a=[m[0]-l[0],m[1]-l[1]];return QT(a,f)===0?!1:!!(Tv(s,i,l,m)&&Tv(l,m,s,i))}function XT(s,i,l){for(let m of l)for(let f=0;f<m.length-1;++f)if(qp(s,i,m[f],m[f+1]))return!0;return!1}function Hu(s,i,l=!1){let m=!1;for(let f of i)for(let a=0;a<f.length-1;a++){if(KT(s,f[a],f[a+1]))return l;HT(s,f[a],f[a+1])&&(m=!m)}return m}function YT(s,i){for(let l of i)if(Hu(s,l))return!0;return!1}function a1(s,i){for(let l of s)if(!Hu(l,i))return!1;for(let l=0;l<s.length-1;++l)if(XT(s[l],s[l+1],i))return!1;return!0}function JT(s,i){for(let l of i)if(a1(s,l))return!0;return!1}function QT(s,i){return s[0]*i[1]-s[1]*i[0]}function Tv(s,i,l,m){let f=s[0]-l[0],a=s[1]-l[1],P=i[0]-l[0],E=i[1]-l[1],O=m[0]-l[0],B=m[1]-l[1],W=f*B-O*a,V=P*B-O*E;return W>0&&V<0||W<0&&V>0}function Cg(s,i,l){let m=[];for(let f=0;f<s.length;f++){let a=[];for(let P=0;P<s[f].length;P++){let E=ZT(s[f][P],l);od(i,E),a.push(E)}m.push(a)}return m}function s1(s,i,l){let m=[];for(let f=0;f<s.length;f++){let a=Cg(s[f],i,l);m.push(a)}return m}function l1(s,i,l,m){if(s[0]<l[0]||s[0]>l[2]){let f=m*.5,a=s[0]-l[0]>f?-m:l[0]-s[0]>f?m:0;a===0&&(a=s[0]-l[2]>f?-m:l[2]-s[0]>f?m:0),s[0]+=a}od(i,s)}function eS(s){s[0]=s[1]=1/0,s[2]=s[3]=-1/0}function Sv(s,i,l,m){let f=Math.pow(2,m.z)*Cs,a=[m.x*Cs,m.y*Cs],P=[];for(let E of s)for(let O of E){let B=[O.x+a[0],O.y+a[1]];l1(B,i,l,f),P.push(B)}return P}function Pv(s,i,l,m){let f=Math.pow(2,m.z)*Cs,a=[m.x*Cs,m.y*Cs],P=[];for(let E of s){let O=[];for(let B of E){let W=[B.x+a[0],B.y+a[1]];od(i,W),O.push(W)}P.push(O)}if(i[2]-i[0]<=f/2){eS(i);for(let E of P)for(let O of E)l1(O,i,l,f)}return P}function tS(s,i){let l=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],f=s.canonicalID();if(i.type==="Polygon"){let a=Cg(i.coordinates,m,f),P=Sv(s.geometry(),l,m,f);if(!Yh(l,m))return!1;for(let E of P)if(!Hu(E,a))return!1}if(i.type==="MultiPolygon"){let a=s1(i.coordinates,m,f),P=Sv(s.geometry(),l,m,f);if(!Yh(l,m))return!1;for(let E of P)if(!YT(E,a))return!1}return!0}function iS(s,i){let l=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],f=s.canonicalID();if(i.type==="Polygon"){let a=Cg(i.coordinates,m,f),P=Pv(s.geometry(),l,m,f);if(!Yh(l,m))return!1;for(let E of P)if(!a1(E,a))return!1}if(i.type==="MultiPolygon"){let a=s1(i.coordinates,m,f),P=Pv(s.geometry(),l,m,f);if(!Yh(l,m))return!1;for(let E of P)if(!JT(E,a))return!1}return!0}var Jh=class s{constructor(i,l){this.type=wi,this.geojson=i,this.geometries=l}static parse(i,l){if(i.length!==2)return l.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(Xh(i[1])){let m=i[1];if(m.type==="FeatureCollection"){let f=[];for(let a of m.features){let{type:P,coordinates:E}=a.geometry;P==="Polygon"&&f.push(E),P==="MultiPolygon"&&f.push(...E)}if(f.length){let a={type:"MultiPolygon",coordinates:f};return new s(m,a)}}else if(m.type==="Feature"){let f=m.geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new s(m,m.geometry)}else if(m.type==="Polygon"||m.type==="MultiPolygon")return new s(m,m)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return tS(i,this.geometries);if(i.geometryType()==="LineString")return iS(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}},Ep=class{constructor(i=[],l=(m,f)=>m<f?-1:m>f?1:0){if(this.data=i,this.length=this.data.length,this.compare=l,this.length>0)for(let m=(this.length>>1)-1;m>=0;m--)this._down(m)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;let i=this.data[0],l=this.data.pop();return--this.length>0&&(this.data[0]=l,this._down(0)),i}peek(){return this.data[0]}_up(i){let{data:l,compare:m}=this,f=l[i];for(;i>0;){let a=i-1>>1,P=l[a];if(m(f,P)>=0)break;l[i]=P,i=a}l[i]=f}_down(i){let{data:l,compare:m}=this,f=this.length>>1,a=l[i];for(;i<f;){let P=(i<<1)+1,E=P+1;if(E<this.length&&m(l[E],l[P])<0&&(P=E),m(l[P],a)>=0)break;l[i]=l[P],i=P}l[i]=a}};function nS(s,i){if(s.length<=1)return[s];let l=[],m,f;for(let a of s){let P=rS(a);P!==0&&(a.area=Math.abs(P),f===void 0&&(f=P<0),f===P<0?(m&&l.push(m),m=[a]):m.push(a))}return m&&l.push(m),l}function rS(s){let i=0;for(let l=0,m=s.length,f=m-1,a,P;l<m;f=l++)a=s[l],P=s[f],i+=(P.x-a.x)*(a.y+P.y);return i}var oS=6378.137,Mv=1/298.257223563,Cv=Mv*(2-Mv),Iv=Math.PI/180,Qh=class{constructor(i){let l=Iv*oS*1e3,m=Math.cos(i*Iv),f=1/(1-Cv*(1-m*m)),a=Math.sqrt(f);this.kx=l*a*m,this.ky=l*a*f*(1-Cv)}distance(i,l){let m=this.wrap(i[0]-l[0])*this.kx,f=(i[1]-l[1])*this.ky;return Math.sqrt(m*m+f*f)}pointOnLine(i,l){let m=1/0,f,a,P,E;for(let O=0;O<i.length-1;O++){let B=i[O][0],W=i[O][1],V=this.wrap(i[O+1][0]-B)*this.kx,he=(i[O+1][1]-W)*this.ky,ue=0;(V!==0||he!==0)&&(ue=(this.wrap(l[0]-B)*this.kx*V+(l[1]-W)*this.ky*he)/(V*V+he*he),ue>1?(B=i[O+1][0],W=i[O+1][1]):ue>0&&(B+=V/this.kx*ue,W+=he/this.ky*ue)),V=this.wrap(l[0]-B)*this.kx,he=(l[1]-W)*this.ky;let be=V*V+he*he;be<m&&(m=be,f=B,a=W,P=O,E=ue)}return{point:[f,a],index:P,t:Math.max(0,Math.min(1,E))}}wrap(i){for(;i<-180;)i+=360;for(;i>180;)i-=360;return i}},rg=100,og=50;function c1(s,i){return i[0]-s[0]}function Lp(s){return s[1]-s[0]+1}function ll(s,i){return s[1]>=s[0]&&s[1]<i}function ag(s,i){if(s[0]>s[1])return[null,null];let l=Lp(s);if(i){if(l===2)return[s,null];let f=Math.floor(l/2);return[[s[0],s[0]+f],[s[0]+f,s[1]]]}if(l===1)return[s,null];let m=Math.floor(l/2)-1;return[[s[0],s[0]+m],[s[0]+m+1,s[1]]]}function sg(s,i){if(!ll(i,s.length))return[1/0,1/0,-1/0,-1/0];let l=[1/0,1/0,-1/0,-1/0];for(let m=i[0];m<=i[1];++m)od(l,s[m]);return l}function lg(s){let i=[1/0,1/0,-1/0,-1/0];for(let l of s)for(let m of l)od(i,m);return i}function Ev(s){return s[0]!==-1/0&&s[1]!==-1/0&&s[2]!==1/0&&s[3]!==1/0}function Ig(s,i,l){if(!Ev(s)||!Ev(i))return NaN;let m=0,f=0;return s[2]<i[0]&&(m=i[0]-s[2]),s[0]>i[2]&&(m=s[0]-i[2]),s[1]>i[3]&&(f=s[1]-i[3]),s[3]<i[1]&&(f=i[1]-s[3]),l.distance([0,0],[m,f])}function Bc(s,i,l){let m=l.pointOnLine(i,s);return l.distance(s,m.point)}function Eg(s,i,l,m,f){let a=Math.min(Bc(s,[l,m],f),Bc(i,[l,m],f)),P=Math.min(Bc(l,[s,i],f),Bc(m,[s,i],f));return Math.min(a,P)}function aS(s,i,l,m,f){if(!(ll(i,s.length)&&ll(m,l.length)))return 1/0;let a=1/0;for(let P=i[0];P<i[1];++P){let E=s[P],O=s[P+1];for(let B=m[0];B<m[1];++B){let W=l[B],V=l[B+1];if(qp(E,O,W,V))return 0;a=Math.min(a,Eg(E,O,W,V,f))}}return a}function sS(s,i,l,m,f){if(!(ll(i,s.length)&&ll(m,l.length)))return NaN;let a=1/0;for(let P=i[0];P<=i[1];++P)for(let E=m[0];E<=m[1];++E)if(a=Math.min(a,f.distance(s[P],l[E])),a===0)return a;return a}function lS(s,i,l){if(Hu(s,i,!0))return 0;let m=1/0;for(let f of i){let a=f[0],P=f[f.length-1];if(a!==P&&(m=Math.min(m,Bc(s,[P,a],l)),m===0))return m;let E=l.pointOnLine(f,s);if(m=Math.min(m,l.distance(s,E.point)),m===0)return m}return m}function cS(s,i,l,m){if(!ll(i,s.length))return NaN;for(let a=i[0];a<=i[1];++a)if(Hu(s[a],l,!0))return 0;let f=1/0;for(let a=i[0];a<i[1];++a){let P=s[a],E=s[a+1];for(let O of l)for(let B=0,W=O.length,V=W-1;B<W;V=B++){let he=O[V],ue=O[B];if(qp(P,E,he,ue))return 0;f=Math.min(f,Eg(P,E,he,ue,m))}}return f}function Lv(s,i){for(let l of s)for(let m of l)if(Hu(m,i,!0))return!0;return!1}function uS(s,i,l,m=1/0){let f=lg(s),a=lg(i);if(m!==1/0&&Ig(f,a,l)>=m)return m;if(Yh(f,a)){if(Lv(s,i))return 0}else if(Lv(i,s))return 0;let P=1/0;for(let E of s)for(let O=0,B=E.length,W=B-1;O<B;W=O++){let V=E[W],he=E[O];for(let ue of i)for(let be=0,ze=ue.length,Xe=ze-1;be<ze;Xe=be++){let Ve=ue[Xe],Se=ue[be];if(qp(V,he,Ve,Se))return 0;P=Math.min(P,Eg(V,he,Ve,Se,l))}}return P}function Av(s,i,l,m,f,a){if(!a)return;let P=Ig(sg(m,a),f,l);P<i&&s.push([P,a,[0,0]])}function mp(s,i,l,m,f,a,P){if(!a||!P)return;let E=Ig(sg(m,a),sg(f,P),l);E<i&&s.push([E,a,P])}function Ap(s,i,l,m,f=1/0){let a=Math.min(m.distance(s[0],l[0][0]),f);if(a===0)return a;let P=new Ep([[0,[0,s.length-1],[0,0]]],c1),E=lg(l);for(;P.length>0;){let O=P.pop();if(O[0]>=a)continue;let B=O[1],W=i?og:rg;if(Lp(B)<=W){if(!ll(B,s.length))return NaN;if(i){let V=cS(s,B,l,m);if(isNaN(V)||V===0)return V;a=Math.min(a,V)}else for(let V=B[0];V<=B[1];++V){let he=lS(s[V],l,m);if(a=Math.min(a,he),a===0)return 0}}else{let V=ag(B,i);Av(P,a,m,s,E,V[0]),Av(P,a,m,s,E,V[1])}}return a}function kp(s,i,l,m,f,a=1/0){let P=Math.min(a,f.distance(s[0],l[0]));if(P===0)return P;let E=new Ep([[0,[0,s.length-1],[0,l.length-1]]],c1);for(;E.length>0;){let O=E.pop();if(O[0]>=P)continue;let B=O[1],W=O[2],V=i?og:rg,he=m?og:rg;if(Lp(B)<=V&&Lp(W)<=he){if(!ll(B,s.length)&&ll(W,l.length))return NaN;let ue;if(i&&m)ue=aS(s,B,l,W,f),P=Math.min(P,ue);else if(i&&!m){let be=s.slice(B[0],B[1]+1);for(let ze=W[0];ze<=W[1];++ze)if(ue=Bc(l[ze],be,f),P=Math.min(P,ue),P===0)return P}else if(!i&&m){let be=l.slice(W[0],W[1]+1);for(let ze=B[0];ze<=B[1];++ze)if(ue=Bc(s[ze],be,f),P=Math.min(P,ue),P===0)return P}else ue=sS(s,B,l,W,f),P=Math.min(P,ue)}else{let ue=ag(B,i),be=ag(W,m);mp(E,P,f,s,l,ue[0],be[0]),mp(E,P,f,s,l,ue[0],be[1]),mp(E,P,f,s,l,ue[1],be[0]),mp(E,P,f,s,l,ue[1],be[1])}}return P}function hS(s,i){let l=s.geometry(),m=l.flat().map(P=>Mg([P.x,P.y],s.canonical));if(l.length===0)return NaN;let f=new Qh(m[0][1]),a=1/0;for(let P of i){switch(P.type){case"Point":a=Math.min(a,kp(m,!1,[P.coordinates],!1,f,a));break;case"LineString":a=Math.min(a,kp(m,!1,P.coordinates,!0,f,a));break;case"Polygon":a=Math.min(a,Ap(m,!1,P.coordinates,f,a));break}if(a===0)return a}return a}function dS(s,i){let l=s.geometry(),m=l.flat().map(P=>Mg([P.x,P.y],s.canonical));if(l.length===0)return NaN;let f=new Qh(m[0][1]),a=1/0;for(let P of i){switch(P.type){case"Point":a=Math.min(a,kp(m,!0,[P.coordinates],!1,f,a));break;case"LineString":a=Math.min(a,kp(m,!0,P.coordinates,!0,f,a));break;case"Polygon":a=Math.min(a,Ap(m,!0,P.coordinates,f,a));break}if(a===0)return a}return a}function pS(s,i){let l=s.geometry();if(l.length===0||l[0].length===0)return NaN;let m=nS(l).map(P=>P.map(E=>E.map(O=>Mg([O.x,O.y],s.canonical)))),f=new Qh(m[0][0][0][1]),a=1/0;for(let P of i)for(let E of m){switch(P.type){case"Point":a=Math.min(a,Ap([P.coordinates],!1,E,f,a));break;case"LineString":a=Math.min(a,Ap(P.coordinates,!0,E,f,a));break;case"Polygon":a=Math.min(a,uS(E,P.coordinates,f,a));break}if(a===0)return a}return a}function Bm(s){return s.type==="MultiPolygon"?s.coordinates.map(i=>({type:"Polygon",coordinates:i})):s.type==="MultiLineString"?s.coordinates.map(i=>({type:"LineString",coordinates:i})):s.type==="MultiPoint"?s.coordinates.map(i=>({type:"Point",coordinates:i})):[s]}var ed=class s{constructor(i,l){this.type=bt,this.geojson=i,this.geometries=l}static parse(i,l){if(i.length!==2)return l.error(`'distance' expression requires exactly one argument, but found ${i.length-1} instead.`);if(Xh(i[1])){let m=i[1];if(m.type==="FeatureCollection")return new s(m,m.features.map(f=>Bm(f.geometry)).flat());if(m.type==="Feature")return new s(m,Bm(m.geometry));if("type"in m&&"coordinates"in m)return new s(m,Bm(m))}return l.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return hS(i,this.geometries);if(i.geometryType()==="LineString")return dS(i,this.geometries);if(i.geometryType()==="Polygon")return pS(i,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}},td=class s{constructor(i){this.type=fi,this.key=i}static parse(i,l){if(i.length!==2)return l.error(`Expected 1 argument, but found ${i.length-1} instead.`);let m=i[1];return m==null?l.error("Global state property must be defined."):typeof m!="string"?l.error(`Global state property must be string, but found ${typeof i[1]} instead.`):new s(m)}evaluate(i){var l;let m=(l=i.globals)===null||l===void 0?void 0:l.globalState;return!m||Object.keys(m).length===0?null:Uh(m,this.key)}eachChild(){}outputDefined(){return!1}},Lg={"==":OT,"!=":FT,">":jT,"<":NT,">=":UT,"<=":$T,array:Ga,at:Hm,boolean:Ga,case:Jm,coalesce:Cp,collator:Ip,format:tg,image:ig,in:Km,"index-of":Xm,interpolate:nl,"interpolate-hcl":nl,"interpolate-lab":nl,length:ng,let:Sp,literal:Gu,match:Ym,number:Ga,"number-format":eg,object:Ga,slice:Qm,step:Mp,string:Ga,"to-boolean":jl,"to-color":jl,"to-number":jl,"to-string":jl,var:Pp,within:Jh,distance:ed,"global-state":td},Zl=class s{constructor(i,l,m,f){this.name=i,this.type=l,this._evaluate=m,this.args=f}evaluate(i){return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}static parse(i,l){let m=i[0],f=s.definitions[m];if(!f)return l.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0);let a=Array.isArray(f)?f[0]:f.type,P=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,E=P.filter(([B])=>!Array.isArray(B)||B.length===i.length-1),O=null;for(let[B,W]of E){O=new Tp(l.registry,zp,l.path,null,l.scope);let V=[],he=!1;for(let ue=1;ue<i.length;ue++){let be=i[ue],ze=Array.isArray(B)?B[ue-1]:B.type,Xe=O.parse(be,1+V.length,ze);if(!Xe){he=!0;break}V.push(Xe)}if(!he){if(Array.isArray(B)&&B.length!==V.length){O.error(`Expected ${B.length} arguments, but found ${V.length} instead.`);continue}for(let ue=0;ue<V.length;ue++){let be=Array.isArray(B)?B[ue]:B.type,ze=V[ue];O.concat(ue+1).checkSubtype(be,ze.type)}if(O.errors.length===0)return new s(m,a,W,V)}}if(E.length===1)l.errors.push(...O.errors);else{let B=(E.length?E:P).map(([V])=>mS(V)).join(" | "),W=[];for(let V=1;V<i.length;V++){let he=l.parse(i[V],1+W.length);if(!he)return null;W.push(zn(he.type))}l.error(`Expected arguments of type ${B}, but found (${W.join(", ")}) instead.`)}return null}static register(i,l){s.definitions=l;for(let m in l)i[m]=s}};function kv(s,[i,l,m,f]){i=i.evaluate(s),l=l.evaluate(s),m=m.evaluate(s);let a=f?f.evaluate(s):1,P=i1(i,l,m,a);if(P)throw new In(P);return new fn(i/255,l/255,m/255,a,!1)}function zv(s,i){return s in i}function Om(s,i){let l=i[s];return typeof l>"u"?null:l}function fS(s,i,l,m){for(;l<=m;){let f=l+m>>1;if(i[f]===s)return!0;i[f]>s?m=f-1:l=f+1}return!1}function zc(s){return{type:s}}Zl.register(Lg,{error:[lT,[Ii],(s,[i])=>{throw new In(i.evaluate(s))}],typeof:[Ii,[fi],(s,[i])=>zn(_r(i.evaluate(s)))],"to-rgba":[Ho(bt,4),[Ms],(s,[i])=>{let[l,m,f,a]=i.evaluate(s).rgb;return[l*255,m*255,f*255,a]}],rgb:[Ms,[bt,bt,bt],kv],rgba:[Ms,[bt,bt,bt,bt],kv],has:{type:wi,overloads:[[[Ii],(s,[i])=>zv(i.evaluate(s),s.properties())],[[Ii,Oc],(s,[i,l])=>zv(i.evaluate(s),l.evaluate(s))]]},get:{type:fi,overloads:[[[Ii],(s,[i])=>Om(i.evaluate(s),s.properties())],[[Ii,Oc],(s,[i,l])=>Om(i.evaluate(s),l.evaluate(s))]]},"feature-state":[fi,[Ii],(s,[i])=>Om(i.evaluate(s),s.featureState||{})],properties:[Oc,[],s=>s.properties()],"geometry-type":[Ii,[],s=>s.geometryType()],id:[fi,[],s=>s.id()],zoom:[bt,[],s=>s.globals.zoom],"heatmap-density":[bt,[],s=>s.globals.heatmapDensity||0],elevation:[bt,[],s=>s.globals.elevation||0],"line-progress":[bt,[],s=>s.globals.lineProgress||0],accumulated:[fi,[],s=>s.globals.accumulated===void 0?null:s.globals.accumulated],"+":[bt,zc(bt),(s,i)=>{let l=0;for(let m of i)l+=m.evaluate(s);return l}],"*":[bt,zc(bt),(s,i)=>{let l=1;for(let m of i)l*=m.evaluate(s);return l}],"-":{type:bt,overloads:[[[bt,bt],(s,[i,l])=>i.evaluate(s)-l.evaluate(s)],[[bt],(s,[i])=>-i.evaluate(s)]]},"/":[bt,[bt,bt],(s,[i,l])=>i.evaluate(s)/l.evaluate(s)],"%":[bt,[bt,bt],(s,[i,l])=>i.evaluate(s)%l.evaluate(s)],ln2:[bt,[],()=>Math.LN2],pi:[bt,[],()=>Math.PI],e:[bt,[],()=>Math.E],"^":[bt,[bt,bt],(s,[i,l])=>Math.pow(i.evaluate(s),l.evaluate(s))],sqrt:[bt,[bt],(s,[i])=>Math.sqrt(i.evaluate(s))],log10:[bt,[bt],(s,[i])=>Math.log(i.evaluate(s))/Math.LN10],ln:[bt,[bt],(s,[i])=>Math.log(i.evaluate(s))],log2:[bt,[bt],(s,[i])=>Math.log(i.evaluate(s))/Math.LN2],sin:[bt,[bt],(s,[i])=>Math.sin(i.evaluate(s))],cos:[bt,[bt],(s,[i])=>Math.cos(i.evaluate(s))],tan:[bt,[bt],(s,[i])=>Math.tan(i.evaluate(s))],asin:[bt,[bt],(s,[i])=>Math.asin(i.evaluate(s))],acos:[bt,[bt],(s,[i])=>Math.acos(i.evaluate(s))],atan:[bt,[bt],(s,[i])=>Math.atan(i.evaluate(s))],min:[bt,zc(bt),(s,i)=>Math.min(...i.map(l=>l.evaluate(s)))],max:[bt,zc(bt),(s,i)=>Math.max(...i.map(l=>l.evaluate(s)))],abs:[bt,[bt],(s,[i])=>Math.abs(i.evaluate(s))],round:[bt,[bt],(s,[i])=>{let l=i.evaluate(s);return l<0?-Math.round(-l):Math.round(l)}],floor:[bt,[bt],(s,[i])=>Math.floor(i.evaluate(s))],ceil:[bt,[bt],(s,[i])=>Math.ceil(i.evaluate(s))],"filter-==":[wi,[Ii,fi],(s,[i,l])=>s.properties()[i.value]===l.value],"filter-id-==":[wi,[fi],(s,[i])=>s.id()===i.value],"filter-type-==":[wi,[Ii],(s,[i])=>s.geometryType()===i.value],"filter-<":[wi,[Ii,fi],(s,[i,l])=>{let m=s.properties()[i.value],f=l.value;return typeof m==typeof f&&m<f}],"filter-id-<":[wi,[fi],(s,[i])=>{let l=s.id(),m=i.value;return typeof l==typeof m&&l<m}],"filter->":[wi,[Ii,fi],(s,[i,l])=>{let m=s.properties()[i.value],f=l.value;return typeof m==typeof f&&m>f}],"filter-id->":[wi,[fi],(s,[i])=>{let l=s.id(),m=i.value;return typeof l==typeof m&&l>m}],"filter-<=":[wi,[Ii,fi],(s,[i,l])=>{let m=s.properties()[i.value],f=l.value;return typeof m==typeof f&&m<=f}],"filter-id-<=":[wi,[fi],(s,[i])=>{let l=s.id(),m=i.value;return typeof l==typeof m&&l<=m}],"filter->=":[wi,[Ii,fi],(s,[i,l])=>{let m=s.properties()[i.value],f=l.value;return typeof m==typeof f&&m>=f}],"filter-id->=":[wi,[fi],(s,[i])=>{let l=s.id(),m=i.value;return typeof l==typeof m&&l>=m}],"filter-has":[wi,[fi],(s,[i])=>i.value in s.properties()],"filter-has-id":[wi,[],s=>s.id()!==null&&s.id()!==void 0],"filter-type-in":[wi,[Ho(Ii)],(s,[i])=>i.value.indexOf(s.geometryType())>=0],"filter-id-in":[wi,[Ho(fi)],(s,[i])=>i.value.indexOf(s.id())>=0],"filter-in-small":[wi,[Ii,Ho(fi)],(s,[i,l])=>l.value.indexOf(s.properties()[i.value])>=0],"filter-in-large":[wi,[Ii,Ho(fi)],(s,[i,l])=>fS(s.properties()[i.value],l.value,0,l.value.length-1)],all:{type:wi,overloads:[[[wi,wi],(s,[i,l])=>i.evaluate(s)&&l.evaluate(s)],[zc(wi),(s,i)=>{for(let l of i)if(!l.evaluate(s))return!1;return!0}]]},any:{type:wi,overloads:[[[wi,wi],(s,[i,l])=>i.evaluate(s)||l.evaluate(s)],[zc(wi),(s,i)=>{for(let l of i)if(l.evaluate(s))return!0;return!1}]]},"!":[wi,[wi],(s,[i])=>!i.evaluate(s)],"is-supported-script":[wi,[Ii],(s,[i])=>{let l=s.globals&&s.globals.isSupportedScript;return l?l(i.evaluate(s)):!0}],upcase:[Ii,[Ii],(s,[i])=>i.evaluate(s).toUpperCase()],downcase:[Ii,[Ii],(s,[i])=>i.evaluate(s).toLowerCase()],concat:[Ii,zc(fi),(s,i)=>i.map(l=>Zh(l.evaluate(s))).join("")],"resolved-locale":[Ii,[$p],(s,[i])=>i.evaluate(s).resolvedLocale()]});function mS(s){return Array.isArray(s)?`(${s.map(zn).join(", ")})`:`(${zn(s.type)}...)`}function zp(s){if(s instanceof Pp)return zp(s.boundExpression);if(s instanceof Zl&&s.name==="error"||s instanceof Ip||s instanceof Jh||s instanceof ed||s instanceof td)return!1;let i=s instanceof jl||s instanceof Ga,l=!0;return s.eachChild(m=>{i?l=l&&zp(m):l=l&&m instanceof Gu}),l?Wp(s)&&Hp(s,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"]):!1}function Wp(s){if(s instanceof Zl&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof Jh||s instanceof ed)return!1;let i=!0;return s.eachChild(l=>{i&&!Wp(l)&&(i=!1)}),i}function id(s){if(s instanceof Zl&&s.name==="feature-state")return!1;let i=!0;return s.eachChild(l=>{i&&!id(l)&&(i=!1)}),i}function Hp(s,i){if(s instanceof Zl&&i.indexOf(s.name)>=0)return!1;let l=!0;return s.eachChild(m=>{l&&!Hp(m,i)&&(l=!1)}),l}function cg(s){return{result:"success",value:s}}function Zu(s){return{result:"error",value:s}}function Rp(s){return s["property-type"]==="data-driven"||s["property-type"]==="cross-faded-data-driven"}function u1(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function h1(s){return!!s.expression&&s.expression.interpolated}function ki(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":s===null?"null":typeof s}function Ag(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)&&_r(s)===Oc}var ug=class{constructor(i,l){this.expression=i,this._warningHistory={},this._evaluator=new wp,this._defaultValue=l?yS(l):null,this._enumValues=l&&l.type==="enum"?l.values:null}evaluateWithoutErrorHandling(i,l,m,f,a,P){return this._evaluator.globals=i,this._evaluator.feature=l,this._evaluator.featureState=m,this._evaluator.canonical=f,this._evaluator.availableImages=a||null,this._evaluator.formattedSection=P,this.expression.evaluate(this._evaluator)}evaluate(i,l,m,f,a,P){this._evaluator.globals=i,this._evaluator.feature=l||null,this._evaluator.featureState=m||null,this._evaluator.canonical=f,this._evaluator.availableImages=a||null,this._evaluator.formattedSection=P||null;try{let E=this.expression.evaluate(this._evaluator);if(E==null||typeof E=="number"&&E!==E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new In(`Expected value to be one of ${Object.keys(this._enumValues).map(O=>JSON.stringify(O)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,typeof console<"u"&&console.warn(E.message)),this._defaultValue}}};function d1(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in Lg}function p1(s,i){let l=new Tp(Lg,zp,[],i?_S(i):void 0),m=l.parse(s,void 0,void 0,void 0,i&&i.type==="string"?{typeAnnotation:"coerce"}:void 0);return m?cg(new ug(m,i)):Zu(l.errors)}var Dp=class{constructor(i,l){this.kind=i,this._styleExpression=l,this.isStateDependent=i!=="constant"&&!id(l.expression),this.globalStateRefs=kg(l.expression)}evaluateWithoutErrorHandling(i,l,m,f,a,P){return this._styleExpression.evaluateWithoutErrorHandling(i,l,m,f,a,P)}evaluate(i,l,m,f,a,P){return this._styleExpression.evaluate(i,l,m,f,a,P)}},Bp=class{constructor(i,l,m,f){this.kind=i,this.zoomStops=m,this._styleExpression=l,this.isStateDependent=i!=="camera"&&!id(l.expression),this.globalStateRefs=kg(l.expression),this.interpolationType=f}evaluateWithoutErrorHandling(i,l,m,f,a,P){return this._styleExpression.evaluateWithoutErrorHandling(i,l,m,f,a,P)}evaluate(i,l,m,f,a,P){return this._styleExpression.evaluate(i,l,m,f,a,P)}interpolationFactor(i,l,m){return this.interpolationType?nl.interpolationFactor(this.interpolationType,i,l,m):0}};function gS(s,i){let l=p1(s,i);if(l.result==="error")return l;let m=l.value.expression,f=Wp(m);if(!f&&!Rp(i))return Zu([new ua("","data expressions not supported")]);let a=Hp(m,["zoom"]);if(!a&&!u1(i))return Zu([new ua("","zoom expressions not supported")]);let P=_p(m);if(!P&&!a)return Zu([new ua("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(P instanceof ua)return Zu([P]);if(P instanceof nl&&!h1(i))return Zu([new ua("",'"interpolate" expressions cannot be used with this property')]);if(!P)return cg(f?new Dp("constant",l.value):new Dp("source",l.value));let E=P instanceof nl?P.interpolation:void 0;return cg(f?new Bp("camera",l.value,P.labels,E):new Bp("composite",l.value,P.labels,E))}function _p(s){let i=null;if(s instanceof Sp)i=_p(s.result);else if(s instanceof Cp){for(let l of s.args)if(i=_p(l),i)break}else(s instanceof Mp||s instanceof nl)&&s.input instanceof Zl&&s.input.name==="zoom"&&(i=s);return i instanceof ua||s.eachChild(l=>{let m=_p(l);m instanceof ua?i=m:!i&&m?i=new ua("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&m&&i!==m&&(i=new ua("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}function kg(s,i=new Set){return s instanceof td&&i.add(s.key),s.eachChild(l=>{kg(l,i)}),i}function _S(s){let i={color:Ms,string:Ii,number:bt,enum:Ii,boolean:wi,formatted:Up,padding:Zp,numberArray:Vp,colorArray:Gh,projectionDefinition:jp,resolvedImage:rd,variableAnchorOffsetCollection:Gp};return s.type==="array"?Ho(i[s.value]||fi,s.length):i[s.type]}function yS(s){if(s.type==="color"&&Ag(s.default))return new fn(0,0,0,0);switch(s.type){case"color":return fn.parse(s.default)||null;case"padding":return ol.parse(s.default)||null;case"numberArray":return al.parse(s.default)||null;case"colorArray":return qa.parse(s.default)||null;case"variableAnchorOffsetCollection":return sl.parse(s.default)||null;case"projectionDefinition":return Uc.parse(s.default)||null;default:return s.default===void 0?null:s.default}}function f1(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(let i of s.slice(1))if(!f1(i)&&typeof i!="boolean")return!1;return!0;default:return!0}}function m1(s){let i=s.key,l=s.value;return l?[new _t(i,l,"constants have been deprecated as of v8")]:[]}function Xn(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function Zc(s){if(Array.isArray(s))return s.map(Zc);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){let i={};for(let l in s)i[l]=Zc(s[l]);return i}return Xn(s)}function ha(s){let i=s.key,l=s.value,m=s.valueSpec||{},f=s.objectElementValidators||{},a=s.style,P=s.styleSpec,E=s.validateSpec,O=[],B=ki(l);if(B!=="object")return[new _t(i,l,`object expected, ${B} found`)];for(let W in l){let V=W.split(".")[0],he=Uh(m,V)||m["*"],ue;if(Uh(f,V))ue=f[V];else if(Uh(m,V))ue=E;else if(f["*"])ue=f["*"];else if(m["*"])ue=E;else{O.push(new _t(i,l[W],`unknown property "${W}"`));continue}O=O.concat(ue({key:(i&&`${i}.`)+W,value:l[W],valueSpec:he,style:a,styleSpec:P,object:l,objectKey:W,validateSpec:E},l))}for(let W in m)f[W]||m[W].required&&m[W].default===void 0&&l[W]===void 0&&O.push(new _t(i,l,`missing required property "${W}"`));return O}function zg(s){let i=s.value,l=s.valueSpec,m=s.validateSpec,f=s.style,a=s.styleSpec,P=s.key,E=s.arrayElementValidator||m;if(ki(i)!=="array")return[new _t(P,i,`array expected, ${ki(i)} found`)];if(l.length&&i.length!==l.length)return[new _t(P,i,`array length ${l.length} expected, length ${i.length} found`)];if(l["min-length"]&&i.length<l["min-length"])return[new _t(P,i,`array length at least ${l["min-length"]} expected, length ${i.length} found`)];let O={type:l.value,values:l.values};a.$version<7&&(O.function=l.function),ki(l.value)==="object"&&(O=l.value);let B=[];for(let W=0;W<i.length;W++)B=B.concat(E({array:i,arrayIndex:W,value:i[W],valueSpec:O,validateSpec:s.validateSpec,style:f,styleSpec:a,key:`${P}[${W}]`}));return B}function Kp(s){let i=s.key,l=s.value,m=s.valueSpec,f=ki(l);return f==="number"&&l!==l&&(f="NaN"),f!=="number"?[new _t(i,l,`number expected, ${f} found`)]:"minimum"in m&&l<m.minimum?[new _t(i,l,`${l} is less than the minimum value ${m.minimum}`)]:"maximum"in m&&l>m.maximum?[new _t(i,l,`${l} is greater than the maximum value ${m.maximum}`)]:[]}function g1(s){let i=s.valueSpec,l=Xn(s.value.type),m,f={},a,P,E=l!=="categorical"&&s.value.property===void 0,O=!E,B=ki(s.value.stops)==="array"&&ki(s.value.stops[0])==="array"&&ki(s.value.stops[0][0])==="object",W=ha({key:s.key,value:s.value,valueSpec:s.styleSpec.function,validateSpec:s.validateSpec,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:V,default:be}});return l==="identity"&&E&&W.push(new _t(s.key,s.value,'missing required property "property"')),l!=="identity"&&!s.value.stops&&W.push(new _t(s.key,s.value,'missing required property "stops"')),l==="exponential"&&s.valueSpec.expression&&!h1(s.valueSpec)&&W.push(new _t(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(O&&!Rp(s.valueSpec)?W.push(new _t(s.key,s.value,"property functions not supported")):E&&!u1(s.valueSpec)&&W.push(new _t(s.key,s.value,"zoom functions not supported"))),(l==="categorical"||B)&&s.value.property===void 0&&W.push(new _t(s.key,s.value,'"property" property is required')),W;function V(ze){if(l==="identity")return[new _t(ze.key,ze.value,'identity function may not have a "stops" property')];let Xe=[],Ve=ze.value;return Xe=Xe.concat(zg({key:ze.key,value:Ve,valueSpec:ze.valueSpec,validateSpec:ze.validateSpec,style:ze.style,styleSpec:ze.styleSpec,arrayElementValidator:he})),ki(Ve)==="array"&&Ve.length===0&&Xe.push(new _t(ze.key,Ve,"array must have at least one stop")),Xe}function he(ze){let Xe=[],Ve=ze.value,Se=ze.key;if(ki(Ve)!=="array")return[new _t(Se,Ve,`array expected, ${ki(Ve)} found`)];if(Ve.length!==2)return[new _t(Se,Ve,`array length 2 expected, length ${Ve.length} found`)];if(B){if(ki(Ve[0])!=="object")return[new _t(Se,Ve,`object expected, ${ki(Ve[0])} found`)];if(Ve[0].zoom===void 0)return[new _t(Se,Ve,"object stop key must have zoom")];if(Ve[0].value===void 0)return[new _t(Se,Ve,"object stop key must have value")];if(P&&P>Xn(Ve[0].zoom))return[new _t(Se,Ve[0].zoom,"stop zoom values must appear in ascending order")];Xn(Ve[0].zoom)!==P&&(P=Xn(Ve[0].zoom),a=void 0,f={}),Xe=Xe.concat(ha({key:`${Se}[0]`,value:Ve[0],valueSpec:{zoom:{}},validateSpec:ze.validateSpec,style:ze.style,styleSpec:ze.styleSpec,objectElementValidators:{zoom:Kp,value:ue}}))}else Xe=Xe.concat(ue({key:`${Se}[0]`,value:Ve[0],validateSpec:ze.validateSpec,style:ze.style,styleSpec:ze.styleSpec},Ve));return d1(Zc(Ve[1]))?Xe.concat([new _t(`${Se}[1]`,Ve[1],"expressions are not allowed in function stops.")]):Xe.concat(ze.validateSpec({key:`${Se}[1]`,value:Ve[1],valueSpec:i,validateSpec:ze.validateSpec,style:ze.style,styleSpec:ze.styleSpec}))}function ue(ze,Xe){let Ve=ki(ze.value),Se=Xn(ze.value),nt=ze.value!==null?ze.value:Xe;if(!m)m=Ve;else if(Ve!==m)return[new _t(ze.key,nt,`${Ve} stop domain type must match previous stop domain type ${m}`)];if(Ve!=="number"&&Ve!=="string"&&Ve!=="boolean")return[new _t(ze.key,nt,"stop domain value must be a number, string, or boolean")];if(Ve!=="number"&&l!=="categorical"){let pt=`number expected, ${Ve} found`;return Rp(i)&&l===void 0&&(pt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new _t(ze.key,nt,pt)]}return l==="categorical"&&Ve==="number"&&(!isFinite(Se)||Math.floor(Se)!==Se)?[new _t(ze.key,nt,`integer expected, found ${Se}`)]:l!=="categorical"&&Ve==="number"&&a!==void 0&&Se<a?[new _t(ze.key,nt,"stop domain values must appear in ascending order")]:(a=Se,l==="categorical"&&Se in f?[new _t(ze.key,nt,"stop domain values must be unique")]:(f[Se]=!0,[]))}function be(ze){return ze.validateSpec({key:ze.key,value:ze.value,valueSpec:i,validateSpec:ze.validateSpec,style:ze.style,styleSpec:ze.styleSpec})}}function qu(s){let i=(s.expressionContext==="property"?gS:p1)(Zc(s.value),s.valueSpec);if(i.result==="error")return i.value.map(m=>new _t(`${s.key}${m.key}`,s.value,m.message));let l=i.value.expression||i.value._styleExpression.expression;if(s.expressionContext==="property"&&s.propertyKey==="text-font"&&!l.outputDefined())return[new _t(s.key,s.value,`Invalid data expression for "${s.propertyKey}". Output values must be contained as literals within the expression.`)];if(s.expressionContext==="property"&&s.propertyType==="layout"&&!id(l))return[new _t(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if(s.expressionContext==="filter"&&!id(l))return[new _t(s.key,s.value,'"feature-state" data expressions are not supported with filters.')];if(s.expressionContext&&s.expressionContext.indexOf("cluster")===0){if(!Hp(l,["zoom","feature-state"]))return[new _t(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(s.expressionContext==="cluster-initial"&&!Wp(l))return[new _t(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function vS(s){let i=s.value,l=s.key,m=ki(i);return m!=="boolean"?[new _t(l,i,`boolean expected, ${m} found`)]:[]}function hg(s){let i=s.key,l=s.value,m=ki(l);return m!=="string"?[new _t(i,l,`color expected, ${m} found`)]:fn.parse(String(l))?[]:[new _t(i,l,`color expected, "${l}" found`)]}function nd(s){let i=s.key,l=s.value,m=s.valueSpec,f=[];return Array.isArray(m.values)?m.values.indexOf(Xn(l))===-1&&f.push(new _t(i,l,`expected one of [${m.values.join(", ")}], ${JSON.stringify(l)} found`)):Object.keys(m.values).indexOf(Xn(l))===-1&&f.push(new _t(i,l,`expected one of [${Object.keys(m.values).join(", ")}], ${JSON.stringify(l)} found`)),f}function Rg(s){return f1(Zc(s.value))?qu(bp({},s,{expressionContext:"filter",valueSpec:{value:"boolean"}})):_1(s)}function _1(s){let i=s.value,l=s.key;if(ki(i)!=="array")return[new _t(l,i,`array expected, ${ki(i)} found`)];let m=s.styleSpec,f,a=[];if(i.length<1)return[new _t(l,i,"filter array must have at least 1 element")];switch(a=a.concat(nd({key:`${l}[0]`,value:i[0],valueSpec:m.filter_operator,style:s.style,styleSpec:s.styleSpec})),Xn(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&Xn(i[1])==="$type"&&a.push(new _t(l,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&a.push(new _t(l,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(f=ki(i[1]),f!=="string"&&a.push(new _t(`${l}[1]`,i[1],`string expected, ${f} found`)));for(let P=2;P<i.length;P++)f=ki(i[P]),Xn(i[1])==="$type"?a=a.concat(nd({key:`${l}[${P}]`,value:i[P],valueSpec:m.geometry_type,style:s.style,styleSpec:s.styleSpec})):f!=="string"&&f!=="number"&&f!=="boolean"&&a.push(new _t(`${l}[${P}]`,i[P],`string, number, or boolean expected, ${f} found`));break;case"any":case"all":case"none":for(let P=1;P<i.length;P++)a=a.concat(_1({key:`${l}[${P}]`,value:i[P],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":f=ki(i[1]),i.length!==2?a.push(new _t(l,i,`filter array for "${i[0]}" operator must have 2 elements`)):f!=="string"&&a.push(new _t(`${l}[1]`,i[1],`string expected, ${f} found`));break}return a}function y1(s,i){let l=s.key,m=s.validateSpec,f=s.style,a=s.styleSpec,P=s.value,E=s.objectKey,O=a[`${i}_${s.layerType}`];if(!O)return[];let B=E.match(/^(.*)-transition$/);if(i==="paint"&&B&&O[B[1]]&&O[B[1]].transition)return m({key:l,value:P,valueSpec:a.transition,style:f,styleSpec:a});let W=s.valueSpec||O[E];if(!W)return[new _t(l,P,`unknown property "${E}"`)];let V;if(ki(P)==="string"&&Rp(W)&&!W.tokens&&(V=/^{([^}]+)}$/.exec(P)))return[new _t(l,P,`"${E}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(V[1])} }\`.`)];let he=[];return s.layerType==="symbol"&&(E==="text-field"&&f&&!f.glyphs&&he.push(new _t(l,P,'use of "text-field" requires a style "glyphs" property')),E==="text-font"&&Ag(Zc(P))&&Xn(P.type)==="identity"&&he.push(new _t(l,P,'"text-font" does not support identity functions'))),he.concat(m({key:s.key,value:P,valueSpec:W,style:f,styleSpec:a,expressionContext:"property",propertyType:i,propertyKey:E}))}function v1(s){return y1(s,"paint")}function x1(s){return y1(s,"layout")}function b1(s){let i=[],l=s.value,m=s.key,f=s.style,a=s.styleSpec;if(ki(l)!=="object")return[new _t(m,l,`object expected, ${ki(l)} found`)];!l.type&&!l.ref&&i.push(new _t(m,l,'either "type" or "ref" is required'));let P=Xn(l.type),E=Xn(l.ref);if(l.id){let O=Xn(l.id);for(let B=0;B<s.arrayIndex;B++){let W=f.layers[B];Xn(W.id)===O&&i.push(new _t(m,l.id,`duplicate layer id "${l.id}", previously used at line ${W.id.__line__}`))}}if("ref"in l){["type","source","source-layer","filter","layout"].forEach(B=>{B in l&&i.push(new _t(m,l[B],`"${B}" is prohibited for ref layers`))});let O;f.layers.forEach(B=>{Xn(B.id)===E&&(O=B)}),O?O.ref?i.push(new _t(m,l.ref,"ref cannot reference another ref layer")):P=Xn(O.type):i.push(new _t(m,l.ref,`ref layer "${E}" not found`))}else if(P!=="background")if(!l.source)i.push(new _t(m,l,'missing required property "source"'));else{let O=f.sources&&f.sources[l.source],B=O&&Xn(O.type);O?B==="vector"&&P==="raster"?i.push(new _t(m,l.source,`layer "${l.id}" requires a raster source`)):B!=="raster-dem"&&P==="hillshade"?i.push(new _t(m,l.source,`layer "${l.id}" requires a raster-dem source`)):B!=="raster-dem"&&P==="color-relief"?i.push(new _t(m,l.source,`layer "${l.id}" requires a raster-dem source`)):B==="raster"&&P!=="raster"?i.push(new _t(m,l.source,`layer "${l.id}" requires a vector source`)):B==="vector"&&!l["source-layer"]?i.push(new _t(m,l,`layer "${l.id}" must specify a "source-layer"`)):B==="raster-dem"&&P!=="hillshade"&&P!=="color-relief"?i.push(new _t(m,l.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):P==="line"&&l.paint&&l.paint["line-gradient"]&&(B!=="geojson"||!O.lineMetrics)&&i.push(new _t(m,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new _t(m,l.source,`source "${l.source}" not found`))}return i=i.concat(ha({key:m,value:l,valueSpec:a.layer,style:s.style,styleSpec:s.styleSpec,validateSpec:s.validateSpec,objectElementValidators:{"*"(){return[]},type(){return s.validateSpec({key:`${m}.type`,value:l.type,valueSpec:a.layer.type,style:s.style,styleSpec:s.styleSpec,validateSpec:s.validateSpec,object:l,objectKey:"type"})},filter:Rg,layout(O){return ha({layer:l,key:O.key,value:O.value,style:O.style,styleSpec:O.styleSpec,validateSpec:O.validateSpec,objectElementValidators:{"*"(B){return x1(bp({layerType:P},B))}}})},paint(O){return ha({layer:l,key:O.key,value:O.value,style:O.style,styleSpec:O.styleSpec,validateSpec:O.validateSpec,objectElementValidators:{"*"(B){return v1(bp({layerType:P},B))}}})}}})),i}function Vc(s){let i=s.value,l=s.key,m=ki(i);return m!=="string"?[new _t(l,i,`string expected, ${m} found`)]:[]}function xS(s){var i;let l=(i=s.sourceName)!==null&&i!==void 0?i:"",m=s.value,f=s.styleSpec,a=f.source_raster_dem,P=s.style,E=[],O=ki(m);if(m===void 0)return E;if(O!=="object")return E.push(new _t("source_raster_dem",m,`object expected, ${O} found`)),E;let B=Xn(m.encoding)==="custom",W=["redFactor","greenFactor","blueFactor","baseShift"],V=s.value.encoding?`"${s.value.encoding}"`:"Default";for(let he in m)!B&&W.includes(he)?E.push(new _t(he,m[he],`In "${l}": "${he}" is only valid when "encoding" is set to "custom". ${V} encoding found`)):a[he]?E=E.concat(s.validateSpec({key:he,value:m[he],valueSpec:a[he],validateSpec:s.validateSpec,style:P,styleSpec:f})):E.push(new _t(he,m[he],`unknown property "${he}"`));return E}var Rv={promoteId:bS};function w1(s){let i=s.value,l=s.key,m=s.styleSpec,f=s.style,a=s.validateSpec;if(!i.type)return[new _t(l,i,'"type" is required')];let P=Xn(i.type),E;switch(P){case"vector":case"raster":return E=ha({key:l,value:i,valueSpec:m[`source_${P.replace("-","_")}`],style:s.style,styleSpec:m,objectElementValidators:Rv,validateSpec:a}),E;case"raster-dem":return E=xS({sourceName:l,value:i,style:s.style,styleSpec:m,validateSpec:a}),E;case"geojson":if(E=ha({key:l,value:i,valueSpec:m.source_geojson,style:f,styleSpec:m,validateSpec:a,objectElementValidators:Rv}),i.cluster)for(let O in i.clusterProperties){let[B,W]=i.clusterProperties[O],V=typeof B=="string"?[B,["accumulated"],["get",O]]:B;E.push(...qu({key:`${l}.${O}.map`,value:W,expressionContext:"cluster-map"})),E.push(...qu({key:`${l}.${O}.reduce`,value:V,expressionContext:"cluster-reduce"}))}return E;case"video":return ha({key:l,value:i,valueSpec:m.source_video,style:f,validateSpec:a,styleSpec:m});case"image":return ha({key:l,value:i,valueSpec:m.source_image,style:f,validateSpec:a,styleSpec:m});case"canvas":return[new _t(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return nd({key:`${l}.type`,value:i.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function bS({key:s,value:i}){if(ki(i)==="string")return Vc({key:s,value:i});{let l=[];for(let m in i)l.push(...Vc({key:`${s}.${m}`,value:i[m]}));return l}}function T1(s){let i=s.value,l=s.styleSpec,m=l.light,f=s.style,a=[],P=ki(i);if(i===void 0)return a;if(P!=="object")return a=a.concat([new _t("light",i,`object expected, ${P} found`)]),a;for(let E in i){let O=E.match(/^(.*)-transition$/);O&&m[O[1]]&&m[O[1]].transition?a=a.concat(s.validateSpec({key:E,value:i[E],valueSpec:l.transition,validateSpec:s.validateSpec,style:f,styleSpec:l})):m[E]?a=a.concat(s.validateSpec({key:E,value:i[E],valueSpec:m[E],validateSpec:s.validateSpec,style:f,styleSpec:l})):a=a.concat([new _t(E,i[E],`unknown property "${E}"`)])}return a}function S1(s){let i=s.value,l=s.styleSpec,m=l.sky,f=s.style,a=ki(i);if(i===void 0)return[];if(a!=="object")return[new _t("sky",i,`object expected, ${a} found`)];let P=[];for(let E in i)m[E]?P=P.concat(s.validateSpec({key:E,value:i[E],valueSpec:m[E],style:f,styleSpec:l})):P=P.concat([new _t(E,i[E],`unknown property "${E}"`)]);return P}function P1(s){let i=s.value,l=s.styleSpec,m=l.terrain,f=s.style,a=[],P=ki(i);if(i===void 0)return a;if(P!=="object")return a=a.concat([new _t("terrain",i,`object expected, ${P} found`)]),a;for(let E in i)m[E]?a=a.concat(s.validateSpec({key:E,value:i[E],valueSpec:m[E],validateSpec:s.validateSpec,style:f,styleSpec:l})):a=a.concat([new _t(E,i[E],`unknown property "${E}"`)]);return a}function wS(s){return Vc(s).length===0?[]:qu(s)}function TS(s){return Vc(s).length===0?[]:qu(s)}function SS(s){let i=s.key,l=s.value;if(ki(l)==="array"){if(l.length<1||l.length>4)return[new _t(i,l,`padding requires 1 to 4 values; ${l.length} values found`)];let m={type:"number"},f=[];for(let a=0;a<l.length;a++)f=f.concat(s.validateSpec({key:`${i}[${a}]`,value:l[a],validateSpec:s.validateSpec,valueSpec:m}));return f}else return Kp({key:i,value:l,valueSpec:{}})}function PS(s){let i=s.key,l=s.value;if(ki(l)==="array"){let m={type:"number"};if(l.length<1)return[new _t(i,l,"array length at least 1 expected, length 0 found")];let f=[];for(let a=0;a<l.length;a++)f=f.concat(s.validateSpec({key:`${i}[${a}]`,value:l[a],validateSpec:s.validateSpec,valueSpec:m}));return f}else return Kp({key:i,value:l,valueSpec:{}})}function MS(s){let i=s.key,l=s.value;if(ki(l)==="array"){if(l.length<1)return[new _t(i,l,"array length at least 1 expected, length 0 found")];let m=[];for(let f=0;f<l.length;f++)m=m.concat(hg({key:`${i}[${f}]`,value:l[f]}));return m}else return hg({key:i,value:l})}function CS(s){let i=s.key,l=s.value,m=ki(l),f=s.styleSpec;if(m!=="array"||l.length<1||l.length%2!==0)return[new _t(i,l,"variableAnchorOffsetCollection requires a non-empty array of even length")];let a=[];for(let P=0;P<l.length;P+=2)a=a.concat(nd({key:`${i}[${P}]`,value:l[P],valueSpec:f.layout_symbol["text-anchor"]})),a=a.concat(zg({key:`${i}[${P+1}]`,value:l[P+1],valueSpec:{length:2,value:"number"},validateSpec:s.validateSpec,style:s.style,styleSpec:f}));return a}function M1(s){let i=[],l=s.value,m=s.key;if(Array.isArray(l)){let f=[],a=[];for(let P in l){l[P].id&&f.includes(l[P].id)&&i.push(new _t(m,l,`all the sprites' ids must be unique, but ${l[P].id} is duplicated`)),f.push(l[P].id),l[P].url&&a.includes(l[P].url)&&i.push(new _t(m,l,`all the sprites' URLs must be unique, but ${l[P].url} is duplicated`)),a.push(l[P].url);let E={id:{type:"string",required:!0},url:{type:"string",required:!0}};i=i.concat(ha({key:`${m}[${P}]`,value:l[P],valueSpec:E,validateSpec:s.validateSpec}))}return i}else return Vc({key:m,value:l})}function IS(s){let i=s.value,l=s.styleSpec,m=l.projection,f=s.style,a=ki(i);if(i===void 0)return[];if(a!=="object")return[new _t("projection",i,`object expected, ${a} found`)];let P=[];for(let E in i)m[E]?P=P.concat(s.validateSpec({key:E,value:i[E],valueSpec:m[E],style:f,styleSpec:l})):P=P.concat([new _t(E,i[E],`unknown property "${E}"`)]);return P}function ES(s){let i=s.key,l=s.value;l=l instanceof String?l.valueOf():l;let m=ki(l);return m==="array"&&!AS(l)&&!LS(l)?[new _t(i,l,`projection expected, invalid array ${JSON.stringify(l)} found`)]:["array","string"].includes(m)?[]:[new _t(i,l,`projection expected, invalid type "${m}" found`)]}function LS(s){return!!["interpolate","step","literal"].includes(s[0])}function AS(s){return Array.isArray(s)&&s.length===3&&typeof s[0]=="string"&&typeof s[1]=="string"&&typeof s[2]=="number"}function kS(s){return!!s&&s.constructor===Object}function C1(s){return kS(s.value)?[]:[new _t(s.key,s.value,`object expected, ${ki(s.value)} found`)]}var Dv={"*"(){return[]},array:zg,boolean:vS,number:Kp,color:hg,constants:m1,enum:nd,filter:Rg,function:g1,layer:b1,object:ha,source:w1,light:T1,sky:S1,terrain:P1,projection:IS,projectionDefinition:ES,string:Vc,formatted:wS,resolvedImage:TS,padding:SS,numberArray:PS,colorArray:MS,variableAnchorOffsetCollection:CS,sprite:M1,state:C1};function Op(s){let i=s.value,l=s.valueSpec,m=s.styleSpec;return s.validateSpec=Op,l.expression&&Ag(Xn(i))?g1(s):l.expression&&d1(Zc(i))?qu(s):l.type&&Dv[l.type]?Dv[l.type](s):ha(bp({},s,{valueSpec:l.type?m[l.type]:l}))}function I1(s){let i=s.value,l=s.key,m=Vc(s);return m.length||(i.indexOf("{fontstack}")===-1&&m.push(new _t(l,i,'"glyphs" url must include a "{fontstack}" token')),i.indexOf("{range}")===-1&&m.push(new _t(l,i,'"glyphs" url must include a "{range}" token'))),m}function Ko(s,i=sT){let l=[];return l=l.concat(Op({key:"",value:s,valueSpec:i.$root,styleSpec:i,style:s,validateSpec:Op,objectElementValidators:{glyphs:I1,"*"(){return[]}}})),s.constants&&(l=l.concat(m1({key:"constants",value:s.constants}))),E1(l)}Ko.source=Ha(Wa(w1));Ko.sprite=Ha(Wa(M1));Ko.glyphs=Ha(Wa(I1));Ko.light=Ha(Wa(T1));Ko.sky=Ha(Wa(S1));Ko.terrain=Ha(Wa(P1));Ko.state=Ha(Wa(C1));Ko.layer=Ha(Wa(b1));Ko.filter=Ha(Wa(Rg));Ko.paintProperty=Ha(Wa(v1));Ko.layoutProperty=Ha(Wa(x1));function Wa(s){return function(i){return s(Po(ai({},i),{validateSpec:Op}))}}function E1(s){return[].concat(s).sort((i,l)=>i.line-l.line)}function Ha(s){return function(...i){return E1(s.apply(this,i))}}function Bv(s){if(!s)return{style:Fl[Ac[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0};if(typeof s=="string"){let i=RS(s);return i.isValidStyle?{style:i.styleObject,requiresUrlMonitoring:!1,isFallback:!1}:i.isValidJSON?{style:Fl[Ac[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0}:s.startsWith("http")?{style:s,requiresUrlMonitoring:!0,isFallback:!1}:s.toLowerCase().includes(".json")?{style:zS(s),requiresUrlMonitoring:!0,isFallback:!1}:{style:lp(s),requiresUrlMonitoring:!0,isFallback:!1}}return s instanceof Du?{style:s.getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!1}:s instanceof Bu?{style:s.getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!1}:Ko(s).length===0?{style:s,requiresUrlMonitoring:!1,isFallback:!1}:{style:Fl[Ac[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0}}function zS(s){try{return new URL(s).href}catch{}return new URL(s,location.origin).href}function RS(s){try{let i=JSON.parse(s),l=Ko(i);return{isValidJSON:!0,isValidStyle:l.length===0,styleObject:l.length===0?i:null}}catch{return{isValidJSON:!1,isValidStyle:!1,styleObject:null}}}function rl(s,i,l){let m=window.document.createElement(s);return i!==void 0&&(m.className=i),l&&l.appendChild(m),m}function Dg(s){s.parentNode&&s.parentNode.removeChild(s)}var dg=class{constructor(){mi(this,"_map"),mi(this,"_container"),mi(this,"_terrainButton"),u2(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(i){return this._map=i,this._container=rl("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=rl("button","maplibregl-ctrl-terrain",this._container),rl("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){Dg(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.hasTerrain()?this._map.disableTerrain():this._map.enableTerrain(),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.hasTerrain()?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))}},pg=class extends Um{constructor(i={}){super({showCompass:i.showCompass??!0,showZoom:i.showZoom??!0,visualizePitch:i.visualizePitch??!0}),mi(this,"_rotateCompassArrow",()=>{let l=this._map.getBearing(),m=this._map.getPitch(),f=this.options.visualizePitch?`scale(${Math.min(1.5,1/Math.cos(m*(Math.PI/180))**.5)}) rotateX(${Math.min(70,m)}deg) rotateZ(${-l}deg)`:`rotate(${-l}deg)`;this._compassIcon.style.transform=f}),this._compass&&(this._compass.removeEventListener("click",this._compass.clickFunction),this._compass.addEventListener("click",l=>{this._map.getPitch()===0?this._map.easeTo({pitch:Math.min(this._map.getMaxPitch(),80)}):this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:l}):this._map.resetNorth({},{originalEvent:l})}))}_createButton(i,l){let m=super._createButton(i,l);return m.clickFunction=l,m}},Ov=$t.default.Marker,Fv=$t.default.LngLat,DS=$t.default.LngLatBounds,fg=class extends Zm{constructor(){super(...arguments),mi(this,"lastUpdatedCenter",new Fv(0,0)),mi(this,"_updateCamera",i=>{var l;let m=new Fv(i.coords.longitude,i.coords.latitude),f=i.coords.accuracy,a=Po(ai({bearing:this._map.getBearing()},this.options.fitBoundsOptions),{linear:!0}),P=this._map.getZoom();P>(((l=this.options.fitBoundsOptions)==null?void 0:l.maxZoom)??30)&&(a.zoom=P),this._map.fitBounds(DS.fromLngLat(m,f),a,{geolocateSource:!0});let E=!1,O=()=>{E=!0};this._map.once("click",O),this._map.once("dblclick",O),this._map.once("dragstart",O),this._map.once("mousedown",O),this._map.once("touchstart",O),this._map.once("wheel",O),this._map.once("moveend",()=>{this._map.off("click",O),this._map.off("dblclick",O),this._map.off("dragstart",O),this._map.off("mousedown",O),this._map.off("touchstart",O),this._map.off("wheel",O),!E&&(this.lastUpdatedCenter=this._map.getCenter())})}),mi(this,"_finishSetupUI",i=>{if(this._map){if(i===!1){let l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=l,this._geolocateButton.setAttribute("aria-label",l)}else{let l=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=l,this._geolocateButton.setAttribute("aria-label",l)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=rl("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Ov({element:this._dotElement}),this._circleElement=rl("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ov({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("move",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("moveend",l=>{let m=l.originalEvent&&l.originalEvent.type==="resize",f=this.lastUpdatedCenter.distanceTo(this._map.getCenter());!l.geolocateSource&&this._watchState==="ACTIVE_LOCK"&&!m&&f>1&&(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new Event("trackuserlocationend")))})}}),mi(this,"_onZoom",()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()})}_updateCircleRadius(){if(this._watchState!=="BACKGROUND"&&this._watchState!=="ACTIVE_LOCK")return;let i=[this._lastKnownPosition.coords.longitude,this._lastKnownPosition.coords.latitude],l=this._map.project(i),m=this._map.unproject([l.x,l.y]),f=this._map.unproject([l.x+20,l.y]),a=m.distanceTo(f)/20,P=Math.ceil(2*this._accuracy/a);this._circleElement.style.width=`${P}px`,this._circleElement.style.height=`${P}px`}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;case"BACKGROUND_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}},Wo,Ps,Rc,Dc,la,yp,po,L1,ca,A1,Vh=class{constructor(i,l){kc(this,po),kc(this,Wo),mi(this,"map"),kc(this,Ps),kc(this,Rc),kc(this,Dc),kc(this,la,!1),kc(this,yp),i.style!==void 0&&$u(this,la,!0),$u(this,Wo,Po(ai(Po(ai({zoomAdjust:-4,position:"top-right"},l),{forceNoAttributionControl:!0,attributionControl:!1,navigationControl:!1,geolocateControl:!1,maptilerLogo:!1,minimap:!1,hash:!1,pitchAdjust:!1}),i),{containerStyle:ai({border:"1px solid #000",width:"400px",height:"300px"},i.containerStyle??{})})),i.lockZoom!==void 0&&(Ni(this,Wo).minZoom=i.lockZoom,Ni(this,Wo).maxZoom=i.lockZoom)}setStyle(i,l){Ni(this,la)||this.map.setStyle(i,l),qo(this,po,ca).call(this)}addLayer(i,l){return Ni(this,la)||this.map.addLayer(i,l),qo(this,po,ca).call(this),this.map}moveLayer(i,l){return Ni(this,la)||this.map.moveLayer(i,l),qo(this,po,ca).call(this),this.map}removeLayer(i){return Ni(this,la)||this.map.removeLayer(i),qo(this,po,ca).call(this),this}setLayerZoomRange(i,l,m){return Ni(this,la)||this.map.setLayerZoomRange(i,l,m),qo(this,po,ca).call(this),this}setFilter(i,l,m){return Ni(this,la)||this.map.setFilter(i,l,m),qo(this,po,ca).call(this),this}setPaintProperty(i,l,m,f){return Ni(this,la)||this.map.setPaintProperty(i,l,m,f),qo(this,po,ca).call(this),this}setLayoutProperty(i,l,m,f){return Ni(this,la)||this.map.setLayoutProperty(i,l,m,f),qo(this,po,ca).call(this),this}setGlyphs(i,l){return Ni(this,la)||this.map.setGlyphs(i,l),qo(this,po,ca).call(this),this}onAdd(i){$u(this,Ps,i),$u(this,Rc,rl("div","maplibregl-ctrl maplibregl-ctrl-group"));for(let[l,m]of Object.entries(Ni(this,Wo).containerStyle))Ni(this,Rc).style.setProperty(l,m);return Ni(this,Wo).container=Ni(this,Rc),Ni(this,Wo).zoom=i.getZoom()+Ni(this,Wo).zoomAdjust,this.map=new Bg(Ni(this,Wo)),this.map.once("style.load",()=>{this.map.resize()}),this.map.once("load",()=>{qo(this,po,L1).call(this,Ni(this,Wo).parentRect),$u(this,yp,qo(this,po,A1).call(this))}),Ni(this,Rc)}onRemove(){var i;(i=Ni(this,yp))==null||i.call(this),Dg(Ni(this,Rc))}};Wo=new WeakMap,Ps=new WeakMap,Rc=new WeakMap,Dc=new WeakMap,la=new WeakMap,yp=new WeakMap,po=new WeakSet,L1=function(s){s===void 0||s.linePaint===void 0&&s.fillPaint===void 0||($u(this,Dc,{type:"Feature",properties:{name:"parentRect"},geometry:{type:"Polygon",coordinates:[[[],[],[],[],[]]]}}),this.map.addSource("parentRect",{type:"geojson",data:Ni(this,Dc)}),(s.lineLayout!==void 0||s.linePaint!==void 0)&&this.map.addLayer({id:"parentRectOutline",type:"line",source:"parentRect",layout:ai({},s.lineLayout),paint:ai({"line-color":"#FFF","line-width":1,"line-opacity":.85},s.linePaint)}),s.fillPaint!==void 0&&this.map.addLayer({id:"parentRectFill",type:"fill",source:"parentRect",layout:{},paint:ai({"fill-color":"#08F","fill-opacity":.135},s.fillPaint)}),qo(this,po,ca).call(this))},ca=function(){if(Ni(this,Dc)===void 0)return;let{devicePixelRatio:s}=window,i=Ni(this,Ps).getCanvas(),l=i.width/s,m=i.height/s,f=Ni(this,Ps).unproject.bind(Ni(this,Ps)),a=f([0,0]),P=f([l,0]),E=f([0,m]),O=f([l,m]);Ni(this,Dc).geometry.coordinates=[[E.toArray(),O.toArray(),P.toArray(),a.toArray(),E.toArray()]];let B=this.map.getSource("parentRect");B!==void 0&&B.setData(Ni(this,Dc))},A1=function(){let{pitchAdjust:s}=Ni(this,Wo),i=()=>{a("parent")},l=()=>{a("minimap")},m=()=>{Ni(this,Ps).on("move",i),this.map.on("move",l)},f=()=>{Ni(this,Ps).off("move",i),this.map.off("move",l)},a=P=>{f();let E=P==="parent"?Ni(this,Ps):this.map,O=P==="parent"?this.map:Ni(this,Ps),B=E.getCenter(),W=E.getZoom()+Ni(this,Wo).zoomAdjust*(P==="parent"?1:-1),V=E.getBearing(),he=E.getPitch();O.jumpTo({center:B,zoom:W,bearing:V,pitch:s?he:0}),qo(this,po,ca).call(this),m()};return m(),()=>{f()}};var mg=class{constructor(){mi(this,"map"),mi(this,"container"),mi(this,"projectionButton")}onAdd(i){return this.map=i,this.container=rl("div","maplibregl-ctrl maplibregl-ctrl-group"),this.projectionButton=rl("button","maplibregl-ctrl-projection",this.container),rl("span","maplibregl-ctrl-icon",this.projectionButton).setAttribute("aria-hidden","true"),this.projectionButton.type="button",this.projectionButton.addEventListener("click",this.toggleProjection.bind(this)),i.on("projectiontransition",this.updateProjectionIcon.bind(this)),this.updateProjectionIcon(),this.container}onRemove(){Dg(this.container),this.map.off("projectiontransition",this.updateProjectionIcon),this.map=void 0}toggleProjection(){this.map.getProjection()===void 0&&this.map.setProjection({type:"mercator"}),this.map.isGlobeProjection()?this.map.enableMercatorProjection():this.map.enableGlobeProjection(),this.updateProjectionIcon()}updateProjectionIcon(){this.projectionButton.classList.remove("maplibregl-ctrl-projection-globe"),this.projectionButton.classList.remove("maplibregl-ctrl-projection-mercator"),this.map.isGlobeProjection()?(this.projectionButton.classList.add("maplibregl-ctrl-projection-mercator"),this.projectionButton.title="Enable Mercator projection"):(this.projectionButton.classList.add("maplibregl-ctrl-projection-globe"),this.projectionButton.title="Enable Globe projection")}},BS="@maptiler/sdk",OS="3.3.0",FS="The Javascript & TypeScript map SDK tailored for MapTiler Cloud",NS="MapTiler",jS="dist/maptiler-sdk.mjs",$S="dist/maptiler-sdk.d.ts",US="dist/maptiler-sdk.css",ZS="module",VS={".":{import:"./dist/maptiler-sdk.mjs",types:"./dist/maptiler-sdk.d.ts"},"./dist/maptiler-sdk.css":{import:"./dist/maptiler-sdk.css"},"./style.css":{import:"./dist/maptiler-sdk.css"}},GS=["maptiler","map","sdk","webmap","cloud","webGL","maplibre"],qS="https://docs.maptiler.com/sdk-js/",WS="BSD-3-Clause",HS={type:"git",url:"https://github.com/maptiler/maptiler-sdk-js.git"},KS={prepare:"husky",doc:"rm -rf docs/* && typedoc --out docs && cp -r images docs/",ncu:"npx npm-check-updates",lint:"tsc --noEmit && eslint src","lint:fix":"tsc --noEmit && eslint src --fix","test:watch":"vitest watch -c vite.config-test.ts --dom",test:"vitest run -c vite.config-test.ts --dom","install:clean":"rm -rf build/ dist/ node_modules/ && npm ci",dev:"npm run build-css && vite -c vite.config-dev.ts","dev-umd":"npm run build-css && tsc && NODE_ENV=development vite build -w -c vite.config-umd.ts","build-css":"mkdir -p dist build && node scripts/replace-path-with-content.js src/style/style_template.css dist/tmp_maptiler-sdk.css && cat node_modules/maplibre-gl/dist/maplibre-gl.css dist/tmp_maptiler-sdk.css > dist/maptiler-sdk.css && rm dist/tmp_maptiler-sdk.css && cp dist/maptiler-sdk.css build/maptiler-sdk.css","build-umd":"tsc && NODE_ENV=production vite build -c vite.config-umd.ts","build-es":"tsc && NODE_ENV=production vite build -c vite.config-es.ts",build:"npm run build-es; npm run build-umd; npm run build-css",make:"npm run install:clean && npm run build"},XS={"@canvas/image-data":"^1.0.0","@eslint/js":"^9.21.0","@types/stats.js":"^0.17.4","@types/uuid":"^10.0.0","@types/xmldom":"^0.1.31","@vitest/web-worker":"^3.0.9","@xmldom/xmldom":"^0.8.10",concurrently:"^9.1.2",eslint:"^9.21.0","eslint-config-prettier":"^10.0.2","eslint-plugin-prettier":"^5.2.3","happy-dom":"^17.4.4",husky:"^8.0.0",jiti:"^2.4.2","lint-staged":"^15.4.3",prettier:"3.5.2","stats.js":"^0.17.0",typedoc:"^0.27.6",typescript:"^5.7.3","typescript-eslint":"^8.25.0",vite:"^6.0.7","vite-plugin-dts":"^4.5.0",vitest:"^3.0.9"},YS={"@maplibre/maplibre-gl-style-spec":"^23.0.0","@maptiler/client":"^2.3.2",events:"^3.3.0","js-base64":"^3.7.7","maplibre-gl":"^5.5.0",uuid:"^11.0.5"},JS={name:BS,version:OS,description:FS,author:NS,module:jS,types:$S,style:US,type:ZS,exports:VS,keywords:GS,homepage:qS,license:WS,repository:HS,scripts:KS,"lint-staged":{"*.ts":"npm run lint:fix"},devDependencies:XS,dependencies:YS},gg=class{constructor(i,l=2e3){mi(this,"map"),mi(this,"registeredModules",new Set),this.map=i,setTimeout(async()=>{if(!Kn.telemetry)return;let m=this.preparePayload();try{(await fetch(m,{method:"POST"})).ok||console.warn("The metrics could not be sent to MapTiler Cloud")}catch(f){console.warn("The metrics could not be sent to MapTiler Cloud",f)}},Math.max(1e3,l))}registerModule(i,l){this.registeredModules.add(`${i}:${l}`)}preparePayload(){let i=new URL(fo.telemetryURL);return i.searchParams.append("sdk",JS.version),i.searchParams.append("key",Kn.apiKey),i.searchParams.append("mtsid",Sg),i.searchParams.append("session",Kn.session?"1":"0"),i.searchParams.append("caching",Kn.caching?"1":"0"),i.searchParams.append("lang-updated",this.map.isLanguageUpdated()?"1":"0"),i.searchParams.append("terrain",this.map.getTerrain()?"1":"0"),i.searchParams.append("globe",this.map.isGlobeProjection()?"1":"0"),this.registeredModules.size>0&&i.searchParams.append("modules",Array.from(this.registeredModules).join("|")),i.href}},QS={POINT:"POINT",COUNTRY:"COUNTRY"},Bg=class k1 extends $t.default.Map{constructor(i){p2(i.container),i.apiKey&&(Kn.apiKey=i.apiKey);let{style:l,requiresUrlMonitoring:m,isFallback:f}=Bv(i.style);f&&console.warn("Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Fallback to default MapTiler style."),Kn.apiKey||console.warn("MapTiler Cloud API key is not set. Visit https://maptiler.com and try Cloud for free!");let a=location.hash,P={compact:!1};i.customAttribution?P.customAttribution=i.customAttribution:i.attributionControl&&typeof i.attributionControl=="object"&&(P=ai(ai({},P),i.attributionControl));let E=Po(ai({},i),{style:l,maplibreLogo:!1,transformRequest:Y0(i.transformRequest),attributionControl:i.forceNoAttributionControl===!0?!1:P});delete E.style,super(E),mi(this,"options"),mi(this,"telemetry"),mi(this,"isTerrainEnabled",!1),mi(this,"terrainExaggeration",1),mi(this,"primaryLanguage"),mi(this,"terrainGrowing",!1),mi(this,"terrainFlattening",!1),mi(this,"minimap"),mi(this,"forceLanguageUpdate"),mi(this,"languageAlwaysBeenStyle"),mi(this,"isReady",!1),mi(this,"terrainAnimationDuration",1e3),mi(this,"monitoredStyleUrls"),mi(this,"styleInProcess",!1),mi(this,"curentProjection"),mi(this,"originalLabelStyle",new window.Map),mi(this,"isStyleLocalized",!1),mi(this,"languageIsUpdated",!1),this.options=i,this.setStyle(l),m&&this.monitorStyleUrl(l);let O=()=>{let ue="The distant style could not be loaded.";this.getStyle()?ue+="Leaving the style as is.":(this.setStyle(Fl.STREETS),ue+=`Loading default MapTiler Cloud style "${Fl.STREETS.getDefaultVariant().getId()}" as a fallback.`),console.warn(ue)};if(this.on("style.load",()=>{this.styleInProcess=!1}),this.on("error",ue=>{if(ue.error instanceof $t.default.AJAXError){let be=ue.error.url,ze=new URL(be);ze.search="";let Xe=ze.href;this.monitoredStyleUrls&&this.monitoredStyleUrls.has(Xe)&&(this.monitoredStyleUrls.delete(Xe),O());return}if(this.styleInProcess){O();return}}),Kn.caching&&!$m&&console.warn("The cache API is only available in secure contexts. More info at https://developer.mozilla.org/en-US/docs/Web/API/Cache"),Kn.caching&&$m&&l2(),typeof i.language>"u")this.primaryLanguage=Kn.primaryLanguage;else{let ue=ap(i.language,Fi);this.primaryLanguage=ue??Kn.primaryLanguage}this.forceLanguageUpdate=!(this.primaryLanguage===Fi.STYLE||this.primaryLanguage===Fi.STYLE_LOCK),this.languageAlwaysBeenStyle=this.primaryLanguage===Fi.STYLE,this.terrainExaggeration=i.terrainExaggeration??this.terrainExaggeration,this.curentProjection=i.projection,this.on("styledata",()=>{this.curentProjection==="mercator"?this.setProjection({type:"mercator"}):this.curentProjection==="globe"&&this.setProjection({type:"globe"})}),this.once("styledata",async()=>{if(!i.geolocate||i.center||i.hash&&a)return;try{if(i.geolocate===QS.COUNTRY){await this.fitToIpBounds();return}}catch(be){console.warn(be.message)}let ue;try{await this.centerOnIpPoint(i.zoom),ue=this.getCameraHash()}catch(be){console.warn(be.message)}(await navigator.permissions.query({name:"geolocation"})).state==="granted"&&navigator.geolocation.getCurrentPosition(be=>{ue===this.getCameraHash()&&(this.terrain?this.easeTo({center:[be.coords.longitude,be.coords.latitude],zoom:i.zoom||12,duration:2e3}):this.once("terrain",()=>{this.easeTo({center:[be.coords.longitude,be.coords.latitude],zoom:i.zoom||12,duration:2e3})}))},null,{maximumAge:24*3600*1e3,timeout:5e3,enableHighAccuracy:!1})}),this.on("styledata",()=>{this.setPrimaryLanguage(this.primaryLanguage)}),this.on("styledata",()=>{this.getTerrain()===null&&this.isTerrainEnabled&&this.enableTerrain(this.terrainExaggeration)}),this.once("load",async()=>{let ue={logo:null};try{let be=Object.keys(this.style.sourceCaches).map(Xe=>this.getSource(Xe)).filter(Xe=>Xe&&"url"in Xe&&typeof Xe.url=="string"&&Xe.url.includes("tiles.json")),ze=new URL(be[0].url);ze.searchParams.has("key")||ze.searchParams.append("key",Kn.apiKey),ue=await(await fetch(ze.href)).json()}catch{}if(i.forceNoAttributionControl!==!0)if("logo"in ue&&ue.logo){let be=ue.logo;this.addControl(new xp({logoURL:be}),i.logoPosition)}else i.maptilerLogo&&this.addControl(new xp,i.logoPosition);if(i.scaleControl){let be=i.scaleControl===!0||i.scaleControl===void 0?"bottom-right":i.scaleControl,ze=new Gm({unit:Kn.unit});this.addControl(ze,be),Kn.on("unit",Xe=>{ze.setUnit(Xe)})}if(i.navigationControl!==!1){let be=i.navigationControl===!0||i.navigationControl===void 0?"top-right":i.navigationControl;this.addControl(new pg,be)}if(i.geolocateControl!==!1){let be=i.geolocateControl===!0||i.geolocateControl===void 0?"top-right":i.geolocateControl;this.addControl(new fg({positionOptions:{enableHighAccuracy:!0,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!0,showAccuracyCircle:!0,showUserLocation:!0}),be)}if(i.terrainControl){let be=i.terrainControl===!0||i.terrainControl===void 0?"top-right":i.terrainControl;this.addControl(new dg,be)}if(i.projectionControl){let be=i.projectionControl===!0||i.projectionControl===void 0?"top-right":i.projectionControl;this.addControl(new mg,be)}if(i.fullscreenControl){let be=i.fullscreenControl===!0||i.fullscreenControl===void 0?"top-right":i.fullscreenControl;this.addControl(new qm({}),be)}this.isReady=!0,this.fire("ready",{target:this})});let B=!1,W=!1,V;this.once("ready",()=>{B=!0,W&&this.fire("loadWithTerrain",V)}),this.once("style.load",()=>{let{minimap:ue}=i;if(typeof ue=="object"){let{zoom:be,center:ze,style:Xe,language:Ve,apiKey:Se,maptilerLogo:nt,canvasContextAttributes:pt,refreshExpiredTiles:Pt,maxBounds:kt,scrollZoom:It,minZoom:Q,maxZoom:re,boxZoom:ce,locale:Ie,fadeDuration:de,crossSourceCollisions:Oe,clickTolerance:Ae,bounds:Ce,fitBoundsOptions:ge,pixelRatio:Fe,validateStyle:Ee}=i;this.minimap=new Vh(ue,{zoom:be,center:ze,style:Xe,language:Ve,apiKey:Se,container:"null",maptilerLogo:nt,canvasContextAttributes:pt,refreshExpiredTiles:Pt,maxBounds:kt,scrollZoom:It,minZoom:Q,maxZoom:re,boxZoom:ce,locale:Ie,fadeDuration:de,crossSourceCollisions:Oe,clickTolerance:Ae,bounds:Ce,fitBoundsOptions:ge,pixelRatio:Fe,validateStyle:Ee}),this.addControl(this.minimap,ue.position??"bottom-left")}else ue===!0?(this.minimap=new Vh({},i),this.addControl(this.minimap,"bottom-left")):ue!==void 0&&ue!==!1&&(this.minimap=new Vh({},i),this.addControl(this.minimap,ue))});let he=ue=>{ue.terrain&&(W=!0,V={type:"loadWithTerrain",target:this,terrain:ue.terrain},this.off("terrain",he),B&&this.fire("loadWithTerrain",V))};this.on("terrain",he),i.terrain&&this.enableTerrain(i.terrainExaggeration??this.terrainExaggeration),this.once("load",()=>{this.getCanvas().addEventListener("webglcontextlost",ue=>{if(this._removed===!0){console.warn("[webglcontextlost]","WebGL context lost after map removal. This is harmless.");return}console.warn("[webglcontextlost]","Unexpected loss of WebGL context!"),this.fire("webglContextLost",ue)})}),this.telemetry=new gg(this)}recreate(){let i={center:this.getCenter(),zoom:this.getZoom(),bearing:this.getBearing(),pitch:this.getPitch()};this.remove(),Object.assign(this,new k1(ai({},this.options))),this.once("load",()=>{this.jumpTo(i)})}setTerrainAnimationDuration(i){this.terrainAnimationDuration=Math.max(i,0)}async onLoadAsync(){return new Promise(i=>{if(this.loaded()){i(this);return}this.once("load",()=>{i(this)})})}async onReadyAsync(){return new Promise(i=>{if(this.isReady){i(this);return}this.once("ready",()=>{i(this)})})}async onLoadWithTerrainAsync(){return new Promise(i=>{if(this.isReady&&this.terrain){i(this);return}this.once("loadWithTerrain",()=>{i(this)})})}monitorStyleUrl(i){typeof this.monitoredStyleUrls>"u"&&(this.monitoredStyleUrls=new Set);let l=new URL(i);l.search="",this.monitoredStyleUrls.add(l.href)}setStyle(i,l){var m;this.originalLabelStyle.clear(),(m=this.minimap)==null||m.setStyle(i),this.forceLanguageUpdate=!0,this.once("idle",()=>{this.forceLanguageUpdate=!1});let f=Bv(i);if(f.requiresUrlMonitoring&&this.monitorStyleUrl(f.style),f.isFallback){if(this.getStyle())return console.warn("Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Keeping the curent style instead."),this;console.warn("Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Fallback to default MapTiler style.")}return this.styleInProcess=!0,super.setStyle(f.style,l),this}addLayer(i,l){var m;return(m=this.minimap)==null||m.addLayer(i,l),super.addLayer(i,l)}moveLayer(i,l){var m;return(m=this.minimap)==null||m.moveLayer(i,l),super.moveLayer(i,l)}removeLayer(i){var l;return(l=this.minimap)==null||l.removeLayer(i),super.removeLayer(i)}setLayerZoomRange(i,l,m){var f;return(f=this.minimap)==null||f.setLayerZoomRange(i,l,m),super.setLayerZoomRange(i,l,m)}setFilter(i,l,m){var f;return(f=this.minimap)==null||f.setFilter(i,l,m),super.setFilter(i,l,m)}setPaintProperty(i,l,m,f){var a;return(a=this.minimap)==null||a.setPaintProperty(i,l,m,f),super.setPaintProperty(i,l,m,f)}setLayoutProperty(i,l,m,f){var a;return(a=this.minimap)==null||a.setLayoutProperty(i,l,m,f),super.setLayoutProperty(i,l,m,f)}setGlyphs(i,l){var m;return(m=this.minimap)==null||m.setGlyphs(i,l),super.setGlyphs(i,l)}getStyleLanguage(){return!this.style||!this.style.stylesheet||!this.style.stylesheet.metadata||typeof this.style.stylesheet.metadata!="object"?null:"maptiler:language"in this.style.stylesheet.metadata&&typeof this.style.stylesheet.metadata["maptiler:language"]=="string"?Nh(this.style.stylesheet.metadata["maptiler:language"]):null}setLanguage(i){var l;(l=this.minimap)==null||l.map.setLanguage(i),this.onStyleReady(()=>{this.setPrimaryLanguage(i)})}setPrimaryLanguage(i){let l=this.getStyleLanguage(),m=ap(i,Fi);if(!m){console.warn(`The language "${m}" is not supported.`);return}if(!(m.flag===Fi.STYLE.flag&&l&&(l.flag===Fi.AUTO.flag||l.flag===Fi.VISITOR.flag))&&(m.flag!==Fi.STYLE.flag&&(this.languageAlwaysBeenStyle=!1),this.languageAlwaysBeenStyle||this.primaryLanguage===m&&!this.forceLanguageUpdate))return;if(this.primaryLanguage.flag===Fi.STYLE_LOCK.flag){console.warn("The language cannot be changed because this map has been instantiated with the STYLE_LOCK language flag.");return}this.primaryLanguage=m;let f=m;if(m.flag===Fi.STYLE.flag){if(!l){console.warn("The style has no default languages or has an invalid one.");return}f=l}let a=Fi.LOCAL.flag,P=["get",a];f.flag===Fi.VISITOR.flag?(a=W0().flag,P=["case",["all",["has",a],["has",Fi.LOCAL.flag]],["case",["==",["get",a],["get",Fi.LOCAL.flag]],["get",Fi.LOCAL.flag],["format",["get",a],{"font-scale":.8},`
`,["get",Fi.LOCAL.flag],{"font-scale":1.1}]],["get",Fi.LOCAL.flag]]):f.flag===Fi.VISITOR_ENGLISH.flag?(a=Fi.ENGLISH.flag,P=["case",["all",["has",a],["has",Fi.LOCAL.flag]],["case",["==",["get",a],["get",Fi.LOCAL.flag]],["get",Fi.LOCAL.flag],["format",["get",a],{"font-scale":.8},`
`,["get",Fi.LOCAL.flag],{"font-scale":1.1}]],["get",Fi.LOCAL.flag]]):f.flag===Fi.AUTO.flag?(a=W0().flag,P=["coalesce",["get",a],["get",Fi.LOCAL.flag]]):f===Fi.LOCAL?(a=Fi.LOCAL.flag,P=["get",a]):(a=f.flag,P=["coalesce",["get",a],["get",Fi.LOCAL.flag]]);let{layers:E}=this.getStyle(),O=this.originalLabelStyle.size===0;if(O){let B=x2(E,this);this.isStyleLocalized=Object.keys(B.localized).length>0}for(let B of E){if(B.type!=="symbol")continue;let W=B,V=this.getSource(W.source);if(!V||!("url"in V&&typeof V.url=="string")||new URL(V.url).host!==fo.maptilerApiHost)continue;let{id:he,layout:ue}=W;if(!ue||!("text-field"in ue))continue;let be;if(O?(be=this.getLayoutProperty(he,"text-field"),this.originalLabelStyle.set(he,be)):be=this.originalLabelStyle.get(he),typeof be=="string"){let{contains:ze,exactMatch:Xe}=m2(be,this.isStyleLocalized);if(!ze)continue;if(Xe)this.setLayoutProperty(he,"text-field",P);else{let Ve=g2(be,P,this.isStyleLocalized);this.setLayoutProperty(he,"text-field",Ve)}}else{let ze=f2(be,P,this.isStyleLocalized);this.setLayoutProperty(he,"text-field",ze)}}this.languageIsUpdated=!0}getPrimaryLanguage(){return this.primaryLanguage}getTerrainExaggeration(){return this.terrainExaggeration}hasTerrain(){return this.isTerrainEnabled}growTerrain(i){if(!this.terrain)return;let l=performance.now(),m=this.terrain.exaggeration,f=i-m,a=()=>{if(!this.terrain||this.terrainFlattening)return;let P=(performance.now()-l)/this.terrainAnimationDuration;if(P<.99){let E=1-(1-P)**4,O=m+E*f;this.terrain.exaggeration=O,requestAnimationFrame(a)}else this.terrainGrowing=!1,this.terrainFlattening=!1,this.terrain.exaggeration=i,this.fire("terrainAnimationStop",{terrain:this.terrain});this._elevationFreeze=!1,this.triggerRepaint()};!this.terrainGrowing&&!this.terrainFlattening&&this.fire("terrainAnimationStart",{terrain:this.terrain}),this.terrainGrowing=!0,this.terrainFlattening=!1,requestAnimationFrame(a)}enableTerrain(i=this.terrainExaggeration){if(i<0){console.warn("Terrain exaggeration cannot be negative.");return}let l=f=>{!this.terrain||f.type!=="data"||f.dataType!=="source"||!("source"in f)||f.sourceId!=="maptiler-terrain"||f.source.type!=="raster-dem"||f.isSourceLoaded&&(this.off("data",l),this.growTerrain(i))},m=()=>{this.isTerrainEnabled=!0,this.terrainExaggeration=i,this.on("data",l),this.addSource(fo.terrainSourceId,{type:"raster-dem",url:fo.terrainSourceURL}),this.setTerrain({source:fo.terrainSourceId,exaggeration:0})};if(this.getTerrain()){this.isTerrainEnabled=!0,this.growTerrain(i);return}this.loaded()||this.isTerrainEnabled?m():this.once("load",()=>{this.getTerrain()&&this.getSource(fo.terrainSourceId)||m()})}disableTerrain(){if(!this.terrain)return;this.isTerrainEnabled=!1;let i=performance.now(),l=this.terrain.exaggeration,m=()=>{if(!this.terrain||this.terrainGrowing)return;let f=(performance.now()-i)/this.terrainAnimationDuration;if(this._elevationFreeze=!1,f<.99){let a=(1-f)**4,P=l*a;this.terrain.exaggeration=P,requestAnimationFrame(m)}else this.terrain.exaggeration=0,this.terrainGrowing=!1,this.terrainFlattening=!1,this.setTerrain(),this.getSource(fo.terrainSourceId)&&this.removeSource(fo.terrainSourceId),this.fire("terrainAnimationStop",{terrain:null});this.triggerRepaint()};!this.terrainGrowing&&!this.terrainFlattening&&this.fire("terrainAnimationStart",{terrain:this.terrain}),this.terrainGrowing=!1,this.terrainFlattening=!0,requestAnimationFrame(m)}setTerrainExaggeration(i,l=!0){!l&&this.terrain?(this.terrainExaggeration=i,this.terrain.exaggeration=i,this.triggerRepaint()):this.enableTerrain(i)}onStyleReady(i){this.isStyleLoaded()?i():this.once("styledata",()=>{i()})}async fitToIpBounds(){let i=await sp.info();this.fitBounds(i.country_bounds,{duration:0,padding:100})}async centerOnIpPoint(i){let l=await sp.info();this.jumpTo({center:[l.longitude??0,l.latitude??0],zoom:i||11})}getCameraHash(){let i=new Float32Array(5),l=this.getCenter();return i[0]=l.lng,i[1]=l.lat,i[2]=this.getZoom(),i[3]=this.getPitch(),i[4]=this.getBearing(),q0.fromUint8Array(new Uint8Array(i.buffer))}getSdkConfig(){return Kn}getMaptilerSessionId(){return Sg}setTransformRequest(i){return super.setTransformRequest(Y0(i)),this}isGlobeProjection(){let i=this.getProjection();return i?i.type==="globe":!1}enableGlobeProjection(){this.isGlobeProjection()!==!0&&(this.setProjection({type:"globe"}),this.curentProjection="globe")}enableMercatorProjection(){this.isGlobeProjection()!==!1&&(this.setProjection({type:"mercator"}),this.curentProjection="mercator")}isLanguageUpdated(){return this.languageIsUpdated}};function Og(s){if(typeof DOMParser<"u"){let i=new DOMParser().parseFromString(s,"application/xml");if(i.querySelector("parsererror"))throw new Error("The provided string is not valid XML");return i}throw new Error("No XML parser found")}function z1(s,i){if(!s.hasChildNodes())return!1;for(let l of Array.from(s.childNodes)){let m=l.nodeName;if(typeof m=="string"&&m.trim().toLowerCase()===i.toLowerCase())return!0}return!1}function Nv(s){if(typeof XMLSerializer<"u")return new XMLSerializer().serializeToString(s);throw new Error("No XML serializer found")}function R1(s){let i=typeof s=="string"?Og(s):s;if(!z1(i,"gpx"))throw new Error("The XML document is not valid GPX");let l=kr(i,"trk"),m=kr(i,"rte"),f=kr(i,"wpt"),a={type:"FeatureCollection",features:[]};for(let P of Array.from(l)){let E=nP(P);E&&a.features.push(E)}for(let P of Array.from(m)){let E=rP(P);E&&a.features.push(E)}for(let P of Array.from(f))a.features.push(oP(P));return a}function D1(s,i){let l=s;if(typeof l=="string"&&(l=Og(l)),!z1(l,"kml"))throw new Error("The XML document is not valid KML");let m={type:"FeatureCollection",features:[]},f={},a={},P={},E=kr(l,"Placemark"),O=kr(l,"Style"),B=kr(l,"StyleMap");for(let W of Array.from(O)){let V=$v(i!==void 0?i(W):Nv(W)).toString(16);f[`#${jc(W,"id")}`]=V,a[V]=W}for(let W of Array.from(B)){f[`#${jc(W,"id")}`]=$v(i!==void 0?i(W):Nv(W)).toString(16);let V=kr(W,"Pair"),he={};for(let ue of Array.from(V))he[Xi(ci(ue,"key"))??""]=Xi(ci(ue,"styleUrl"));P[`#${jc(W,"id")}`]=he}for(let W of Array.from(E))m.features=m.features.concat(iP(W,f,a,P));return m}function jv(s){if(s===null)return["#000000",1];let i="",l=1,m=s;return m.startsWith("#")&&(m=m.substring(1)),(m.length===6||m.length===3)&&(i=m),m.length===8&&(l=Number.parseInt(m.substring(0,2),16)/255,i=`#${m.substring(6,8)}${m.substring(4,6)}${m.substring(2,4)}`),[i??"#000000",l??1]}function eP(s){return F1(s.split(" "))}function tP(s){let i=kr(s,"coord"),l=[],m=[];i.length===0&&(i=kr(s,"gx:coord"));for(let a of Array.from(i))l.push(eP(Xi(a)??""));let f=kr(s,"when");for(let a of Array.from(f))m.push(Xi(a));return{coords:l,times:m}}function vp(s){let i=["Polygon","LineString","Point","Track","gx:Track"],l,m,f,a,P,E=[],O=[];if(ci(s,"MultiGeometry")!==null)return vp(ci(s,"MultiGeometry"));if(ci(s,"MultiTrack")!==null)return vp(ci(s,"MultiTrack"));if(ci(s,"gx:MultiTrack")!==null)return vp(ci(s,"gx:MultiTrack"));for(f=0;f<i.length;f++)if(m=kr(s,i[f]),m){for(a=0;a<m.length;a++)if(l=m[a],i[f]==="Point")E.push({type:"Point",coordinates:N1(Xi(ci(l,"coordinates"))??"")});else if(i[f]==="LineString")E.push({type:"LineString",coordinates:Zv(Xi(ci(l,"coordinates"))??"")});else if(i[f]==="Polygon"){let B=kr(l,"LinearRing"),W=[];for(P=0;P<B.length;P++)W.push(Zv(Xi(ci(B[P],"coordinates"))??""));E.push({type:"Polygon",coordinates:W})}else if(i[f]==="Track"||i[f]==="gx:Track"){let B=tP(l);E.push({type:"LineString",coordinates:B.coords}),B.times.length&&O.push(B.times)}}return{geoms:E,coordTimes:O}}function iP(s,i,l,m){let f=vp(s),a={},P=Xi(ci(s,"name")),E=Xi(ci(s,"address")),O=Xi(ci(s,"description")),B=ci(s,"TimeSpan"),W=ci(s,"TimeStamp"),V=ci(s,"ExtendedData"),he=ci(s,"visibility"),ue,be=Xi(ci(s,"styleUrl")),ze=ci(s,"LineStyle"),Xe=ci(s,"PolyStyle");if(!f.geoms.length)return[];if(P&&(a.name=P),E&&(a.address=E),be){be.startsWith("#")||(be=`#${be}`),a.styleUrl=be,i[be]&&(a.styleHash=i[be]),m[be]&&(a.styleMapHash=m[be],a.styleHash=i[m[be].normal??""]);let Se=l[a.styleHash??""];if(Se){ze||(ze=ci(Se,"LineStyle")),Xe||(Xe=ci(Se,"PolyStyle"));let nt=ci(Se,"IconStyle");if(nt){let pt=ci(nt,"Icon");if(pt){let Pt=Xi(ci(pt,"href"));Pt&&(a.icon=Pt)}}}}if(O&&(a.description=O),B){let Se=Xi(ci(B,"begin")),nt=Xi(ci(B,"end"));Se&&nt&&(a.timespan={begin:Se,end:nt})}if(W!==null&&(a.timestamp=Xi(ci(W,"when"))??new Date().toISOString()),ze!==null){let Se=jv(Xi(ci(ze,"color"))),nt=Se[0],pt=Se[1],Pt=Number.parseFloat(Xi(ci(ze,"width"))??"");nt&&(a.stroke=nt),Number.isNaN(pt)||(a["stroke-opacity"]=pt),Number.isNaN(Pt)||(a["stroke-width"]=Pt)}if(Xe){let Se=jv(Xi(ci(Xe,"color"))),nt=Se[0],pt=Se[1],Pt=Xi(ci(Xe,"fill")),kt=Xi(ci(Xe,"outline"));nt&&(a.fill=nt),Number.isNaN(pt)||(a["fill-opacity"]=pt),Pt&&(a["fill-opacity"]=Pt==="1"?a["fill-opacity"]||1:0),kt&&(a["stroke-opacity"]=kt==="1"?a["stroke-opacity"]||1:0)}if(V){let Se=kr(V,"Data"),nt=kr(V,"SimpleData");for(ue=0;ue<Se.length;ue++)a[Se[ue].getAttribute("name")??""]=Xi(ci(Se[ue],"value"))??"";for(ue=0;ue<nt.length;ue++)a[nt[ue].getAttribute("name")??""]=Xi(nt[ue])??""}he!==null&&(a.visibility=Xi(he)??""),f.coordTimes.length!==0&&(a.coordTimes=f.coordTimes.length===1?f.coordTimes[0]:f.coordTimes);let Ve={type:"Feature",geometry:f.geoms.length===1?f.geoms[0]:{type:"GeometryCollection",geometries:f.geoms},properties:a};return jc(s,"id")&&(Ve.id=jc(s,"id")??void 0),[Ve]}function B1(s,i){let l=kr(s,i),m=[],f=[],a=[],P=l.length;if(!(P<2)){for(let E=0;E<P;E++){let O=j1(l[E]);m.push(O.coordinates),O.time&&f.push(O.time),(O.heartRate||a.length)&&(a.length===0&&(a=new Array(E).fill(null)),a.push(O.heartRate))}return{line:m,times:f,heartRates:a}}}function nP(s){let i=kr(s,"trkseg"),l=[],m=[],f=[],a;for(let E=0;E<i.length;E++)if(a=B1(i[E],"trkpt"),a!==void 0&&(a.line&&l.push(a.line),a.times&&a.times.length&&m.push(a.times),f.length||a.heartRates&&a.heartRates.length)){if(!f.length)for(let O=0;O<E;O++)f.push(new Array(l[O].length).fill(null));a.heartRates&&a.heartRates.length?f.push(a.heartRates):f.push(new Array(a.line.length).fill(null))}if(l.length===0)return;let P=ai(ai({},Fg(s)),O1(ci(s,"extensions")));return m.length!==0&&(P.coordTimes=l.length===1?m[0]:m),f.length!==0&&(P.heartRates=l.length===1?f[0]:f),l.length===1?{type:"Feature",properties:P,geometry:{type:"LineString",coordinates:l[0]}}:{type:"Feature",properties:P,geometry:{type:"MultiLineString",coordinates:l}}}function rP(s){let i=B1(s,"rtept");return i===void 0?void 0:{type:"Feature",properties:ai(ai({},Fg(s)),O1(ci(s,"extensions"))),geometry:{type:"LineString",coordinates:i.line}}}function oP(s){return{type:"Feature",properties:ai(ai({},Fg(s)),_g(s,["sym"])),geometry:{type:"Point",coordinates:j1(s).coordinates}}}function O1(s){let i={};if(s){let l=ci(s,"line");if(l){let m=Xi(ci(l,"color")),f=Number.parseFloat(Xi(ci(l,"opacity"))??"0"),a=Number.parseFloat(Xi(ci(l,"width"))??"0");m&&(i.stroke=m),Number.isNaN(f)||(i["stroke-opacity"]=f),Number.isNaN(a)||(i["stroke-width"]=a*96/25.4)}}return i}function Fg(s){let i=_g(s,["name","cmt","desc","type","time","keywords"]),l=kr(s,"link");if(l.length!==0){i.links=[];for(let m of Array.from(l)){let f=ai({href:jc(m,"href")},_g(m,["text","type"]));i.links.push(f)}}return i}function $v(s){let i=0;if(!s||!s.length)return i;for(let l=0;l<s.length;l++)i=(i<<5)-i+s.charCodeAt(l)|0;return i}function kr(s,i){return s.getElementsByTagName(i)}function jc(s,i){return s.getAttribute(i)}function Uv(s,i){return Number.parseFloat(jc(s,i)??"0")}function ci(s,i){let l=kr(s,i);return l.length?l[0]:null}function aP(s){return s.normalize&&s.normalize(),s}function F1(s){return s.map(Number.parseFloat).map(i=>Number.isNaN(i)?null:i)}function Xi(s){return s&&aP(s),s&&s.textContent}function _g(s,i){let l={},m,f;for(f=0;f<i.length;f++)m=ci(s,i[f]),m&&(l[i[f]]=Xi(m)??"");return l}function N1(s){return F1(s.replace(/\s*/g,"").split(","))}function Zv(s){let i=s.replace(/^\s*|\s*$/g,"").split(/\s+/),l=[];for(let m of i)l.push(N1(m));return l}function j1(s){let i=[Uv(s,"lon"),Uv(s,"lat")],l=ci(s,"ele"),m=ci(s,"gpxtpx:hr")||ci(s,"hr"),f=ci(s,"time"),a;return l&&(a=Number.parseFloat(Xi(l)??"0"),Number.isNaN(a)||i.push(a)),{coordinates:i,time:f?Xi(f):null,heartRate:m!==null?Number.parseFloat(Xi(m)??"0"):null}}function sP(s){let i=s;try{typeof i=="string"&&(i=Og(i))}catch{return null}try{return R1(i)}catch{}try{return D1(i)}catch{}return null}async function lP(s,i={}){let l=i.download??!1,m=await cP(s);if(l){let f=i.filename??"maptiler_screenshot.png",a=document.createElement("a");a.style.display="none",document.body.appendChild(a),a.href=URL.createObjectURL(m),a.download=f,a.click(),setTimeout(()=>{document.body.removeChild(a),URL.revokeObjectURL(a.href)},0)}return m}function cP(s){return new Promise((i,l)=>{s.redraw(),s.once("idle",()=>{s.getCanvas().toBlob(m=>{if(!m){l(Error("Screenshot could not be created."));return}i(m)},"image/png")})})}var yg=[["#1D5B79","#468B97","#EF6262","#F3AA60"],["#614BC3","#33BBC5","#85E6C5","#C8FFE0"],["#461959","#7A316F","#CD6688","#AED8CC"],["#0079FF","#00DFA2","#F6FA70","#FF0060"],["#39B5E0","#A31ACB","#FF78F0","#F5EA5A"],["#37E2D5","#590696","#C70A80","#FBCB0A"],["#FFD36E","#FFF56D","#99FFCD","#9FB4FF"],["#00EAD3","#FFF5B7","#FF449F","#005F99"],["#10A19D","#540375","#FF7000","#FFBF00"]];function Xp(){return yg[~~(Math.random()*yg.length)][~~(Math.random()*4)]}function ad(){return`maptiler_source_${Wv()}`}function sd(){return`maptiler_layer_${Wv()}`}function vg(s,i){if(i<=s[0].zoom)return s[0].value;if(i>=s[s.length-1].zoom)return s[s.length-1].value;for(let l=0;l<s.length-1;l+=1)if(i>=s[l].zoom&&i<s[l+1].zoom){let m=s[l+1].zoom-s[l].zoom,f=(i-s[l].zoom)/m;return f*s[l+1].value+(1-f)*s[l].value}return 0}function $l(s){return["interpolate",["linear"],["zoom"],...s.flatMap(i=>[i.zoom,i.value])]}function Wi(s){return["interpolate",["linear"],["zoom"],...s.flatMap(i=>[i.zoom,i.value])]}function $1(s,i){if(typeof i=="number"&&typeof s=="number")return 2*i+s;if(typeof i=="number"&&Array.isArray(s))return["interpolate",["linear"],["zoom"],...s.flatMap(l=>[l.zoom,2*i+l.value])];if(typeof s=="number"&&Array.isArray(i))return["interpolate",["linear"],["zoom"],...i.flatMap(l=>[l.zoom,2*l.value+s])];if(Array.isArray(s)&&Array.isArray(i)){let l=Array.from(new Set([...s.map(m=>m.zoom),...i.map(m=>m.zoom)])).sort((m,f)=>m<f?-1:1);return["interpolate",["linear"],["zoom"],...l.flatMap(m=>[m,2*vg(i,m)+vg(s,m)])]}return 0}function U1(s,i){return["interpolate",["linear"],["get",i],...s.flatMap(l=>[l.propertyValue,l.value])]}function Ng(s){let i=s.trimStart(),l=`${i}${" ".repeat(s.length-i.length)}`,m=Array.from(l);if(!m.every(a=>a===" "||a==="_"))throw new Error("A dash pattern must be composed only of whitespace and underscore characters.");if(!(m.some(a=>a==="_")&&m.some(a=>a===" ")))throw new Error("A dash pattern must contain at least one underscore and one whitespace character");let f=[1];for(let a=1;a<m.length;a+=1){let P=m[a-1],E=m[a];P===E?f[f.length-1]+=1:f.push(1)}return f}function xg(s,i){return["interpolate",["linear"],["get",i],...s.flatMap(l=>[l.value,l.color])]}function bg(s,i,l=!0){return l?["interpolate",["linear"],["zoom"],0,["interpolate",["linear"],["get",i],...s.flatMap(m=>[m.value,m.pointRadius*.025])],2,["interpolate",["linear"],["get",i],...s.flatMap(m=>[m.value,m.pointRadius*.05])],4,["interpolate",["linear"],["get",i],...s.flatMap(m=>[m.value,m.pointRadius*.1])],8,["interpolate",["linear"],["get",i],...s.flatMap(m=>[m.value,m.pointRadius*.25])],16,["interpolate",["linear"],["get",i],...s.flatMap(m=>[m.value,m.pointRadius])]]:["interpolate",["linear"],["get",i],...s.flatMap(m=>[m.value,m.pointRadius])]}function Z1(s,i,l=!0){return l?["interpolate",["linear"],["zoom"],0,["interpolate",["linear"],["get",i],...s.flatMap(m=>[m.propertyValue,m.value*.025])],2,["interpolate",["linear"],["get",i],...s.flatMap(m=>[m.propertyValue,m.value*.05])],4,["interpolate",["linear"],["get",i],...s.flatMap(m=>[m.propertyValue,m.value*.1])],8,["interpolate",["linear"],["get",i],...s.flatMap(m=>[m.propertyValue,m.value*.25])],16,["interpolate",["linear"],["get",i],...s.flatMap(m=>[m.propertyValue,m.value])]]:["interpolate",["linear"],["get",i],...s.flatMap(m=>[m.propertyValue,m.value])]}function wg(s,i){return s.every(l=>l.color[3]===s[0].color[3])?s[0].color[3]?s[0].color[3]/255:1:["interpolate",["linear"],["get",i],...s.getRawColorStops().flatMap(l=>{let m=l.value,f=l.color;return[m,f.length===4?f[3]/255:1]})]}function V1(s,i=10){return["interpolate",["linear"],["heatmap-density"],...Array.from({length:i+1},(l,m)=>{let f=m/i;return[f,s.getColorHex(f)]}).flat()]}function gp(s){let i=s.toString(16);return i.length===1?`0${i}`:i}function uP(s){return`#${gp(s[0])}${gp(s[1])}${gp(s[2])}${s.length===4?gp(s[3]):""}`}var Jt=class s extends Array{constructor(i={}){super(),mi(this,"min",0),mi(this,"max",1),"min"in i&&(this.min=i.min),"max"in i&&(this.max=i.max),"stops"in i&&this.setStops(i.stops,{clone:!1})}static fromArrayDefinition(i){return new s({stops:i.map(l=>({value:l[0],color:l[1]}))})}setStops(i,l={clone:!0}){let m=l.clone?this.clone():this;m.length=0;let f=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY;for(let P=0;P<i.length;P+=1)f=Math.min(f,i[P].value),a=Math.max(a,i[P].value),m.push({value:i[P].value,color:i[P].color.slice()});return m.sort((P,E)=>P.value<E.value?-1:1),this.min=f,this.max=a,m}scale(i,l,m={clone:!0}){let f=m.clone,a=this[0].value,P=this.at(-1).value-a,E=l-i,O=[];for(let B=0;B<this.length;B+=1){let W=(this[B].value-a)/P*E+i;f?O.push({value:W,color:this[B].color.slice()}):this[B].value=W}return f?new s({stops:O}):this}at(i){return i<0?this[this.length+i]:this[i]}clone(){return new s({stops:this.getRawColorStops()})}getRawColorStops(){let i=[];for(let l=0;l<this.length;l+=1)i.push({value:this[l].value,color:this[l].color});return i}reverse(i={clone:!0}){let l=i.clone?this.clone():this;for(let m=0;m<~~(l.length/2);m+=1){let f=l[m].color;l[m].color=l.at(-(m+1)).color,l.at(-(m+1)).color=f}return l}getBounds(){return{min:this.min,max:this.max}}getColor(i,l={smooth:!0}){if(i<=this[0].value)return this[0].color;if(i>=this.at(-1).value)return this.at(-1).color;for(let m=0;m<this.length-1;m+=1){if(i>this[m+1].value)continue;let f=this[m].color;if(!l.smooth)return f.slice();let a=this[m].value,P=this[m+1].value,E=this[m+1].color,O=(P-i)/(P-a);return f.map((B,W)=>Math.round(B*O+E[W]*(1-O)))}return[0,0,0]}getColorHex(i,l={smooth:!0,withAlpha:!1}){return uP(this.getColor(i,l))}getColorRelative(i,l={smooth:!0}){let m=this.getBounds();return this.getColor(m.min+i*(m.max-m.min),l)}getCanvasStrip(i={horizontal:!0,size:512,smooth:!0}){let l=document.createElement("canvas");l.width=i.horizontal?i.size:1,l.height=i.horizontal?1:i.size;let m=l.getContext("2d");if(!m)throw new Error("Canvs context is missing");let f=m.getImageData(0,0,l.width,l.height),a=f.data,P=i.size,E=this[0].value,O=(this.at(-1).value-E)/P;for(let B=0;B<P;B+=1){let W=this.getColor(E+B*O,{smooth:i.smooth});a[B*4]=W[0],a[B*4+1]=W[1],a[B*4+2]=W[2],a[B*4+3]=W.length>3?W[3]:255}return m.putImageData(f,0,0),l}resample(i,l=15){let m=this.getBounds(),f=this.scale(0,1),a=1/(l-1),P;if(i==="ease-in-square")P=Array.from({length:l},(E,O)=>{let B=O*a,W=B**2,V=f.getColor(W);return{value:B,color:V}});else if(i==="ease-out-square")P=Array.from({length:l},(E,O)=>{let B=O*a,W=1-(1-B)**2,V=f.getColor(W);return{value:B,color:V}});else if(i==="ease-out-sqrt")P=Array.from({length:l},(E,O)=>{let B=O*a,W=B**.5,V=f.getColor(W);return{value:B,color:V}});else if(i==="ease-in-sqrt")P=Array.from({length:l},(E,O)=>{let B=O*a,W=1-(1-B)**.5,V=f.getColor(W);return{value:B,color:V}});else if(i==="ease-out-exp")P=Array.from({length:l},(E,O)=>{let B=O*a,W=1-2**(-10*B),V=f.getColor(W);return{value:B,color:V}});else if(i==="ease-in-exp")P=Array.from({length:l},(E,O)=>{let B=O*a,W=2**(10*B-10),V=f.getColor(W);return{value:B,color:V}});else throw new Error("Invalid ressampling method.");return new s({stops:P}).scale(m.min,m.max)}transparentStart(){let i=this.getRawColorStops();i.unshift({value:i[0].value,color:i[0].color.slice()}),i[1].value+=.001;for(let l of i)l.color.length===3&&l.color.push(255);return i[0].color[3]=0,new s({stops:i})}hasTransparentStart(){return this[0].color.length===4&&this[0].color[3]===0}},G1={NULL:new Jt({stops:[{value:0,color:[0,0,0,0]},{value:1,color:[0,0,0,0]}]}),GRAY:new Jt({stops:[{value:0,color:[0,0,0]},{value:1,color:[255,255,255]}]}),JET:new Jt({stops:[{value:0,color:[0,0,131]},{value:.125,color:[0,60,170]},{value:.375,color:[5,255,255]},{value:.625,color:[255,255,0]},{value:.875,color:[250,0,0]},{value:1,color:[128,0,0]}]}),HSV:new Jt({stops:[{value:0,color:[255,0,0]},{value:.169,color:[253,255,2]},{value:.173,color:[247,255,2]},{value:.337,color:[0,252,4]},{value:.341,color:[0,252,10]},{value:.506,color:[1,249,255]},{value:.671,color:[2,0,253]},{value:.675,color:[8,0,253]},{value:.839,color:[255,0,251]},{value:.843,color:[255,0,245]},{value:1,color:[255,0,6]}]}),HOT:new Jt({stops:[{value:0,color:[0,0,0]},{value:.3,color:[230,0,0]},{value:.6,color:[255,210,0]},{value:1,color:[255,255,255]}]}),SPRING:new Jt({stops:[{value:0,color:[255,0,255]},{value:1,color:[255,255,0]}]}),SUMMER:new Jt({stops:[{value:0,color:[0,128,102]},{value:1,color:[255,255,102]}]}),AUTOMN:new Jt({stops:[{value:0,color:[255,0,0]},{value:1,color:[255,255,0]}]}),WINTER:new Jt({stops:[{value:0,color:[0,0,255]},{value:1,color:[0,255,128]}]}),BONE:new Jt({stops:[{value:0,color:[0,0,0]},{value:.376,color:[84,84,116]},{value:.753,color:[169,200,200]},{value:1,color:[255,255,255]}]}),COPPER:new Jt({stops:[{value:0,color:[0,0,0]},{value:.804,color:[255,160,102]},{value:1,color:[255,199,127]}]}),GREYS:new Jt({stops:[{value:0,color:[0,0,0]},{value:1,color:[255,255,255]}]}),YIGNBU:new Jt({stops:[{value:0,color:[8,29,88]},{value:.125,color:[37,52,148]},{value:.25,color:[34,94,168]},{value:.375,color:[29,145,192]},{value:.5,color:[65,182,196]},{value:.625,color:[127,205,187]},{value:.75,color:[199,233,180]},{value:.875,color:[237,248,217]},{value:1,color:[255,255,217]}]}),GREENS:new Jt({stops:[{value:0,color:[0,68,27]},{value:.125,color:[0,109,44]},{value:.25,color:[35,139,69]},{value:.375,color:[65,171,93]},{value:.5,color:[116,196,118]},{value:.625,color:[161,217,155]},{value:.75,color:[199,233,192]},{value:.875,color:[229,245,224]},{value:1,color:[247,252,245]}]}),YIORRD:new Jt({stops:[{value:0,color:[128,0,38]},{value:.125,color:[189,0,38]},{value:.25,color:[227,26,28]},{value:.375,color:[252,78,42]},{value:.5,color:[253,141,60]},{value:.625,color:[254,178,76]},{value:.75,color:[254,217,118]},{value:.875,color:[255,237,160]},{value:1,color:[255,255,204]}]}),BLUERED:new Jt({stops:[{value:0,color:[0,0,255]},{value:1,color:[255,0,0]}]}),RDBU:new Jt({stops:[{value:0,color:[5,10,172]},{value:.35,color:[106,137,247]},{value:.5,color:[190,190,190]},{value:.6,color:[220,170,132]},{value:.7,color:[230,145,90]},{value:1,color:[178,10,28]}]}),PICNIC:new Jt({stops:[{value:0,color:[0,0,255]},{value:.1,color:[51,153,255]},{value:.2,color:[102,204,255]},{value:.3,color:[153,204,255]},{value:.4,color:[204,204,255]},{value:.5,color:[255,255,255]},{value:.6,color:[255,204,255]},{value:.7,color:[255,153,255]},{value:.8,color:[255,102,204]},{value:.9,color:[255,102,102]},{value:1,color:[255,0,0]}]}),RAINBOW:new Jt({stops:[{value:0,color:[150,0,90]},{value:.125,color:[0,0,200]},{value:.25,color:[0,25,255]},{value:.375,color:[0,152,255]},{value:.5,color:[44,255,150]},{value:.625,color:[151,255,0]},{value:.75,color:[255,234,0]},{value:.875,color:[255,111,0]},{value:1,color:[255,0,0]}]}),PORTLAND:new Jt({stops:[{value:0,color:[12,51,131]},{value:.25,color:[10,136,186]},{value:.5,color:[242,211,56]},{value:.75,color:[242,143,56]},{value:1,color:[217,30,30]}]}),BLACKBODY:new Jt({stops:[{value:0,color:[0,0,0]},{value:.2,color:[230,0,0]},{value:.4,color:[230,210,0]},{value:.7,color:[255,255,255]},{value:1,color:[160,200,255]}]}),EARTH:new Jt({stops:[{value:0,color:[0,0,130]},{value:.1,color:[0,180,180]},{value:.2,color:[40,210,40]},{value:.4,color:[230,230,50]},{value:.6,color:[120,70,20]},{value:1,color:[255,255,255]}]}),ELECTRIC:new Jt({stops:[{value:0,color:[0,0,0]},{value:.15,color:[30,0,100]},{value:.4,color:[120,0,100]},{value:.6,color:[160,90,0]},{value:.8,color:[230,200,0]},{value:1,color:[255,250,220]}]}),VIRIDIS:new Jt({stops:[{value:0,color:[68,1,84]},{value:.13,color:[71,44,122]},{value:.25,color:[59,81,139]},{value:.38,color:[44,113,142]},{value:.5,color:[33,144,141]},{value:.63,color:[39,173,129]},{value:.75,color:[92,200,99]},{value:.88,color:[170,220,50]},{value:1,color:[253,231,37]}]}),INFERNO:new Jt({stops:[{value:0,color:[0,0,4]},{value:.13,color:[31,12,72]},{value:.25,color:[85,15,109]},{value:.38,color:[136,34,106]},{value:.5,color:[186,54,85]},{value:.63,color:[227,89,51]},{value:.75,color:[249,140,10]},{value:.88,color:[249,201,50]},{value:1,color:[252,255,164]}]}),MAGMA:new Jt({stops:[{value:0,color:[0,0,4]},{value:.13,color:[28,16,68]},{value:.25,color:[79,18,123]},{value:.38,color:[129,37,129]},{value:.5,color:[181,54,122]},{value:.63,color:[229,80,100]},{value:.75,color:[251,135,97]},{value:.88,color:[254,194,135]},{value:1,color:[252,253,191]}]}),PLASMA:new Jt({stops:[{value:0,color:[13,8,135]},{value:.13,color:[75,3,161]},{value:.25,color:[125,3,168]},{value:.38,color:[168,34,150]},{value:.5,color:[203,70,121]},{value:.63,color:[229,107,93]},{value:.75,color:[248,148,65]},{value:.88,color:[253,195,40]},{value:1,color:[240,249,33]}]}),WARM:new Jt({stops:[{value:0,color:[125,0,179]},{value:.13,color:[172,0,187]},{value:.25,color:[219,0,170]},{value:.38,color:[255,0,130]},{value:.5,color:[255,63,74]},{value:.63,color:[255,123,0]},{value:.75,color:[234,176,0]},{value:.88,color:[190,228,0]},{value:1,color:[147,255,0]}]}),COOL:new Jt({stops:[{value:0,color:[125,0,179]},{value:.13,color:[116,0,218]},{value:.25,color:[98,74,237]},{value:.38,color:[68,146,231]},{value:.5,color:[0,204,197]},{value:.63,color:[0,247,146]},{value:.75,color:[0,255,88]},{value:.88,color:[40,255,8]},{value:1,color:[147,255,0]}]}),RAINBOW_SOFT:new Jt({stops:[{value:0,color:[125,0,179]},{value:.1,color:[199,0,180]},{value:.2,color:[255,0,121]},{value:.3,color:[255,108,0]},{value:.4,color:[222,194,0]},{value:.5,color:[150,255,0]},{value:.6,color:[0,255,55]},{value:.7,color:[0,246,150]},{value:.8,color:[50,167,222]},{value:.9,color:[103,51,235]},{value:1,color:[124,0,186]}]}),BATHYMETRY:new Jt({stops:[{value:0,color:[40,26,44]},{value:.13,color:[59,49,90]},{value:.25,color:[64,76,139]},{value:.38,color:[63,110,151]},{value:.5,color:[72,142,158]},{value:.63,color:[85,174,163]},{value:.75,color:[120,206,163]},{value:.88,color:[187,230,172]},{value:1,color:[253,254,204]}]}),CDOM:new Jt({stops:[{value:0,color:[47,15,62]},{value:.13,color:[87,23,86]},{value:.25,color:[130,28,99]},{value:.38,color:[171,41,96]},{value:.5,color:[206,67,86]},{value:.63,color:[230,106,84]},{value:.75,color:[242,149,103]},{value:.88,color:[249,193,135]},{value:1,color:[254,237,176]}]}),CHLOROPHYLL:new Jt({stops:[{value:0,color:[18,36,20]},{value:.13,color:[25,63,41]},{value:.25,color:[24,91,59]},{value:.38,color:[13,119,72]},{value:.5,color:[18,148,80]},{value:.63,color:[80,173,89]},{value:.75,color:[132,196,122]},{value:.88,color:[175,221,162]},{value:1,color:[215,249,208]}]}),DENSITY:new Jt({stops:[{value:0,color:[54,14,36]},{value:.13,color:[89,23,80]},{value:.25,color:[110,45,132]},{value:.38,color:[120,77,178]},{value:.5,color:[120,113,213]},{value:.63,color:[115,151,228]},{value:.75,color:[134,185,227]},{value:.88,color:[177,214,227]},{value:1,color:[230,241,241]}]}),FREESURFACE_BLUE:new Jt({stops:[{value:0,color:[30,4,110]},{value:.13,color:[47,14,176]},{value:.25,color:[41,45,236]},{value:.38,color:[25,99,212]},{value:.5,color:[68,131,200]},{value:.63,color:[114,156,197]},{value:.75,color:[157,181,203]},{value:.88,color:[200,208,216]},{value:1,color:[241,237,236]}]}),FREESURFACE_RED:new Jt({stops:[{value:0,color:[60,9,18]},{value:.13,color:[100,17,27]},{value:.25,color:[142,20,29]},{value:.38,color:[177,43,27]},{value:.5,color:[192,87,63]},{value:.63,color:[205,125,105]},{value:.75,color:[216,162,148]},{value:.88,color:[227,199,193]},{value:1,color:[241,237,236]}]}),OXYGEN:new Jt({stops:[{value:0,color:[64,5,5]},{value:.13,color:[106,6,15]},{value:.25,color:[144,26,7]},{value:.38,color:[168,64,3]},{value:.5,color:[188,100,4]},{value:.63,color:[206,136,11]},{value:.75,color:[220,174,25]},{value:.88,color:[231,215,44]},{value:1,color:[248,254,105]}]}),PAR:new Jt({stops:[{value:0,color:[51,20,24]},{value:.13,color:[90,32,35]},{value:.25,color:[129,44,34]},{value:.38,color:[159,68,25]},{value:.5,color:[182,99,19]},{value:.63,color:[199,134,22]},{value:.75,color:[212,171,35]},{value:.88,color:[221,210,54]},{value:1,color:[225,253,75]}]}),PHASE:new Jt({stops:[{value:0,color:[145,105,18]},{value:.13,color:[184,71,38]},{value:.25,color:[186,58,115]},{value:.38,color:[160,71,185]},{value:.5,color:[110,97,218]},{value:.63,color:[50,123,164]},{value:.75,color:[31,131,110]},{value:.88,color:[77,129,34]},{value:1,color:[145,105,18]}]}),SALINITY:new Jt({stops:[{value:0,color:[42,24,108]},{value:.13,color:[33,50,162]},{value:.25,color:[15,90,145]},{value:.38,color:[40,118,137]},{value:.5,color:[59,146,135]},{value:.63,color:[79,175,126]},{value:.75,color:[120,203,104]},{value:.88,color:[193,221,100]},{value:1,color:[253,239,154]}]}),TEMPERATURE:new Jt({stops:[{value:0,color:[4,35,51]},{value:.13,color:[23,51,122]},{value:.25,color:[85,59,157]},{value:.38,color:[129,79,143]},{value:.5,color:[175,95,130]},{value:.63,color:[222,112,101]},{value:.75,color:[249,146,66]},{value:.88,color:[249,196,65]},{value:1,color:[232,250,91]}]}),TURBIDITY:new Jt({stops:[{value:0,color:[34,31,27]},{value:.13,color:[65,50,41]},{value:.25,color:[98,69,52]},{value:.38,color:[131,89,57]},{value:.5,color:[161,112,59]},{value:.63,color:[185,140,66]},{value:.75,color:[202,174,88]},{value:.88,color:[216,209,126]},{value:1,color:[233,246,171]}]}),VELOCITY_BLUE:new Jt({stops:[{value:0,color:[17,32,64]},{value:.13,color:[35,52,116]},{value:.25,color:[29,81,156]},{value:.38,color:[31,113,162]},{value:.5,color:[50,144,169]},{value:.63,color:[87,173,176]},{value:.75,color:[149,196,189]},{value:.88,color:[203,221,211]},{value:1,color:[254,251,230]}]}),VELOCITY_GREEN:new Jt({stops:[{value:0,color:[23,35,19]},{value:.13,color:[24,64,38]},{value:.25,color:[11,95,45]},{value:.38,color:[39,123,35]},{value:.5,color:[95,146,12]},{value:.63,color:[152,165,18]},{value:.75,color:[201,186,69]},{value:.88,color:[233,216,137]},{value:1,color:[255,253,205]}]}),CUBEHELIX:new Jt({stops:[{value:0,color:[0,0,0]},{value:.07,color:[22,5,59]},{value:.13,color:[60,4,105]},{value:.2,color:[109,1,135]},{value:.27,color:[161,0,147]},{value:.33,color:[210,2,142]},{value:.4,color:[251,11,123]},{value:.47,color:[255,29,97]},{value:.53,color:[255,54,69]},{value:.6,color:[255,85,46]},{value:.67,color:[255,120,34]},{value:.73,color:[255,157,37]},{value:.8,color:[241,191,57]},{value:.87,color:[224,220,93]},{value:.93,color:[218,241,142]},{value:1,color:[227,253,198]}]}),CIVIDIS:new Jt({stops:[{value:0,color:[0,32,77,255]},{value:.125,color:[5,54,110,255]},{value:.25,color:[65,77,108,255]},{value:.375,color:[97,100,111,255]},{value:.5,color:[125,124,121,255]},{value:.625,color:[156,149,120,255]},{value:.75,color:[190,175,111,255]},{value:.875,color:[225,204,94,255]},{value:1,color:[255,235,70,255]}]}),TURBO:new Jt({stops:[{value:0,color:[48,18,59,255]},{value:.125,color:[70,107,227,255]},{value:.25,color:[40,187,236,255]},{value:.375,color:[49,242,153,255]},{value:.5,color:[162,252,60,255]},{value:.625,color:[237,208,58,255]},{value:.75,color:[251,128,34,255]},{value:.875,color:[210,49,5,255]},{value:1,color:[122,4,3,255]}]}),ROCKET:new Jt({stops:[{value:0,color:[250,235,221,0]},{value:.133,color:[250,235,221,255]},{value:.266,color:[246,170,130,255]},{value:.4,color:[240,96,67,255]},{value:.533,color:[203,27,79,255]},{value:.666,color:[132,30,90,255]},{value:.8,color:[63,27,68,255]},{value:1,color:[3,5,26,255]}]}),MAKO:new Jt({stops:[{value:0,color:[11,4,5,255]},{value:.125,color:[43,28,53,255]},{value:.25,color:[62,53,107,255]},{value:.375,color:[59,86,152,255]},{value:.5,color:[53,123,162,255]},{value:.625,color:[53,158,170,255]},{value:.75,color:[73,193,173,255]},{value:.875,color:[150,221,181,255]},{value:1,color:[222,245,229,255]}]})};async function hP(s,i,l={}){var m,f;if(!i.sourceId&&!i.data)throw new Error("Creating a polyline layer requires an existing .sourceId or a valid .data property");let a=i.data;if(typeof a=="string"){if(Fp(a))a=`https://api.maptiler.com/data/${i.data}/features.json?key=${Kn.apiKey}`;else if(((m=a.split(".").pop())==null?void 0:m.toLowerCase().trim())==="gpx"){let P=await(await fetch(a,l)).text();a=R1(P)}else if(((f=a.split(".").pop())==null?void 0:f.toLowerCase().trim())==="kml"){let P=await(await fetch(a,l)).text();a=D1(P)}else{let P=h2(a)??sP(a);P&&(a=P)}if(!a)throw new Error("Polyline data was provided as string but is incompatible with valid formats.")}return dP(s,Po(ai({},i),{data:a}))}function dP(s,i){if(i.layerId&&s.getLayer(i.layerId))throw new Error(`A layer already exists with the layer id: ${i.layerId}`);let l=i.sourceId??ad(),m=i.layerId??sd(),f={polylineLayerId:m,polylineOutlineLayerId:"",polylineSourceId:l};i.data&&!s.getSource(l)&&s.addSource(l,{type:"geojson",data:i.data});let a=i.lineWidth??3,P=i.lineColor??Xp(),E=i.lineOpacity??1,O=i.lineBlur??0,B=i.lineGapWidth??0,W=i.lineDashArray??null,V=i.outlineWidth??1,he=i.outlineColor??"#FFFFFF",ue=i.outlineOpacity??1,be=i.outlineBlur??0;if(typeof W=="string"&&(W=Ng(W)),i.outline===!0){let ze=`${m}_outline`;f.polylineOutlineLayerId=ze,s.addLayer({id:ze,type:"line",source:l,layout:{"line-join":i.lineJoin??"round","line-cap":i.lineCap??"round"},minzoom:i.minzoom??0,maxzoom:i.maxzoom??23,paint:{"line-opacity":typeof ue=="number"?ue:Wi(ue),"line-color":typeof he=="string"?he:$l(he),"line-width":$1(a,V),"line-blur":typeof be=="number"?be:Wi(be)}},i.beforeId)}return s.addLayer({id:m,type:"line",source:l,layout:{"line-join":i.lineJoin??"round","line-cap":i.lineCap??"round"},minzoom:i.minzoom??0,maxzoom:i.maxzoom??23,paint:ai({"line-opacity":typeof E=="number"?E:Wi(E),"line-color":typeof P=="string"?P:$l(P),"line-width":typeof a=="number"?a:Wi(a),"line-blur":typeof O=="number"?O:Wi(O),"line-gap-width":typeof B=="number"?B:Wi(B)},W&&{"line-dasharray":W})},i.beforeId),f}function pP(s,i){if(i.layerId&&s.getLayer(i.layerId))throw new Error(`A layer already exists with the layer id: ${i.layerId}`);let l=i.sourceId??ad(),m=i.layerId??sd(),f={polygonLayerId:m,polygonOutlineLayerId:i.outline?`${m}_outline`:"",polygonSourceId:l};if(i.data&&!s.getSource(l)){let ze=i.data;typeof ze=="string"&&Fp(ze)&&(ze=`https://api.maptiler.com/data/${ze}/features.json?key=${Kn.apiKey}`),s.addSource(l,{type:"geojson",data:ze})}let a=i.outlineDashArray??null,P=i.outlineWidth??1,E=i.outlineColor??"#FFFFFF",O=i.outlineOpacity??1,B=i.outlineBlur??0,W=i.fillColor??Xp(),V=i.fillOpacity??1,he=i.outlinePosition??"center",ue=i.pattern??null;typeof a=="string"&&(a=Ng(a));let be=(ze=null)=>{if(s.addLayer({id:m,type:"fill",source:l,minzoom:i.minzoom??0,maxzoom:i.maxzoom??23,paint:ai({"fill-color":typeof W=="string"?W:$l(W),"fill-opacity":typeof V=="number"?V:Wi(V)},ze&&{"fill-pattern":ze})},i.beforeId),i.outline===!0){let Xe;he==="inside"?typeof P=="number"?Xe=.5*P:Xe=Wi(P.map(({zoom:Ve,value:Se})=>({zoom:Ve,value:.5*Se}))):he==="outside"?typeof P=="number"?Xe=-.5*P:Xe=Wi(P.map(Ve=>({zoom:Ve.zoom,value:-.5*Ve.value}))):Xe=0,s.addLayer({id:f.polygonOutlineLayerId,type:"line",source:l,layout:{"line-join":i.outlineJoin??"round","line-cap":i.outlineCap??"butt"},minzoom:i.minzoom??0,maxzoom:i.maxzoom??23,paint:ai({"line-opacity":typeof O=="number"?O:Wi(O),"line-color":typeof E=="string"?E:$l(E),"line-width":typeof P=="number"?P:Wi(P),"line-blur":typeof B=="number"?B:Wi(B),"line-offset":Xe},a&&{"line-dasharray":a})},i.beforeId)}};return ue?s.hasImage(ue)?be(ue):s.loadImage(ue).then(ze=>{s.addImage(ue,ze.data),be(ue)}).catch(ze=>{console.error("Could not load the pattern image.",ze.message),be()}):be(),f}function fP(s,i){if(i.layerId&&s.getLayer(i.layerId))throw new Error(`A layer already exists with the layer id: ${i.layerId}`);let l=i.minPointRadius??10,m=i.maxPointRadius??50,f=i.cluster??!1,a=20,P=Array.isArray(i.pointColor)?i.pointColor:G1.TURBO.scale(10,i.cluster?1e4:1e3).resample("ease-out-square"),E=P.getBounds(),O=i.sourceId??ad(),B=i.layerId??sd(),W=i.showLabel??f,V=i.alignOnViewport??!0,he=i.outline??!1,ue=i.outlineOpacity??1,be=i.outlineWidth??1,ze=i.outlineColor??"#FFFFFF",Xe,Ve=i.zoomCompensation??!0,Se=i.minzoom??0,nt=i.maxzoom??23;typeof i.pointOpacity=="number"?Xe=i.pointOpacity:Array.isArray(i.pointOpacity)?Xe=Wi(i.pointOpacity):i.cluster?Xe=wg(P,"point_count"):i.property?Xe=wg(P,i.property):Xe=Wi([{zoom:Se,value:0},{zoom:Se+.25,value:1},{zoom:nt-.25,value:1},{zoom:nt,value:0}]);let pt={pointLayerId:B,clusterLayerId:"",labelLayerId:"",pointSourceId:O};if(i.data&&!s.getSource(O)){let Pt=i.data;typeof Pt=="string"&&Fp(Pt)&&(Pt=`https://api.maptiler.com/data/${Pt}/features.json?key=${Kn.apiKey}`),s.addSource(O,{type:"geojson",data:Pt,cluster:f})}if(f){pt.clusterLayerId=`${B}_cluster`;let Pt=Array.from({length:a},(kt,It)=>{let Q=E.min+It*(E.max-E.min)/(a-1);return{value:Q,pointRadius:l+(m-l)*(It/(a-1))**.5,color:P.getColorHex(Q)}});s.addLayer({id:pt.clusterLayerId,type:"circle",source:O,filter:["has","point_count"],paint:ai({"circle-color":typeof i.pointColor=="string"?i.pointColor:xg(Pt,"point_count"),"circle-radius":typeof i.pointRadius=="number"?i.pointRadius:Array.isArray(i.pointRadius)?Wi(i.pointRadius):bg(Pt,"point_count",!1),"circle-pitch-alignment":V?"viewport":"map","circle-pitch-scale":"map","circle-opacity":Xe},he&&{"circle-stroke-opacity":typeof ue=="number"?ue:Wi(ue),"circle-stroke-width":typeof be=="number"?be:Wi(be),"circle-stroke-color":typeof ze=="string"?ze:$l(ze)}),minzoom:Se,maxzoom:nt},i.beforeId),s.addLayer({id:pt.pointLayerId,type:"circle",source:O,filter:["!",["has","point_count"]],paint:ai({"circle-pitch-alignment":V?"viewport":"map","circle-pitch-scale":"map","circle-color":typeof i.pointColor=="string"?i.pointColor:P.getColorHex(P.getBounds().min),"circle-radius":typeof i.pointRadius=="number"?i.pointRadius:Array.isArray(i.pointRadius)?Wi(i.pointRadius):Pt[0].pointRadius*.75,"circle-opacity":Xe},he&&{"circle-stroke-opacity":typeof ue=="number"?ue:Wi(ue),"circle-stroke-width":typeof be=="number"?be:Wi(be),"circle-stroke-color":typeof ze=="string"?ze:$l(ze)}),minzoom:Se,maxzoom:nt},i.beforeId)}else{let Pt=typeof i.pointColor=="string"?i.pointColor:Array.isArray(i.pointColor)?i.pointColor.getColorHex(i.pointColor.getBounds().min):Xp(),kt=typeof i.pointRadius=="number"?Ve?Wi([{zoom:0,value:i.pointRadius*.025},{zoom:2,value:i.pointRadius*.05},{zoom:4,value:i.pointRadius*.1},{zoom:8,value:i.pointRadius*.25},{zoom:16,value:i.pointRadius*1}]):i.pointRadius:Array.isArray(i.pointRadius)?Wi(i.pointRadius):Ve?Wi([{zoom:0,value:l*.05},{zoom:2,value:l*.1},{zoom:4,value:l*.2},{zoom:8,value:l*.5},{zoom:16,value:l*1}]):l;if(i.property&&Array.isArray(i.pointColor)){let It=Array.from({length:a},(Q,re)=>{let ce=E.min+re*(E.max-E.min)/(a-1);return{value:ce,pointRadius:typeof i.pointRadius=="number"?i.pointRadius:l+(m-l)*(re/(a-1))**.5,color:typeof i.pointColor=="string"?i.pointColor:P.getColorHex(ce)}});Pt=xg(It,i.property),kt=bg(It,i.property,Ve)}s.addLayer({id:pt.pointLayerId,type:"circle",source:O,layout:{"circle-sort-key":i.property?["/",1,["get",i.property]]:0},paint:ai({"circle-pitch-alignment":V?"viewport":"map","circle-pitch-scale":"map","circle-color":Pt,"circle-opacity":Xe,"circle-radius":kt},he&&{"circle-stroke-opacity":typeof ue=="number"?ue:Wi(ue),"circle-stroke-width":typeof be=="number"?be:Wi(be),"circle-stroke-color":typeof ze=="string"?ze:$l(ze)}),minzoom:Se,maxzoom:nt},i.beforeId)}if(W!==!1&&(i.cluster||i.property)){pt.labelLayerId=`${B}_label`;let Pt=i.labelColor??"#fff",kt=i.labelSize??12;s.addLayer({id:pt.labelLayerId,type:"symbol",source:O,filter:["has",i.cluster?"point_count":i.property],layout:{"text-field":i.cluster?"{point_count_abbreviated}":`{${i.property}}`,"text-font":["Noto Sans Regular"],"text-size":kt,"text-pitch-alignment":V?"viewport":"map","symbol-sort-key":["/",1,["get",i.cluster?"point_count":i.property]]},paint:{"text-color":Pt,"text-opacity":Xe},minzoom:Se,maxzoom:nt},i.beforeId)}return pt}function mP(s,i){if(i.layerId&&s.getLayer(i.layerId))throw new Error(`A layer already exists with the layer id: ${i.layerId}`);let l=i.sourceId??ad(),m=i.layerId??sd(),f=i.minzoom??0,a=i.maxzoom??23,P=i.zoomCompensation??!0,E=i.opacity??[{zoom:f,value:0},{zoom:f+.25,value:1},{zoom:a-.25,value:1},{zoom:a,value:0}],O=Array.isArray(i.colorRamp)?i.colorRamp:G1.TURBO.transparentStart(),B=O.getBounds();(B.min!==0||B.max!==1)&&(O=O.scale(0,1)),O.hasTransparentStart()||(O=O.transparentStart());let W=i.intensity??[{zoom:0,value:.01},{zoom:4,value:.2},{zoom:16,value:1}],V=i.property??null,he=i.weight??1,ue=1;V?typeof he=="number"?(ue=he,typeof i.weight=="number"&&console.warn("The option `.property` is ignored when `.propertyValueWeights` is not of type `PropertyValueWeights`")):Array.isArray(he)?ue=U1(he,V):console.warn("The option `.property` is ignored when `.propertyValueWeights` is not of type `PropertyValueWeights`"):typeof he=="number"?ue=he:Array.isArray(he)&&console.warn("The options `.propertyValueWeights` can only be used when `.property` is provided.");let be=[{zoom:0,value:50*.025},{zoom:2,value:50*.05},{zoom:4,value:50*.1},{zoom:8,value:50*.25},{zoom:16,value:50}],ze=i.radius??(P?be:10),Xe=1;typeof ze=="number"?Xe=ze:Array.isArray(ze)&&"zoom"in ze[0]?Xe=Wi(ze):V&&Array.isArray(ze)&&"propertyValue"in ze[0]?Xe=Z1(ze,V,P):!V&&Array.isArray(ze)&&"propertyValue"in ze[0]?(Xe=Wi(be),console.warn("The option `.radius` can only be property-driven if the option `.property` is provided.")):Xe=Wi(be);let Ve={heatmapLayerId:m,heatmapSourceId:l};if(i.data&&!s.getSource(l)){let Se=i.data;typeof Se=="string"&&Fp(Se)&&(Se=`https://api.maptiler.com/data/${Se}/features.json?key=${Kn.apiKey}`),s.addSource(l,{type:"geojson",data:Se})}return s.addLayer({id:m,type:"heatmap",source:l,minzoom:f,maxzoom:a,paint:{"heatmap-weight":ue,"heatmap-intensity":typeof W=="number"?W:Wi(W),"heatmap-color":V1(O),"heatmap-radius":Xe,"heatmap-opacity":typeof E=="number"?E:Wi(E)}},i.beforeId),Ve}var Ku=Object.freeze(Object.defineProperty({__proto__:null,addHeatmap:mP,addPoint:fP,addPolygon:pP,addPolyline:hP,colorDrivenByProperty:xg,colorPalettes:yg,computeRampedOutlineWidth:$1,dashArrayMaker:Ng,generateRandomLayerName:sd,generateRandomSourceName:ad,getRandomColor:Xp,heatmapIntensityFromColorRamp:V1,lerpZoomNumberValues:vg,opacityDrivenByProperty:wg,paintColorOptionsToPaintSpec:$l,radiusDrivenByProperty:bg,radiusDrivenByPropertyHeatmap:Z1,rampedOptionsToLayerPaintSpec:Wi,rampedPropertyValueWeight:U1,takeScreenshot:lP},Symbol.toStringTag,{value:"Module"}));c2();var uI=$t.default.Map,hI=$t.default.Marker,dI=$t.default.Popup,pI=$t.default.Style,fI=$t.default.CanvasSource,mI=$t.default.GeoJSONSource,gI=$t.default.ImageSource,_I=$t.default.RasterTileSource,yI=$t.default.RasterDEMTileSource,vI=$t.default.VectorTileSource,xI=$t.default.VideoSource,bI=$t.default.NavigationControl,wI=$t.default.GeolocateControl,TI=$t.default.AttributionControl,SI=$t.default.LogoControl,PI=$t.default.ScaleControl,MI=$t.default.FullscreenControl,CI=$t.default.TerrainControl,II=$t.default.BoxZoomHandler,EI=$t.default.ScrollZoomHandler,LI=$t.default.CooperativeGesturesHandler,AI=$t.default.KeyboardHandler,kI=$t.default.TwoFingersTouchPitchHandler,zI=$t.default.MapWheelEvent,RI=$t.default.MapTouchEvent,DI=$t.default.MapMouseEvent,BI=$t.default.config,OI=$t.default.getVersion,{setRTLTextPlugin:FI,getRTLTextPluginStatus:NI,LngLat:jI,LngLatBounds:$I,MercatorCoordinate:UI,Evented:ZI,AJAXError:VI,prewarm:GI,clearPrewarmedResources:qI,Hash:WI,Point:HI,EdgeInsets:KI,DragRotateHandler:XI,DragPanHandler:YI,TwoFingersTouchZoomRotateHandler:JI,DoubleClickZoomHandler:QI,TwoFingersTouchZoomHandler:eE,TwoFingersTouchRotateHandler:tE,getWorkerCount:iE,setWorkerCount:nE,getMaxParallelImageRequests:rE,setMaxParallelImageRequests:oE,getWorkerUrl:aE,setWorkerUrl:sE,addSourceType:lE,importScriptInWorkers:cE,addProtocol:uE,removeProtocol:hE}=$t.default;var gP="@maptiler/leaflet-maptilersdk",_P="4.1.0",q1=Yn.default.Layer.extend({options:{updateInterval:32,padding:.1,interactive:!1,pane:"tilePane"},map:null,initialize:function(s){Yn.default.setOptions(this,s),this._throttledUpdate=Yn.default.Util.throttle(this._update,this.options.updateInterval,this)},onAdd:function(s){var i;this._container||this._initContainer();let l=this.getPaneName();(i=s.getPane(l))==null||i.appendChild(this._container),this._initMaptilerSDK(),this._offset=this._map.containerPointToLayerPoint([0,0]),s.options.zoomAnimation&&Yn.default.DomEvent.on(s._proxy,Yn.default.DomUtil.TRANSITION_END,this._transitionEnd,this),s.attributionControl.addAttribution('<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>')},onRemove:function(s){var i;this._map._proxy&&this._map.options.zoomAnimation&&Yn.default.DomEvent.off(this._map._proxy,Yn.default.DomUtil.TRANSITION_END,this._transitionEnd,this);let l=this.getPaneName();(i=s.getPane(l))==null||i.removeChild(this._container),this._maptilerMap.remove(),this._maptilerMap=null},getEvents:function(){return{move:this._throttledUpdate,zoomanim:this._animateZoom,zoom:this._pinchZoom,zoomstart:this._zoomStart,zoomend:this._zoomEnd,resize:this._resize}},getMaptilerSDKMap:function(){return this._maptilerMap},getCanvas:function(){return this._maptilerMap.getCanvas()},getSize:function(){return this._map.getSize().multiplyBy(1+this.options.padding*2)},getBounds:function(){let s=this.getSize().multiplyBy(.5),i=this._map.latLngToContainerPoint(this._map.getCenter());return Yn.default.latLngBounds(this._map.containerPointToLatLng(i.subtract(s)),this._map.containerPointToLatLng(i.add(s)))},getContainer:function(){return this._container},getPaneName:function(){return this._map.getPane(this.options.pane)?this.options.pane:"tilePane"},setStyle:function(s){this._maptilerMap.setStyle(s)},setLanguage:function(s){this._maptilerMap.setLanguage(s)},_roundPoint:s=>({x:Math.round(s.x),y:Math.round(s.y)}),_initContainer:function(){this._container=Yn.default.DomUtil.create("div","leaflet-gl-layer");let s=this.getSize(),i=this._map.getSize().multiplyBy(this.options.padding);this._container.style.width=`${s.x}px`,this._container.style.height=`${s.y}px`;let l=this._map.containerPointToLayerPoint([0,0]).subtract(i);Yn.default.DomUtil.setPosition(this._container,this._roundPoint(l))},_initMaptilerSDK:function(){let s=this._map.getCenter(),i=Po(ai({},this.options),{projection:"mercator",container:this._container,center:[s.lng,s.lat],zoom:this._map.getZoom()-1,attributionControl:!1});this.options.geolocate&&(i.center=void 0,i.zoom=void 0),this._maptilerMap=new Bg(i),this._maptilerMap.telemetry.registerModule(gP,_P),this._maptilerMap.once("load",()=>{this.fire("ready")}),this._maptilerMap.once("load",async()=>{let m={logo:null};try{let f=Object.keys(this._maptilerMap.style.sourceCaches).map(P=>this._maptilerMap.getSource(P)).filter(P=>P&&"url"in P&&typeof P.url=="string"&&P?.url.includes("tiles.json")),a=new URL(f[0].url);a.searchParams.has("key")||a.searchParams.append("key",i.apiKey),m=await(await fetch(a.href)).json()}catch{}if(m.logo||i.maptilerLogo){let f=m.logo??"https://api.maptiler.com/resources/logo.svg",a=document.createElement("a");a.href="https://www.maptiler.com",a.style.setProperty("position","absolute"),a.style.setProperty("left","10px"),a.style.setProperty("bottom","2px"),a.style.setProperty("z-index","999");let P=document.createElement("img");P.src=f,P.alt="MapTiler logo",P.width=100,P.height=30,a.appendChild(P),this._map.getContainer().appendChild(a)}}),this._maptilerMap.transform.freezeElevation=!0,this.options.geolocate&&this._maptilerMap.on("load",()=>{this._map.setView(this._maptilerMap.getCenter(),this._maptilerMap.getZoom()+1)}),this._transformGL(),this._maptilerMap._actualCanvas=this._maptilerMap._canvas;let l=this._maptilerMap._actualCanvas;Yn.default.DomUtil.addClass(l,"leaflet-image-layer"),Yn.default.DomUtil.addClass(l,"leaflet-zoom-animated"),this.options.interactive&&Yn.default.DomUtil.addClass(l,"leaflet-interactive"),this.options.className&&Yn.default.DomUtil.addClass(l,this.options.className),this.addHeatmap=m=>Ku.addHeatmap(this._maptilerMap,m),this.addPolygon=m=>Ku.addPolygon(this._maptilerMap,m),this.addPoint=m=>Ku.addPoint(this._maptilerMap,m),this.addPolyline=m=>Ku.addPolyline(this._maptilerMap,m),this.takeScreenshot=m=>Ku.takeScreenshot(this._maptilerMap,m)},_update:function(){if(this._offset=this._map.containerPointToLayerPoint([0,0]),this._zooming)return;let s=this.getSize(),i=this._map.getSize().multiplyBy(this.options.padding),l=this._map.containerPointToLayerPoint([0,0]).subtract(i);Yn.default.DomUtil.setPosition(this._container,this._roundPoint(l)),this._transformGL(),this._maptilerMap.transform.width!==s.x||this._maptilerMap.transform.height!==s.y?(this._container.style.width=`${s.x}px`,this._container.style.height=`${s.y}px`,this._maptilerMap._resize!==null&&this._maptilerMap._resize!==void 0?this._maptilerMap._resize():this._maptilerMap.resize()):this._maptilerMap._update!==null&&this._maptilerMap._update!==void 0?this._maptilerMap._update():this._maptilerMap.update()},_transformGL:function(){this._maptilerMap.setCenter(this._map.getCenter()),this._maptilerMap.setZoom(this._map.getZoom()-1)},_pinchZoom:function(){this._maptilerMap.jumpTo({zoom:this._map.getZoom()-1,center:this._map.getCenter()})},_animateZoom:function(s){let i=this._map.getZoomScale(s.zoom),l=this._map.getSize().multiplyBy(this.options.padding*i),m=this.getSize()._divideBy(2),f=this._map.project(s.center,s.zoom)._subtract(m)._add(this._map._getMapPanePos().add(l))._round(),a=this._map.project(this._map.getBounds().getNorthWest(),s.zoom)._subtract(f);Yn.default.DomUtil.setTransform(this._maptilerMap.getCanvas(),a.subtract(this._offset),i)},_zoomStart:function(){this._zooming=!0},_zoomEnd:function(){let s=this._map.getZoomScale(this._map.getZoom());Yn.default.DomUtil.setTransform(this._maptilerMap.getCanvas(),new Yn.default.Point(0,0),s),this._zooming=!1,this._update()},_transitionEnd:function(){Yn.default.Util.requestAnimFrame(()=>{let s=this._map.getZoom(),i=this._map.getCenter(),l=this._map.latLngToContainerPoint(this._map.getBounds().getNorthWest());Yn.default.DomUtil.setTransform(this._maptilerMap._actualCanvas,l,1),this._maptilerMap.once("moveend",Yn.default.Util.bind(()=>{this._zoomEnd()},this)),this._maptilerMap.jumpTo({center:i,zoom:s-1})},this)},_resize:function(s){this._transitionEnd(s)}});var Rr=Ec(Ru(),1);var yP=Object.defineProperty,Sx=s=>{throw TypeError(s)},vP=(s,i,l)=>i in s?yP(s,i,{enumerable:!0,configurable:!0,writable:!0,value:l}):s[i]=l,Ht=(s,i,l)=>vP(s,typeof i!="symbol"?i+"":i,l),Px=(s,i,l)=>i.has(s)||Sx("Cannot "+l),da=(s,i,l)=>(Px(s,i,"read from private field"),l?l.call(s):i.get(s)),W1=(s,i,l)=>i.has(s)?Sx("Cannot add the same private member more than once"):i instanceof WeakSet?i.add(s):i.set(s,l),H1=(s,i,l,m)=>(Px(s,i,"write to private field"),m?m.call(s,l):i.set(s,l),l);function En(){}function xP(s,i){for(let l in i)s[l]=i[l];return s}function Mx(s){return s()}function K1(){return Object.create(null)}function pl(s){s.forEach(Mx)}function Cx(s){return typeof s=="function"}function Wl(s,i){return s!=s?i==i:s!==i||s&&typeof s=="object"||typeof s=="function"}var Yp;function eo(s,i){return s===i?!0:(Yp||(Yp=document.createElement("a")),Yp.href=i,s===Yp.href)}function bP(s){return Object.keys(s).length===0}function wP(s,i,l,m){if(s){let f=Ix(s,i,l,m);return s[0](f)}}function Ix(s,i,l,m){return s[1]&&m?xP(l.ctx.slice(),s[1](m(i))):l.ctx}function TP(s,i,l,m){return s[2],i.dirty}function SP(s,i,l,m,f,a){if(f){let P=Ix(i,l,m,a);s.p(P,f)}}function PP(s){if(s.ctx.length>32){let i=[],l=s.ctx.length/32;for(let m=0;m<l;m++)i[m]=-1;return i}return-1}function sf(s){return s??""}function ji(s,i){s.appendChild(i)}function Ln(s,i,l){s.insertBefore(i,l||null)}function wn(s){s.parentNode&&s.parentNode.removeChild(s)}function en(s){return document.createElement(s)}function Xa(s){return document.createElementNS("http://www.w3.org/2000/svg",s)}function Gl(s){return document.createTextNode(s)}function Yo(){return Gl(" ")}function MP(){return Gl("")}function Sr(s,i,l,m){return s.addEventListener(i,l,m),()=>s.removeEventListener(i,l,m)}function CP(s){return function(i){return i.preventDefault(),s.call(this,i)}}function rt(s,i,l){l==null?s.removeAttribute(i):s.getAttribute(i)!==l&&s.setAttribute(i,l)}function IP(s){return Array.from(s.childNodes)}function md(s,i){i=""+i,s.data!==i&&(s.data=i)}function X1(s,i){s.value=i??""}function Ls(s,i,l){s.classList.toggle(i,!!l)}function EP(s,i,{bubbles:l=!1,cancelable:m=!1}={}){return new CustomEvent(s,{detail:i,bubbles:l,cancelable:m})}var gd;function fd(s){gd=s}function Ex(){if(!gd)throw new Error("Function called outside component initialization");return gd}function LP(s){Ex().$$.on_destroy.push(s)}function Lx(){let s=Ex();return(i,l,{cancelable:m=!1}={})=>{let f=s.$$.callbacks[i];if(f){let a=EP(i,l,{cancelable:m});return f.slice().forEach(P=>{P.call(s,a)}),!a.defaultPrevented}return!0}}function AP(s,i){let l=s.$$.callbacks[i.type];l&&l.slice().forEach(m=>m.call(this,i))}var Yu=[],Zg=[],Qu=[],Y1=[],kP=Promise.resolve(),Vg=!1;function zP(){Vg||(Vg=!0,kP.then(Ax))}function Gg(s){Qu.push(s)}var jg=new Set,Xu=0;function Ax(){if(Xu!==0)return;let s=gd;do{try{for(;Xu<Yu.length;){let i=Yu[Xu];Xu++,fd(i),RP(i.$$)}}catch(i){throw Yu.length=0,Xu=0,i}for(fd(null),Yu.length=0,Xu=0;Zg.length;)Zg.pop()();for(let i=0;i<Qu.length;i+=1){let l=Qu[i];jg.has(l)||(jg.add(l),l())}Qu.length=0}while(Yu.length);for(;Y1.length;)Y1.pop()();Vg=!1,jg.clear(),fd(s)}function RP(s){if(s.fragment!==null){s.update(),pl(s.before_update);let i=s.dirty;s.dirty=[-1],s.fragment&&s.fragment.p(s.ctx,i),s.after_update.forEach(Gg)}}function DP(s){let i=[],l=[];Qu.forEach(m=>s.indexOf(m)===-1?i.push(m):l.push(m)),l.forEach(m=>m()),Qu=i}var tf=new Set,qc;function nf(){qc={r:0,c:[],p:qc}}function rf(){qc.r||pl(qc.c),qc=qc.p}function sr(s,i){s&&s.i&&(tf.delete(s),s.i(i))}function zr(s,i,l,m){if(s&&s.o){if(tf.has(s))return;tf.add(s),qc.c.push(()=>{tf.delete(s),m&&(l&&s.d(1),m())}),s.o(i)}else m&&m()}function J1(s){return s?.length!==void 0?s:Array.from(s)}function BP(s,i){zr(s,1,1,()=>{i.delete(s.key)})}function OP(s,i,l,m,f,a,P,E,O,B,W,V){let he=s.length,ue=a.length,be=he,ze={};for(;be--;)ze[s[be].key]=be;let Xe=[],Ve=new Map,Se=new Map,nt=[];for(be=ue;be--;){let It=V(f,a,be),Q=l(It),re=P.get(Q);re?nt.push(()=>re.p(It,i)):(re=B(Q,It),re.c()),Ve.set(Q,Xe[be]=re),Q in ze&&Se.set(Q,Math.abs(be-ze[Q]))}let pt=new Set,Pt=new Set;function kt(It){sr(It,1),It.m(E,W),P.set(It.key,It),W=It.first,ue--}for(;he&&ue;){let It=Xe[ue-1],Q=s[he-1],re=It.key,ce=Q.key;It===Q?(W=It.first,he--,ue--):Ve.has(ce)?!P.has(re)||pt.has(re)?kt(It):Pt.has(ce)?he--:Se.get(re)>Se.get(ce)?(Pt.add(re),kt(It)):(pt.add(ce),he--):(O(Q,P),he--)}for(;he--;){let It=s[he];Ve.has(It.key)||O(It,P)}for(;ue;)kt(Xe[ue-1]);return pl(nt),Xe}function ql(s){s&&s.c()}function ul(s,i,l){let{fragment:m,after_update:f}=s.$$;m&&m.m(i,l),Gg(()=>{let a=s.$$.on_mount.map(Mx).filter(Cx);s.$$.on_destroy?s.$$.on_destroy.push(...a):pl(a),s.$$.on_mount=[]}),f.forEach(Gg)}function hl(s,i){let l=s.$$;l.fragment!==null&&(DP(l.after_update),pl(l.on_destroy),l.fragment&&l.fragment.d(i),l.on_destroy=l.fragment=null,l.ctx=[])}function FP(s,i){s.$$.dirty[0]===-1&&(Yu.push(s),zP(),s.$$.dirty.fill(0)),s.$$.dirty[i/31|0]|=1<<i%31}function Hl(s,i,l,m,f,a,P=null,E=[-1]){let O=gd;fd(s);let B=s.$$={fragment:null,ctx:[],props:a,update:En,not_equal:f,bound:K1(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(i.context||(O?O.$$.context:[])),callbacks:K1(),dirty:E,skip_bound:!1,root:i.target||O.$$.root};P&&P(B.root);let W=!1;if(B.ctx=l?l(s,i.props||{},(V,he,...ue)=>{let be=ue.length?ue[0]:he;return B.ctx&&f(B.ctx[V],B.ctx[V]=be)&&(!B.skip_bound&&B.bound[V]&&B.bound[V](be),W&&FP(s,V)),he}):[],B.update(),W=!0,pl(B.before_update),B.fragment=m?m(B.ctx):!1,i.target){if(i.hydrate){let V=IP(i.target);B.fragment&&B.fragment.l(V),V.forEach(wn)}else B.fragment&&B.fragment.c();i.intro&&sr(s.$$.fragment),ul(s,i.target,i.anchor),Ax()}fd(O)}var ks=class{constructor(){Ht(this,"$$"),Ht(this,"$$set")}$destroy(){hl(this,1),this.$destroy=En}$on(i,l){if(!Cx(l))return En;let m=this.$$.callbacks[i]||(this.$$.callbacks[i]=[]);return m.push(l),()=>{let f=m.indexOf(l);f!==-1&&m.splice(f,1)}}$set(i){this.$$set&&!bP(i)&&(this.$$.skip_bound=!0,this.$$set(i),this.$$.skip_bound=!1)}},NP="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(NP);function jP(s){let i,l;return{c(){i=Xa("svg"),l=Xa("path"),rt(l,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),rt(i,"viewBox","0 0 14 14"),rt(i,"width","13"),rt(i,"height","13"),rt(i,"class","svelte-en2qvf")},m(m,f){Ln(m,i,f),ji(i,l)},p:En,i:En,o:En,d(m){m&&wn(i)}}}var lf=class extends ks{constructor(i){super(),Hl(this,i,null,jP,Wl,{})}};function $P(s){let i,l;return{c(){i=Xa("svg"),l=Xa("path"),rt(l,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),rt(i,"viewBox","0 0 30 30"),rt(i,"fill","none"),rt(i,"xmlns","http://www.w3.org/2000/svg"),rt(i,"class","svelte-d2loi5")},m(m,f){Ln(m,i,f),ji(i,l)},p:En,i:En,o:En,d(m){m&&wn(i)}}}var cf=class extends ks{constructor(i){super(),Hl(this,i,null,$P,Wl,{})}};function UP(s){let i,l;return{c(){i=en("img"),eo(i.src,l=s[3]+"area.svg")||rt(i,"src",l),rt(i,"alt",s[7]),rt(i,"title",s[7]),rt(i,"class","svelte-w9y5n9")},m(m,f){Ln(m,i,f)},p(m,f){f&8&&!eo(i.src,l=m[3]+"area.svg")&&rt(i,"src",l),f&128&&rt(i,"alt",m[7]),f&128&&rt(i,"title",m[7])},d(m){m&&wn(i)}}}function ZP(s){let i,l;return{c(){i=en("img"),eo(i.src,l=s[3]+"reverse.svg")||rt(i,"src",l),rt(i,"alt",s[7]),rt(i,"title",s[7]),rt(i,"class","svelte-w9y5n9")},m(m,f){Ln(m,i,f)},p(m,f){f&8&&!eo(i.src,l=m[3]+"reverse.svg")&&rt(i,"src",l),f&128&&rt(i,"alt",m[7]),f&128&&rt(i,"title",m[7])},d(m){m&&wn(i)}}}function VP(s){let i,l;return{c(){i=en("img"),eo(i.src,l=s[3]+"poi.svg")||rt(i,"src",l),rt(i,"alt",s[7]),rt(i,"title",s[7]),rt(i,"class","svelte-w9y5n9")},m(m,f){Ln(m,i,f)},p(m,f){f&8&&!eo(i.src,l=m[3]+"poi.svg")&&rt(i,"src",l),f&128&&rt(i,"alt",m[7]),f&128&&rt(i,"title",m[7])},d(m){m&&wn(i)}}}function GP(s){let i,l;return{c(){i=en("img"),eo(i.src,l=s[3]+"postal_code.svg")||rt(i,"src",l),rt(i,"alt",s[7]),rt(i,"title",s[7]),rt(i,"class","svelte-w9y5n9")},m(m,f){Ln(m,i,f)},p(m,f){f&8&&!eo(i.src,l=m[3]+"postal_code.svg")&&rt(i,"src",l),f&128&&rt(i,"alt",m[7]),f&128&&rt(i,"title",m[7])},d(m){m&&wn(i)}}}function qP(s){let i,l;return{c(){i=en("img"),eo(i.src,l=s[3]+"street.svg")||rt(i,"src",l),rt(i,"alt",s[7]),rt(i,"title",s[7]),rt(i,"class","svelte-w9y5n9")},m(m,f){Ln(m,i,f)},p(m,f){f&8&&!eo(i.src,l=m[3]+"street.svg")&&rt(i,"src",l),f&128&&rt(i,"alt",m[7]),f&128&&rt(i,"title",m[7])},d(m){m&&wn(i)}}}function WP(s){let i,l;return{c(){i=en("img"),eo(i.src,l=s[3]+"road.svg")||rt(i,"src",l),rt(i,"alt",s[7]),rt(i,"title",s[7]),rt(i,"class","svelte-w9y5n9")},m(m,f){Ln(m,i,f)},p(m,f){f&8&&!eo(i.src,l=m[3]+"road.svg")&&rt(i,"src",l),f&128&&rt(i,"alt",m[7]),f&128&&rt(i,"title",m[7])},d(m){m&&wn(i)}}}function HP(s){let i,l;return{c(){i=en("img"),eo(i.src,l=s[3]+"housenumber.svg")||rt(i,"src",l),rt(i,"alt",s[7]),rt(i,"title",s[7]),rt(i,"class","svelte-w9y5n9")},m(m,f){Ln(m,i,f)},p(m,f){f&8&&!eo(i.src,l=m[3]+"housenumber.svg")&&rt(i,"src",l),f&128&&rt(i,"alt",m[7]),f&128&&rt(i,"title",m[7])},d(m){m&&wn(i)}}}function KP(s){let i,l,m,f;return{c(){i=en("img"),eo(i.src,l=s[5])||rt(i,"src",l),rt(i,"alt",s[4]),rt(i,"title",s[7]),rt(i,"class","svelte-w9y5n9")},m(a,P){Ln(a,i,P),m||(f=Sr(i,"error",s[14]),m=!0)},p(a,P){P&32&&!eo(i.src,l=a[5])&&rt(i,"src",l),P&16&&rt(i,"alt",a[4]),P&128&&rt(i,"title",a[7])},d(a){a&&wn(i),m=!1,f()}}}function XP(s){let i,l;return{c(){i=en("div"),rt(i,"class","sprite-icon svelte-w9y5n9"),rt(i,"style",l=`
        width: ${s[6].width/pa}px;
        height: ${s[6].height/pa}px;
        background-image: url(${s[3]}sprite${qg}.png);
        background-position: -${s[6].x/pa}px -${s[6].y/pa}px;
        background-size: ${Es.width/pa}px ${Es.height/pa}px;
      `),rt(i,"title",s[7])},m(m,f){Ln(m,i,f)},p(m,f){f&72&&l!==(l=`
        width: ${m[6].width/pa}px;
        height: ${m[6].height/pa}px;
        background-image: url(${m[3]}sprite${qg}.png);
        background-position: -${m[6].x/pa}px -${m[6].y/pa}px;
        background-size: ${Es.width/pa}px ${Es.height/pa}px;
      `)&&rt(i,"style",l),f&128&&rt(i,"title",m[7])},d(m){m&&wn(i)}}}function Q1(s){let i,l;return{c(){i=en("span"),l=Gl(s[7]),rt(i,"class","secondary svelte-w9y5n9")},m(m,f){Ln(m,i,f),ji(i,l)},p(m,f){f&128&&md(l,m[7])},d(m){m&&wn(i)}}}function YP(s){let i,l,m,f,a,P,E,O,B,W=(s[8]?s[0].place_name:s[0].place_name.replace(/,.*/,""))+"",V,he,ue=s[2]==="always"||s[2]!=="never"&&!s[0].address&&!s[0].id.startsWith("road.")&&!s[0].id.startsWith("address.")&&!s[0].id.startsWith("postal_code.")&&(!s[0].id.startsWith("poi.")||!s[5])&&!s[8],be,ze,Xe=(s[8]?"":s[0].place_name.replace(/[^,]*,?\s*/,""))+"",Ve,Se,nt,pt,Pt,kt;function It(Ie,de){return de&1&&(l=null),de&1&&(m=null),de&1&&(f=null),de&1&&(a=null),Es&&Ie[6]?XP:Ie[5]?KP:Ie[0].address?HP:(l==null&&(l=!!Ie[0].id.startsWith("road.")),l?WP:(m==null&&(m=!!Ie[0].id.startsWith("address.")),m?qP:(f==null&&(f=!!Ie[0].id.startsWith("postal_code.")),f?GP:(a==null&&(a=!!Ie[0].id.startsWith("poi.")),a?VP:Ie[8]?ZP:UP))))}let Q=It(s,-1),re=Q(s),ce=ue&&Q1(s);return{c(){i=en("li"),re.c(),P=Yo(),E=en("span"),O=en("span"),B=en("span"),V=Gl(W),he=Yo(),ce&&ce.c(),be=Yo(),ze=en("span"),Ve=Gl(Xe),rt(B,"class","primary svelte-w9y5n9"),rt(O,"class","svelte-w9y5n9"),rt(ze,"class","line2 svelte-w9y5n9"),rt(E,"class","texts svelte-w9y5n9"),rt(i,"tabindex","-1"),rt(i,"role","option"),rt(i,"aria-selected",Se=s[1]==="selected"),rt(i,"aria-checked",nt=s[1]==="picked"),rt(i,"class",pt=sf(s[1])+" svelte-w9y5n9")},m(Ie,de){Ln(Ie,i,de),re.m(i,null),ji(i,P),ji(i,E),ji(E,O),ji(O,B),ji(B,V),ji(O,he),ce&&ce.m(O,null),ji(E,be),ji(E,ze),ji(ze,Ve),Pt||(kt=[Sr(i,"mouseenter",s[13]),Sr(i,"focus",s[15]),Sr(i,"click",s[16])],Pt=!0)},p(Ie,[de]){Q===(Q=It(Ie,de))&&re?re.p(Ie,de):(re.d(1),re=Q(Ie),re&&(re.c(),re.m(i,P))),de&257&&W!==(W=(Ie[8]?Ie[0].place_name:Ie[0].place_name.replace(/,.*/,""))+"")&&md(V,W),de&293&&(ue=Ie[2]==="always"||Ie[2]!=="never"&&!Ie[0].address&&!Ie[0].id.startsWith("road.")&&!Ie[0].id.startsWith("address.")&&!Ie[0].id.startsWith("postal_code.")&&(!Ie[0].id.startsWith("poi.")||!Ie[5])&&!Ie[8]),ue?ce?ce.p(Ie,de):(ce=Q1(Ie),ce.c(),ce.m(O,null)):ce&&(ce.d(1),ce=null),de&257&&Xe!==(Xe=(Ie[8]?"":Ie[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&md(Ve,Xe),de&2&&Se!==(Se=Ie[1]==="selected")&&rt(i,"aria-selected",Se),de&2&&nt!==(nt=Ie[1]==="picked")&&rt(i,"aria-checked",nt),de&2&&pt!==(pt=sf(Ie[1])+" svelte-w9y5n9")&&rt(i,"class",pt)},i:En,o:En,d(Ie){Ie&&wn(i),re.d(),ce&&ce.d(),Pt=!1,pl(kt)}}}var kx=typeof devicePixelRatio>"u"?1:devicePixelRatio>1.25,qg=kx?"@2x":"",pa=kx?2:1,Es,Jp;function JP(s,i,l){let m,f,a,{feature:P}=i,{style:E="default"}=i,{showPlaceType:O}=i,{missingIconsCache:B}=i,{iconsBaseUrl:W}=i,V=Lx(),he,ue,be,ze;function Xe(){Jp??(Jp=fetch(`${W}sprite${qg}.json`).then(Q=>Q.json()).then(Q=>{Es=Q}).catch(()=>{Es=null}))}function Ve(){ue&&B.add(ue),Se()}function Se(){Es!==void 0?nt():(Xe(),Jp?.then(nt))}function nt(){do{if(ze--,l(4,he=m?.[ze]),l(6,be=he?Es?.icons[he]:void 0),be)break;l(5,ue=he?W+he.replace(/ /g,"_")+".svg":void 0)}while(ze>-1&&(!ue||B.has(ue)))}function pt(Q){AP.call(this,s,Q)}let Pt=()=>Ve(),kt=()=>V("select",void 0),It=Q=>{document.activeElement!==Q.target&&V("select",void 0)};return s.$$set=Q=>{"feature"in Q&&l(0,P=Q.feature),"style"in Q&&l(1,E=Q.style),"showPlaceType"in Q&&l(2,O=Q.showPlaceType),"missingIconsCache"in Q&&l(11,B=Q.missingIconsCache),"iconsBaseUrl"in Q&&l(3,W=Q.iconsBaseUrl)},s.$$.update=()=>{var Q,re,ce,Ie,de;s.$$.dirty&1&&l(12,m=(Q=P.properties)==null?void 0:Q.categories),s.$$.dirty&1&&l(8,f=P.place_type[0]==="reverse"),s.$$.dirty&1&&l(7,a=((ce=(re=P.properties)==null?void 0:re.categories)==null?void 0:ce.join(", "))??((de=(Ie=P.properties)==null?void 0:Ie.place_type_name)==null?void 0:de[0])??P.place_type[0]),s.$$.dirty&4096&&(ze=m?.length??0,Se())},[P,E,O,W,he,ue,be,a,f,V,Ve,B,m,pt,Pt,kt,It]}var Wg=class extends ks{constructor(i){super(),Hl(this,i,JP,YP,Wl,{feature:0,style:1,showPlaceType:2,missingIconsCache:11,iconsBaseUrl:3})}};function QP(s){let i;return{c(){i=en("div"),i.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',rt(i,"class","svelte-7cmwmc")},m(l,m){Ln(l,i,m)},p:En,i:En,o:En,d(l){l&&wn(i)}}}var Hg=class extends ks{constructor(i){super(),Hl(this,i,null,QP,Wl,{})}};function eM(s){let i,l,m;return{c(){i=Xa("svg"),l=Xa("path"),rt(l,"stroke-width","4"),rt(l,"d","M 5,33.103579 C 5,17.607779 18.457,5 35,5 C 51.543,5 65,17.607779 65,33.103579 C 65,56.388679 40.4668,76.048179 36.6112,79.137779 C 36.3714,79.329879 36.2116,79.457979 36.1427,79.518879 C 35.8203,79.800879 35.4102,79.942779 35,79.942779 C 34.5899,79.942779 34.1797,79.800879 33.8575,79.518879 C 33.7886,79.457979 33.6289,79.330079 33.3893,79.138079 C 29.5346,76.049279 5,56.389379 5,33.103579 Z M 35.0001,49.386379 C 43.1917,49.386379 49.8323,42.646079 49.8323,34.331379 C 49.8323,26.016779 43.1917,19.276479 35.0001,19.276479 C 26.8085,19.276479 20.1679,26.016779 20.1679,34.331379 C 20.1679,42.646079 26.8085,49.386379 35.0001,49.386379 Z"),rt(l,"class","svelte-gzo3ar"),rt(i,"width",m=s[0]==="list"?20:void 0),rt(i,"viewBox","0 0 70 85"),rt(i,"fill","none"),rt(i,"class","svelte-gzo3ar"),Ls(i,"in-map",s[0]!=="list"),Ls(i,"list-icon",s[0]==="list")},m(f,a){Ln(f,i,a),ji(i,l)},p(f,[a]){a&1&&m!==(m=f[0]==="list"?20:void 0)&&rt(i,"width",m),a&1&&Ls(i,"in-map",f[0]!=="list"),a&1&&Ls(i,"list-icon",f[0]==="list")},i:En,o:En,d(f){f&&wn(i)}}}function tM(s,i,l){let{displayIn:m}=i;return s.$$set=f=>{"displayIn"in f&&l(0,m=f.displayIn)},[m]}var Kg=class extends ks{constructor(i){super(),Hl(this,i,tM,eM,Wl,{displayIn:0})}};function iM(s){let i,l;return{c(){i=Xa("svg"),l=Xa("path"),rt(l,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),rt(i,"viewBox","0 0 60.006 21.412"),rt(i,"width","14"),rt(i,"height","20"),rt(i,"class","svelte-en2qvf")},m(m,f){Ln(m,i,f),ji(i,l)},p:En,i:En,o:En,d(m){m&&wn(i)}}}var Xg=class extends ks{constructor(i){super(),Hl(this,i,null,iM,Wl,{})}};function nM(s){let i,l,m;return{c(){i=Xa("svg"),l=Xa("circle"),m=Xa("path"),rt(l,"cx","4.789"),rt(l,"cy","4.787"),rt(l,"r","3.85"),rt(l,"class","svelte-1aq105l"),rt(m,"d","M12.063 12.063 7.635 7.635"),rt(m,"class","svelte-1aq105l"),rt(i,"xmlns","http://www.w3.org/2000/svg"),rt(i,"width","13"),rt(i,"height","13"),rt(i,"viewBox","0 0 13 13"),rt(i,"class","svelte-1aq105l")},m(f,a){Ln(f,i,a),ji(i,l),ji(i,m)},p:En,i:En,o:En,d(f){f&&wn(i)}}}var Yg=class extends ks{constructor(i){super(),Hl(this,i,null,nM,Wl,{})}};function rM(s,i,l){let m=i[1],f=i[0],a=m-f;return s===m&&l?s:((s-f)%a+a)%a+f}function _d(s){let i=[...s];return i[2]<i[0]&&(Math.abs((i[0]+i[2]+360)/2)>Math.abs((i[0]-360+i[2])/2)?i[0]-=360:i[2]+=360),i}var ld;async function oM(s,i,l){let m=s?.getCenterAndZoom();for(let f of i??[])if(!(m&&(f.minZoom!=null&&f.minZoom>m[0]||f.maxZoom!=null&&f.maxZoom<m[0]))){if(f.type==="fixed")return f.coordinates.join(",");e:if(f.type==="client-geolocation"){if(ld&&f.cachedLocationExpiry&&ld.time+f.cachedLocationExpiry>Date.now()){if(!ld.coords)break e;return ld.coords}let a;try{return a=await new Promise((P,E)=>{l.signal.addEventListener("abort",()=>{E(Error("aborted"))}),navigator.geolocation.getCurrentPosition(O=>{P([O.coords.longitude,O.coords.latitude].map(B=>B.toFixed(6)).join(","))},O=>{E(O)},f)}),a}catch{}finally{f.cachedLocationExpiry&&(ld={time:Date.now(),coords:a})}if(l.signal.aborted)return}if(f.type==="server-geolocation")return"ip";if(m&&f.type==="map-center")return m[1].toFixed(6)+","+m[2].toFixed(6)}}var aM=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,ex=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,tx=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([•º°]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([•º°]?)[\s]*(EAST|WEST|[EW])?$/i,ix=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,nx=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,rx=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|′′|’’|´´|["″”\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|′′|´´|’’|["″”\.])?\s*(EAST|WEST|[EW])?$/i;function sM(s){if(!["DMS","DM","DD"].includes(s))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){let i=this.decimalCoordinates.split(",").map(ue=>Number(ue.trim())),l=Number(i[0]),m=Number(i[1]),f=Math.abs(l),a=Math.abs(m),P=l>0?"N":"S",E=m>0?"E":"W",O;s=="DD"&&(O=`${f}\xB0 ${P}, ${a}\xB0 ${E}`);let B=Math.floor(f),W=Math.floor(a),V=(f-B)*60,he=(a-W)*60;if(s=="DM"){let ue=ox(V,3).toFixed(3).padStart(6,"0"),be=ox(he,3).toFixed(3).padStart(6,"0");ue.endsWith(".000")&&be.endsWith(".000")&&(ue=ue.replace(/\.000$/,""),be=be.replace(/\.000$/,"")),O=`${B}\xB0 ${ue}' ${P}, ${W}\xB0 ${be}' ${E}`}if(s=="DMS"){let ue=Math.floor(V),be=Math.floor(he),ze=((V-ue)*60).toFixed(1).padStart(4,"0"),Xe=((he-be)*60).toFixed(1).padStart(4,"0"),Ve=ue.toString().padStart(2,"0"),Se=be.toString().padStart(2,"0");ze.endsWith(".0")&&Xe.endsWith(".0")&&(ze=ze.replace(/\.0$/,""),Xe=Xe.replace(/\.0$/,"")),O=`${B}\xB0 ${Ve}' ${ze}" ${P}, ${W}\xB0 ${Se}' ${Xe}" ${E}`}return O}else throw new Error("no decimal coordinates to convert")}function ox(s,i){let l=Math.pow(10,i);return Math.round((s+Number.EPSILON)*l)/l}function n_(s,i){i||(i=5),s=s.replace(/\s+/g," ").trim();let l=null,m=null,f="",a="",P=null,E=[],O=!1;if(aM.test(s))throw new Error("invalid coordinate value");if(ex.test(s))if(E=ex.exec(s),O=cd(E),O)l=Math.abs(E[1])+E[2]/60,Number(E[1])<0&&(l*=-1),m=Math.abs(E[3])+E[4]/60,Number(E[3])<0&&(m*=-1),P="DM";else throw new Error("invalid coordinate format");else if(tx.test(s))if(E=tx.exec(s),O=cd(E),O){if(l=E[2],m=E[6],l.includes(",")&&(l=l.replace(",",".")),m.includes(",")&&(m=m.replace(",",".")),P="DD",Number(Math.round(l))==Number(l))throw new Error("integer only coordinate provided");if(Number(Math.round(m))==Number(m))throw new Error("integer only coordinate provided");E[1]?(f=E[1],a=E[5]):E[4]&&(f=E[4],a=E[8])}else throw new Error("invalid decimal coordinate format");else if(ix.test(s))if(E=ix.exec(s),O=cd(E),O)l=Math.abs(parseInt(E[2])),E[4]&&(l+=E[4]/60,P="DM"),E[6]&&(l+=E[6].replace(",",".")/3600,P="DMS"),parseInt(E[2])<0&&(l=-1*l),m=Math.abs(parseInt(E[9])),E[11]&&(m+=E[11]/60),E[13]&&(m+=E[13].replace(",",".")/3600),parseInt(E[9])<0&&(m=-1*m),E[1]?(f=E[1],a=E[8]):E[7]&&(f=E[7],a=E[14]);else throw new Error("invalid DMS coordinates format");else if(nx.test(s))if(E=nx.exec(s),O=cd(E),O)l=Math.abs(parseInt(E[2])),E[4]&&(l+=E[4]/60,P="DM"),E[6]&&(l+=E[6]/3600,P="DMS"),parseInt(E[2])<0&&(l=-1*l),m=Math.abs(parseInt(E[10])),E[12]&&(m+=E[12]/60),E[14]&&(m+=E[14]/3600),parseInt(E[10])<0&&(m=-1*m),E[1]?(f=E[1],a=E[9]):E[8]&&(f=E[8],a=E[16]);else throw new Error("invalid DMS coordinates format");else if(rx.test(s)){if(E=rx.exec(s),O=cd(E),E.filter(B=>B).length<=5)throw new Error("invalid coordinates format");if(O)l=Math.abs(parseInt(E[2])),E[4]&&(l+=E[4].replace(",",".")/60,P="DM"),E[6]&&(l+=E[6].replace(",",".")/3600,P="DMS"),parseInt(E[2])<0&&(l=-1*l),m=Math.abs(parseInt(E[10])),E[12]&&(m+=E[12].replace(",",".")/60),E[14]&&(m+=E[14].replace(",",".")/3600),parseInt(E[10])<0&&(m=-1*m),E[1]?(f=E[1],a=E[9]):E[8]&&(f=E[8],a=E[16]);else throw new Error("invalid coordinates format")}if(O){if(Math.abs(m)>=180)throw new Error("invalid longitude value");if(Math.abs(l)>=90)throw new Error("invalid latitude value");if(f&&!a||!f&&a)throw new Error("invalid coordinates value");if(f&&f==a)throw new Error("invalid coordinates format");l.toString().includes(",")&&(l=l.replace(",",".")),m.toString().includes(",")&&(m=m.replace(",","."));let B=/S|SOUTH/i;B.test(f)&&l>0&&(l=-1*l),B=/W|WEST/i,B.test(a)&&m>0&&(m=-1*m);let W=E[0].trim(),V,he,ue=/[,/;\u0020]/g,be=W.match(ue);if(be==null){let Ve=Math.floor(s.length/2);V=W.substring(0,Ve).trim(),he=W.substring(Ve).trim()}else{let Ve;be.length%2==1?Ve=Math.floor(be.length/2):Ve=be.length/2-1;let Se=0;if(Ve==0)Se=W.indexOf(be[0]),V=W.substring(0,Se).trim(),he=W.substring(Se+1).trim();else{let nt=0,pt=0;for(;nt<=Ve;)Se=W.indexOf(be[nt],pt),pt=Se+1,nt++;V=W.substring(0,Se).trim(),he=W.substring(Se+1).trim()}}let ze=V.split(".");if(ze.length==2&&ze[1]==0&&ze[1].length!=2)throw new Error("invalid coordinates format");let Xe=he.split(".");if(Xe.length==2&&Xe[1]==0&&Xe[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(V)||/^\d+$/.test(he))throw new Error("degree only coordinate/s provided");return l=Number(Number(l).toFixed(i)),m=Number(Number(m).toFixed(i)),Object.freeze({verbatimCoordinates:W,verbatimLatitude:V,verbatimLongitude:he,decimalLatitude:l,decimalLongitude:m,decimalCoordinates:`${l},${m}`,originalFormat:P,closeEnough:lM,toCoordinateFormat:sM})}else throw new Error("coordinates pattern match failed")}function cd(s){if(!isNaN(s[0]))return!1;let i=[...s];if(i.shift(),i.length%2>0)return!1;let l=/^[-+]?\d+([\.,]\d+)?$/,m=/[eastsouthnorthwest]+/i,f=i.length/2;for(let a=0;a<f;a++){let P=i[a],E=i[a+f],O=l.test(P)&&l.test(E),B=m.test(P)&&m.test(E),W=P==E;if(!(P==null&&E==null)){if(P==null||E==null)return!1;if(O||B||W)continue;return!1}}return!0}function ax(s,i){let l=Math.abs(s-i);return Number(l.toFixed(6))<=1e-5}function lM(s){if(!s)throw new Error("coords must be provided");if(s.includes(",")){let i=s.split(",");if(Number(i[0])==NaN||Number(i[1])==NaN)throw new Error("coords are not valid decimals");return ax(this.decimalLatitude,Number(i[0]))&&ax(this.decimalLongitude,i[1])}else throw new Error("coords being tested must be separated by a comma")}var cM=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});n_.to=cM;var uM=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123\xB0 N 74.123\xB0 W",verbatimLatitude:"40.123\xB0 N",verbatimLongitude:"74.123\xB0 W"},{verbatimCoordinates:"40.123\xB0 N 74.123\xB0 W",verbatimLatitude:"40.123\xB0 N",verbatimLongitude:"74.123\xB0 W"},{verbatimCoordinates:'40\xB0 7\xB4 22.8" N 74\xB0 7\xB4 22.8" W',verbatimLatitude:'40\xB0 7\xB4 22.8" N',verbatimLongitude:'74\xB0 7\xB4 22.8" W'},{verbatimCoordinates:"40\xB0 7.38\u2019 , -74\xB0 7.38\u2019",verbatimLatitude:"40\xB0 7.38\u2019",verbatimLongitude:"-74\xB0 7.38\u2019"},{verbatimCoordinates:"N40\xB07\u201922.8\u2019\u2019, W74\xB07\u201922.8\u2019\u2019",verbatimLatitude:"N40\xB07\u201922.8\u2019\u2019",verbatimLongitude:"W74\xB07\u201922.8\u2019\u2019"},{verbatimCoordinates:'40\xB07\u201922.8"N, 74\xB07\u201922.8"W',verbatimLatitude:'40\xB07\u201922.8"N',verbatimLongitude:'74\xB07\u201922.8"W'},{verbatimCoordinates:`40\xB07'22.8"N, 74\xB07'22.8"W`,verbatimLatitude:`40\xB07'22.8"N`,verbatimLongitude:`74\xB07'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123\xB0,-74.123\xB0",verbatimLatitude:"40.123\xB0",verbatimLongitude:"-74.123\xB0"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40\xB07\u201922.8"N, 74\xB07\u201922.8"W',verbatimLatitude:'40\xB07\u201922.8"N',verbatimLongitude:'74\xB07\u201922.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40\xB07\u201923"N 74\xB07\u201923"W',verbatimLatitude:'40\xB07\u201923"N',verbatimLongitude:'74\xB07\u201923"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40\xB07\u201923"S 74\xB07\u201923"E',verbatimLatitude:'40\xB07\u201923"S',verbatimLongitude:'74\xB07\u201923"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40\xB07\u201923" -74\xB07\u201923"',verbatimLatitude:'40\xB07\u201923"',verbatimLongitude:'-74\xB07\u201923"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7\u2019 23" N 74d 7\u2019 23" W',verbatimLatitude:'40d 7\u2019 23" N',verbatimLongitude:'74d 7\u2019 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40\xB0 7.38, -74\xB0 7.38",verbatimLatitude:"40\xB0 7.38",verbatimLongitude:"-74\xB0 7.38"},{verbatimCoordinates:"40\xB0 7.38, -74\xB0 7.38",verbatimLatitude:"40\xB0 7.38",verbatimLongitude:"-74\xB0 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],hM={decimalLatitude:40.123,decimalLongitude:-74.123},dM=[{verbatimCoordinates:`50\xB04'17.698"south, 14\xB024'2.826"east`,verbatimLatitude:`50\xB04'17.698"south`,verbatimLongitude:`14\xB024'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"40\xB026\u203247\u2033N 79\xB058\u203236\u2033W",verbatimLatitude:"40\xB026\u203247\u2033N",verbatimLongitude:"79\xB058\u203236\u2033W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26\u2032 47\u2033 N 79d 58\u2032 36\u2033 W",verbatimLatitude:"40d 26\u2032 47\u2033 N",verbatimLongitude:"79d 58\u2032 36\u2033 W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195\xB0 79,948862\xB0",verbatimLatitude:"40,446195\xB0",verbatimLongitude:"79,948862\xB0",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40\xB0 26.7717, -79\xB0 56.93172",verbatimLatitude:"40\xB0 26.7717",verbatimLongitude:"-79\xB0 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"18\xB024S 22\xB045E",verbatimLatitude:"18\xB024S",verbatimLongitude:"22\xB045E",decimalLatitude:-18.4,decimalLongitude:22.75}],pM=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245\xB0 S / 28.2344\xB0 E",verbatimLatitude:"-23.3245\xB0 S",verbatimLongitude:"28.2344\xB0 E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40\xB0 26.7717 -79\xB0 56.93172",verbatimLatitude:"40\xB0 26.7717",verbatimLongitude:"-79\xB0 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563 \xB0  E22.45634 \xB0",verbatimLatitude:"S23.43563 \xB0",verbatimLongitude:"E22.45634 \xB0",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372\xB0 S 23,07771\xB0 E",verbatimLatitude:"27,71372\xB0 S",verbatimLongitude:"23,07771\xB0 E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48\xB0 30,6410', E 18\xB0 57,4583'",verbatimLatitude:"N 48\xB0 30,6410'",verbatimLongitude:"E 18\xB0 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function fM(){let s=[];return uM.forEach(i=>{i.decimalLatitude?s.push(i):s.push(ai(ai({},i),hM))}),[...s,...dM,...pM]}var mM=fM();n_.formats=mM.map(s=>s.verbatimCoordinates);var gM=n_;function sx(s,i,l){let m=s.slice();return m[97]=i[l],m[99]=l,m}function lx(s){let i,l;return i=new Hg({}),{c(){ql(i.$$.fragment)},m(m,f){ul(i,m,f),l=!0},i(m){l||(sr(i.$$.fragment,m),l=!0)},o(m){zr(i.$$.fragment,m),l=!1},d(m){hl(i,m)}}}function cx(s){let i,l,m,f,a;return l=new Xg({}),{c(){i=en("button"),ql(l.$$.fragment),rt(i,"type","button"),rt(i,"title",s[10]),rt(i,"class","svelte-bz0zu3"),Ls(i,"active",s[0])},m(P,E){Ln(P,i,E),ul(l,i,null),m=!0,f||(a=Sr(i,"click",s[79]),f=!0)},p(P,E){(!m||E[0]&1024)&&rt(i,"title",P[10]),(!m||E[0]&1)&&Ls(i,"active",P[0])},i(P){m||(sr(l.$$.fragment,P),m=!0)},o(P){zr(l.$$.fragment,P),m=!1},d(P){P&&wn(i),hl(l),f=!1,a()}}}function _M(s){let i,l=[],m=new Map,f,a,P,E=J1(s[13]),O=B=>B[97].id+(B[97].address?","+B[97].address:"");for(let B=0;B<E.length;B+=1){let W=sx(s,E,B),V=O(W);m.set(V,l[B]=ux(V,W))}return{c(){i=en("ul");for(let B=0;B<l.length;B+=1)l[B].c();rt(i,"class","options svelte-bz0zu3"),rt(i,"role","listbox")},m(B,W){Ln(B,i,W);for(let V=0;V<l.length;V+=1)l[V]&&l[V].m(i,null);f=!0,a||(P=[Sr(i,"mouseleave",s[27]),Sr(i,"blur",s[83]),Sr(i,"keydown",s[23])],a=!0)},p(B,W){W[0]&102823936&&(E=J1(B[13]),nf(),l=OP(l,W,O,1,B,E,m,i,BP,ux,null,sx),rf())},i(B){if(!f){for(let W=0;W<E.length;W+=1)sr(l[W]);f=!0}},o(B){for(let W=0;W<l.length;W+=1)zr(l[W]);f=!1},d(B){B&&wn(i);for(let W=0;W<l.length;W+=1)l[W].d();a=!1,pl(P)}}}function yM(s){let i,l,m,f,a,P;return l=new cf({}),{c(){i=en("div"),ql(l.$$.fragment),m=Yo(),f=en("div"),a=Gl(s[8]),rt(f,"class","svelte-bz0zu3"),rt(i,"class","no-results svelte-bz0zu3")},m(E,O){Ln(E,i,O),ul(l,i,null),ji(i,m),ji(i,f),ji(f,a),P=!0},p(E,O){(!P||O[0]&256)&&md(a,E[8])},i(E){P||(sr(l.$$.fragment,E),P=!0)},o(E){zr(l.$$.fragment,E),P=!1},d(E){E&&wn(i),hl(l)}}}function vM(s){let i="",l;return{c(){l=Gl(i)},m(m,f){Ln(m,l,f)},p:En,i:En,o:En,d(m){m&&wn(l)}}}function xM(s){let i,l,m,f,a,P,E,O,B,W,V;return l=new cf({}),O=new lf({}),{c(){i=en("div"),ql(l.$$.fragment),m=Yo(),f=en("div"),a=Gl(s[7]),P=Yo(),E=en("button"),ql(O.$$.fragment),rt(f,"class","svelte-bz0zu3"),rt(E,"class","svelte-bz0zu3"),rt(i,"class","error svelte-bz0zu3")},m(he,ue){Ln(he,i,ue),ul(l,i,null),ji(i,m),ji(i,f),ji(f,a),ji(i,P),ji(i,E),ul(O,E,null),B=!0,W||(V=Sr(E,"click",s[80]),W=!0)},p(he,ue){(!B||ue[0]&128)&&md(a,he[7])},i(he){B||(sr(l.$$.fragment,he),sr(O.$$.fragment,he),B=!0)},o(he){zr(l.$$.fragment,he),zr(O.$$.fragment,he),B=!1},d(he){he&&wn(i),hl(l),hl(O),W=!1,V()}}}function ux(s,i){var l;let m,f,a;function P(){return i[81](i[99])}function E(){return i[82](i[97])}return f=new Wg({props:{feature:i[97],showPlaceType:i[11],style:i[15]===i[99]?"selected":((l=i[14])==null?void 0:l.id)===i[97].id?"picked":"default",missingIconsCache:i[21],iconsBaseUrl:i[12]}}),f.$on("mouseenter",P),f.$on("select",E),{key:s,first:null,c(){m=MP(),ql(f.$$.fragment),this.first=m},m(O,B){Ln(O,m,B),ul(f,O,B),a=!0},p(O,B){var W;i=O;let V={};B[0]&8192&&(V.feature=i[97]),B[0]&2048&&(V.showPlaceType=i[11]),B[0]&57344&&(V.style=i[15]===i[99]?"selected":((W=i[14])==null?void 0:W.id)===i[97].id?"picked":"default"),B[0]&4096&&(V.iconsBaseUrl=i[12]),f.$set(V)},i(O){a||(sr(f.$$.fragment,O),a=!0)},o(O){zr(f.$$.fragment,O),a=!1},d(O){O&&wn(m),hl(f,O)}}}function bM(s){let i,l,m,f,a,P,E,O,B,W,V,he,ue,be,ze,Xe,Ve,Se,nt,pt,Pt,kt=!1;a=new Yg({}),V=new lf({});let It=s[20]&&lx(),Q=s[6]==="button"&&cx(s),re=s[70].default,ce=wP(re,s,s[69],null),Ie=[xM,vM,yM,_M],de=[];function Oe(Ae,Ce){var ge,Fe;return Ae[19]?0:!Ae[16]&&!Ae[4]?1:((ge=Ae[13])==null?void 0:ge.length)===0?2:(Fe=Ae[13])!=null&&Fe.length&&(Ae[16]||Ae[4])?3:-1}return~(Xe=Oe(s))&&(Ve=de[Xe]=Ie[Xe](s)),{c(){i=Yo(),l=en("form"),m=en("div"),f=en("button"),ql(a.$$.fragment),P=Yo(),E=en("input"),O=Yo(),B=en("div"),W=en("button"),ql(V.$$.fragment),he=Yo(),It&&It.c(),ue=Yo(),Q&&Q.c(),be=Yo(),ce&&ce.c(),ze=Yo(),Ve&&Ve.c(),rt(f,"class","search-button svelte-bz0zu3"),rt(f,"type","button"),rt(E,"placeholder",s[9]),rt(E,"aria-label",s[9]),rt(E,"class","svelte-bz0zu3"),rt(W,"type","button"),rt(W,"title",s[3]),rt(W,"class","svelte-bz0zu3"),rt(B,"class","clear-button-container svelte-bz0zu3"),Ls(B,"displayable",s[1]!==""),rt(m,"class","input-group svelte-bz0zu3"),rt(l,"class",Se=sf(s[2])+" svelte-bz0zu3"),Ls(l,"can-collapse",s[5]&&s[1]==="")},m(Ae,Ce){Ln(Ae,i,Ce),Ln(Ae,l,Ce),ji(l,m),ji(m,f),ul(a,f,null),ji(m,P),ji(m,E),s[72](E),X1(E,s[1]),ji(m,O),ji(m,B),ji(B,W),ul(V,W,null),ji(B,he),It&&It.m(B,null),ji(m,ue),Q&&Q.m(m,null),ji(m,be),ce&&ce.m(m,null),ji(l,ze),~Xe&&de[Xe].m(l,null),nt=!0,pt||(Pt=[Sr(f,"click",s[71]),Sr(E,"input",s[73]),Sr(E,"focus",s[74]),Sr(E,"blur",s[75]),Sr(E,"click",s[76]),Sr(E,"keydown",s[23]),Sr(E,"input",s[24]),Sr(E,"change",s[77]),Sr(W,"click",s[78]),Sr(l,"submit",CP(s[22]))],pt=!0)},p(Ae,Ce){(!nt||Ce[0]&512)&&rt(E,"placeholder",Ae[9]),(!nt||Ce[0]&512)&&rt(E,"aria-label",Ae[9]),Ce[0]&2&&E.value!==Ae[1]&&X1(E,Ae[1]),(!nt||Ce[0]&8)&&rt(W,"title",Ae[3]),Ae[20]?It?Ce[0]&1048576&&sr(It,1):(It=lx(),It.c(),sr(It,1),It.m(B,null)):It&&(nf(),zr(It,1,1,()=>{It=null}),rf()),(!nt||Ce[0]&2)&&Ls(B,"displayable",Ae[1]!==""),Ae[6]==="button"?Q?(Q.p(Ae,Ce),Ce[0]&64&&sr(Q,1)):(Q=cx(Ae),Q.c(),sr(Q,1),Q.m(m,be)):Q&&(nf(),zr(Q,1,1,()=>{Q=null}),rf()),ce&&ce.p&&(!nt||Ce[2]&128)&&SP(ce,re,Ae,Ae[69],nt?TP(re,Ae[69],Ce,null):PP(Ae[69]),null);let ge=Xe;Xe=Oe(Ae),Xe===ge?~Xe&&de[Xe].p(Ae,Ce):(Ve&&(nf(),zr(de[ge],1,1,()=>{de[ge]=null}),rf()),~Xe?(Ve=de[Xe],Ve?Ve.p(Ae,Ce):(Ve=de[Xe]=Ie[Xe](Ae),Ve.c()),sr(Ve,1),Ve.m(l,null)):Ve=null),(!nt||Ce[0]&4&&Se!==(Se=sf(Ae[2])+" svelte-bz0zu3"))&&rt(l,"class",Se),(!nt||Ce[0]&38)&&Ls(l,"can-collapse",Ae[5]&&Ae[1]==="")},i(Ae){nt||(sr(kt),sr(a.$$.fragment,Ae),sr(V.$$.fragment,Ae),sr(It),sr(Q),sr(ce,Ae),sr(Ve),nt=!0)},o(Ae){zr(kt),zr(a.$$.fragment,Ae),zr(V.$$.fragment,Ae),zr(It),zr(Q),zr(ce,Ae),zr(Ve),nt=!1},d(Ae){Ae&&(wn(i),wn(l)),hl(a),s[72](null),hl(V),It&&It.d(),Q&&Q.d(),ce&&ce.d(Ae),~Xe&&de[Xe].d(),pt=!1,pl(Pt)}}}function wM(s,i,l){let m,f,a,{$$slots:P={},$$scope:E}=i,O={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13},{class:B=void 0}=i,{apiKey:W}=i,{bbox:V=void 0}=i,{clearButtonTitle:he="clear"}=i,{clearOnBlur:ue=!1}=i,{clearListOnPick:be=!1}=i,{keepListOpen:ze=!1}=i,{collapsed:Xe=!1}=i,{country:Ve=void 0}=i,{debounceSearch:Se=200}=i,{enableReverse:nt="never"}=i,{errorMessage:pt="Something went wrong\u2026"}=i,{filter:Pt=()=>!0}=i,{flyTo:kt=!0}=i,{fuzzyMatch:It=!0}=i,{language:Q=void 0}=i,{limit:re=void 0}=i,ce=41415112612,{reverseGeocodingLimit:Ie=ce}=i,{mapController:de=void 0}=i,{minLength:Oe=2}=i,{noResultsMessage:Ae="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=i,{placeholder:Ce="Search"}=i,{proximity:ge=[{type:"server-geolocation"}]}=i,{reverseActive:Fe=nt==="always"}=i,{reverseButtonTitle:Ee="toggle reverse geocoding"}=i,{searchValue:qe=""}=i,{pickedResultStyle:xt="full-geometry"}=i,{showPlaceType:Tt="if-needed"}=i,{showResultsWhileTyping:Et=!0}=i,{selectFirst:St=!0}=i,{flyToSelected:zt=!1}=i,{markerOnSelected:Ft=!0}=i,{types:Qt=void 0}=i,Vi=[],{reverseGeocodingTypes:Jn=Vi}=i,{exhaustiveReverseGeocoding:hn=!1}=i,{excludeTypes:Yi=!1}=i,Ri=void 0,{reverseGeocodingExcludeTypes:_i=Ri}=i,{zoom:Ui=O}=i,{apiUrl:Zi="https://api.maptiler.com/geocoding"}=i,{fetchParameters:ui={}}=i,{iconsBaseUrl:to="https://cdn.maptiler.com/maptiler-geocoding-control/v2.1.6/icons/"}=i,{adjustUrlQuery:Io=()=>{}}=i,{adjustUrl:jn=()=>{}}=i;function Pr(We){Tn.focus(We)}function mo(){Tn.blur()}function io(We,Pi=!0,tn=!1){l(1,qe=We),Pi?(l(15,Ti=-1),ie()):(yt(void 0,!tn,tn),setTimeout(()=>{Tn.focus(),Tn.select()}))}function no(){l(13,ni=void 0),l(14,Ot=void 0),l(15,Ti=-1)}function Jo(){l(64,Gi=[]),l(14,Ot=void 0)}let ni,Gi,Ot,qr="",Tn,Ti=-1,dn,An=[],Rn,Re,X,Y,te=!1,me=new Set,Te=Lx();LP(()=>{de&&(de.setEventHandler(void 0),de.indicateReverse(!1),de.setSelectedMarker(-1),de.setFeatures(void 0,void 0,!1))});function ie(We){if(l(17,te=!1),Re&&(clearTimeout(Re),Re=void 0),Ti>-1&&ni)l(14,Ot=ni[Ti]),l(1,qe=Ot.place_type[0]==="reverse"?Ot.place_name:Ot.place_name.replace(/,.*/,"")),l(19,dn=void 0),l(64,Gi=void 0),l(15,Ti=-1);else if(qe){let Pi=We||!Ne(qe);ke(qe,{exact:!0}).then(()=>{l(64,Gi=ni),l(14,Ot=void 0),Pi&&Be()}).catch(tn=>l(19,dn=tn))}}function Ne(We){try{return gM(We,6)}catch{return!1}}async function ke(We,{byId:Pi=!1,exact:tn=!1}={}){var nn,rn,zi;l(19,dn=void 0),Rn?.abort();let on=new AbortController;l(20,Rn=on);try{let qt=Ne(We),ro=new URL(Zi+"/"+encodeURIComponent(qt?qt.decimalLongitude+","+qt.decimalLatitude:We)+".json"),Dn=ro.searchParams;Q!==void 0&&Dn.set("language",Array.isArray(Q)?Q.join(","):Q??"");let[Eo]=de?.getCenterAndZoom()??[],kn=(nn=!qt||Jn===Vi?Qt:Jn)==null?void 0:nn.map(mn=>typeof mn=="string"?mn:Eo===void 0||(mn[0]??0)<=Eo&&Eo<(mn[1]??1/0)?mn[2]:void 0).filter(mn=>mn!==void 0);kn&&(kn=[...new Set(kn)],Dn.set("types",kn.join(",")));let Dr=!qt||_i===Ri?Yi:_i;if(Dr&&Dn.set("excludeTypes",String(Dr)),V&&Dn.set("bbox",V.map(mn=>mn.toFixed(6)).join(",")),Ve&&Dn.set("country",Array.isArray(Ve)?Ve.join(","):Ve),!Pi&&!qt){let mn=await oM(de,ge,on);mn&&Dn.set("proximity",mn),(tn||!Et)&&Dn.set("autocomplete","false"),Dn.set("fuzzyMatch",String(It))}let Lo=Ie===ce?re:Ie;Lo!==void 0&&Lo>1&&kn?.length!==1&&console.warn("For reverse geocoding when limit > 1 then types must contain single value."),qt?(Lo===1||Lo!==void 0&&(hn||kn?.length===1))&&Dn.set("limit",String(Lo)):re!==void 0&&Dn.set("limit",String(re)),W&&Dn.set("key",W),Io(Dn),jn(ro);let Ao=ro.searchParams.get("types")===""&&ro.searchParams.get("excludeTypes")!=="true",yi=ro.toString();if(yi===qr){Pi?(be&&l(13,ni=void 0),l(14,Ot=An[0])):(l(13,ni=An),((rn=ni[Ti])==null?void 0:rn.id)!==f?.id&&l(15,Ti=-1));return}qr=yi;let Ai;if(Ao)Ai={type:"FeatureCollection",features:[]};else{let mn=await fetch(yi,ai({signal:on.signal},ui));if(!mn.ok)throw new Error(await mn.text());Ai=await mn.json()}Te("response",{url:yi,featureCollection:Ai}),Pi?(be&&l(13,ni=void 0),l(14,Ot=Ai.features[0]),An=[Ot]):(l(13,ni=Ai.features.filter(Pt)),qt&&ni.unshift({type:"Feature",properties:{},id:"reverse_"+qt.decimalLongitude+"_"+qt.decimalLatitude,text:qt.decimalLatitude+", "+qt.decimalLongitude,place_name:qt.decimalLatitude+", "+qt.decimalLongitude,place_type:["reverse"],center:[qt.decimalLongitude,qt.decimalLatitude],bbox:[qt.decimalLongitude,qt.decimalLatitude,qt.decimalLongitude,qt.decimalLatitude],geometry:{type:"Point",coordinates:[qt.decimalLongitude,qt.decimalLatitude]}}),An=ni,((zi=ni[Ti])==null?void 0:zi.id)!==f?.id&&l(15,Ti=-1),qt&&Tn.focus())}catch(qt){if(qt&&typeof qt=="object"&&"name"in qt&&qt.name==="AbortError")return;throw qt}finally{on===Rn&&l(20,Rn=void 0)}}function Be(){var We;if(!(Gi!=null&&Gi.length)||!kt)return;let Pi=[180,90,-180,-90],tn=!Gi.some(rn=>!rn.matching_text),nn;for(let rn of Gi){let zi=De(rn);if(nn=nn===void 0?zi:zi===void 0?nn:Math.max(nn,zi),tn||!rn.matching_text)for(let on of[0,1,2,3])Pi[on]=Math[on<2?"min":"max"](Pi[on],((We=rn.bbox)==null?void 0:We[on])??rn.center[on%2])}de&&Gi.length>0&&(Ot&&Pi[0]===Pi[2]&&Pi[1]===Pi[3]?de.flyTo(Ot.center,De(Ot)):de.fitBounds(_d(Pi),50,nn))}function Ze(){!Ot||!de||(!Ot.bbox||Ot.bbox[0]===Ot.bbox[2]&&Ot.bbox[1]===Ot.bbox[3]?de.flyTo(Ot.center,De(Ot)):de.fitBounds(_d(Ot.bbox),50,De(Ot)))}function De(We){var Pi;if(!We.bbox||We.bbox[0]!==We.bbox[2]&&We.bbox[1]!==We.bbox[3])return;let tn=We.id.replace(/\..*/,"");return(Array.isArray((Pi=We.properties)==null?void 0:Pi.categories)?We.properties.categories.reduce((nn,rn)=>{let zi=Ui[tn+"."+rn];return nn===void 0?zi:zi===void 0?nn:Math.max(nn,zi)},void 0):void 0)??Ui[tn]}function at(We){l(0,Fe=nt==="always"),l(13,ni=void 0),l(14,Ot=void 0),l(15,Ti=-1),io(We[1].toFixed(6)+", "+rM(We[0],[-180,180],!0).toFixed(6),!1,!0)}function mt(We){if(!ni)return;let Pi=We.key==="ArrowDown"?1:We.key==="ArrowUp"?-1:0;Pi&&(Tn.focus(),l(17,te=!0),We.preventDefault(),Ot&&Ti===-1&&l(15,Ti=ni.findIndex(tn=>tn.id===Ot?.id)),Ti===(Ot||St?0:-1)&&Pi===-1&&l(15,Ti=ni.length),l(15,Ti+=Pi),Ti>=ni.length&&l(15,Ti=-1),Ti<0&&(Ot||St)&&l(15,Ti=0))}function yt(We,Pi=!0,tn=!1){if(l(19,dn=void 0),l(14,Ot=void 0),l(17,te=!0),Et||tn){if(Re&&clearTimeout(Re),qe.length<Oe)return;let nn=qe;Re=window.setTimeout(()=>{ke(nn).catch(rn=>l(19,dn=rn))},Pi?Se:0)}else l(13,ni=void 0),l(19,dn=void 0)}function Dt(We){Ot&&Ot?.id===We?.id?Ze():(l(14,Ot=We),l(1,qe=We.place_name))}function Yt(We){l(15,Ti=We)}function Gt(){(!St||Ot)&&l(15,Ti=-1),zt&&Ze()}let Ye=()=>Tn.focus();function ri(We){Zg[We?"unshift":"push"](()=>{Tn=We,l(18,Tn)})}function ft(){qe=this.value,l(1,qe),l(17,te),l(31,ue),l(16,X)}let Si=()=>l(17,te=!0),Zt=()=>l(17,te=!1),ot=()=>l(17,te=!0),Nt=()=>l(14,Ot=void 0),Kt=()=>{l(1,qe=""),l(14,Ot=void 0),Tn.focus()},Hi=()=>l(0,Fe=!Fe),$i=()=>l(19,dn=void 0),Qn=We=>Yt(We),ei=We=>Dt(We),Qo=()=>{};return s.$$set=We=>{"class"in We&&l(2,B=We.class),"apiKey"in We&&l(29,W=We.apiKey),"bbox"in We&&l(30,V=We.bbox),"clearButtonTitle"in We&&l(3,he=We.clearButtonTitle),"clearOnBlur"in We&&l(31,ue=We.clearOnBlur),"clearListOnPick"in We&&l(32,be=We.clearListOnPick),"keepListOpen"in We&&l(4,ze=We.keepListOpen),"collapsed"in We&&l(5,Xe=We.collapsed),"country"in We&&l(33,Ve=We.country),"debounceSearch"in We&&l(34,Se=We.debounceSearch),"enableReverse"in We&&l(6,nt=We.enableReverse),"errorMessage"in We&&l(7,pt=We.errorMessage),"filter"in We&&l(35,Pt=We.filter),"flyTo"in We&&l(36,kt=We.flyTo),"fuzzyMatch"in We&&l(37,It=We.fuzzyMatch),"language"in We&&l(38,Q=We.language),"limit"in We&&l(39,re=We.limit),"reverseGeocodingLimit"in We&&l(40,Ie=We.reverseGeocodingLimit),"mapController"in We&&l(41,de=We.mapController),"minLength"in We&&l(42,Oe=We.minLength),"noResultsMessage"in We&&l(8,Ae=We.noResultsMessage),"placeholder"in We&&l(9,Ce=We.placeholder),"proximity"in We&&l(43,ge=We.proximity),"reverseActive"in We&&l(0,Fe=We.reverseActive),"reverseButtonTitle"in We&&l(10,Ee=We.reverseButtonTitle),"searchValue"in We&&l(1,qe=We.searchValue),"pickedResultStyle"in We&&l(44,xt=We.pickedResultStyle),"showPlaceType"in We&&l(11,Tt=We.showPlaceType),"showResultsWhileTyping"in We&&l(45,Et=We.showResultsWhileTyping),"selectFirst"in We&&l(46,St=We.selectFirst),"flyToSelected"in We&&l(47,zt=We.flyToSelected),"markerOnSelected"in We&&l(48,Ft=We.markerOnSelected),"types"in We&&l(49,Qt=We.types),"reverseGeocodingTypes"in We&&l(50,Jn=We.reverseGeocodingTypes),"exhaustiveReverseGeocoding"in We&&l(51,hn=We.exhaustiveReverseGeocoding),"excludeTypes"in We&&l(52,Yi=We.excludeTypes),"reverseGeocodingExcludeTypes"in We&&l(53,_i=We.reverseGeocodingExcludeTypes),"zoom"in We&&l(54,Ui=We.zoom),"apiUrl"in We&&l(55,Zi=We.apiUrl),"fetchParameters"in We&&l(56,ui=We.fetchParameters),"iconsBaseUrl"in We&&l(12,to=We.iconsBaseUrl),"adjustUrlQuery"in We&&l(57,Io=We.adjustUrlQuery),"adjustUrl"in We&&l(58,jn=We.adjustUrl),"$$scope"in We&&l(69,E=We.$$scope)},s.$$.update=()=>{if(s.$$.dirty[0]&64&&l(0,Fe=nt==="always"),s.$$.dirty[0]&16384|s.$$.dirty[1]&8192&&xt!=="marker-only"&&Ot&&!Ot.address&&Ot.geometry.type==="Point"&&Ot.place_type[0]!=="reverse"&&ke(Ot.id,{byId:!0}).catch(We=>l(19,dn=We)),s.$$.dirty[0]&16384|s.$$.dirty[1]&1058|s.$$.dirty[2]&8&&(de&&Ot&&Ot.id!==Y&&kt&&(Ze(),be&&l(13,ni=void 0),l(64,Gi=void 0),l(15,Ti=-1)),l(65,Y=Ot?.id)),s.$$.dirty[0]&196608|s.$$.dirty[1]&1&&setTimeout(()=>{l(16,X=te),ue&&!X&&l(1,qe="")}),s.$$.dirty[0]&8194|s.$$.dirty[1]&2048&&qe.length<Oe&&(l(13,ni=void 0),l(19,dn=void 0),l(64,Gi=ni)),s.$$.dirty[0]&57344|s.$$.dirty[1]&32768&&St&&ni!=null&&ni.length&&Ti==-1&&!Ot&&l(15,Ti=0),s.$$.dirty[0]&8192|s.$$.dirty[2]&4&&Gi!==ni&&l(64,Gi=void 0),s.$$.dirty[0]&73729|s.$$.dirty[1]&1024|s.$$.dirty[2]&4&&de&&de.setEventHandler(We=>{switch(We.type){case"mapClick":Fe&&at(We.coordinates);break;case"markerClick":{let Pi=ni?.find(tn=>tn.id===We.id);Pi&&Dt(Pi)}break;case"markerMouseEnter":Gi&&l(15,Ti=X?ni?.findIndex(Pi=>Pi.id===We.id)??-1:-1);break;case"markerMouseLeave":Gi&&l(15,Ti=-1);break}}),s.$$.dirty[0]&40960&&l(66,f=ni?.[Ti]),s.$$.dirty[1]&66592|s.$$.dirty[2]&16&&de&&f&&kt&&zt&&de.flyTo(f.center,De(f)),s.$$.dirty[1]&8192&&l(68,m=xt==="full-geometry-including-polygon-center-marker"),s.$$.dirty[1]&132096|s.$$.dirty[2]&64&&(Ft||de==null||de.setFeatures(void 0,void 0,m)),s.$$.dirty[0]&16384|s.$$.dirty[1]&132096|s.$$.dirty[2]&84&&de&&Ft&&!Gi&&(de.setFeatures(f?[f]:void 0,Ot,m),de.setSelectedMarker(f?0:-1)),s.$$.dirty[0]&16384|s.$$.dirty[1]&1024|s.$$.dirty[2]&68&&de&&de.setFeatures(Gi,Ot,m),s.$$.dirty[0]&32768|s.$$.dirty[1]&1024|s.$$.dirty[2]&4&&Gi&&de&&de.setSelectedMarker(Ti),s.$$.dirty[0]&2|s.$$.dirty[1]&1024&&de){let We=Ne(qe);de.setReverseMarker(We?[We.decimalLongitude,We.decimalLatitude]:void 0)}s.$$.dirty[2]&16&&Te("select",{feature:f}),s.$$.dirty[0]&16384&&Te("pick",{feature:Ot}),s.$$.dirty[0]&73744&&l(67,a=!!(ni!=null&&ni.length)&&(X||ze)),s.$$.dirty[2]&32&&Te("optionsvisibilitychange",{optionsVisible:a}),s.$$.dirty[0]&8192&&Te("featureslisted",{features:ni}),s.$$.dirty[2]&4&&Te("featuresmarked",{features:Gi}),s.$$.dirty[0]&1&&Te("reversetoggle",{reverse:Fe}),s.$$.dirty[0]&2&&Te("querychange",{query:qe}),s.$$.dirty[0]&1|s.$$.dirty[1]&1024&&de&&de.indicateReverse(Fe)},[Fe,qe,B,he,ze,Xe,nt,pt,Ae,Ce,Ee,Tt,to,ni,Ot,Ti,X,te,Tn,dn,Rn,me,ie,mt,yt,Dt,Yt,Gt,O,W,V,ue,be,Ve,Se,Pt,kt,It,Q,re,Ie,de,Oe,ge,xt,Et,St,zt,Ft,Qt,Jn,hn,Yi,_i,Ui,Zi,ui,Io,jn,Pr,mo,io,no,Jo,Gi,Y,f,a,m,E,P,Ye,ri,ft,Si,Zt,ot,Nt,Kt,Hi,$i,Qn,ei,Qo]}var TM=class extends ks{constructor(s){super(),Hl(this,s,wM,bM,Wl,{ZOOM_DEFAULTS:28,class:2,apiKey:29,bbox:30,clearButtonTitle:3,clearOnBlur:31,clearListOnPick:32,keepListOpen:4,collapsed:5,country:33,debounceSearch:34,enableReverse:6,errorMessage:7,filter:35,flyTo:36,fuzzyMatch:37,language:38,limit:39,reverseGeocodingLimit:40,mapController:41,minLength:42,noResultsMessage:8,placeholder:9,proximity:43,reverseActive:0,reverseButtonTitle:10,searchValue:1,pickedResultStyle:44,showPlaceType:11,showResultsWhileTyping:45,selectFirst:46,flyToSelected:47,markerOnSelected:48,types:49,reverseGeocodingTypes:50,exhaustiveReverseGeocoding:51,excludeTypes:52,reverseGeocodingExcludeTypes:53,zoom:54,apiUrl:55,fetchParameters:56,iconsBaseUrl:12,adjustUrlQuery:57,adjustUrl:58,focus:59,blur:60,setQuery:61,clearList:62,clearMap:63},null,[-1,-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[28]}get focus(){return this.$$.ctx[59]}get blur(){return this.$$.ctx[60]}get setQuery(){return this.$$.ctx[61]}get clearList(){return this.$$.ctx[62]}get clearMap(){return this.$$.ctx[63]}};function yd(s,i,l={}){let m={type:"Feature"};return(l.id===0||l.id)&&(m.id=l.id),l.bbox&&(m.bbox=l.bbox),m.properties=i||{},m.geometry=s,m}function r_(s,i,l={}){for(let m of s){if(m.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(m[m.length-1].length!==m[0].length)throw new Error("First and last Position are not equivalent.");for(let f=0;f<m[m.length-1].length;f++)if(m[m.length-1][f]!==m[0][f])throw new Error("First and last Position are not equivalent.")}return yd({type:"Polygon",coordinates:s},i,l)}function vd(s,i={}){let l={type:"FeatureCollection"};return i.id&&(l.id=i.id),i.bbox&&(l.bbox=i.bbox),l.features=s,l}function zx(s,i,l={}){return yd({type:"MultiPolygon",coordinates:s},i,l)}function Rx(s,i,l){if(s!==null)for(var m,f,a,P,E,O,B,W=0,V=0,he,ue=s.type,be=ue==="FeatureCollection",ze=ue==="Feature",Xe=be?s.features.length:1,Ve=0;Ve<Xe;Ve++){B=be?s.features[Ve].geometry:ze?s.geometry:s,he=B?B.type==="GeometryCollection":!1,E=he?B.geometries.length:1;for(var Se=0;Se<E;Se++){var nt=0,pt=0;if(P=he?B.geometries[Se]:B,P!==null){O=P.coordinates;var Pt=P.type;switch(W=0,Pt){case null:break;case"Point":if(i(O,V,Ve,nt,pt)===!1)return!1;V++,nt++;break;case"LineString":case"MultiPoint":for(m=0;m<O.length;m++){if(i(O[m],V,Ve,nt,pt)===!1)return!1;V++,Pt==="MultiPoint"&&nt++}Pt==="LineString"&&nt++;break;case"Polygon":case"MultiLineString":for(m=0;m<O.length;m++){for(f=0;f<O[m].length-W;f++){if(i(O[m][f],V,Ve,nt,pt)===!1)return!1;V++}Pt==="MultiLineString"&&nt++,Pt==="Polygon"&&pt++}Pt==="Polygon"&&nt++;break;case"MultiPolygon":for(m=0;m<O.length;m++){for(pt=0,f=0;f<O[m].length;f++){for(a=0;a<O[m][f].length-W;a++){if(i(O[m][f][a],V,Ve,nt,pt)===!1)return!1;V++}pt++}nt++}break;case"GeometryCollection":for(m=0;m<P.geometries.length;m++)if(Rx(P.geometries[m],i)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function o_(s,i){var l,m,f,a,P,E,O,B,W,V,he=0,ue=s.type==="FeatureCollection",be=s.type==="Feature",ze=ue?s.features.length:1;for(l=0;l<ze;l++){for(E=ue?s.features[l].geometry:be?s.geometry:s,B=ue?s.features[l].properties:be?s.properties:{},W=ue?s.features[l].bbox:be?s.bbox:void 0,V=ue?s.features[l].id:be?s.id:void 0,O=E?E.type==="GeometryCollection":!1,P=O?E.geometries.length:1,f=0;f<P;f++){if(a=O?E.geometries[f]:E,a===null){if(i(null,he,B,W,V)===!1)return!1;continue}switch(a.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(i(a,he,B,W,V)===!1)return!1;break}case"GeometryCollection":{for(m=0;m<a.geometries.length;m++)if(i(a.geometries[m],he,B,W,V)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}he++}}function SM(s,i){o_(s,function(l,m,f,a,P){var E=l===null?null:l.type;switch(E){case null:case"Point":case"LineString":case"Polygon":return i(yd(l,f,{bbox:a,id:P}),m,0)===!1?!1:void 0}var O;switch(E){case"MultiPoint":O="Point";break;case"MultiLineString":O="LineString";break;case"MultiPolygon":O="Polygon";break}for(var B=0;B<l.coordinates.length;B++){var W=l.coordinates[B],V={type:O,coordinates:W};if(i(yd(V,f),m,B)===!1)return!1}})}function PM(s,i={}){if(s.bbox!=null&&i.recompute!==!0)return s.bbox;let l=[1/0,1/0,-1/0,-1/0];return Rx(s,m=>{l[0]>m[0]&&(l[0]=m[0]),l[1]>m[1]&&(l[1]=m[1]),l[2]<m[0]&&(l[2]=m[0]),l[3]<m[1]&&(l[3]=m[1])}),l}var Jg=PM;function MM(s){if(!s)throw new Error("geojson is required");switch(s.type){case"Feature":return Dx(s);case"FeatureCollection":return CM(s);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return a_(s);default:throw new Error("unknown GeoJSON type")}}function Dx(s){let i={type:"Feature"};return Object.keys(s).forEach(l=>{switch(l){case"type":case"properties":case"geometry":return;default:i[l]=s[l]}}),i.properties=Bx(s.properties),s.geometry==null?i.geometry=null:i.geometry=a_(s.geometry),i}function Bx(s){let i={};return s&&Object.keys(s).forEach(l=>{let m=s[l];typeof m=="object"?m===null?i[l]=null:Array.isArray(m)?i[l]=m.map(f=>f):i[l]=Bx(m):i[l]=m}),i}function CM(s){let i={type:"FeatureCollection"};return Object.keys(s).forEach(l=>{switch(l){case"type":case"features":return;default:i[l]=s[l]}}),i.features=s.features.map(l=>Dx(l)),i}function a_(s){let i={type:s.type};return s.bbox&&(i.bbox=s.bbox),s.type==="GeometryCollection"?(i.geometries=s.geometries.map(l=>a_(l)),i):(i.coordinates=Ox(s.coordinates),i)}function Ox(s){let i=s;return typeof i[0]!="object"?i.slice():i.map(l=>Ox(l))}var IM=MM,EM=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,$g=Math.ceil,ma=Math.floor,Mo="[BigNumber Error] ",hx=Mo+"Number primitive has more than 15 significant digits: ",Ka=1e14,gi=14,dx=9007199254740991,Ug=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],Vl=1e7,Xo=1e9;function Fx(s){var i,l,m,f=Se.prototype={constructor:Se,toString:null,valueOf:null},a=new Se(1),P=20,E=4,O=-7,B=21,W=-1e7,V=1e7,he=!1,ue=1,be=0,ze={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"\xA0",suffix:""},Xe="0123456789abcdefghijklmnopqrstuvwxyz",Ve=!0;function Se(Q,re){var ce,Ie,de,Oe,Ae,Ce,ge,Fe,Ee=this;if(!(Ee instanceof Se))return new Se(Q,re);if(re==null){if(Q&&Q._isBigNumber===!0){Ee.s=Q.s,!Q.c||Q.e>V?Ee.c=Ee.e=null:Q.e<W?Ee.c=[Ee.e=0]:(Ee.e=Q.e,Ee.c=Q.c.slice());return}if((Ce=typeof Q=="number")&&Q*0==0){if(Ee.s=1/Q<0?(Q=-Q,-1):1,Q===~~Q){for(Oe=0,Ae=Q;Ae>=10;Ae/=10,Oe++);Oe>V?Ee.c=Ee.e=null:(Ee.e=Oe,Ee.c=[Q]);return}Fe=String(Q)}else{if(!EM.test(Fe=String(Q)))return m(Ee,Fe,Ce);Ee.s=Fe.charCodeAt(0)==45?(Fe=Fe.slice(1),-1):1}(Oe=Fe.indexOf("."))>-1&&(Fe=Fe.replace(".","")),(Ae=Fe.search(/e/i))>0?(Oe<0&&(Oe=Ae),Oe+=+Fe.slice(Ae+1),Fe=Fe.substring(0,Ae)):Oe<0&&(Oe=Fe.length)}else{if(Nn(re,2,Xe.length,"Base"),re==10&&Ve)return Ee=new Se(Q),kt(Ee,P+Ee.e+1,E);if(Fe=String(Q),Ce=typeof Q=="number"){if(Q*0!=0)return m(Ee,Fe,Ce,re);if(Ee.s=1/Q<0?(Fe=Fe.slice(1),-1):1,Se.DEBUG&&Fe.replace(/^0\.0*|\./,"").length>15)throw Error(hx+Q)}else Ee.s=Fe.charCodeAt(0)===45?(Fe=Fe.slice(1),-1):1;for(ce=Xe.slice(0,re),Oe=Ae=0,ge=Fe.length;Ae<ge;Ae++)if(ce.indexOf(Ie=Fe.charAt(Ae))<0){if(Ie=="."){if(Ae>Oe){Oe=ge;continue}}else if(!de&&(Fe==Fe.toUpperCase()&&(Fe=Fe.toLowerCase())||Fe==Fe.toLowerCase()&&(Fe=Fe.toUpperCase()))){de=!0,Ae=-1,Oe=0;continue}return m(Ee,String(Q),Ce,re)}Ce=!1,Fe=l(Fe,re,10,Ee.s),(Oe=Fe.indexOf("."))>-1?Fe=Fe.replace(".",""):Oe=Fe.length}for(Ae=0;Fe.charCodeAt(Ae)===48;Ae++);for(ge=Fe.length;Fe.charCodeAt(--ge)===48;);if(Fe=Fe.slice(Ae,++ge)){if(ge-=Ae,Ce&&Se.DEBUG&&ge>15&&(Q>dx||Q!==ma(Q)))throw Error(hx+Ee.s*Q);if((Oe=Oe-Ae-1)>V)Ee.c=Ee.e=null;else if(Oe<W)Ee.c=[Ee.e=0];else{if(Ee.e=Oe,Ee.c=[],Ae=(Oe+1)%gi,Oe<0&&(Ae+=gi),Ae<ge){for(Ae&&Ee.c.push(+Fe.slice(0,Ae)),ge-=gi;Ae<ge;)Ee.c.push(+Fe.slice(Ae,Ae+=gi));Ae=gi-(Fe=Fe.slice(Ae)).length}else Ae-=ge;for(;Ae--;Fe+="0");Ee.c.push(+Fe)}}else Ee.c=[Ee.e=0]}Se.clone=Fx,Se.ROUND_UP=0,Se.ROUND_DOWN=1,Se.ROUND_CEIL=2,Se.ROUND_FLOOR=3,Se.ROUND_HALF_UP=4,Se.ROUND_HALF_DOWN=5,Se.ROUND_HALF_EVEN=6,Se.ROUND_HALF_CEIL=7,Se.ROUND_HALF_FLOOR=8,Se.EUCLID=9,Se.config=Se.set=function(Q){var re,ce;if(Q!=null)if(typeof Q=="object"){if(Q.hasOwnProperty(re="DECIMAL_PLACES")&&(ce=Q[re],Nn(ce,0,Xo,re),P=ce),Q.hasOwnProperty(re="ROUNDING_MODE")&&(ce=Q[re],Nn(ce,0,8,re),E=ce),Q.hasOwnProperty(re="EXPONENTIAL_AT")&&(ce=Q[re],ce&&ce.pop?(Nn(ce[0],-1e9,0,re),Nn(ce[1],0,Xo,re),O=ce[0],B=ce[1]):(Nn(ce,-1e9,Xo,re),O=-(B=ce<0?-ce:ce))),Q.hasOwnProperty(re="RANGE"))if(ce=Q[re],ce&&ce.pop)Nn(ce[0],-1e9,-1,re),Nn(ce[1],1,Xo,re),W=ce[0],V=ce[1];else if(Nn(ce,-1e9,Xo,re),ce)W=-(V=ce<0?-ce:ce);else throw Error(Mo+re+" cannot be zero: "+ce);if(Q.hasOwnProperty(re="CRYPTO"))if(ce=Q[re],ce===!!ce)if(ce)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))he=ce;else throw he=!ce,Error(Mo+"crypto unavailable");else he=ce;else throw Error(Mo+re+" not true or false: "+ce);if(Q.hasOwnProperty(re="MODULO_MODE")&&(ce=Q[re],Nn(ce,0,9,re),ue=ce),Q.hasOwnProperty(re="POW_PRECISION")&&(ce=Q[re],Nn(ce,0,Xo,re),be=ce),Q.hasOwnProperty(re="FORMAT"))if(ce=Q[re],typeof ce=="object")ze=ce;else throw Error(Mo+re+" not an object: "+ce);if(Q.hasOwnProperty(re="ALPHABET"))if(ce=Q[re],typeof ce=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(ce))Ve=ce.slice(0,10)=="0123456789",Xe=ce;else throw Error(Mo+re+" invalid: "+ce)}else throw Error(Mo+"Object expected: "+Q);return{DECIMAL_PLACES:P,ROUNDING_MODE:E,EXPONENTIAL_AT:[O,B],RANGE:[W,V],CRYPTO:he,MODULO_MODE:ue,POW_PRECISION:be,FORMAT:ze,ALPHABET:Xe}},Se.isBigNumber=function(Q){if(!Q||Q._isBigNumber!==!0)return!1;if(!Se.DEBUG)return!0;var re,ce,Ie=Q.c,de=Q.e,Oe=Q.s;e:if({}.toString.call(Ie)=="[object Array]"){if((Oe===1||Oe===-1)&&de>=-1e9&&de<=Xo&&de===ma(de)){if(Ie[0]===0){if(de===0&&Ie.length===1)return!0;break e}if(re=(de+1)%gi,re<1&&(re+=gi),String(Ie[0]).length==re){for(re=0;re<Ie.length;re++)if(ce=Ie[re],ce<0||ce>=Ka||ce!==ma(ce))break e;if(ce!==0)return!0}}}else if(Ie===null&&de===null&&(Oe===null||Oe===1||Oe===-1))return!0;throw Error(Mo+"Invalid BigNumber: "+Q)},Se.maximum=Se.max=function(){return pt(arguments,-1)},Se.minimum=Se.min=function(){return pt(arguments,1)},Se.random=function(){var Q=9007199254740992,re=Math.random()*Q&2097151?function(){return ma(Math.random()*Q)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(ce){var Ie,de,Oe,Ae,Ce,ge=0,Fe=[],Ee=new Se(a);if(ce==null?ce=P:Nn(ce,0,Xo),Ae=$g(ce/gi),he)if(crypto.getRandomValues){for(Ie=crypto.getRandomValues(new Uint32Array(Ae*=2));ge<Ae;)Ce=Ie[ge]*131072+(Ie[ge+1]>>>11),Ce>=9e15?(de=crypto.getRandomValues(new Uint32Array(2)),Ie[ge]=de[0],Ie[ge+1]=de[1]):(Fe.push(Ce%1e14),ge+=2);ge=Ae/2}else if(crypto.randomBytes){for(Ie=crypto.randomBytes(Ae*=7);ge<Ae;)Ce=(Ie[ge]&31)*281474976710656+Ie[ge+1]*1099511627776+Ie[ge+2]*4294967296+Ie[ge+3]*16777216+(Ie[ge+4]<<16)+(Ie[ge+5]<<8)+Ie[ge+6],Ce>=9e15?crypto.randomBytes(7).copy(Ie,ge):(Fe.push(Ce%1e14),ge+=7);ge=Ae/7}else throw he=!1,Error(Mo+"crypto unavailable");if(!he)for(;ge<Ae;)Ce=re(),Ce<9e15&&(Fe[ge++]=Ce%1e14);for(Ae=Fe[--ge],ce%=gi,Ae&&ce&&(Ce=Ug[gi-ce],Fe[ge]=ma(Ae/Ce)*Ce);Fe[ge]===0;Fe.pop(),ge--);if(ge<0)Fe=[Oe=0];else{for(Oe=-1;Fe[0]===0;Fe.splice(0,1),Oe-=gi);for(ge=1,Ce=Fe[0];Ce>=10;Ce/=10,ge++);ge<gi&&(Oe-=gi-ge)}return Ee.e=Oe,Ee.c=Fe,Ee}}(),Se.sum=function(){for(var Q=1,re=arguments,ce=new Se(re[0]);Q<re.length;)ce=ce.plus(re[Q++]);return ce},l=function(){var Q="0123456789";function re(ce,Ie,de,Oe){for(var Ae,Ce=[0],ge,Fe=0,Ee=ce.length;Fe<Ee;){for(ge=Ce.length;ge--;Ce[ge]*=Ie);for(Ce[0]+=Oe.indexOf(ce.charAt(Fe++)),Ae=0;Ae<Ce.length;Ae++)Ce[Ae]>de-1&&(Ce[Ae+1]==null&&(Ce[Ae+1]=0),Ce[Ae+1]+=Ce[Ae]/de|0,Ce[Ae]%=de)}return Ce.reverse()}return function(ce,Ie,de,Oe,Ae){var Ce,ge,Fe,Ee,qe,xt,Tt,Et,St=ce.indexOf("."),zt=P,Ft=E;for(St>=0&&(Ee=be,be=0,ce=ce.replace(".",""),Et=new Se(Ie),xt=Et.pow(ce.length-St),be=Ee,Et.c=re(cl(fa(xt.c),xt.e,"0"),10,de,Q),Et.e=Et.c.length),Tt=re(ce,Ie,de,Ae?(Ce=Xe,Q):(Ce=Q,Xe)),Fe=Ee=Tt.length;Tt[--Ee]==0;Tt.pop());if(!Tt[0])return Ce.charAt(0);if(St<0?--Fe:(xt.c=Tt,xt.e=Fe,xt.s=Oe,xt=i(xt,Et,zt,Ft,de),Tt=xt.c,qe=xt.r,Fe=xt.e),ge=Fe+zt+1,St=Tt[ge],Ee=de/2,qe=qe||ge<0||Tt[ge+1]!=null,qe=Ft<4?(St!=null||qe)&&(Ft==0||Ft==(xt.s<0?3:2)):St>Ee||St==Ee&&(Ft==4||qe||Ft==6&&Tt[ge-1]&1||Ft==(xt.s<0?8:7)),ge<1||!Tt[0])ce=qe?cl(Ce.charAt(1),-zt,Ce.charAt(0)):Ce.charAt(0);else{if(Tt.length=ge,qe)for(--de;++Tt[--ge]>de;)Tt[ge]=0,ge||(++Fe,Tt=[1].concat(Tt));for(Ee=Tt.length;!Tt[--Ee];);for(St=0,ce="";St<=Ee;ce+=Ce.charAt(Tt[St++]));ce=cl(ce,Fe,Ce.charAt(0))}return ce}}(),i=function(){function Q(Ie,de,Oe){var Ae,Ce,ge,Fe,Ee=0,qe=Ie.length,xt=de%Vl,Tt=de/Vl|0;for(Ie=Ie.slice();qe--;)ge=Ie[qe]%Vl,Fe=Ie[qe]/Vl|0,Ae=Tt*ge+Fe*xt,Ce=xt*ge+Ae%Vl*Vl+Ee,Ee=(Ce/Oe|0)+(Ae/Vl|0)+Tt*Fe,Ie[qe]=Ce%Oe;return Ee&&(Ie=[Ee].concat(Ie)),Ie}function re(Ie,de,Oe,Ae){var Ce,ge;if(Oe!=Ae)ge=Oe>Ae?1:-1;else for(Ce=ge=0;Ce<Oe;Ce++)if(Ie[Ce]!=de[Ce]){ge=Ie[Ce]>de[Ce]?1:-1;break}return ge}function ce(Ie,de,Oe,Ae){for(var Ce=0;Oe--;)Ie[Oe]-=Ce,Ce=Ie[Oe]<de[Oe]?1:0,Ie[Oe]=Ce*Ae+Ie[Oe]-de[Oe];for(;!Ie[0]&&Ie.length>1;Ie.splice(0,1));}return function(Ie,de,Oe,Ae,Ce){var ge,Fe,Ee,qe,xt,Tt,Et,St,zt,Ft,Qt,Vi,Jn,hn,Yi,Ri,_i,Ui=Ie.s==de.s?1:-1,Zi=Ie.c,ui=de.c;if(!Zi||!Zi[0]||!ui||!ui[0])return new Se(!Ie.s||!de.s||(Zi?ui&&Zi[0]==ui[0]:!ui)?NaN:Zi&&Zi[0]==0||!ui?Ui*0:Ui/0);for(St=new Se(Ui),zt=St.c=[],Fe=Ie.e-de.e,Ui=Oe+Fe+1,Ce||(Ce=Ka,Fe=ga(Ie.e/gi)-ga(de.e/gi),Ui=Ui/gi|0),Ee=0;ui[Ee]==(Zi[Ee]||0);Ee++);if(ui[Ee]>(Zi[Ee]||0)&&Fe--,Ui<0)zt.push(1),qe=!0;else{for(hn=Zi.length,Ri=ui.length,Ee=0,Ui+=2,xt=ma(Ce/(ui[0]+1)),xt>1&&(ui=Q(ui,xt,Ce),Zi=Q(Zi,xt,Ce),Ri=ui.length,hn=Zi.length),Jn=Ri,Ft=Zi.slice(0,Ri),Qt=Ft.length;Qt<Ri;Ft[Qt++]=0);_i=ui.slice(),_i=[0].concat(_i),Yi=ui[0],ui[1]>=Ce/2&&Yi++;do{if(xt=0,ge=re(ui,Ft,Ri,Qt),ge<0){if(Vi=Ft[0],Ri!=Qt&&(Vi=Vi*Ce+(Ft[1]||0)),xt=ma(Vi/Yi),xt>1)for(xt>=Ce&&(xt=Ce-1),Tt=Q(ui,xt,Ce),Et=Tt.length,Qt=Ft.length;re(Tt,Ft,Et,Qt)==1;)xt--,ce(Tt,Ri<Et?_i:ui,Et,Ce),Et=Tt.length,ge=1;else xt==0&&(ge=xt=1),Tt=ui.slice(),Et=Tt.length;if(Et<Qt&&(Tt=[0].concat(Tt)),ce(Ft,Tt,Qt,Ce),Qt=Ft.length,ge==-1)for(;re(ui,Ft,Ri,Qt)<1;)xt++,ce(Ft,Ri<Qt?_i:ui,Qt,Ce),Qt=Ft.length}else ge===0&&(xt++,Ft=[0]);zt[Ee++]=xt,Ft[0]?Ft[Qt++]=Zi[Jn]||0:(Ft=[Zi[Jn]],Qt=1)}while((Jn++<hn||Ft[0]!=null)&&Ui--);qe=Ft[0]!=null,zt[0]||zt.splice(0,1)}if(Ce==Ka){for(Ee=1,Ui=zt[0];Ui>=10;Ui/=10,Ee++);kt(St,Oe+(St.e=Ee+Fe*gi-1)+1,Ae,qe)}else St.e=Fe,St.r=+qe;return St}}();function nt(Q,re,ce,Ie){var de,Oe,Ae,Ce,ge;if(ce==null?ce=E:Nn(ce,0,8),!Q.c)return Q.toString();if(de=Q.c[0],Ae=Q.e,re==null)ge=fa(Q.c),ge=Ie==1||Ie==2&&(Ae<=O||Ae>=B)?ef(ge,Ae):cl(ge,Ae,"0");else if(Q=kt(new Se(Q),re,ce),Oe=Q.e,ge=fa(Q.c),Ce=ge.length,Ie==1||Ie==2&&(re<=Oe||Oe<=O)){for(;Ce<re;ge+="0",Ce++);ge=ef(ge,Oe)}else if(re-=Ae,ge=cl(ge,Oe,"0"),Oe+1>Ce){if(--re>0)for(ge+=".";re--;ge+="0");}else if(re+=Oe-Ce,re>0)for(Oe+1==Ce&&(ge+=".");re--;ge+="0");return Q.s<0&&de?"-"+ge:ge}function pt(Q,re){for(var ce,Ie,de=1,Oe=new Se(Q[0]);de<Q.length;de++)Ie=new Se(Q[de]),(!Ie.s||(ce=Gc(Oe,Ie))===re||ce===0&&Oe.s===re)&&(Oe=Ie);return Oe}function Pt(Q,re,ce){for(var Ie=1,de=re.length;!re[--de];re.pop());for(de=re[0];de>=10;de/=10,Ie++);return(ce=Ie+ce*gi-1)>V?Q.c=Q.e=null:ce<W?Q.c=[Q.e=0]:(Q.e=ce,Q.c=re),Q}m=function(){var Q=/^(-?)0([xbo])(?=\w[\w.]*$)/i,re=/^([^.]+)\.$/,ce=/^\.([^.]+)$/,Ie=/^-?(Infinity|NaN)$/,de=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(Oe,Ae,Ce,ge){var Fe,Ee=Ce?Ae:Ae.replace(de,"");if(Ie.test(Ee))Oe.s=isNaN(Ee)?null:Ee<0?-1:1;else{if(!Ce&&(Ee=Ee.replace(Q,function(qe,xt,Tt){return Fe=(Tt=Tt.toLowerCase())=="x"?16:Tt=="b"?2:8,!ge||ge==Fe?xt:qe}),ge&&(Fe=ge,Ee=Ee.replace(re,"$1").replace(ce,"0.$1")),Ae!=Ee))return new Se(Ee,Fe);if(Se.DEBUG)throw Error(Mo+"Not a"+(ge?" base "+ge:"")+" number: "+Ae);Oe.s=null}Oe.c=Oe.e=null}}();function kt(Q,re,ce,Ie){var de,Oe,Ae,Ce,ge,Fe,Ee,qe=Q.c,xt=Ug;if(qe){e:{for(de=1,Ce=qe[0];Ce>=10;Ce/=10,de++);if(Oe=re-de,Oe<0)Oe+=gi,Ae=re,ge=qe[Fe=0],Ee=ma(ge/xt[de-Ae-1]%10);else if(Fe=$g((Oe+1)/gi),Fe>=qe.length)if(Ie){for(;qe.length<=Fe;qe.push(0));ge=Ee=0,de=1,Oe%=gi,Ae=Oe-gi+1}else break e;else{for(ge=Ce=qe[Fe],de=1;Ce>=10;Ce/=10,de++);Oe%=gi,Ae=Oe-gi+de,Ee=Ae<0?0:ma(ge/xt[de-Ae-1]%10)}if(Ie=Ie||re<0||qe[Fe+1]!=null||(Ae<0?ge:ge%xt[de-Ae-1]),Ie=ce<4?(Ee||Ie)&&(ce==0||ce==(Q.s<0?3:2)):Ee>5||Ee==5&&(ce==4||Ie||ce==6&&(Oe>0?Ae>0?ge/xt[de-Ae]:0:qe[Fe-1])%10&1||ce==(Q.s<0?8:7)),re<1||!qe[0])return qe.length=0,Ie?(re-=Q.e+1,qe[0]=xt[(gi-re%gi)%gi],Q.e=-re||0):qe[0]=Q.e=0,Q;if(Oe==0?(qe.length=Fe,Ce=1,Fe--):(qe.length=Fe+1,Ce=xt[gi-Oe],qe[Fe]=Ae>0?ma(ge/xt[de-Ae]%xt[Ae])*Ce:0),Ie)for(;;)if(Fe==0){for(Oe=1,Ae=qe[0];Ae>=10;Ae/=10,Oe++);for(Ae=qe[0]+=Ce,Ce=1;Ae>=10;Ae/=10,Ce++);Oe!=Ce&&(Q.e++,qe[0]==Ka&&(qe[0]=1));break}else{if(qe[Fe]+=Ce,qe[Fe]!=Ka)break;qe[Fe--]=0,Ce=1}for(Oe=qe.length;qe[--Oe]===0;qe.pop());}Q.e>V?Q.c=Q.e=null:Q.e<W&&(Q.c=[Q.e=0])}return Q}function It(Q){var re,ce=Q.e;return ce===null?Q.toString():(re=fa(Q.c),re=ce<=O||ce>=B?ef(re,ce):cl(re,ce,"0"),Q.s<0?"-"+re:re)}return f.absoluteValue=f.abs=function(){var Q=new Se(this);return Q.s<0&&(Q.s=1),Q},f.comparedTo=function(Q,re){return Gc(this,new Se(Q,re))},f.decimalPlaces=f.dp=function(Q,re){var ce,Ie,de,Oe=this;if(Q!=null)return Nn(Q,0,Xo),re==null?re=E:Nn(re,0,8),kt(new Se(Oe),Q+Oe.e+1,re);if(!(ce=Oe.c))return null;if(Ie=((de=ce.length-1)-ga(this.e/gi))*gi,de=ce[de])for(;de%10==0;de/=10,Ie--);return Ie<0&&(Ie=0),Ie},f.dividedBy=f.div=function(Q,re){return i(this,new Se(Q,re),P,E)},f.dividedToIntegerBy=f.idiv=function(Q,re){return i(this,new Se(Q,re),0,1)},f.exponentiatedBy=f.pow=function(Q,re){var ce,Ie,de,Oe,Ae,Ce,ge,Fe,Ee,qe=this;if(Q=new Se(Q),Q.c&&!Q.isInteger())throw Error(Mo+"Exponent not an integer: "+It(Q));if(re!=null&&(re=new Se(re)),Ce=Q.e>14,!qe.c||!qe.c[0]||qe.c[0]==1&&!qe.e&&qe.c.length==1||!Q.c||!Q.c[0])return Ee=new Se(Math.pow(+It(qe),Ce?Q.s*(2-Qp(Q)):+It(Q))),re?Ee.mod(re):Ee;if(ge=Q.s<0,re){if(re.c?!re.c[0]:!re.s)return new Se(NaN);Ie=!ge&&qe.isInteger()&&re.isInteger(),Ie&&(qe=qe.mod(re))}else{if(Q.e>9&&(qe.e>0||qe.e<-1||(qe.e==0?qe.c[0]>1||Ce&&qe.c[1]>=24e7:qe.c[0]<8e13||Ce&&qe.c[0]<=9999975e7)))return Oe=qe.s<0&&Qp(Q)?-0:0,qe.e>-1&&(Oe=1/Oe),new Se(ge?1/Oe:Oe);be&&(Oe=$g(be/gi+2))}for(Ce?(ce=new Se(.5),ge&&(Q.s=1),Fe=Qp(Q)):(de=Math.abs(+It(Q)),Fe=de%2),Ee=new Se(a);;){if(Fe){if(Ee=Ee.times(qe),!Ee.c)break;Oe?Ee.c.length>Oe&&(Ee.c.length=Oe):Ie&&(Ee=Ee.mod(re))}if(de){if(de=ma(de/2),de===0)break;Fe=de%2}else if(Q=Q.times(ce),kt(Q,Q.e+1,1),Q.e>14)Fe=Qp(Q);else{if(de=+It(Q),de===0)break;Fe=de%2}qe=qe.times(qe),Oe?qe.c&&qe.c.length>Oe&&(qe.c.length=Oe):Ie&&(qe=qe.mod(re))}return Ie?Ee:(ge&&(Ee=a.div(Ee)),re?Ee.mod(re):Oe?kt(Ee,be,E,Ae):Ee)},f.integerValue=function(Q){var re=new Se(this);return Q==null?Q=E:Nn(Q,0,8),kt(re,re.e+1,Q)},f.isEqualTo=f.eq=function(Q,re){return Gc(this,new Se(Q,re))===0},f.isFinite=function(){return!!this.c},f.isGreaterThan=f.gt=function(Q,re){return Gc(this,new Se(Q,re))>0},f.isGreaterThanOrEqualTo=f.gte=function(Q,re){return(re=Gc(this,new Se(Q,re)))===1||re===0},f.isInteger=function(){return!!this.c&&ga(this.e/gi)>this.c.length-2},f.isLessThan=f.lt=function(Q,re){return Gc(this,new Se(Q,re))<0},f.isLessThanOrEqualTo=f.lte=function(Q,re){return(re=Gc(this,new Se(Q,re)))===-1||re===0},f.isNaN=function(){return!this.s},f.isNegative=function(){return this.s<0},f.isPositive=function(){return this.s>0},f.isZero=function(){return!!this.c&&this.c[0]==0},f.minus=function(Q,re){var ce,Ie,de,Oe,Ae=this,Ce=Ae.s;if(Q=new Se(Q,re),re=Q.s,!Ce||!re)return new Se(NaN);if(Ce!=re)return Q.s=-re,Ae.plus(Q);var ge=Ae.e/gi,Fe=Q.e/gi,Ee=Ae.c,qe=Q.c;if(!ge||!Fe){if(!Ee||!qe)return Ee?(Q.s=-re,Q):new Se(qe?Ae:NaN);if(!Ee[0]||!qe[0])return qe[0]?(Q.s=-re,Q):new Se(Ee[0]?Ae:E==3?-0:0)}if(ge=ga(ge),Fe=ga(Fe),Ee=Ee.slice(),Ce=ge-Fe){for((Oe=Ce<0)?(Ce=-Ce,de=Ee):(Fe=ge,de=qe),de.reverse(),re=Ce;re--;de.push(0));de.reverse()}else for(Ie=(Oe=(Ce=Ee.length)<(re=qe.length))?Ce:re,Ce=re=0;re<Ie;re++)if(Ee[re]!=qe[re]){Oe=Ee[re]<qe[re];break}if(Oe&&(de=Ee,Ee=qe,qe=de,Q.s=-Q.s),re=(Ie=qe.length)-(ce=Ee.length),re>0)for(;re--;Ee[ce++]=0);for(re=Ka-1;Ie>Ce;){if(Ee[--Ie]<qe[Ie]){for(ce=Ie;ce&&!Ee[--ce];Ee[ce]=re);--Ee[ce],Ee[Ie]+=Ka}Ee[Ie]-=qe[Ie]}for(;Ee[0]==0;Ee.splice(0,1),--Fe);return Ee[0]?Pt(Q,Ee,Fe):(Q.s=E==3?-1:1,Q.c=[Q.e=0],Q)},f.modulo=f.mod=function(Q,re){var ce,Ie,de=this;return Q=new Se(Q,re),!de.c||!Q.s||Q.c&&!Q.c[0]?new Se(NaN):!Q.c||de.c&&!de.c[0]?new Se(de):(ue==9?(Ie=Q.s,Q.s=1,ce=i(de,Q,0,3),Q.s=Ie,ce.s*=Ie):ce=i(de,Q,0,ue),Q=de.minus(ce.times(Q)),!Q.c[0]&&ue==1&&(Q.s=de.s),Q)},f.multipliedBy=f.times=function(Q,re){var ce,Ie,de,Oe,Ae,Ce,ge,Fe,Ee,qe,xt,Tt,Et,St,zt,Ft=this,Qt=Ft.c,Vi=(Q=new Se(Q,re)).c;if(!Qt||!Vi||!Qt[0]||!Vi[0])return!Ft.s||!Q.s||Qt&&!Qt[0]&&!Vi||Vi&&!Vi[0]&&!Qt?Q.c=Q.e=Q.s=null:(Q.s*=Ft.s,!Qt||!Vi?Q.c=Q.e=null:(Q.c=[0],Q.e=0)),Q;for(Ie=ga(Ft.e/gi)+ga(Q.e/gi),Q.s*=Ft.s,ge=Qt.length,qe=Vi.length,ge<qe&&(Et=Qt,Qt=Vi,Vi=Et,de=ge,ge=qe,qe=de),de=ge+qe,Et=[];de--;Et.push(0));for(St=Ka,zt=Vl,de=qe;--de>=0;){for(ce=0,xt=Vi[de]%zt,Tt=Vi[de]/zt|0,Ae=ge,Oe=de+Ae;Oe>de;)Fe=Qt[--Ae]%zt,Ee=Qt[Ae]/zt|0,Ce=Tt*Fe+Ee*xt,Fe=xt*Fe+Ce%zt*zt+Et[Oe]+ce,ce=(Fe/St|0)+(Ce/zt|0)+Tt*Ee,Et[Oe--]=Fe%St;Et[Oe]=ce}return ce?++Ie:Et.splice(0,1),Pt(Q,Et,Ie)},f.negated=function(){var Q=new Se(this);return Q.s=-Q.s||null,Q},f.plus=function(Q,re){var ce,Ie=this,de=Ie.s;if(Q=new Se(Q,re),re=Q.s,!de||!re)return new Se(NaN);if(de!=re)return Q.s=-re,Ie.minus(Q);var Oe=Ie.e/gi,Ae=Q.e/gi,Ce=Ie.c,ge=Q.c;if(!Oe||!Ae){if(!Ce||!ge)return new Se(de/0);if(!Ce[0]||!ge[0])return ge[0]?Q:new Se(Ce[0]?Ie:de*0)}if(Oe=ga(Oe),Ae=ga(Ae),Ce=Ce.slice(),de=Oe-Ae){for(de>0?(Ae=Oe,ce=ge):(de=-de,ce=Ce),ce.reverse();de--;ce.push(0));ce.reverse()}for(de=Ce.length,re=ge.length,de-re<0&&(ce=ge,ge=Ce,Ce=ce,re=de),de=0;re;)de=(Ce[--re]=Ce[re]+ge[re]+de)/Ka|0,Ce[re]=Ka===Ce[re]?0:Ce[re]%Ka;return de&&(Ce=[de].concat(Ce),++Ae),Pt(Q,Ce,Ae)},f.precision=f.sd=function(Q,re){var ce,Ie,de,Oe=this;if(Q!=null&&Q!==!!Q)return Nn(Q,1,Xo),re==null?re=E:Nn(re,0,8),kt(new Se(Oe),Q,re);if(!(ce=Oe.c))return null;if(de=ce.length-1,Ie=de*gi+1,de=ce[de]){for(;de%10==0;de/=10,Ie--);for(de=ce[0];de>=10;de/=10,Ie++);}return Q&&Oe.e+1>Ie&&(Ie=Oe.e+1),Ie},f.shiftedBy=function(Q){return Nn(Q,-9007199254740991,dx),this.times("1e"+Q)},f.squareRoot=f.sqrt=function(){var Q,re,ce,Ie,de,Oe=this,Ae=Oe.c,Ce=Oe.s,ge=Oe.e,Fe=P+4,Ee=new Se("0.5");if(Ce!==1||!Ae||!Ae[0])return new Se(!Ce||Ce<0&&(!Ae||Ae[0])?NaN:Ae?Oe:1/0);if(Ce=Math.sqrt(+It(Oe)),Ce==0||Ce==1/0?(re=fa(Ae),(re.length+ge)%2==0&&(re+="0"),Ce=Math.sqrt(+re),ge=ga((ge+1)/2)-(ge<0||ge%2),Ce==1/0?re="5e"+ge:(re=Ce.toExponential(),re=re.slice(0,re.indexOf("e")+1)+ge),ce=new Se(re)):ce=new Se(Ce+""),ce.c[0]){for(ge=ce.e,Ce=ge+Fe,Ce<3&&(Ce=0);;)if(de=ce,ce=Ee.times(de.plus(i(Oe,de,Fe,1))),fa(de.c).slice(0,Ce)===(re=fa(ce.c)).slice(0,Ce))if(ce.e<ge&&--Ce,re=re.slice(Ce-3,Ce+1),re=="9999"||!Ie&&re=="4999"){if(!Ie&&(kt(de,de.e+P+2,0),de.times(de).eq(Oe))){ce=de;break}Fe+=4,Ce+=4,Ie=1}else{(!+re||!+re.slice(1)&&re.charAt(0)=="5")&&(kt(ce,ce.e+P+2,1),Q=!ce.times(ce).eq(Oe));break}}return kt(ce,ce.e+P+1,E,Q)},f.toExponential=function(Q,re){return Q!=null&&(Nn(Q,0,Xo),Q++),nt(this,Q,re,1)},f.toFixed=function(Q,re){return Q!=null&&(Nn(Q,0,Xo),Q=Q+this.e+1),nt(this,Q,re)},f.toFormat=function(Q,re,ce){var Ie,de=this;if(ce==null)Q!=null&&re&&typeof re=="object"?(ce=re,re=null):Q&&typeof Q=="object"?(ce=Q,Q=re=null):ce=ze;else if(typeof ce!="object")throw Error(Mo+"Argument not an object: "+ce);if(Ie=de.toFixed(Q,re),de.c){var Oe,Ae=Ie.split("."),Ce=+ce.groupSize,ge=+ce.secondaryGroupSize,Fe=ce.groupSeparator||"",Ee=Ae[0],qe=Ae[1],xt=de.s<0,Tt=xt?Ee.slice(1):Ee,Et=Tt.length;if(ge&&(Oe=Ce,Ce=ge,ge=Oe,Et-=Oe),Ce>0&&Et>0){for(Oe=Et%Ce||Ce,Ee=Tt.substr(0,Oe);Oe<Et;Oe+=Ce)Ee+=Fe+Tt.substr(Oe,Ce);ge>0&&(Ee+=Fe+Tt.slice(Oe)),xt&&(Ee="-"+Ee)}Ie=qe?Ee+(ce.decimalSeparator||"")+((ge=+ce.fractionGroupSize)?qe.replace(new RegExp("\\d{"+ge+"}\\B","g"),"$&"+(ce.fractionGroupSeparator||"")):qe):Ee}return(ce.prefix||"")+Ie+(ce.suffix||"")},f.toFraction=function(Q){var re,ce,Ie,de,Oe,Ae,Ce,ge,Fe,Ee,qe,xt,Tt=this,Et=Tt.c;if(Q!=null&&(Ce=new Se(Q),!Ce.isInteger()&&(Ce.c||Ce.s!==1)||Ce.lt(a)))throw Error(Mo+"Argument "+(Ce.isInteger()?"out of range: ":"not an integer: ")+It(Ce));if(!Et)return new Se(Tt);for(re=new Se(a),Fe=ce=new Se(a),Ie=ge=new Se(a),xt=fa(Et),Oe=re.e=xt.length-Tt.e-1,re.c[0]=Ug[(Ae=Oe%gi)<0?gi+Ae:Ae],Q=!Q||Ce.comparedTo(re)>0?Oe>0?re:Fe:Ce,Ae=V,V=1/0,Ce=new Se(xt),ge.c[0]=0;Ee=i(Ce,re,0,1),de=ce.plus(Ee.times(Ie)),de.comparedTo(Q)!=1;)ce=Ie,Ie=de,Fe=ge.plus(Ee.times(de=Fe)),ge=de,re=Ce.minus(Ee.times(de=re)),Ce=de;return de=i(Q.minus(ce),Ie,0,1),ge=ge.plus(de.times(Fe)),ce=ce.plus(de.times(Ie)),ge.s=Fe.s=Tt.s,Oe=Oe*2,qe=i(Fe,Ie,Oe,E).minus(Tt).abs().comparedTo(i(ge,ce,Oe,E).minus(Tt).abs())<1?[Fe,Ie]:[ge,ce],V=Ae,qe},f.toNumber=function(){return+It(this)},f.toPrecision=function(Q,re){return Q!=null&&Nn(Q,1,Xo),nt(this,Q,re,2)},f.toString=function(Q){var re,ce=this,Ie=ce.s,de=ce.e;return de===null?Ie?(re="Infinity",Ie<0&&(re="-"+re)):re="NaN":(Q==null?re=de<=O||de>=B?ef(fa(ce.c),de):cl(fa(ce.c),de,"0"):Q===10&&Ve?(ce=kt(new Se(ce),P+de+1,E),re=cl(fa(ce.c),ce.e,"0")):(Nn(Q,2,Xe.length,"Base"),re=l(cl(fa(ce.c),de,"0"),10,Q,Ie,!0)),Ie<0&&ce.c[0]&&(re="-"+re)),re},f.valueOf=f.toJSON=function(){return It(this)},f._isBigNumber=!0,f[Symbol.toStringTag]="BigNumber",f[Symbol.for("nodejs.util.inspect.custom")]=f.valueOf,s!=null&&Se.set(s),Se}function ga(s){var i=s|0;return s>0||s===i?i:i-1}function fa(s){for(var i,l,m=1,f=s.length,a=s[0]+"";m<f;){for(i=s[m++]+"",l=gi-i.length;l--;i="0"+i);a+=i}for(f=a.length;a.charCodeAt(--f)===48;);return a.slice(0,f+1||1)}function Gc(s,i){var l,m,f=s.c,a=i.c,P=s.s,E=i.s,O=s.e,B=i.e;if(!P||!E)return null;if(l=f&&!f[0],m=a&&!a[0],l||m)return l?m?0:-E:P;if(P!=E)return P;if(l=P<0,m=O==B,!f||!a)return m?0:!f^l?1:-1;if(!m)return O>B^l?1:-1;for(E=(O=f.length)<(B=a.length)?O:B,P=0;P<E;P++)if(f[P]!=a[P])return f[P]>a[P]^l?1:-1;return O==B?0:O>B^l?1:-1}function Nn(s,i,l,m){if(s<i||s>l||s!==ma(s))throw Error(Mo+(m||"Argument")+(typeof s=="number"?s<i||s>l?" out of range: ":" not an integer: ":" not a primitive number: ")+String(s))}function Qp(s){var i=s.c.length-1;return ga(s.e/gi)==i&&s.c[i]%2!=0}function ef(s,i){return(s.length>1?s.charAt(0)+"."+s.slice(1):s)+(i<0?"e":"e+")+i}function cl(s,i,l){var m,f;if(i<0){for(f=l+".";++i;f+=l);s=f+s}else if(m=s.length,++i>m){for(f=l,i-=m;--i;f+=l);s+=f}else i<m&&(s=s.slice(0,i)+"."+s.slice(i));return s}var As=Fx(),LM=class{constructor(s){Ht(this,"key"),Ht(this,"left",null),Ht(this,"right",null),this.key=s}},ud=class extends LM{constructor(s){super(s)}},AM=class{constructor(){Ht(this,"size",0),Ht(this,"modificationCount",0),Ht(this,"splayCount",0)}splay(s){let i=this.root;if(i==null)return this.compare(s,s),-1;let l=null,m=null,f=null,a=null,P=i,E=this.compare,O;for(;;)if(O=E(P.key,s),O>0){let B=P.left;if(B==null||(O=E(B.key,s),O>0&&(P.left=B.right,B.right=P,P=B,B=P.left,B==null)))break;l==null?m=P:l.left=P,l=P,P=B}else if(O<0){let B=P.right;if(B==null||(O=E(B.key,s),O<0&&(P.right=B.left,B.left=P,P=B,B=P.right,B==null)))break;f==null?a=P:f.right=P,f=P,P=B}else break;return f!=null&&(f.right=P.left,P.left=a),l!=null&&(l.left=P.right,P.right=m),this.root!==P&&(this.root=P,this.splayCount++),O}splayMin(s){let i=s,l=i.left;for(;l!=null;){let m=l;i.left=m.right,m.right=i,i=m,l=i.left}return i}splayMax(s){let i=s,l=i.right;for(;l!=null;){let m=l;i.right=m.left,m.left=i,i=m,l=i.right}return i}_delete(s){if(this.root==null||this.splay(s)!=0)return null;let i=this.root,l=i,m=i.left;if(this.size--,m==null)this.root=i.right;else{let f=i.right;i=this.splayMax(m),i.right=f,this.root=i}return this.modificationCount++,l}addNewRoot(s,i){this.size++,this.modificationCount++;let l=this.root;if(l==null){this.root=s;return}i<0?(s.left=l,s.right=l.right,l.right=null):(s.right=l,s.left=l.left,l.left=null),this.root=s}_first(){let s=this.root;return s==null?null:(this.root=this.splayMin(s),this.root)}_last(){let s=this.root;return s==null?null:(this.root=this.splayMax(s),this.root)}clear(){this.root=null,this.size=0,this.modificationCount++}has(s){return this.validKey(s)&&this.splay(s)==0}defaultCompare(){return(s,i)=>s<i?-1:s>i?1:0}wrap(){return{getRoot:()=>this.root,setRoot:s=>{this.root=s},getSize:()=>this.size,getModificationCount:()=>this.modificationCount,getSplayCount:()=>this.splayCount,setSplayCount:s=>{this.splayCount=s},splay:s=>this.splay(s),has:s=>this.has(s)}}},px,fx,uf=class dd extends AM{constructor(i,l){super(),Ht(this,"root",null),Ht(this,"compare"),Ht(this,"validKey"),Ht(this,px,"[object Set]"),this.compare=i??this.defaultCompare(),this.validKey=l??(m=>m!=null&&m!=null)}delete(i){return this.validKey(i)?this._delete(i)!=null:!1}deleteAll(i){for(let l of i)this.delete(l)}forEach(i){let l=this[Symbol.iterator](),m;for(;m=l.next(),!m.done;)i(m.value,m.value,this)}add(i){let l=this.splay(i);return l!=0&&this.addNewRoot(new ud(i),l),this}addAndReturn(i){let l=this.splay(i);return l!=0&&this.addNewRoot(new ud(i),l),this.root.key}addAll(i){for(let l of i)this.add(l)}isEmpty(){return this.root==null}isNotEmpty(){return this.root!=null}single(){if(this.size==0)throw"Bad state: No element";if(this.size>1)throw"Bad state: Too many element";return this.root.key}first(){if(this.size==0)throw"Bad state: No element";return this._first().key}last(){if(this.size==0)throw"Bad state: No element";return this._last().key}lastBefore(i){if(i==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(i)<0)return this.root.key;let l=this.root.left;if(l==null)return null;let m=l.right;for(;m!=null;)l=m,m=l.right;return l.key}firstAfter(i){if(i==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(i)>0)return this.root.key;let l=this.root.right;if(l==null)return null;let m=l.left;for(;m!=null;)l=m,m=l.left;return l.key}retainAll(i){let l=new dd(this.compare,this.validKey),m=this.modificationCount;for(let f of i){if(m!=this.modificationCount)throw"Concurrent modification during iteration.";this.validKey(f)&&this.splay(f)==0&&l.add(this.root.key)}l.size!=this.size&&(this.root=l.root,this.size=l.size,this.modificationCount++)}lookup(i){return!this.validKey(i)||this.splay(i)!=0?null:this.root.key}intersection(i){let l=new dd(this.compare,this.validKey);for(let m of this)i.has(m)&&l.add(m);return l}difference(i){let l=new dd(this.compare,this.validKey);for(let m of this)i.has(m)||l.add(m);return l}union(i){let l=this.clone();return l.addAll(i),l}clone(){let i=new dd(this.compare,this.validKey);return i.size=this.size,i.root=this.copyNode(this.root),i}copyNode(i){if(i==null)return null;function l(f,a){let P,E;do{if(P=f.left,E=f.right,P!=null){let O=new ud(P.key);a.left=O,l(P,O)}if(E!=null){let O=new ud(E.key);a.right=O,f=E,a=O}}while(E!=null)}let m=new ud(i.key);return l(i,m),m}toSet(){return this.clone()}entries(){return new zM(this.wrap())}keys(){return this[Symbol.iterator]()}values(){return this[Symbol.iterator]()}[(fx=Symbol.iterator,px=Symbol.toStringTag,fx)](){return new kM(this.wrap())}},Nx=class{constructor(s){Ht(this,"tree"),Ht(this,"path",new Array),Ht(this,"modificationCount",null),Ht(this,"splayCount"),this.tree=s,this.splayCount=s.getSplayCount()}[Symbol.iterator](){return this}next(){return this.moveNext()?{done:!1,value:this.current()}:{done:!0,value:null}}current(){if(!this.path.length)return null;let s=this.path[this.path.length-1];return this.getValue(s)}rebuildPath(s){this.path.splice(0,this.path.length),this.tree.splay(s),this.path.push(this.tree.getRoot()),this.splayCount=this.tree.getSplayCount()}findLeftMostDescendent(s){for(;s!=null;)this.path.push(s),s=s.left}moveNext(){if(this.modificationCount!=this.tree.getModificationCount()){if(this.modificationCount==null){this.modificationCount=this.tree.getModificationCount();let l=this.tree.getRoot();for(;l!=null;)this.path.push(l),l=l.left;return this.path.length>0}throw"Concurrent modification during iteration."}if(!this.path.length)return!1;this.splayCount!=this.tree.getSplayCount()&&this.rebuildPath(this.path[this.path.length-1].key);let s=this.path[this.path.length-1],i=s.right;if(i!=null){for(;i!=null;)this.path.push(i),i=i.left;return!0}for(this.path.pop();this.path.length&&this.path[this.path.length-1].right===s;)s=this.path.pop();return this.path.length>0}},kM=class extends Nx{getValue(s){return s.key}},zM=class extends Nx{getValue(s){return[s.key,s.key]}},jx=s=>()=>s,Qg=s=>{let i=s?(l,m)=>m.minus(l).abs().isLessThanOrEqualTo(s):jx(!1);return(l,m)=>i(l,m)?0:l.comparedTo(m)};function RM(s){let i=s?(l,m,f,a,P)=>l.exponentiatedBy(2).isLessThanOrEqualTo(a.minus(m).exponentiatedBy(2).plus(P.minus(f).exponentiatedBy(2)).times(s)):jx(!1);return(l,m,f)=>{let a=l.x,P=l.y,E=f.x,O=f.y,B=P.minus(O).times(m.x.minus(E)).minus(a.minus(E).times(m.y.minus(O)));return i(B,a,P,E,O)?0:B.comparedTo(0)}}var DM=s=>s,BM=s=>{if(s){let i=new uf(Qg(s)),l=new uf(Qg(s)),m=(a,P)=>P.addAndReturn(a),f=a=>({x:m(a.x,i),y:m(a.y,l)});return f({x:new As(0),y:new As(0)}),f}return DM},e_=s=>({set:i=>{dl=e_(i)},reset:()=>e_(s),compare:Qg(s),snap:BM(s),orient:RM(s)}),dl=e_(),hd=(s,i)=>s.ll.x.isLessThanOrEqualTo(i.x)&&i.x.isLessThanOrEqualTo(s.ur.x)&&s.ll.y.isLessThanOrEqualTo(i.y)&&i.y.isLessThanOrEqualTo(s.ur.y),t_=(s,i)=>{if(i.ur.x.isLessThan(s.ll.x)||s.ur.x.isLessThan(i.ll.x)||i.ur.y.isLessThan(s.ll.y)||s.ur.y.isLessThan(i.ll.y))return null;let l=s.ll.x.isLessThan(i.ll.x)?i.ll.x:s.ll.x,m=s.ur.x.isLessThan(i.ur.x)?s.ur.x:i.ur.x,f=s.ll.y.isLessThan(i.ll.y)?i.ll.y:s.ll.y,a=s.ur.y.isLessThan(i.ur.y)?s.ur.y:i.ur.y;return{ll:{x:l,y:f},ur:{x:m,y:a}}},of=(s,i)=>s.x.times(i.y).minus(s.y.times(i.x)),$x=(s,i)=>s.x.times(i.x).plus(s.y.times(i.y)),hf=s=>$x(s,s).sqrt(),OM=(s,i,l)=>{let m={x:i.x.minus(s.x),y:i.y.minus(s.y)},f={x:l.x.minus(s.x),y:l.y.minus(s.y)};return of(f,m).div(hf(f)).div(hf(m))},FM=(s,i,l)=>{let m={x:i.x.minus(s.x),y:i.y.minus(s.y)},f={x:l.x.minus(s.x),y:l.y.minus(s.y)};return $x(f,m).div(hf(f)).div(hf(m))},mx=(s,i,l)=>i.y.isZero()?null:{x:s.x.plus(i.x.div(i.y).times(l.minus(s.y))),y:l},gx=(s,i,l)=>i.x.isZero()?null:{x:l,y:s.y.plus(i.y.div(i.x).times(l.minus(s.x)))},NM=(s,i,l,m)=>{if(i.x.isZero())return gx(l,m,s.x);if(m.x.isZero())return gx(s,i,l.x);if(i.y.isZero())return mx(l,m,s.y);if(m.y.isZero())return mx(s,i,l.y);let f=of(i,m);if(f.isZero())return null;let a={x:l.x.minus(s.x),y:l.y.minus(s.y)},P=of(a,i).div(f),E=of(a,m).div(f),O=s.x.plus(E.times(i.x)),B=l.x.plus(P.times(m.x)),W=s.y.plus(E.times(i.y)),V=l.y.plus(P.times(m.y)),he=O.plus(B).div(2),ue=W.plus(V).div(2);return{x:he,y:ue}},Is=class Ux{constructor(i,l){Ht(this,"point"),Ht(this,"isLeft"),Ht(this,"segment"),Ht(this,"otherSE"),Ht(this,"consumedBy"),i.events===void 0?i.events=[this]:i.events.push(this),this.point=i,this.isLeft=l}static compare(i,l){let m=Ux.comparePoints(i.point,l.point);return m!==0?m:(i.point!==l.point&&i.link(l),i.isLeft!==l.isLeft?i.isLeft?1:-1:pf.compare(i.segment,l.segment))}static comparePoints(i,l){return i.x.isLessThan(l.x)?-1:i.x.isGreaterThan(l.x)?1:i.y.isLessThan(l.y)?-1:i.y.isGreaterThan(l.y)?1:0}link(i){if(i.point===this.point)throw new Error("Tried to link already linked events");let l=i.point.events;for(let m=0,f=l.length;m<f;m++){let a=l[m];this.point.events.push(a),a.point=this.point}this.checkForConsuming()}checkForConsuming(){let i=this.point.events.length;for(let l=0;l<i;l++){let m=this.point.events[l];if(m.segment.consumedBy===void 0)for(let f=l+1;f<i;f++){let a=this.point.events[f];a.consumedBy===void 0&&m.otherSE.point.events===a.otherSE.point.events&&m.segment.consume(a.segment)}}}getAvailableLinkedEvents(){let i=[];for(let l=0,m=this.point.events.length;l<m;l++){let f=this.point.events[l];f!==this&&!f.segment.ringOut&&f.segment.isInResult()&&i.push(f)}return i}getLeftmostComparator(i){let l=new Map,m=f=>{let a=f.otherSE;l.set(f,{sine:OM(this.point,i.point,a.point),cosine:FM(this.point,i.point,a.point)})};return(f,a)=>{l.has(f)||m(f),l.has(a)||m(a);let{sine:P,cosine:E}=l.get(f),{sine:O,cosine:B}=l.get(a);return P.isGreaterThanOrEqualTo(0)&&O.isGreaterThanOrEqualTo(0)?E.isLessThan(B)?1:E.isGreaterThan(B)?-1:0:P.isLessThan(0)&&O.isLessThan(0)?E.isLessThan(B)?-1:E.isGreaterThan(B)?1:0:O.isLessThan(P)?-1:O.isGreaterThan(P)?1:0}}},jM=class i_{constructor(i){Ht(this,"events"),Ht(this,"poly"),Ht(this,"_isExteriorRing"),Ht(this,"_enclosingRing"),this.events=i;for(let l=0,m=i.length;l<m;l++)i[l].segment.ringOut=this;this.poly=null}static factory(i){let l=[];for(let m=0,f=i.length;m<f;m++){let a=i[m];if(!a.isInResult()||a.ringOut)continue;let P=null,E=a.leftSE,O=a.rightSE,B=[E],W=E.point,V=[];for(;P=E,E=O,B.push(E),E.point!==W;)for(;;){let he=E.getAvailableLinkedEvents();if(he.length===0){let ze=B[0].point,Xe=B[B.length-1].point;throw new Error(`Unable to complete output ring starting at [${ze.x}, ${ze.y}]. Last matching segment found ends at [${Xe.x}, ${Xe.y}].`)}if(he.length===1){O=he[0].otherSE;break}let ue=null;for(let ze=0,Xe=V.length;ze<Xe;ze++)if(V[ze].point===E.point){ue=ze;break}if(ue!==null){let ze=V.splice(ue)[0],Xe=B.splice(ze.index);Xe.unshift(Xe[0].otherSE),l.push(new i_(Xe.reverse()));continue}V.push({index:B.length,point:E.point});let be=E.getLeftmostComparator(P);O=he.sort(be)[0].otherSE;break}l.push(new i_(B))}return l}getGeom(){let i=this.events[0].point,l=[i];for(let B=1,W=this.events.length-1;B<W;B++){let V=this.events[B].point,he=this.events[B+1].point;dl.orient(V,i,he)!==0&&(l.push(V),i=V)}if(l.length===1)return null;let m=l[0],f=l[1];dl.orient(m,i,f)===0&&l.shift(),l.push(l[0]);let a=this.isExteriorRing()?1:-1,P=this.isExteriorRing()?0:l.length-1,E=this.isExteriorRing()?l.length:-1,O=[];for(let B=P;B!=E;B+=a)O.push([l[B].x.toNumber(),l[B].y.toNumber()]);return O}isExteriorRing(){if(this._isExteriorRing===void 0){let i=this.enclosingRing();this._isExteriorRing=i?!i.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){var i,l;let m=this.events[0];for(let P=1,E=this.events.length;P<E;P++){let O=this.events[P];Is.compare(m,O)>0&&(m=O)}let f=m.segment.prevInResult(),a=f?f.prevInResult():null;for(;;){if(!f)return null;if(!a)return f.ringOut;if(a.ringOut!==f.ringOut)return((i=a.ringOut)==null?void 0:i.enclosingRing())!==f.ringOut?f.ringOut:(l=f.ringOut)==null?void 0:l.enclosingRing();f=a.prevInResult(),a=f?f.prevInResult():null}}},_x=class{constructor(s){Ht(this,"exteriorRing"),Ht(this,"interiorRings"),this.exteriorRing=s,s.poly=this,this.interiorRings=[]}addInterior(s){this.interiorRings.push(s),s.poly=this}getGeom(){let s=this.exteriorRing.getGeom();if(s===null)return null;let i=[s];for(let l=0,m=this.interiorRings.length;l<m;l++){let f=this.interiorRings[l].getGeom();f!==null&&i.push(f)}return i}},$M=class{constructor(s){Ht(this,"rings"),Ht(this,"polys"),this.rings=s,this.polys=this._composePolys(s)}getGeom(){let s=[];for(let i=0,l=this.polys.length;i<l;i++){let m=this.polys[i].getGeom();m!==null&&s.push(m)}return s}_composePolys(s){var i;let l=[];for(let m=0,f=s.length;m<f;m++){let a=s[m];if(!a.poly)if(a.isExteriorRing())l.push(new _x(a));else{let P=a.enclosingRing();P!=null&&P.poly||l.push(new _x(P)),(i=P?.poly)==null||i.addInterior(a)}}return l}},UM=class{constructor(s,i=pf.compare){Ht(this,"queue"),Ht(this,"tree"),Ht(this,"segments"),this.queue=s,this.tree=new uf(i),this.segments=[]}process(s){let i=s.segment,l=[];if(s.consumedBy)return s.isLeft?this.queue.delete(s.otherSE):this.tree.delete(i),l;s.isLeft&&this.tree.add(i);let m=i,f=i;do m=this.tree.lastBefore(m);while(m!=null&&m.consumedBy!=null);do f=this.tree.firstAfter(f);while(f!=null&&f.consumedBy!=null);if(s.isLeft){let a=null;if(m){let E=m.getIntersection(i);if(E!==null&&(i.isAnEndpoint(E)||(a=E),!m.isAnEndpoint(E))){let O=this._splitSafely(m,E);for(let B=0,W=O.length;B<W;B++)l.push(O[B])}}let P=null;if(f){let E=f.getIntersection(i);if(E!==null&&(i.isAnEndpoint(E)||(P=E),!f.isAnEndpoint(E))){let O=this._splitSafely(f,E);for(let B=0,W=O.length;B<W;B++)l.push(O[B])}}if(a!==null||P!==null){let E=null;a===null?E=P:P===null?E=a:E=Is.comparePoints(a,P)<=0?a:P,this.queue.delete(i.rightSE),l.push(i.rightSE);let O=i.split(E);for(let B=0,W=O.length;B<W;B++)l.push(O[B])}l.length>0?(this.tree.delete(i),l.push(s)):(this.segments.push(i),i.prev=m)}else{if(m&&f){let a=m.getIntersection(f);if(a!==null){if(!m.isAnEndpoint(a)){let P=this._splitSafely(m,a);for(let E=0,O=P.length;E<O;E++)l.push(P[E])}if(!f.isAnEndpoint(a)){let P=this._splitSafely(f,a);for(let E=0,O=P.length;E<O;E++)l.push(P[E])}}}this.tree.delete(i)}return l}_splitSafely(s,i){this.tree.delete(s);let l=s.rightSE;this.queue.delete(l);let m=s.split(i);return m.push(l),s.consumedBy===void 0&&this.tree.add(s),m}},ZM=class{constructor(){Ht(this,"type"),Ht(this,"numMultiPolys")}run(s,i,l){pd.type=s;let m=[new vx(i,!0)];for(let O=0,B=l.length;O<B;O++)m.push(new vx(l[O],!1));if(pd.numMultiPolys=m.length,pd.type==="difference"){let O=m[0],B=1;for(;B<m.length;)t_(m[B].bbox,O.bbox)!==null?B++:m.splice(B,1)}if(pd.type==="intersection")for(let O=0,B=m.length;O<B;O++){let W=m[O];for(let V=O+1,he=m.length;V<he;V++)if(t_(W.bbox,m[V].bbox)===null)return[]}let f=new uf(Is.compare);for(let O=0,B=m.length;O<B;O++){let W=m[O].getSweepEvents();for(let V=0,he=W.length;V<he;V++)f.add(W[V])}let a=new UM(f),P=null;for(f.size!=0&&(P=f.first(),f.delete(P));P;){let O=a.process(P);for(let B=0,W=O.length;B<W;B++){let V=O[B];V.consumedBy===void 0&&f.add(V)}f.size!=0?(P=f.first(),f.delete(P)):P=null}dl.reset();let E=jM.factory(a.segments);return new $M(E).getGeom()}},pd=new ZM,df=pd,VM=0,pf=class af{constructor(i,l,m,f){Ht(this,"id"),Ht(this,"leftSE"),Ht(this,"rightSE"),Ht(this,"rings"),Ht(this,"windings"),Ht(this,"ringOut"),Ht(this,"consumedBy"),Ht(this,"prev"),Ht(this,"_prevInResult"),Ht(this,"_beforeState"),Ht(this,"_afterState"),Ht(this,"_isInResult"),this.id=++VM,this.leftSE=i,i.segment=this,i.otherSE=l,this.rightSE=l,l.segment=this,l.otherSE=i,this.rings=m,this.windings=f}static compare(i,l){let m=i.leftSE.point.x,f=l.leftSE.point.x,a=i.rightSE.point.x,P=l.rightSE.point.x;if(P.isLessThan(m))return 1;if(a.isLessThan(f))return-1;let E=i.leftSE.point.y,O=l.leftSE.point.y,B=i.rightSE.point.y,W=l.rightSE.point.y;if(m.isLessThan(f)){if(O.isLessThan(E)&&O.isLessThan(B))return 1;if(O.isGreaterThan(E)&&O.isGreaterThan(B))return-1;let V=i.comparePoint(l.leftSE.point);if(V<0)return 1;if(V>0)return-1;let he=l.comparePoint(i.rightSE.point);return he!==0?he:-1}if(m.isGreaterThan(f)){if(E.isLessThan(O)&&E.isLessThan(W))return-1;if(E.isGreaterThan(O)&&E.isGreaterThan(W))return 1;let V=l.comparePoint(i.leftSE.point);if(V!==0)return V;let he=i.comparePoint(l.rightSE.point);return he<0?1:he>0?-1:1}if(E.isLessThan(O))return-1;if(E.isGreaterThan(O))return 1;if(a.isLessThan(P)){let V=l.comparePoint(i.rightSE.point);if(V!==0)return V}if(a.isGreaterThan(P)){let V=i.comparePoint(l.rightSE.point);if(V<0)return 1;if(V>0)return-1}if(!a.eq(P)){let V=B.minus(E),he=a.minus(m),ue=W.minus(O),be=P.minus(f);if(V.isGreaterThan(he)&&ue.isLessThan(be))return 1;if(V.isLessThan(he)&&ue.isGreaterThan(be))return-1}return a.isGreaterThan(P)?1:a.isLessThan(P)||B.isLessThan(W)?-1:B.isGreaterThan(W)?1:i.id<l.id?-1:i.id>l.id?1:0}static fromRing(i,l,m){let f,a,P,E=Is.comparePoints(i,l);if(E<0)f=i,a=l,P=1;else if(E>0)f=l,a=i,P=-1;else throw new Error(`Tried to create degenerate segment at [${i.x}, ${i.y}]`);let O=new Is(f,!0),B=new Is(a,!1);return new af(O,B,[m],[P])}replaceRightSE(i){this.rightSE=i,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){let i=this.leftSE.point.y,l=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:i.isLessThan(l)?i:l},ur:{x:this.rightSE.point.x,y:i.isGreaterThan(l)?i:l}}}vector(){return{x:this.rightSE.point.x.minus(this.leftSE.point.x),y:this.rightSE.point.y.minus(this.leftSE.point.y)}}isAnEndpoint(i){return i.x.eq(this.leftSE.point.x)&&i.y.eq(this.leftSE.point.y)||i.x.eq(this.rightSE.point.x)&&i.y.eq(this.rightSE.point.y)}comparePoint(i){return dl.orient(this.leftSE.point,i,this.rightSE.point)}getIntersection(i){let l=this.bbox(),m=i.bbox(),f=t_(l,m);if(f===null)return null;let a=this.leftSE.point,P=this.rightSE.point,E=i.leftSE.point,O=i.rightSE.point,B=hd(l,E)&&this.comparePoint(E)===0,W=hd(m,a)&&i.comparePoint(a)===0,V=hd(l,O)&&this.comparePoint(O)===0,he=hd(m,P)&&i.comparePoint(P)===0;if(W&&B)return he&&!V?P:!he&&V?O:null;if(W)return V&&a.x.eq(O.x)&&a.y.eq(O.y)?null:a;if(B)return he&&P.x.eq(E.x)&&P.y.eq(E.y)?null:E;if(he&&V)return null;if(he)return P;if(V)return O;let ue=NM(a,this.vector(),E,i.vector());return ue===null||!hd(f,ue)?null:dl.snap(ue)}split(i){let l=[],m=i.events!==void 0,f=new Is(i,!0),a=new Is(i,!1),P=this.rightSE;this.replaceRightSE(a),l.push(a),l.push(f);let E=new af(f,P,this.rings.slice(),this.windings.slice());return Is.comparePoints(E.leftSE.point,E.rightSE.point)>0&&E.swapEvents(),Is.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),m&&(f.checkForConsuming(),a.checkForConsuming()),l}swapEvents(){let i=this.rightSE;this.rightSE=this.leftSE,this.leftSE=i,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let l=0,m=this.windings.length;l<m;l++)this.windings[l]*=-1}consume(i){let l=this,m=i;for(;l.consumedBy;)l=l.consumedBy;for(;m.consumedBy;)m=m.consumedBy;let f=af.compare(l,m);if(f!==0){if(f>0){let a=l;l=m,m=a}if(l.prev===m){let a=l;l=m,m=a}for(let a=0,P=m.rings.length;a<P;a++){let E=m.rings[a],O=m.windings[a],B=l.rings.indexOf(E);B===-1?(l.rings.push(E),l.windings.push(O)):l.windings[B]+=O}m.rings=null,m.windings=null,m.consumedBy=l,m.leftSE.consumedBy=l.leftSE,m.rightSE.consumedBy=l.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{let i=this.prev.consumedBy||this.prev;this._beforeState=i.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;let i=this.beforeState();this._afterState={rings:i.rings.slice(0),windings:i.windings.slice(0),multiPolys:[]};let l=this._afterState.rings,m=this._afterState.windings,f=this._afterState.multiPolys;for(let E=0,O=this.rings.length;E<O;E++){let B=this.rings[E],W=this.windings[E],V=l.indexOf(B);V===-1?(l.push(B),m.push(W)):m[V]+=W}let a=[],P=[];for(let E=0,O=l.length;E<O;E++){if(m[E]===0)continue;let B=l[E],W=B.poly;if(P.indexOf(W)===-1)if(B.isExterior)a.push(W);else{P.indexOf(W)===-1&&P.push(W);let V=a.indexOf(B.poly);V!==-1&&a.splice(V,1)}}for(let E=0,O=a.length;E<O;E++){let B=a[E].multiPoly;f.indexOf(B)===-1&&f.push(B)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;let i=this.beforeState().multiPolys,l=this.afterState().multiPolys;switch(df.type){case"union":{let m=i.length===0,f=l.length===0;this._isInResult=m!==f;break}case"intersection":{let m,f;i.length<l.length?(m=i.length,f=l.length):(m=l.length,f=i.length),this._isInResult=f===df.numMultiPolys&&m<f;break}case"xor":{let m=Math.abs(i.length-l.length);this._isInResult=m%2===1;break}case"difference":{let m=f=>f.length===1&&f[0].isSubject;this._isInResult=m(i)!==m(l);break}}return this._isInResult}},yx=class{constructor(s,i,l){if(Ht(this,"poly"),Ht(this,"isExterior"),Ht(this,"segments"),Ht(this,"bbox"),!Array.isArray(s)||s.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=i,this.isExterior=l,this.segments=[],typeof s[0][0]!="number"||typeof s[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let m=dl.snap({x:new As(s[0][0]),y:new As(s[0][1])});this.bbox={ll:{x:m.x,y:m.y},ur:{x:m.x,y:m.y}};let f=m;for(let a=1,P=s.length;a<P;a++){if(typeof s[a][0]!="number"||typeof s[a][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let E=dl.snap({x:new As(s[a][0]),y:new As(s[a][1])});E.x.eq(f.x)&&E.y.eq(f.y)||(this.segments.push(pf.fromRing(f,E,this)),E.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=E.x),E.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=E.y),E.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=E.x),E.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=E.y),f=E)}(!m.x.eq(f.x)||!m.y.eq(f.y))&&this.segments.push(pf.fromRing(f,m,this))}getSweepEvents(){let s=[];for(let i=0,l=this.segments.length;i<l;i++){let m=this.segments[i];s.push(m.leftSE),s.push(m.rightSE)}return s}},GM=class{constructor(s,i){if(Ht(this,"multiPoly"),Ht(this,"exteriorRing"),Ht(this,"interiorRings"),Ht(this,"bbox"),!Array.isArray(s))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new yx(s[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let l=1,m=s.length;l<m;l++){let f=new yx(s[l],this,!1);f.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=f.bbox.ll.x),f.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=f.bbox.ll.y),f.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=f.bbox.ur.x),f.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=f.bbox.ur.y),this.interiorRings.push(f)}this.multiPoly=i}getSweepEvents(){let s=this.exteriorRing.getSweepEvents();for(let i=0,l=this.interiorRings.length;i<l;i++){let m=this.interiorRings[i].getSweepEvents();for(let f=0,a=m.length;f<a;f++)s.push(m[f])}return s}},vx=class{constructor(s,i){if(Ht(this,"isSubject"),Ht(this,"polys"),Ht(this,"bbox"),!Array.isArray(s))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof s[0][0][0]=="number"&&(s=[s])}catch{}this.polys=[],this.bbox={ll:{x:new As(Number.POSITIVE_INFINITY),y:new As(Number.POSITIVE_INFINITY)},ur:{x:new As(Number.NEGATIVE_INFINITY),y:new As(Number.NEGATIVE_INFINITY)}};for(let l=0,m=s.length;l<m;l++){let f=new GM(s[l],this);f.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=f.bbox.ll.x),f.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=f.bbox.ll.y),f.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=f.bbox.ur.x),f.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=f.bbox.ur.y),this.polys.push(f)}this.isSubject=i}getSweepEvents(){let s=[];for(let i=0,l=this.polys.length;i<l;i++){let m=this.polys[i].getSweepEvents();for(let f=0,a=m.length;f<a;f++)s.push(m[f])}return s}},qM=(s,...i)=>df.run("union",s,i),WM=(s,...i)=>df.run("difference",s,i);dl.set;function HM(s,i={}){let l=[];if(o_(s,f=>{l.push(f.coordinates)}),l.length<2)throw new Error("Must have at least 2 geometries");let m=qM(l[0],...l.slice(1));return m.length===0?null:m.length===1?r_(m[0],i.properties):zx(m,i.properties)}var Zx=HM;function KM(s){let i=[];if(o_(s,f=>{i.push(f.coordinates)}),i.length<2)throw new Error("Must have at least two features");let l=s.features[0].properties||{},m=WM(i[0],...i.slice(1));return m.length===0?null:m.length===1?r_(m[0],l):zx(m,l)}var XM=KM;function YM(s){if(!s)throw new Error("geojson is required");var i=[];return SM(s,function(l){i.push(l)}),vd(i)}var JM=YM;function xx(s,i){let l=XM(vd([r_([[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]),s]));if(!l)return;l.properties={isMask:!0};let m=_d(Jg(s)),f=(m[2]-m[0])/360/1e3,a=m[0]<-180,P=m[2]>180,E=JM(s);if(E.features.length>1&&(a||P))for(let O of E.features){let B=_d(Jg(O));if(P&&B[0]<-180+f)for(let W of O.geometry.coordinates)for(let V of W)V[0]+=360-f;if(a&&B[2]>180-f)for(let W of O.geometry.coordinates)for(let V of W)V[0]-=360-f}i(vd([E.features.length<2?s:Zx(E)??s,l]))}var bx=s=>{var i,l,m;let f=(i=s?.geometry)==null?void 0:i.type,a=(l=s?.properties)!=null&&l.isMask?0:f==="LineString"||f==="MultiLineString"?3:2;return{color:"#3170fe",fillColor:"#000",fillOpacity:(m=s?.properties)!=null&&m.isMask?.1:0,weight:a,dashArray:[a,a],lineCap:"butt"}};function QM(s,i=!0,l=!0,m={},f={},a=bx){let P,E=[],O,B,W=Rr.geoJSON(void 0,{style:a===!0?bx:a===!1?void 0:a??void 0,interactive:!1}).addTo(s),V=ue=>{P?.({type:"mapClick",coordinates:[ue.latlng.lng,ue.latlng.lat]})};function he(ue,be=!1){let ze=document.createElement("div");return new Kg({props:{displayIn:"leaflet"},target:ze}),new Rr.Marker(ue,{interactive:be,icon:new Rr.DivIcon({html:ze,className:"",iconAnchor:[12,26],iconSize:[25,30],tooltipAnchor:[1,-24]})})}return{setEventHandler(ue){ue?(P=ue,s.on("click",V)):(P=void 0,s.off("click",V))},flyTo(ue,be){s.flyTo([ue[1],ue[0]],be,ai({duration:2},m))},fitBounds(ue,be,ze){s.flyToBounds([[ue[1],ue[0]],[ue[3],ue[2]]],ai(ai({padding:[be,be],duration:2},ze?{maxZoom:ze}:{}),f))},indicateReverse(ue){s.getContainer().style.cursor=ue?"crosshair":""},setReverseMarker(ue){var be;if(!i)return;let ze=ue&&[ue[1],ue[0]];B?ze?B.setLatLng(ze):(B.remove(),B=void 0):ze&&(i instanceof Function?B=i(s)??void 0:(B=(typeof i=="object"?new Rr.Marker(ze,i):he(ze)).addTo(s),(be=B.getElement())==null||be.classList.add("marker-reverse")))},setFeatures(ue,be,ze){function Xe(Ve){W.clearLayers(),Ve&&W.addData(Ve)}for(let Ve of E)Ve.remove();E.length=0,Xe();e:if(be){let Ve=!1;if(be.geometry.type==="GeometryCollection"){let Se=be.geometry.geometries.filter(nt=>nt.type==="Polygon"||nt.type==="MultiPolygon");t:if(Se.length>0){let nt=Zx(vd(Se.map(pt=>yd(pt))));if(!nt)break t;xx(Po(ai({},be),{geometry:nt.geometry}),Xe),Ve=!0}else{let nt=be.geometry.geometries.filter(pt=>pt.type==="LineString"||pt.type==="MultiLineString");nt.length>0&&(Xe(Po(ai({},be),{geometry:{type:"GeometryCollection",geometries:nt}})),Ve=!0)}}if(!Ve){if(be.geometry.type==="Polygon"||be.geometry.type==="MultiPolygon")xx(be,Se=>{if(!Se)return;let nt=[...Se.features],pt=_d(Jg(be)),Pt=pt[2]-pt[0];pt[0]-Pt/4<-180&&nt.push(...wx(Se,-360).features),pt[2]+Pt/4>180&&nt.push(...wx(Se,360).features),Xe(vd(nt))});else if(be.geometry.type==="LineString"||be.geometry.type==="MultiLineString"){Xe(be);break e}}if(!ze&&!be.geometry.type.endsWith("Point"))break e;if(i instanceof Function){let Se=i(s,be);Se&&E.push(Se.addTo(s))}else if(i){let Se=[be.center[1],be.center[0]];E.push(typeof i=="object"?new Rr.Marker(Se,i):he(Se).addTo(s))}}if(l)for(let Ve of ue??[]){if(Ve===be)continue;let Se=[Ve.center[1],Ve.center[0]],nt;if(l instanceof Function){if(nt=l(s,Ve),!nt)continue}else nt=(typeof l=="object"?new Rr.Marker(Se,l):he(Se,!0)).addTo(s).bindTooltip(Ve.place_type[0]==="reverse"?Ve.place_name:Ve.place_name.replace(/,.*/,""),{direction:"top"});let pt=nt.getElement();pt&&(pt.addEventListener("click",Pt=>{Pt.stopPropagation(),P?.({type:"markerClick",id:Ve.id})}),pt.addEventListener("mouseenter",()=>{P?.({type:"markerMouseEnter",id:Ve.id})}),pt.addEventListener("mouseleave",()=>{P?.({type:"markerMouseLeave",id:Ve.id})}),pt.classList.toggle("marker-fuzzy",!!Ve.matching_text)),E.push(nt)}},setSelectedMarker(ue){var be,ze;O&&((be=O.getElement())==null||be.classList.toggle("marker-selected",!1)),O=ue>-1?E[ue]:void 0,(ze=O?.getElement())==null||ze.classList.toggle("marker-selected",!0)},getCenterAndZoom(){let ue=s.getCenter();return[s.getZoom(),ue.lng,ue.lat]}}}function wx(s,i){let l=IM(s);for(let m of l.features)if(m.geometry.type=="MultiPolygon")for(let f of m.geometry.coordinates)Tx(f,i);else Tx(m.geometry.coordinates,i);return l}function Tx(s,i){for(let l of s)for(let m of l)m[0]+=i}var ff=class extends Rr.Control{};Rr.Util.extend(ff.prototype,Rr.Evented.prototype);var _a,Ju,xd=class extends ff{constructor(i){super(i),W1(this,_a),W1(this,Ju),H1(this,Ju,i)}onAdd(i){let l=document.createElement("div");l.className="leaflet-ctrl-geocoder",Rr.DomEvent.disableClickPropagation(l),Rr.DomEvent.disableScrollPropagation(l);let he=da(this,Ju),{marker:m,showResultMarkers:f,flyTo:a,fullGeometryStyle:P,position:E}=he,O=fm(he,["marker","showResultMarkers","flyTo","fullGeometryStyle","position"]),B=typeof a=="boolean"?{}:a,W=QM(i,m,f,B,B,P);H1(this,_a,new TM({target:l,props:ai({mapController:W,flyTo:a===void 0?!0:!!a},O)}));let V={select:void 0,pick:void 0,featureslisted:void 0,featuresmarked:void 0,response:void 0,optionsvisibilitychange:void 0,reversetoggle:void 0,querychange:void 0};for(let ue in V)da(this,_a).$on(ue,be=>this.fire(ue,be.detail));return l}setOptions(i){var l;Object.assign(da(this,Ju),i);let O=da(this,Ju),{marker:m,showResultMarkers:f,flyTo:a,fullGeometryStyle:P}=O,E=fm(O,["marker","showResultMarkers","flyTo","fullGeometryStyle"]);(l=da(this,_a))==null||l.$set(E)}setQuery(i,l=!0){var m;(m=da(this,_a))==null||m.setQuery(i,l)}clearMap(){var i;(i=da(this,_a))==null||i.clearMap()}clearList(){var i;(i=da(this,_a))==null||i.clearList()}setReverseMode(i){var l;(l=da(this,_a))==null||l.$set({reverseActive:i})}focus(i){var l;(l=da(this,_a))==null||l.focus(i)}blur(){var i;(i=da(this,_a))==null||i.blur()}onRemove(){var i;(i=da(this,_a))==null||i.$destroy()}};_a=new WeakMap,Ju=new WeakMap;function eC(...s){return new xd(...s)}window.L&&typeof window.L=="object"&&typeof window.L.control=="function"&&(window.L.control.maptilerGeocoding=eC);var Vx=(()=>{class s{constructor(l){this.feature=il(),this.journeyData=e0(()=>new o0(""+this.feature()?.id,this.feature()?.properties?.name??"",this.feature()?.properties?.title??"",this.feature()?.properties?.category??r0,this.feature()?.properties?.journeyDate??"",this.feature()?.properties?.tags??[],this.feature()?.properties?.thumbnail??n0)),this.elementRef=l}static{this.\u0275fac=function(m){return new(m||s)(Ky(Qd))}}static{this.\u0275cmp=ep({type:s,selectors:[["app-marker-popup"]],inputs:{feature:[1,"feature"]},decls:1,vars:1,consts:[[3,"journey"]],template:function(m,f){m&1&&ip(0,"app-journey-card-view",0),m&2&&tp("journey",f.journeyData())},dependencies:[a0],styles:[".leaflet-popup-content{min-width:15rem!important}"],changeDetection:0})}}return s})();var ya=Ec(Ru()),iC=["default","adventure","shopping","funny","park","restaurant","home","flight","temple","favorite","love"],nC=ya.divIcon({className:"custom-div-icon",html:"<div class='marker-icon-wrapper'><div class='marker-pin'></div><i class='material-icons text-app-blue fs-5'>home</i></div>",iconSize:[30,42],iconAnchor:[15,42],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]}),rC=ya.divIcon({className:"custom-div-icon",html:"<div class='marker-icon-wrapper'><div class='marker-pin'></div><i class='material-icons text-app-blue fs-5'>flight</i></div>",iconSize:[30,42],iconAnchor:[15,42],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]}),oC=ya.divIcon({className:"custom-div-icon",html:"<div class='marker-icon-wrapper'><div class='marker-pin'></div><i class='material-icons text-app-blue fs-5'>restaurant</i></div>",iconSize:[30,42],iconAnchor:[15,42],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]}),aC=ya.divIcon({className:"custom-div-icon",html:"<div class='marker-icon-wrapper'><div class='marker-pin'></div><i class='material-icons small text-app-blue fs-5'>temple_hindu</i></div>",iconSize:[30,42],iconAnchor:[15,42],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]}),sC=ya.divIcon({className:"custom-div-icon",html:"<div class='marker-icon-wrapper'><div class='marker-pin'></div><i class='material-icons text-app-blue fs-5'>explore</i></div>",iconSize:[30,42],iconAnchor:[15,42],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]}),lC=ya.divIcon({className:"custom-div-icon",html:"<div class='marker-icon-wrapper'><div class='marker-pin'></div><i class='material-icons text-success fs-5'>park</i></div>",iconSize:[30,42],iconAnchor:[15,42],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]}),cC=ya.divIcon({className:"custom-div-icon",html:"<div class='marker-icon-wrapper'><div class='marker-pin'></div><i class='material-icons text-app-blue fs-5'>star</i></div>",iconSize:[30,42],iconAnchor:[15,42],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]}),uC=ya.divIcon({className:"custom-div-icon",html:"<div class='marker-icon-wrapper'><div class='marker-pin'></div><i class='material-icons text-danger fs-5'>favorite</i></div>",iconSize:[30,42],iconAnchor:[15,42],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]}),hC=ya.divIcon({className:"custom-div-icon",html:"<div class='marker-icon-wrapper'><div class='marker-pin'></div><i class='material-icons text-app-blue fs-5'>local_mall</i></div>",iconSize:[30,42],iconAnchor:[15,42],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]}),dC=ya.divIcon({className:"custom-div-icon",html:"<div class='marker-icon-wrapper'><div class='marker-pin'></div><i class='material-icons text-info fs-5'>mood</i></div>",iconSize:[30,42],iconAnchor:[15,42],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]}),mf=ya.divIcon({className:"custom-div-icon",html:"<div class='marker-icon-wrapper'><div class='marker-pin'></div><i class='material-icons text-app-blue fs-5'>location_on</i></div>",iconSize:[30,42],iconAnchor:[15,42],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]});function qx(s,i="default"){return s?.properties?.icon?Gx(s?.properties?.icon):i?Gx(i):mf}function Gx(s){if(iC.indexOf(s)==-1)return mf;switch(s){case"default":return mf;case"favorite":return cC;case"love":return uC;case"home":return nC;case"restaurant":return oC;case"flight":return rC;case"temple":return aC;case"adventure":return sC;case"park":return lC;case"shopping":return hC;case"funny":return dC;default:return mf}}var gf=class{constructor(i,l,m=[]){this.place_name=i,this.geometry=l,this.context=m,this.name=this.place_name,this.location=this.geometry?.type==="Point"?this.geometry:void 0,this.area=this.geometry?.type==="MultiPolygon"?this.geometry:void 0,this.state=this.context.find(f=>f.kind==="admin_area"&&f.id?.startsWith("region"))?.text,this.country=this.context.find(f=>f.kind==="admin_area"&&f.id?.startsWith("country"))?.text}};var pC=["markerPopupViewContainer"],fC=Co.icon({iconRetinaUrl:"assets/marker-icon-2x.png",iconUrl:"assets/marker-icon.png",shadowUrl:"assets/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]});Co.Marker.prototype.options.icon=fC;var nL=(()=>{class s{constructor(){this.elementRef=mm(Qd),this.themeService=mm(i0),this.geoJsonData=il(void 0),this.markerPopupViewContainerRef=Xy.required("markerPopupViewContainer",{read:_m}),this.enablePopup=il(!1),this.zoomIn=il(4),this.maxZoom=il(10),this.iconType=il("default"),this.enableGeoCoding=il(!1),this.location=gm(),this.area=gm(),Wy(xm(this.geoJsonData),xm(this.iconType)).pipe(t0()).subscribe({next:l=>{this.addGeoJsonData(this.geoJsonData())}})}ngAfterViewInit(){this.initializeMap()}initializeMap(){this.map=Co.map(this.elementRef.nativeElement.querySelector("div.map-renderer"),{fullscreenControl:!0,forceSeparateButton:!0,fullscreenControlOptions:{position:"topleft"}}).fitWorld().zoomIn(this.zoomIn()),Co.control.scale().addTo(this.map),new q1({apiKey:Fh.maptilerKey,style:this.themeService.isDarkMode()?`https://api.maptiler.com/maps/d5592658-7af1-476b-bb9d-483a28703d79/style.json?key=${Fh.maptilerKey}`:""}).addTo(this.map),this.enableGeoCoding()&&this.enableGeoCodingSearch(),this.addTileLayers(),this.addGeoJsonLayer()}enableGeoCodingSearch(){if(this.map){let l=new xd({apiKey:Fh.maptilerKey,class:"text-primary",debounceSearch:1e3,language:"en",markerOnSelected:!1,marker:!1});this.map.addControl(l),l.on("pick",m=>{this.emitGeoCodingData(new gf(m.feature.place_name,m.feature.geometry,m.feature.context))})}}emitGeoCodingData(l){l.location!=null?this.location.emit({name:l.name,location:l.location,state:l.state,country:l.country}):l.area!=null?this.area.emit({area:l.area,name:l.name}):console.log("No Area and location detected:",l)}addTileLayers(){this.map&&Co.tileLayer(`https://api.maptiler.com/maps/streets-v2/style.json?key=${Fh.maptilerKey}`,{tileSize:512,zoomOffset:-1,minZoom:2,maxZoom:19,crossOrigin:!0,attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(this.map)}addGeoJsonData(l){this.geoJsonLayer&&this.geoJsonLayer?.clearLayers(),l&&(this.geoJsonLayer?.addData(l),this.geoJsonLayer?.setZIndex(this.zoomIn()),setTimeout(()=>this.flyToBound(),1e3))}flyToBound(){let l=this.geoJsonLayer?.getBounds();l&&this.map?.flyToBounds(l,{maxZoom:this.maxZoom(),paddingTopLeft:[25,25]})}addGeoJsonLayer(){let l=m=>{let f=this.markerPopupViewContainerRef().createComponent(Vx);return f.setInput("feature",m),f?.instance.elementRef.nativeElement};if(this.map){let m=this.enablePopup();this.geoJsonLayer=Co.geoJSON(this.geoJsonData(),{pointToLayer:(f,a)=>Co.marker(a,{icon:qx(f,this.iconType())}),onEachFeature:function(f,a){m&&a.bindPopup(l(f));let P=f.properties?.name;P&&a.bindTooltip(P)}}).addTo(this.map)}else console.warn("Unable to create GeoJson Layer. Cause:Map is not yet initialised")}static{this.\u0275fac=function(m){return new(m||s)}}static{this.\u0275cmp=ep({type:s,selectors:[["app-world-map"]],viewQuery:function(m,f){m&1&&Jy(f.markerPopupViewContainerRef,pC,5,_m),m&2&&Qy()},inputs:{geoJsonData:[1,"geoJsonData"],enablePopup:[1,"enablePopup"],zoomIn:[1,"zoomIn"],maxZoom:[1,"maxZoom"],iconType:[1,"iconType"],enableGeoCoding:[1,"enableGeoCoding"]},outputs:{location:"location",area:"area"},decls:6,vars:1,consts:[["markerPopupViewContainer",""],[1,"map-container","h-full","w-full"],[1,"border-2","border-primary","w-full","h-full","relative"],["id","map",1,"map-renderer","h-full","w-full"],[3,"hidden"]],template:function(m,f){m&1&&(ym(0,"div",1)(1,"div",2),ip(2,"div",3),vm(),ym(3,"div",4),Yy(4,null,0),vm()()),m&2&&(Hy(3),tp("hidden",!0))},encapsulation:2,changeDetection:0})}}return s})();export{iC as a,nL as b};
