import{a as Gt,b as at,c as st,d as Ht,e as Qt,f as lt}from"./chunk-XSH6NE7B.js";import{a as Lt}from"./chunk-2F4AARJE.js";import"./chunk-F5X5MWHG.js";import{a as P,b as Z}from"./chunk-MD5F3S5N.js";import"./chunk-XX4IC5FV.js";import{a as nt}from"./chunk-IPPV37HB.js";import{a as Et,b as Mt}from"./chunk-ZXPU4FUU.js";import{p as wt}from"./chunk-YFHJRQYX.js";import{a as ot,c as rt,d as Yt,f as Bt}from"./chunk-BPZMZBLQ.js";import{a as R}from"./chunk-3HSBMUEW.js";import{b as et,c as it}from"./chunk-FTDHHZAN.js";import{a as W,b as J,c as jt,f as X,g as tt}from"./chunk-33QQ45UH.js";import"./chunk-I26XFCYJ.js";import"./chunk-QLQOFAIY.js";import{a as qt}from"./chunk-JRATTFTI.js";import"./chunk-KH7BRNI5.js";import"./chunk-CFUYXJ76.js";import"./chunk-L6DJFSIC.js";import{b as G,g as H,h as Tt,i as kt,j as Q,k as At,p as $,r as Dt,s as It,t as z,u as K}from"./chunk-WYEMPCIW.js";import"./chunk-R6IJEX4T.js";import{a as x,c as L}from"./chunk-DNEPPB4M.js";import{a as Rt,b as Vt,d as Nt,f as Ft,g as Ot,k as Ut}from"./chunk-R7RXGC3S.js";import{b as O,c as T}from"./chunk-UJZZXKND.js";import{a as A,b as D}from"./chunk-3SCI6QDE.js";import{g as Pt,h as y,k as I}from"./chunk-DPXNYG4I.js";import"./chunk-TS6BF4HD.js";import"./chunk-CGJVCASA.js";import{h as w,q as B}from"./chunk-T257ZYH5.js";import{$c as M,Aa as k,Cb as u,Ea as ft,Ic as U,Lc as q,Ma as gt,Nc as Y,Rb as S,Sb as C,Tc as St,Ub as vt,Vb as yt,Wb as c,Xb as n,Yb as e,Yc as Ct,Zb as E,bc as v,gb as _t,gc as f,ic as p,kb as l,m as ut,oa as m,ob as xt,sc as F,ua as g,va as _,wb as h,xc as o,yb as ht,yc as V,zc as bt}from"./chunk-BQWC7YH4.js";function oe(t,i){if(t&1&&E(0,"img",10),t&2){let s,r=p();c("src","data:image/png;base64,"+((s=r.qrCodeData())==null?null:s.data),_t)}}function re(t,i){t&1&&E(0,"mat-spinner",11)}function ae(t,i){t&1&&(n(0,"mat-error")(1,"p"),o(2,"Enter a valid 6-digit code."),e()())}var $t=(()=>{let i=class i{constructor(){this.destroyRef=m(k),this.dialogRef=m(ot),this.myAccountService=m(R),this.notificationService=m(nt),this.qrCodeData=L(this.myAccountService.generateNewQRCode())}activate(r){if(r.valid&&this.qrCodeData()?.secretKey){let a={secretKey:this.qrCodeData().secretKey,code:r.value};this.myAccountService.activateTotp(a).pipe(x(this.destroyRef)).subscribe({next:d=>this.onSuccess(),error:d=>this.notificationService.showError("Code Invalid")})}}onSuccess(){this.notificationService.showSuccess("2FA activated successfully"),this.dialogRef.close(!0)}cancelActivation(){this.dialogRef.close(!1)}};i.\u0275fac=function(a){return new(a||i)},i.\u0275cmp=h({type:i,selectors:[["app-totp-activation"]],decls:66,vars:3,consts:[["totpCode","ngModel"],[1,"card","border","rounded-lg","shadow-md","pb-4"],[1,"card-header","text-lg","fw-bold","p-5","bg-primary-text"],[1,"card-body"],["expanded",""],[1,"text-sm"],["href","https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2&hl=en","target","_blank",1,"text-primary","font-bold","underline"],["href","https://www.microsoft.com/en-us/security/mobile-authenticator-app","target","_blank",1,"text-primary","font-bold","underline"],["href","https://authy.com/download/","target","_blank",1,"text-primary","font-bold","underline"],[1,"qr-code-section","flex","justify-center","items-center","mt-4"],["id","qrCode","alt","QR Code",1,"w-48","h-48",3,"src"],["diameter","40"],[1,"secret-key-section","text-center","mt-4"],[1,"font-medium","text-primary","text-sm"],[1,"mt-3"],[1,"w-full"],["matInput","","type","text","inputmode","number","id","totpCode","name","totpCode","aria-label","6 Digit TOTP Code","aria-describedby","totpCodeLabel","autocomplete","off","ngModel","","required","","pattern","[0-9]{6}","maxlength","6",1,"rounded-lg","w-full"],[4,"ngIf"],[1,"flex","gap-2","mt-4","justify-end"],["mat-flat-button","","type","button",3,"click"],["mat-stroked-button","","type","button",3,"click"]],template:function(a,d){if(a&1){let b=v();n(0,"div",1)(1,"div",2),o(2," Two-Factor Authentication (2FA) - TOTP Activation "),e(),n(3,"div",3)(4,"mat-expansion-panel",4)(5,"mat-expansion-panel-header")(6,"mat-panel-title"),o(7," Step 1: Install an Authenticator App "),e()(),n(8,"p"),o(9," To use 2FA, you will need an authenticator app installed on your mobile device. If you don\u2019t already have one, download one of these apps: "),e(),n(10,"ol",5)(11,"li")(12,"a",6),o(13,"Google Authenticator (iOS and Android)"),e()(),n(14,"li")(15,"a",7),o(16,"Microsoft Authenticator (iOS and Android)"),e()(),n(17,"li")(18,"a",8),o(19," Authy (iOS and Android)"),e()()()(),n(20,"mat-expansion-panel",4)(21,"mat-expansion-panel-header")(22,"mat-panel-title"),o(23," Step 2: Scan the QR Code "),e()(),n(24,"ol",5)(25,"li"),o(26,"Open your authenticator app."),e(),n(27,"li"),o(28,'Tap the "+" icon to add a new account.'),e(),n(29,"li"),o(30,"Select the option to scan a QR code."),e(),n(31,"li"),o(32,"Scan the QR code displayed below using your app."),e()(),n(33,"div",9),S(34,oe,1,1,"img",10)(35,re,1,0,"mat-spinner",11),e(),n(36,"div",12)(37,"p",13),o(38," Or enter the key manually: "),n(39,"strong"),o(40),e()()()(),n(41,"mat-expansion-panel",4)(42,"mat-expansion-panel-header")(43,"mat-panel-title"),o(44," Step 3: Confirm the Verification Code "),e()(),n(45,"ol",5)(46,"li"),o(47,"After scanning the QR code, your authenticator app will generate a 6-digit verification code."),e(),n(48,"li"),o(49,"Enter the 6-digit code in the field below to activate 2FA."),e(),n(50,"li"),o(51,'Click the "Activate" button to complete the process.'),e(),n(52,"li"),o(53,"You\u2019ll receive a confirmation message once 2FA is successfully activated."),e()(),n(54,"div",14)(55,"mat-form-field",15)(56,"mat-label"),o(57,"Code"),e(),E(58,"input",16,0),u(60,ae,3,0,"mat-error",17),e()(),n(61,"div",18)(62,"button",19),f("click",function(){g(b);let Xt=F(59);return _(d.activate(Xt))}),o(63,"Activate"),e(),n(64,"button",20),f("click",function(){return g(b),_(d.cancelActivation())}),o(65,"Cancel"),e()()()()()}if(a&2){let b,j=F(59);l(34),C(d.qrCodeData()?34:35),l(6),V((b=d.qrCodeData())==null?null:b.secretKey),l(20),c("ngIf",j.invalid&&j.touched)}},dependencies:[K,G,H,$,It,z,Q,Mt,Et,lt,at,st,Ht,I,y,w,tt,X,W,J,it,et],styles:[".card-body[_ngcontent-%COMP%]{max-height:90vh;overflow:scroll}mat-expansion-panel[_ngcontent-%COMP%]{margin:.5rem 0}"],changeDetection:0});let t=i;return t})();var ct=(()=>{let i=class i{constructor(){this.roles=Ct.required({alias:"appDisableIfNoRoleExists"}),this.el=m(gt),this.renderer=m(xt),this.authService=m(T)}ngOnInit(){this.checkRoleAndDisableIfRequired()}checkRoleAndDisableIfRequired(){this.authService.hasAnyRole(this.roles())?(this.renderer.setProperty(this.el.nativeElement,"disabled",!1),this.renderer.setAttribute(this.el.nativeElement,"disabled","false"),this.el.nativeElement.disabled=!1):(this.renderer.setProperty(this.el.nativeElement,"disabled",!0),this.renderer.setAttribute(this.el.nativeElement,"disabled","true"),this.el.nativeElement.disabled=!0)}};i.\u0275fac=function(a){return new(a||i)},i.\u0275dir=ht({type:i,selectors:[["","appDisableIfNoRoleExists",""]],inputs:{roles:[1,"appDisableIfNoRoleExists","roles"]}});let t=i;return t})();var mt=(()=>{let i=class i{constructor(){this.dialogRef=m(ot)}confirmAction(){this.dialogRef.close(!0)}};i.\u0275fac=function(a){return new(a||i)},i.\u0275cmp=h({type:i,selectors:[["app-confirmation-dialog"]],decls:17,vars:0,consts:[[1,"confirmation-card","shadow-lg","rounded-xl","border","border-primary"],[1,"text-primary"],[1,"!py-5"],[1,"text-sm","text-red-600","font-medium","mt-2"],["align","end",1,"gap-2","py-4"],["mat-flat-button","","type","button",3,"click"],["mat-stroked-button","","type","button","mat-dialog-close","false"]],template:function(a,d){a&1&&(n(0,"mat-card",0)(1,"mat-card-header")(2,"mat-card-title",1),o(3,"Confirmation Required"),e()(),n(4,"mat-card-content",2)(5,"p",1),o(6,"Are you sure you want to proceed with this action?"),e(),n(7,"p",3),o(8," This action "),n(9,"strong"),o(10,"cannot be undone"),e(),o(11,". "),e()(),n(12,"mat-card-actions",4)(13,"button",5),f("click",function(){return d.confirmAction()}),o(14,"Confirm"),e(),n(15,"button",6),o(16,"Cancel"),e()()())},dependencies:[Yt,y,Ut,Rt,Ft,Nt,Ot,Vt],encapsulation:2,changeDetection:0});let t=i;return t})();var zt=t=>[t];function le(t,i){t&1&&(n(0,"span",4)(1,"mat-icon"),o(2,"check_circle"),e(),o(3," Activated "),e())}function ce(t,i){t&1&&(n(0,"span",5)(1,"mat-icon"),o(2,"error"),e(),o(3," Not Activated "),e())}function me(t,i){if(t&1){let s=v();n(0,"button",11),f("click",function(){g(s);let a=p(3);return _(a.setupTotp())}),o(1," Activate "),e()}}function de(t,i){t&1&&(n(0,"div")(1,"p",12),o(2,"You do have access to activate/deactivate TOTP for the account."),e()())}function pe(t,i){if(t&1&&(n(0,"div",8),u(1,me,2,0,"button",9)(2,de,3,0,"div",10),e()),t&2){let s=p(2);l(),c("ngIf",s.authService.hasAuthenticatedRole()),l(),c("ngIf",!s.authService.hasAuthenticatedRole())}}function ue(t,i){if(t&1){let s=v();n(0,"div",13)(1,"button",14),f("click",function(){g(s);let a=p(2);return _(a.confirmTotpDeactivation())}),o(2," Deactivate "),e(),n(3,"button",15),f("click",function(){g(s);let a=p(2);return _(a.testCode())}),o(4," Test "),e()()}if(t&2){let s=p(2);l(),c("appDisableIfNoRoleExists",U(2,zt,s.Role.AUTHENTICATED_USER)),l(2),c("appDisableIfNoRoleExists",U(4,zt,s.Role.AUTHENTICATED_USER))}}function fe(t,i){if(t&1&&(n(0,"section",1)(1,"div",2)(2,"h4",3),o(3,"Authenticator TOTP"),e(),n(4,"div"),S(5,le,4,0,"span",4)(6,ce,4,0,"span",5),e()(),u(7,pe,3,2,"div",6)(8,ue,5,6,"div",7),e()),t&2){let s=p();l(5),C(s.isTotpActive()?5:6),l(2),c("ngIf",!s.isTotpActive()),l(),c("ngIf",s.isTotpActive())}}var Kt=(()=>{let i=class i{constructor(){this.destroyRef=m(k),this.dialog=m(rt),this.myAccountService=m(R),this.authService=m(T),this.isTotpActive=M(!1),this.isLoadingCompleted=M(!1),this.Role=O}setupTotp(){this.dialog.open($t,{disableClose:!0}).afterClosed().pipe(x(this.destroyRef)).subscribe(a=>{this.getCurrentTotpStatus()})}ngOnInit(){this.getCurrentTotpStatus()}getCurrentTotpStatus(){this.myAccountService.getTotpStatus().pipe(x(this.destroyRef)).subscribe({next:r=>{this.isTotpActive.set(r.active),this.isLoadingCompleted.set(!0)},error:r=>{console.log(r),this.isLoadingCompleted.set(!0)}})}testCode(){this.dialog.open(Bt,{disableClose:!0}).afterClosed().pipe(x(this.destroyRef)).subscribe(a=>{console.log("Result:",a)})}confirmTotpDeactivation(){this.dialog.open(mt,{disableClose:!0}).afterClosed().pipe(x(this.destroyRef)).subscribe(a=>{a===!0&&this.deactivateTotp()})}deactivateTotp(){this.myAccountService.deactivateTotp().pipe(x(this.destroyRef)).subscribe({next:r=>this.getCurrentTotpStatus(),error:r=>console.log(r)})}};i.\u0275fac=function(a){return new(a||i)},i.\u0275cmp=h({type:i,selectors:[["app-my-totp-settings"]],inputs:{isTotpActive:[1,"isTotpActive"],isLoadingCompleted:[1,"isLoadingCompleted"]},outputs:{isTotpActive:"isTotpActiveChange",isLoadingCompleted:"isLoadingCompletedChange"},decls:1,vars:1,consts:[["class","container mx-auto mt-4 p-6 border border-black/50 dark:border-white/50 rounded-lg shadow-lg flex flex-col",4,"ngIf"],[1,"container","mx-auto","mt-4","p-6","border","border-black/50","dark:border-white/50","rounded-lg","shadow-lg","flex","flex-col"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-primary","text-lg","font-bold"],["matTooltip","Activated",1,"text-success","flex","items-center","gap-1","text-sm"],["matTooltip","Not Activated",1,"text-danger","flex","items-center","gap-1","text-sm"],["class","flex justify-start",4,"ngIf"],["class","flex gap-2 mt-4",4,"ngIf"],[1,"flex","justify-start"],["mat-flat-button","","type","button",3,"click",4,"ngIf"],[4,"ngIf"],["mat-flat-button","","type","button",3,"click"],[1,"text-sm","text-primary","italic"],[1,"flex","gap-2","mt-4"],["mat-button","","type","button",3,"click","appDisableIfNoRoleExists"],["mat-stroked-button","","type","button",3,"click","appDisableIfNoRoleExists"]],template:function(a,d){a&1&&u(0,fe,9,3,"section",0),a&2&&c("ngIf",d.isLoadingCompleted())},dependencies:[w,ct,Z,P,D,A,I,y],encapsulation:2,changeDetection:0});let t=i;return t})();var ge=t=>[t];function _e(t,i){t&1&&(n(0,"span",5)(1,"mat-icon"),o(2,"check_circle"),e(),o(3," Activated "),e())}function xe(t,i){t&1&&(n(0,"span",6)(1,"mat-icon"),o(2,"error"),e(),o(3," Not Activated "),e())}function he(t,i){t&1&&(n(0,"div",9)(1,"p",10),o(2," Multi-Factor Authentication activation requires one of the following security measures to be enabled or verified: "),e(),n(3,"ul",11)(4,"li"),o(5,"Email Address"),e(),n(6,"li"),o(7,"TOTP (Time-Based One-Time Password)"),e()()())}function ve(t,i){if(t&1){let s=v();n(0,"button",16),f("click",function(){g(s);let a=p(3);return _(a.enableMfa())}),o(1," Activate "),e()}}function ye(t,i){t&1&&(n(0,"div")(1,"p",17),o(2,"You do have access to activate/deactivate Multi-Factor authentication for the account."),e()())}function be(t,i){t&1&&(n(0,"p",18),o(1," Unable to activate MFA. Please check prerequisite conditions before activating MFA. "),e())}function Se(t,i){if(t&1&&(n(0,"div",12),u(1,ve,2,0,"button",13)(2,ye,3,0,"div",14)(3,be,2,0,"p",15),e()),t&2){let s=p(2);l(),c("ngIf",s.authService.hasAuthenticatedRole()),l(),c("ngIf",!s.authService.hasAuthenticatedRole()),l(),c("ngIf",s.isErrorOccurred())}}function Ce(t,i){t&1&&(n(0,"p",18),o(1," Unable to deactivate MFA. Please try again later. "),e())}function Ee(t,i){if(t&1){let s=v();n(0,"div",12)(1,"div",19)(2,"button",20),f("click",function(){g(s);let a=p(2);return _(a.confirmMfaDeactivation())}),o(3,"Deactivate "),e()(),u(4,Ce,2,0,"p",15),e()}if(t&2){let s=p(2);l(2),c("appDisableIfNoRoleExists",U(2,ge,s.Role.AUTHENTICATED_USER)),l(2),c("ngIf",s.isErrorOccurred())}}function Me(t,i){if(t&1&&(n(0,"section",1)(1,"div",2)(2,"h4",3),o(3,"Multi-Factor Authentication"),e(),n(4,"div",4),S(5,_e,4,0,"span",5)(6,xe,4,0,"span",6),e()(),u(7,he,8,0,"div",7)(8,Se,4,3,"div",8)(9,Ee,5,4,"div",8),e()),t&2){let s,r,a,d,b=p();l(5),C((s=b.userData())!=null&&s.mfaEnabled?5:6),l(2),c("ngIf",!((r=b.userData())!=null&&r.mfaEnabled)),l(),c("ngIf",!((a=b.userData())!=null&&a.mfaEnabled)),l(),c("ngIf",(d=b.userData())==null?null:d.mfaEnabled)}}var Zt=(()=>{let i=class i{constructor(){this.Role=O,this.destroyRef=m(k),this.dialog=m(rt),this.myAccountService=m(R),this.authService=m(T),this.userData=M(),this.isErrorOccurred=M(!0)}ngOnInit(){this.fetchCurrentUserData()}fetchCurrentUserData(){this.myAccountService.getProfileData().pipe(x(this.destroyRef)).subscribe({next:r=>{this.userData.set(r),this.isErrorOccurred.set(!1)},error:r=>console.log(r)})}enableMfa(){this.changeMfa(!0)}confirmMfaDeactivation(){this.dialog.open(mt,{disableClose:!0}).afterClosed().pipe(x(this.destroyRef)).subscribe(a=>{a===!0&&this.changeMfa(!1)})}changeMfa(r){this.myAccountService.changeMfaStatus(r).pipe(x(this.destroyRef)).subscribe({next:a=>this.fetchCurrentUserData(),error:a=>{console.log(a),this.isErrorOccurred.set(!0)}})}};i.\u0275fac=function(a){return new(a||i)},i.\u0275cmp=h({type:i,selectors:[["app-my-mfa-settings"]],inputs:{userData:[1,"userData"],isErrorOccurred:[1,"isErrorOccurred"]},outputs:{userData:"userDataChange",isErrorOccurred:"isErrorOccurredChange"},decls:1,vars:1,consts:[["class","container mx-auto mt-4 p-6 border border-black/50 dark:border-white/50 rounded-lg shadow-lg flex flex-col",4,"ngIf"],[1,"container","mx-auto","mt-4","p-6","border","border-black/50","dark:border-white/50","rounded-lg","shadow-lg","flex","flex-col"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-primary","text-lg","font-bold"],[1,"status-badge","flex","items-center","ml-3"],["matTooltip","Activated",1,"text-success","flex","items-center","gap-1","text-sm"],["matTooltip","Not Activated",1,"text-danger","flex","items-center","gap-1","text-sm"],["class","text-primary text-sm font-medium mb-4",4,"ngIf"],["class","flex flex-col",4,"ngIf"],[1,"text-primary","text-sm","font-medium","mb-4"],[1,"mb-2"],[1,"list-disc","pl-5"],[1,"flex","flex-col"],["mat-flat-button","","type","button","class","w-max",3,"click",4,"ngIf"],[4,"ngIf"],["class","text-danger text-sm font-bold mt-2",4,"ngIf"],["mat-flat-button","","type","button",1,"w-max",3,"click"],[1,"text-sm","text-primary","italic"],[1,"text-danger","text-sm","font-bold","mt-2"],[1,"flex","gap-2"],["mat-button","","type","button",1,"w-max",3,"click","appDisableIfNoRoleExists"]],template:function(a,d){a&1&&u(0,Me,10,4,"section",0),a&2&&c("ngIf",d.userData())},dependencies:[w,ct,P,D,A,I,y],encapsulation:2,changeDetection:0});let t=i;return t})();function we(t,i){t&1&&(n(0,"span",6)(1,"mat-icon"),o(2,"check_circle"),e(),o(3," Compliant "),e())}function Te(t,i){t&1&&(n(0,"span",7)(1,"mat-icon"),o(2,"error"),e(),o(3," Non-Compliant "),e())}function ke(t,i){if(t&1&&(n(0,"p"),o(1," Current Password Changed at "),n(2,"span",10),o(3),q(4,"date"),e()()),t&2){let s,r=p(2);l(3),bt(" ",Y(4,1,(s=r.userData())==null?null:s.passwordChangedAt,"dd.MM.YYYY, h:mm:ss a z")," ")}}function Ae(t,i){if(t&1){let s=v();n(0,"button",12),f("click",function(){g(s);let a=p(3);return _(a.editMode.set(!0))}),o(1," Change Password "),e()}}function De(t,i){t&1&&(n(0,"div")(1,"p",13),o(2,"You do have access to change password for the account."),e()())}function Ie(t,i){if(t&1&&(n(0,"div"),u(1,Ae,2,0,"button",11)(2,De,3,0,"div",9),e()),t&2){let s=p(2);l(),c("ngIf",s.authService.hasAuthenticatedRole()),l(),c("ngIf",!s.authService.hasAuthenticatedRole())}}function Pe(t,i){t&1&&(n(0,"mat-error"),o(1," Password must be 8-50 characters long, include uppercase, lowercase, number, and special character. "),e())}function Re(t,i){t&1&&(n(0,"div",24),o(1," Invalid Password. Valid Password should contain at least one lowercase letter, one uppercase letter, one digit, one special character, and be 8 to 50 characters long. "),e())}function Ve(t,i){if(t&1){let s=v();n(0,"div")(1,"form",14),f("ngSubmit",function(){g(s);let a=F(9),d=p(2);return _(d.savePassword(a))}),E(2,"input",15,0),n(4,"div",16)(5,"mat-form-field",17)(6,"mat-label"),o(7,"New Password"),e(),E(8,"input",18,1),n(10,"button",19),f("click",function(){g(s);let a=p(2);return _(a.togglePasswordVisibility())}),n(11,"mat-icon"),o(12),e()(),u(13,Pe,2,0,"mat-error",9),e()(),u(14,Re,2,0,"div",20),n(15,"div",21)(16,"button",22),f("click",function(){g(s);let a=p(2);return _(a.editMode.set(!1))}),o(17,"Cancel"),e(),n(18,"button",23),o(19,"Save"),e()()()()}if(t&2){let s=F(9),r=p(2);l(2),c("hidden",!0)("ngModel",r.userData().username),l(6),c("type",r.showPassword()?"text":"password"),l(4),V(r.showPassword()?"visibility_off":"visibility"),l(),c("ngIf",s.invalid&&s.touched),l(),c("ngIf",r.isErrorOccurred()),l(4),c("disabled",s.invalid)}}function Ne(t,i){if(t&1&&(n(0,"section",3)(1,"div",4)(2,"h4",5),o(3,"Password"),e(),n(4,"div"),S(5,we,4,0,"span",6)(6,Te,4,0,"span",7),e()(),n(7,"div",8)(8,"p"),o(9,"We recommend changing your password at least every 3 months to enhance the security of your account."),e(),u(10,ke,5,4,"p",9),e(),u(11,Ie,3,2,"div",9)(12,Ve,20,7,"div",9),e()),t&2){let s,r=p();l(5),C(r.isPasswordComplaint()?5:6),l(5),c("ngIf",(s=r.userData())==null?null:s.passwordChangedAt),l(),c("ngIf",!r.editMode()),l(),c("ngIf",r.editMode()&&r.userData())}}var Wt=(()=>{let i=class i{constructor(){this.destroyRef=m(k),this.myAccountService=m(R),this.authService=m(T),this.userData=M(),this.isErrorOccurred=M(!0),this.editMode=M(!1),this.showPassword=ft(!1),this.Role=O}ngOnInit(){this.fetchCurrentUserData()}fetchCurrentUserData(){this.myAccountService.getProfileData().pipe(x(this.destroyRef)).subscribe({next:r=>{this.userData.set(r),this.isErrorOccurred.set(!1),this.editMode.set(!1)},error:r=>console.log(r)})}savePassword(r){r.valid?this.myAccountService.changePassword(r.value).pipe(x(this.destroyRef)).subscribe({next:a=>this.fetchCurrentUserData(),error:a=>{console.log(a),this.isErrorOccurred.set(!0)}}):this.isErrorOccurred.set(!0)}isPasswordComplaint(){return this.userData()?.passwordChangedAt?new Date().getFullYear()-new Date(Date.parse(this.userData().passwordChangedAt)).getFullYear()*12<=3:!1}togglePasswordVisibility(){this.showPassword.update(r=>!r)}};i.\u0275fac=function(a){return new(a||i)},i.\u0275cmp=h({type:i,selectors:[["app-my-password-settings"]],inputs:{userData:[1,"userData"],isErrorOccurred:[1,"isErrorOccurred"],editMode:[1,"editMode"]},outputs:{userData:"userDataChange",isErrorOccurred:"isErrorOccurredChange",editMode:"editModeChange"},decls:1,vars:1,consts:[["username","ngModel"],["newPassword","ngModel"],["class","container mx-auto mt-4 p-6 border border-black/50 dark:border-white/50 shadow-lg rounded-lg shadow-lg",4,"ngIf"],[1,"container","mx-auto","mt-4","p-6","border","border-black/50","dark:border-white/50","shadow-lg","rounded-lg","shadow-lg"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-primary","text-lg","font-bold"],["matTooltip","Compliant",1,"text-success","flex","items-center","gap-1","text-sm"],["matTooltip","Non-Compliant",1,"text-danger","flex","items-center","gap-1","text-sm"],[1,"text-primary","text-sm","mb-4","flex","flex-col","gap-2"],[4,"ngIf"],[1,"font-bold","underline"],["mat-flat-button","","type","button",3,"click",4,"ngIf"],["mat-flat-button","","type","button",3,"click"],[1,"text-sm","text-primary","italic"],[1,"flex","flex-col","gap-2",3,"ngSubmit"],["type","email","name","username","id","username","required","","placeholder","Username","autocomplete","username",3,"hidden","ngModel"],[1,"relative"],[1,"w-full"],["matInput","","type","password","id","newPassword","name","newPassword","ngModel","","autocomplete","new-password","required","","minlength","8","pattern","^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[@.#$!%*?&^])[A-Za-z\\d@.#$!%*?&]{8,50}$",3,"type"],["mat-icon-button","","type","button","matSuffix","",3,"click"],["class","text-danger text-sm font-bold",4,"ngIf"],[1,"flex","justify-end","gap-2"],["mat-stroked-button","","type","button",3,"click"],["mat-raised-button","","type","submit",3,"disabled"],[1,"text-danger","text-sm","font-bold"]],template:function(a,d){a&1&&u(0,Ne,13,4,"section",2),a&2&&c("ngIf",d.userData())},dependencies:[w,B,K,At,G,H,Tt,$,Dt,z,Q,kt,P,tt,X,W,J,jt,D,A,I,y,Pt,it,et],encapsulation:2,changeDetection:0});let t=i;return t})();var Fe=(t,i)=>i.credentialId;function Oe(t,i){t&1&&(n(0,"span",3)(1,"mat-icon"),o(2,"check_circle"),e(),o(3," Activated "),e())}function Ue(t,i){t&1&&(n(0,"span",4)(1,"mat-icon"),o(2,"error"),e(),o(3," Not Activated "),e())}function je(t,i){if(t&1){let s=v();n(0,"button",9),f("click",function(){g(s);let a=p();return _(a.registerNewPasskey())}),o(1," Register New Passkey "),e()}}function qe(t,i){if(t&1){let s=v();n(0,"tr")(1,"td",18),o(2),e(),n(3,"td",19),o(4),q(5,"date"),e(),n(6,"td",20)(7,"button",21),f("click",function(){let a=g(s).$implicit,d=p(3);return _(d.removePasskey(a.credentialId))}),o(8,"Remove "),e()()()}if(t&2){let s=i.$implicit;l(2),V(s.deviceInfo),l(2),V(Y(5,2,s.createdAt,"long"))}}function Ye(t,i){if(t&1&&(n(0,"table",13)(1,"thead",14)(2,"tr")(3,"th",15),o(4,"Name"),e(),n(5,"th",15),o(6,"Registered At"),e(),n(7,"th",16),o(8,"Action"),e()()(),n(9,"tbody",17),vt(10,qe,9,5,"tr",null,Fe),e()()),t&2){let s=p(2);l(10),yt(s.registeredPasskeys())}}function Be(t,i){t&1&&(n(0,"div",10)(1,"mat-accordion")(2,"mat-expansion-panel")(3,"mat-expansion-panel-header")(4,"h5",11),o(5,"Registered Passkeys"),e()(),u(6,Ye,12,0,"ng-template",12),e()()())}function Le(t,i){t&1&&(n(0,"div")(1,"p",22),o(2,"You do have access to register Passkey for the account."),e()())}var Jt=(()=>{let i=class i{constructor(){this.authService=m(T),this.passkeyService=m(qt),this.notificationService=m(nt),this.passkeysSubject=new ut([]),this.registeredPasskeys=L(this.passkeysSubject.asObservable(),{initialValue:[]}),this.isPasskeyExists=St(()=>this.registeredPasskeys().length>0),this.list()}list(){this.passkeyService.list().subscribe({next:r=>{console.log("Retrieved passkeys:",r),this.passkeysSubject.next(r)},error:r=>{console.error("Error retrieving passkeys:",r),this.notificationService.showError("Error retrieving passkeys: "+r.message)}})}registerNewPasskey(){this.passkeyService.register().subscribe({next:()=>{this.notificationService.showSuccess("Registration completed successfully!"),this.list()},error:r=>this.notificationService.showError("Error during registration:"+r.message)})}removePasskey(r){console.log("Removing passkey with ID:",r),this.passkeyService.remove(r).subscribe({next:()=>{this.notificationService.showSuccess("Passkey removed successfully!"),this.list()},error:a=>this.notificationService.showError("Error removing passkey: "+a.message)})}};i.\u0275fac=function(a){return new(a||i)},i.\u0275cmp=h({type:i,selectors:[["app-my-passkey-settings"]],decls:11,vars:4,consts:[[1,"container","mx-auto","mt-4","p-6","border","border-black/50","dark:border-white/50","rounded-lg","shadow-lg","flex","flex-col"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-primary","text-lg","font-bold"],["matTooltip","Activated",1,"text-success","flex","items-center","gap-1","text-sm"],["matTooltip","Not Activated",1,"text-danger","flex","items-center","gap-1","text-sm"],[1,"flex","justify-start"],["mat-flat-button","","type","button",3,"click",4,"ngIf"],["class","mt-4",4,"ngIf"],[4,"ngIf"],["mat-flat-button","","type","button",3,"click"],[1,"mt-4"],[1,"text-md","font-semibold","mb-2"],["matExpansionPanelContent",""],[1,"min-w-full","divide-y","divide-gray-200","border","rounded-lg","overflow-hidden"],[1,"bg-gray-50","dark:bg-gray-800"],[1,"px-4","py-2","text-left","text-sm","font-semibold","text-gray-700","dark:text-gray-300"],[1,"px-4","py-2","text-sm","font-semibold","text-gray-700","dark:text-gray-300"],[1,"divide-y","divide-gray-100","dark:divide-gray-700","bg-white","dark:bg-gray-900"],[1,"px-4","py-2","font-mono","text-sm","text-gray-900","dark:text-gray-200"],[1,"px-4","py-2","font-mono","text-sm","text-gray-500","dark:text-gray-400"],[1,"px-4","py-2","text-right"],["mat-button","","type","button",1,"text-red-600","hover:text-red-800","text-sm","font-medium",3,"click"],[1,"text-sm","text-primary","italic"]],template:function(a,d){a&1&&(n(0,"section",0)(1,"div",1)(2,"h4",2),o(3,"Passkey"),e(),n(4,"div"),S(5,Oe,4,0,"span",3)(6,Ue,4,0,"span",4),e()(),n(7,"div",5),u(8,je,2,0,"button",6),e(),u(9,Be,7,0,"div",7)(10,Le,3,0,"div",8),e()),a&2&&(l(5),C(d.isPasskeyExists()?5:6),l(3),c("ngIf",d.authService.hasAuthenticatedRole()),l(),c("ngIf",d.isPasskeyExists()),l(),c("ngIf",!d.authService.hasAuthenticatedRole()))},dependencies:[D,A,Z,P,y,w,B,Qt,lt,at,st,Gt],encapsulation:2});let t=i;return t})();var In=(()=>{let i=class i{constructor(){this.MY_SECURITY_SETTINGS_PAGE_INFO=wt}};i.\u0275fac=function(a){return new(a||i)},i.\u0275cmp=h({type:i,selectors:[["app-my-account-settings-page"]],decls:8,vars:1,consts:[[3,"pageInfo"],[1,"flex","flex-col"]],template:function(a,d){a&1&&(n(0,"header"),E(1,"app-page-header",0),e(),n(2,"main")(3,"div",1),E(4,"app-my-passkey-settings")(5,"app-my-password-settings")(6,"app-my-totp-settings")(7,"app-my-mfa-settings"),e()()),a&2&&(l(),c("pageInfo",d.MY_SECURITY_SETTINGS_PAGE_INFO))},dependencies:[Lt,Kt,Zt,Wt,Jt],encapsulation:2,changeDetection:0});let t=i;return t})();export{In as MyAccountSettingsPageComponent};
