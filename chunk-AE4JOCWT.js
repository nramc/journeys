import{a as $}from"./chunk-RN6ALRD2.js";import{a as T}from"./chunk-YP7Z2DMN.js";import{a as Y}from"./chunk-AQN6FMJN.js";import{b as q}from"./chunk-BS35BKX7.js";import{b as Z}from"./chunk-OHR2DNYA.js";import"./chunk-KH7BRNI5.js";import"./chunk-CKO7ZF4O.js";import"./chunk-TUAD65OT.js";import{b as O,g as j,h as W,i as B,j as D,k as R,p as z,s as J,u as H}from"./chunk-AEZFIZRL.js";import"./chunk-KR4OTF54.js";import{c as U}from"./chunk-7XLSB2U3.js";import{c as K}from"./chunk-3GWABDWC.js";import{a as G,b as I}from"./chunk-APFWKF4N.js";import{h as Q,j as X}from"./chunk-V5KZ4TFP.js";import"./chunk-Z5EQZODQ.js";import{a as V,c as N,d as A}from"./chunk-5YR7RF5U.js";import"./chunk-23FG2HRM.js";import{x as F}from"./chunk-G2RP32WO.js";import{Dc as r,Fa as k,Hc as w,Ic as C,Jc as L,Sb as c,Tb as g,Xb as y,Yb as e,Zb as t,_b as S,gc as P,hb as E,lb as m,lc as _,oc as b,pa as x,va as h,wa as v,xb as M,yc as p}from"./chunk-JDJNICZL.js";function ee(n,l){n&1&&(e(0,"div",4),S(1,"mat-spinner"),t())}function te(n,l){n&1&&(e(0,"div"),r(1,"Username is required."),t())}function ie(n,l){n&1&&(e(0,"div"),r(1,"Max 50 characters."),t())}function ne(n,l){if(n&1&&(e(0,"div",17),c(1,te,2,0,"div"),c(2,ie,2,0,"div"),t()),n&2){b();let d=p(20);m(),g(d.errors!=null&&d.errors.required?1:-1),m(),g(d.errors!=null&&d.errors.maxlength?2:-1)}}function oe(n,l){n&1&&(e(0,"div"),r(1,"Password is required."),t())}function re(n,l){n&1&&(e(0,"div"),r(1,"Max 50 characters."),t())}function ae(n,l){if(n&1&&(e(0,"div",17),c(1,oe,2,0,"div"),c(2,re,2,0,"div"),t()),n&2){b();let d=p(29);m(),g(d.errors!=null&&d.errors.required?1:-1),m(),g(d.errors!=null&&d.errors.maxlength?2:-1)}}var ke=(()=>{let l=class l{constructor(){this.SIGNUP_PAGE_INFO=q,this.forgotPasswordAssistanceUrl="https://github.com/nramc/journeys/issues/new?assignees=&labels=bug&projects=&template=bug-report-form.yml&title=%5BBug%5D%3A+",this.authService=x(K),this.loginService=x(Z),this.router=x(N),this.activatedRoute=x(V),this.notificationService=x($),this.isServiceAvailable=U(x(Y).getVersion(),{initialValue:null}),this.form=k({username:"",password:""})}login(a){a.valid&&this.loginService.login(this.form()).subscribe({next:i=>this.onLoginSuccess(this.form(),i),error:i=>{a.resetForm(),this.onLoginFailed(i)}})}onLoginSuccess(a,i){if(i.additionalFactorRequired){let o={credential:a,options:i.securityAttributes};this.router.navigate(["mfa"],{queryParams:this.activatedRoute.snapshot.queryParams,state:o}).then(console.log)}else{let o=this.authService.getUserContextForSuccessfulLogin(i);this.onLogOnSuccess(o)}}onLoginFailed(a){console.error(a),this.notificationService.showError("Login failed. "+a.message)}onLogOnSuccess(a){this.notificationService.showSuccess("Login successful!");let i=this.activatedRoute.snapshot.queryParams.redirectUrl??"/home";this.router.navigateByUrl(i).then(console.log)}loginAsGuest(){this.loginService.loginAsGuest().subscribe({next:a=>{let i=this.authService.getUserContextForSuccessfulLogin(a);this.onLogOnSuccess(i)},error:a=>this.onLoginFailed(a)})}loginWithPasskey(a){this.loginService.loginWithPasskey(a).subscribe({next:i=>{let o=this.authService.getUserContextForSuccessfulLogin(i);this.onLogOnSuccess(o)},error:i=>this.onLoginFailed(i)})}};l.\u0275fac=function(i){return new(i||l)},l.\u0275cmp=M({type:l,selectors:[["app-login"]],decls:42,vars:7,consts:[["loginForm","ngForm"],["username","ngModel"],["password","ngModel"],[1,"flex","min-h-full","flex-col","justify-center","px-6","py-12","lg:px-8"],[1,"mask-with-spinner"],[1,"sm:mx-auto","sm:w-full","sm:max-w-sm"],["ngSrc","assets/logo/journey-logo-64x64.png","alt","Journey","height","64","width","64",1,"mx-auto","h-10","w-auto"],[1,"text-primary","text-center","text-2xl/9","font-bold","tracking-tight"],[1,"mt-10","sm:mx-auto","sm:w-full","sm:max-w-sm"],[1,"flex","flex-col","gap-5",3,"ngSubmit"],["mat-flat-button","","type","button",1,"w-full","flex","items-center","justify-center","gap-2","px-4","py-2","rounded-xl","text-sm","font-semibold","bg-gray-100","hover:bg-gray-200","dark:bg-gray-800","dark:hover:bg-gray-700","border","border-gray-300","transition",3,"click"],[1,"text-xl"],[1,"space-y-1.5"],[1,"flex","items-center","justify-between"],["for","username",1,"text-sm","font-medium"],["tabindex","-1",1,"text-xs","text-primary","font-semibold","hover:underline",3,"routerLink"],["type","email","name","username","id","username","required","","placeholder","you@example.com","autocomplete","username webauthn","maxlength","50",1,"w-full","rounded-md","bg-white","px-3","py-2","text-sm","text-gray-900","outline","outline-1","outline-gray-300","placeholder:text-gray-400","focus:outline-2","focus:outline-indigo-600","dark:bg-gray-900","dark:text-white",3,"ngModelChange","ngModel"],[1,"text-sm","text-danger"],["for","password",1,"text-sm","font-medium"],["target","_blank","tabindex","-1",1,"text-xs","text-primary","font-semibold","hover:underline",3,"href"],["type","password","name","password","id","password","required","","placeholder","\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022","autocomplete","current-password webauthn","maxlength","50",1,"w-full","rounded-md","bg-white","px-3","py-2","text-sm","text-gray-900","outline","outline-1","outline-gray-300","placeholder:text-gray-400","focus:outline-2","focus:outline-indigo-600","dark:bg-gray-900","dark:text-white",3,"ngModelChange","ngModel"],[1,"flex","flex-col","items-center","gap-2","text-center","pt-2"],["mat-flat-button","","type","submit","color","primary",1,"w-full","font-semibold"],[1,"text-gray-500","dark:text-gray-400"],["mat-stroked-button","","type","button",1,"w-full","flex","items-center","justify-center","gap-2","rounded-xl","px-4","py-2","text-sm","font-medium","border","border-indigo-400","text-indigo-600","hover:bg-indigo-50","dark:border-indigo-500","dark:text-indigo-300","dark:hover:bg-indigo-900","transition",3,"click"],[1,"text-lg"],[1,"ml-2","text-xs","text-green-600","font-semibold"]],template:function(i,o){if(i&1){let u=P();e(0,"div",3),c(1,ee,2,0,"div",4),e(2,"div",5),S(3,"img",6),e(4,"h2",7),r(5,"Sign in to your account"),t()(),e(6,"div",8)(7,"form",9,0),_("ngSubmit",function(){h(u);let s=p(8);return v(o.login(s))}),e(9,"button",10),_("click",function(){h(u);let s=p(20);return v(o.loginWithPasskey(s.value))}),e(10,"mat-icon",11),r(11,"fingerprint"),t(),r(12," Sign in with Passkey "),t(),e(13,"div",12)(14,"div",13)(15,"label",14),r(16,"Email address"),t(),e(17,"a",15),r(18," Don\u2019t have an account? "),t()(),e(19,"input",16,1),L("ngModelChange",function(s){return h(u),C(o.form().username,s)||(o.form().username=s),v(s)}),t(),c(21,ne,3,2,"div",17),t(),e(22,"div",12)(23,"div",13)(24,"label",18),r(25,"Password"),t(),e(26,"a",19),r(27," Forgot Password? "),t()(),e(28,"input",20,2),L("ngModelChange",function(s){return h(u),C(o.form().password,s)||(o.form().password=s),v(s)}),t(),c(30,ae,3,2,"div",17),t(),e(31,"div",21)(32,"button",22),r(33," Sign In "),t(),e(34,"small",23),r(35,"or"),t(),e(36,"button",24),_("click",function(){return h(u),v(o.loginAsGuest())}),e(37,"mat-icon",25),r(38,"travel_explore"),t(),r(39," Explore as Guest "),e(40,"span",26),r(41,"No signup needed"),t()()()()()()}if(i&2){let u=p(8),f=p(20),s=p(29);m(),g(o.isServiceAvailable()?-1:1),m(16),y("routerLink",o.SIGNUP_PAGE_INFO.path),m(2),w("ngModel",o.form().username),m(2),g(f.invalid&&(f.dirty||u.submitted)?21:-1),m(5),y("href",o.forgotPasswordAssistanceUrl,E),m(2),w("ngModel",o.form().password),m(2),g(s.invalid&&(s.dirty||u.submitted)?30:-1)}},dependencies:[H,R,O,j,W,z,J,D,B,A,F,T,X,Q,I,G],styles:[".mask-with-spinner[_ngcontent-%COMP%]{position:absolute;height:100%;width:100%;background-color:#3459e61a;display:flex;justify-content:center;align-items:center;z-index:1000}"],changeDetection:0});let n=l;return n})();export{ke as LoginComponent};
