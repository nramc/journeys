import{a as w}from"./chunk-KH7BRNI5.js";import{a as l}from"./chunk-V7KP7MMP.js";import{c as b}from"./chunk-2CTIELUH.js";import{f as v}from"./chunk-MBVDDYAL.js";import{ca as m,fa as h,ja as g,pa as d,t as y}from"./chunk-6YGVGKRS.js";function S(e){let s="==".slice(0,(4-e.length%4)%4),t=e.replace(/-/g,"+").replace(/_/g,"/")+s,r=atob(t),o=new ArrayBuffer(r.length),c=new Uint8Array(o);for(let p=0;p<r.length;p++)c[p]=r.charCodeAt(p);return o}function j(e){let s=new Uint8Array(e),t="";for(let c of s)t+=String.fromCharCode(c);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}var n="copy",u="convert";function f(e,s,t){if(s===n)return t;if(s===u)return e(t);if(s instanceof Array)return t.map(r=>f(e,s[0],r));if(s instanceof Object){let r={};for(let[o,c]of Object.entries(s)){if(c.derive){let p=c.derive(t);p!==void 0&&(t[o]=p)}if(!(o in t)){if(c.required)throw new Error(`Missing key: ${o}`);continue}if(t[o]==null){r[o]=null;continue}r[o]=f(e,c.schema,t[o])}return r}}function C(e,s){return{required:!0,schema:e,derive:s}}function i(e){return{required:!0,schema:e}}function a(e){return{required:!1,schema:e}}var x={type:i(n),id:i(u),transports:a(n)},A={appid:a(n),appidExclude:a(n),credProps:a(n)},B={appid:a(n),appidExclude:a(n),credProps:a(n)},T={publicKey:i({rp:i(n),user:i({id:i(u),name:i(n),displayName:i(n)}),challenge:i(u),pubKeyCredParams:i(n),timeout:a(n),excludeCredentials:a([x]),authenticatorSelection:a(n),attestation:a(n),extensions:a(A)}),signal:a(n)},U={type:i(n),id:i(n),rawId:i(u),authenticatorAttachment:a(n),response:i({clientDataJSON:i(u),attestationObject:i(u),transports:C(n,e=>{var s;return((s=e.getTransports)==null?void 0:s.call(e))||[]})}),clientExtensionResults:C(B,e=>e.getClientExtensionResults())},R={mediation:a(n),publicKey:i({challenge:i(u),timeout:a(n),rpId:a(n),allowCredentials:a([x]),userVerification:a(n),extensions:a(A)}),signal:a(n)},$={type:i(n),id:i(n),rawId:i(u),authenticatorAttachment:a(n),response:i({clientDataJSON:i(u),authenticatorData:i(u),signature:i(u),userHandle:i(u)}),clientExtensionResults:C(B,e=>e.getClientExtensionResults())};function E(e){return f(S,T,e)}function J(e){return f(j,U,e)}async function k(e){let s=await navigator.credentials.create(E(e));return J(s)}function q(e){return f(S,R,e)}function K(e){return f(j,$,e)}async function I(e){let s=await navigator.credentials.get(q(e));return K(s)}var O=(()=>{class e{constructor(){this.http=d(v),this.authService=d(b)}list(){let r={headers:{Authorization:`Bearer ${this.authService.getCurrentUserContext().accessToken}`}};return this.http.get(`${l.journeyBaseUrl}/webauthn/credentials`,r).pipe(h(o=>console.log("Credentials retrieved:",o)))}remove(t){let o={headers:{Authorization:`Bearer ${this.authService.getCurrentUserContext().accessToken}`},params:{credentialId:t}};return this.http.delete(`${l.journeyBaseUrl}/webauthn/credentials`,o).pipe(h(c=>console.log("Credential removed:",c)))}register(){let r={headers:{Authorization:`Bearer ${this.authService.getCurrentUserContext().accessToken}`}};return this.http.post(`${l.journeyBaseUrl}/webauthn/register/start`,{flowID:w()},r).pipe(h(o=>console.log("Credential options received:",o)),m(o=>y(k(o)).pipe(h(c=>console.log("Attestation object:",c)),m(c=>this.http.post(`${l.journeyBaseUrl}/webauthn/register/finish`,c,r)))))}login(t){return this.http.post(`${l.journeyBaseUrl}/webauthn/authenticate/start`,{username:t},{params:{username:t}}).pipe(h(r=>console.log("Authentication options received:",r)),m(r=>y(I(r))),h(r=>console.log("Assertion object:",r)),m(r=>this.http.post(`${l.journeyBaseUrl}/webauthn/authenticate/finish`,r)))}static{this.\u0275fac=function(r){return new(r||e)}}static{this.\u0275prov=g({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var _=(()=>{class e{constructor(){this.httpClient=d(v),this.passkeyService=d(O)}login(t){return this.httpClient.post(l.journeyApi+"/login",{username:t.username,password:t.password},{headers:{Authorization:"Basic "+btoa(t.username+":"+t.password),"Content-Type":"application/json"}})}mfa(t,r,o){return this.httpClient.post(l.journeyApi+"/mfa",{type:r,value:t},{headers:{Authorization:"Basic "+btoa(o.username+":"+o.password),"Content-Type":"application/json"}})}loginAsGuest(){return this.httpClient.post(l.journeyApi+"/guestLogin",{username:Math.random().toString(36)},{headers:{"Content-Type":"application/json"}})}loginWithPasskey(t){return this.passkeyService.login(t)}static{this.\u0275fac=function(r){return new(r||e)}}static{this.\u0275prov=g({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();export{O as a,_ as b};
