import{a as Z}from"./chunk-VSHXB745.js";import{a as A}from"./chunk-5Z56B3SQ.js";import{a as X}from"./chunk-OL5AB5GU.js";import{b as U}from"./chunk-BS35BKX7.js";import{b as Y}from"./chunk-TPP4GMFL.js";import"./chunk-CHGDWI4X.js";import"./chunk-66AFA25Q.js";import{b as I,g as O,h as j,i as W,j as B,k as D,p as R,s as z,u as J}from"./chunk-WYGIYYQO.js";import"./chunk-5HCI3JVT.js";import{c as T}from"./chunk-RL25V5BE.js";import{c as H}from"./chunk-OG5DQ5VQ.js";import{a as q,b as G}from"./chunk-RQKRTOUM.js";import{h as K,j as Q}from"./chunk-OLDPWYQ6.js";import"./chunk-SUU2CJAS.js";import{a as F,c as V,d as N}from"./chunk-CLWH3GUL.js";import{s as P}from"./chunk-LVLQ6W55.js";import{Bc as a,Ea as L,Fc as b,Gc as w,Hc as C,Qb as d,Rb as u,Vb as v,Wb as t,Xb as i,Yb as y,ec as M,fb as k,jb as l,jc as _,ma as p,mc as S,sa as x,ta as h,wc as c,yb as E}from"./chunk-JOM6ROGP.js";function $(n,f){n&1&&(t(0,"div",4),y(1,"mat-spinner"),i())}function ee(n,f){n&1&&(t(0,"div"),a(1,"Username is required."),i())}function te(n,f){n&1&&(t(0,"div"),a(1,"Max 50 characters."),i())}function ie(n,f){if(n&1&&(t(0,"div",17),d(1,ee,2,0,"div"),d(2,te,2,0,"div"),i()),n&2){S();let e=c(20);l(),u(e.errors!=null&&e.errors.required?1:-1),l(),u(e.errors!=null&&e.errors.maxlength?2:-1)}}function ne(n,f){n&1&&(t(0,"div"),a(1,"Password is required."),i())}function oe(n,f){n&1&&(t(0,"div"),a(1,"Max 50 characters."),i())}function re(n,f){if(n&1&&(t(0,"div",17),d(1,ne,2,0,"div"),d(2,oe,2,0,"div"),i()),n&2){S();let e=c(29);l(),u(e.errors!=null&&e.errors.required?1:-1),l(),u(e.errors!=null&&e.errors.maxlength?2:-1)}}var Le=(()=>{class n{constructor(){this.SIGNUP_PAGE_INFO=U,this.forgotPasswordAssistanceUrl="https://github.com/nramc/journeys/issues/new?assignees=&labels=bug&projects=&template=bug-report-form.yml&title=%5BBug%5D%3A+",this.authService=p(H),this.loginService=p(Y),this.router=p(V),this.activatedRoute=p(F),this.notificationService=p(Z),this.isServiceAvailable=T(p(X).getVersion(),{initialValue:null}),this.form=L({username:"",password:""})}login(e){e.valid&&this.loginService.login(this.form()).subscribe({next:o=>this.onLoginSuccess(this.form(),o),error:o=>{e.resetForm(),this.onLoginFailed(o)}})}onLoginSuccess(e,o){if(o.additionalFactorRequired){let r={credential:e,options:o.securityAttributes};this.router.navigate(["mfa"],{queryParams:this.activatedRoute.snapshot.queryParams,state:r}).then(console.log)}else{let r=this.authService.getUserContextForSuccessfulLogin(o);this.onLogOnSuccess(r)}}onLoginFailed(e){console.error(e),this.notificationService.showError("Login failed. "+e.message)}onLogOnSuccess(e){this.notificationService.showSuccess("Login successful!");let o=this.activatedRoute.snapshot.queryParams.redirectUrl??"/home";this.router.navigateByUrl(o).then(console.log)}loginAsGuest(){this.loginService.loginAsGuest().subscribe({next:e=>{let o=this.authService.getUserContextForSuccessfulLogin(e);this.onLogOnSuccess(o)},error:e=>this.onLoginFailed(e)})}loginWithPasskey(e){this.loginService.loginWithPasskey(e).subscribe({next:o=>{let r=this.authService.getUserContextForSuccessfulLogin(o);this.onLogOnSuccess(r)},error:o=>this.onLoginFailed(o)})}static{this.\u0275fac=function(o){return new(o||n)}}static{this.\u0275cmp=E({type:n,selectors:[["app-login"]],decls:42,vars:7,consts:[["loginForm","ngForm"],["username","ngModel"],["password","ngModel"],[1,"flex","min-h-full","flex-col","justify-center","px-6","py-12","lg:px-8"],[1,"mask-with-spinner"],[1,"sm:mx-auto","sm:w-full","sm:max-w-sm"],["ngSrc","assets/logo/journey-logo-64x64.png","alt","Journey","height","64","width","64",1,"mx-auto","h-10","w-auto"],[1,"text-primary","text-center","text-2xl/9","font-bold","tracking-tight"],[1,"mt-10","sm:mx-auto","sm:w-full","sm:max-w-sm"],[1,"flex","flex-col","gap-5",3,"ngSubmit"],["mat-flat-button","","type","button",1,"w-full","flex","items-center","justify-center","gap-2","px-4","py-2","rounded-xl","text-sm","font-semibold","bg-gray-100","hover:bg-gray-200","dark:bg-gray-800","dark:hover:bg-gray-700","border","border-gray-300","transition",3,"click"],[1,"text-xl"],[1,"space-y-1.5"],[1,"flex","items-center","justify-between"],["for","username",1,"text-sm","font-medium"],["tabindex","-1",1,"text-xs","text-primary","font-semibold","hover:underline",3,"routerLink"],["type","email","name","username","id","username","required","","placeholder","you@example.com","autocomplete","username webauthn","maxlength","50",1,"w-full","rounded-md","bg-white","px-3","py-2","text-sm","text-gray-900","outline","outline-1","outline-gray-300","placeholder:text-gray-400","focus:outline-2","focus:outline-indigo-600","dark:bg-gray-900","dark:text-white",3,"ngModelChange","ngModel"],[1,"text-sm","text-danger"],["for","password",1,"text-sm","font-medium"],["target","_blank","tabindex","-1",1,"text-xs","text-primary","font-semibold","hover:underline",3,"href"],["type","password","name","password","id","password","required","","placeholder","\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022","autocomplete","current-password webauthn","maxlength","50",1,"w-full","rounded-md","bg-white","px-3","py-2","text-sm","text-gray-900","outline","outline-1","outline-gray-300","placeholder:text-gray-400","focus:outline-2","focus:outline-indigo-600","dark:bg-gray-900","dark:text-white",3,"ngModelChange","ngModel"],[1,"flex","flex-col","items-center","gap-2","text-center","pt-2"],["mat-flat-button","","type","submit","color","primary",1,"w-full","font-semibold"],[1,"text-gray-500","dark:text-gray-400"],["mat-stroked-button","","type","button",1,"w-full","flex","items-center","justify-center","gap-2","rounded-xl","px-4","py-2","text-sm","font-medium","border","border-indigo-400","text-indigo-600","hover:bg-indigo-50","dark:border-indigo-500","dark:text-indigo-300","dark:hover:bg-indigo-900","transition",3,"click"],[1,"text-lg"],[1,"ml-2","text-xs","text-green-600","font-semibold"]],template:function(o,r){if(o&1){let m=M();t(0,"div",3),d(1,$,2,0,"div",4),t(2,"div",5),y(3,"img",6),t(4,"h2",7),a(5,"Sign in to your account"),i()(),t(6,"div",8)(7,"form",9,0),_("ngSubmit",function(){x(m);let s=c(8);return h(r.login(s))}),t(9,"button",10),_("click",function(){x(m);let s=c(20);return h(r.loginWithPasskey(s.value))}),t(10,"mat-icon",11),a(11,"fingerprint"),i(),a(12," Sign in with Passkey "),i(),t(13,"div",12)(14,"div",13)(15,"label",14),a(16,"Email address"),i(),t(17,"a",15),a(18," Don\u2019t have an account? "),i()(),t(19,"input",16,1),C("ngModelChange",function(s){return x(m),w(r.form().username,s)||(r.form().username=s),h(s)}),i(),d(21,ie,3,2,"div",17),i(),t(22,"div",12)(23,"div",13)(24,"label",18),a(25,"Password"),i(),t(26,"a",19),a(27," Forgot Password? "),i()(),t(28,"input",20,2),C("ngModelChange",function(s){return x(m),w(r.form().password,s)||(r.form().password=s),h(s)}),i(),d(30,re,3,2,"div",17),i(),t(31,"div",21)(32,"button",22),a(33," Sign In "),i(),t(34,"small",23),a(35,"or"),i(),t(36,"button",24),_("click",function(){return x(m),h(r.loginAsGuest())}),t(37,"mat-icon",25),a(38,"travel_explore"),i(),a(39," Explore as Guest "),t(40,"span",26),a(41,"No signup needed"),i()()()()()()}if(o&2){let m=c(8),g=c(20),s=c(29);l(),u(r.isServiceAvailable()?-1:1),l(16),v("routerLink",r.SIGNUP_PAGE_INFO.path),l(2),b("ngModel",r.form().username),l(2),u(g.invalid&&(g.dirty||m.submitted)?21:-1),l(5),v("href",r.forgotPasswordAssistanceUrl,k),l(2),b("ngModel",r.form().password),l(2),u(s.invalid&&(s.dirty||m.submitted)?30:-1)}},dependencies:[J,D,I,O,j,R,z,B,W,N,P,A,Q,K,G,q],styles:[".mask-with-spinner[_ngcontent-%COMP%]{position:absolute;height:100%;width:100%;background-color:#3459e61a;display:flex;justify-content:center;align-items:center;z-index:1000}"],changeDetection:0})}}return n})();export{Le as LoginComponent};
