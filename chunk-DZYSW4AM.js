import{a as H,b as J,c as K,d as Q,e as X,f as Y}from"./chunk-7QCJPMRQ.js";import"./chunk-MSQHH3PV.js";import{a as f}from"./chunk-AOMZEFOI.js";import{a as $}from"./chunk-LDRZWZFG.js";import"./chunk-JA4JGXDI.js";import"./chunk-NWXFWB74.js";import{c as j,h as U,i as N,j as L,k as P,l as q,t as W,w as B,x as z,y as G}from"./chunk-6OHNXZFP.js";import{a as k}from"./chunk-BZBETYD3.js";import{a as F}from"./chunk-RYITIG3B.js";import{b as _}from"./chunk-R6MPEOK3.js";import"./chunk-A2N4MVAO.js";import{e as O,g as I}from"./chunk-EGCIWAOK.js";import{c as A}from"./chunk-HLWHUVVB.js";import"./chunk-T74QBNJG.js";import{Ac as b,Bb as y,Da as d,Ea as c,Hb as R,Ka as g,Mb as C,Sb as E,Xb as o,Yb as a,Zb as T,bc as h,gc as m,ic as D,ka as w,ob as l,pb as S,qa as s,sa as v,sc as u,tc as n}from"./chunk-VRY62XD3.js";var ee=(()=>{class r{constructor(){this.httpClient=s(A),this.authService=s(_)}sendConfirmationCode(e){let t=this.authService.getCurrentUserContext(),i=e?"Basic "+btoa(e.username+":"+e.password):`Bearer ${t.accessToken}`;return this.httpClient.post(k.journeyApi+"/sendEmailCode",{},{headers:{Authorization:i}})}verifyConfirmationCode(e){let t=this.authService.getCurrentUserContext();return this.httpClient.post(k.journeyApi+"/verifyEmailCode",{code:e},{headers:{Authorization:`Bearer ${t.accessToken}`}})}static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275prov=w({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var te=(()=>{class r{constructor(){this.destroyRef=s(g),this.emailConfirmationCodeService=s(ee),this.loginService=s($),this.authService=s(_),this.dialogRef=s(H),this.credential=s(J),this.isCodeSent=y(!1),this.canSendCode=y(!0),this.isCodeValid=y(!0)}confirmCode(e,t){this.isCodeValid.set(!0),e.validity.valid?(t.disabled=!0,this.credential?this.verifyCodeInUnauthenticatedContext(e,t):this.verifyCodeInAuthenticatedContext(e,t)):(this.isCodeValid.set(!1),console.log("invalid code"))}verifyCodeInUnauthenticatedContext(e,t){this.loginService.mfa(e.value,"EMAIL_ADDRESS",this.credential).pipe(f(this.destroyRef)).subscribe({next:i=>{this.authService.getUserContextForSuccessfulLogin(i),this.onVerificationSuccess(t)},error:i=>this.onVerificationError(i,t)})}verifyCodeInAuthenticatedContext(e,t){this.emailConfirmationCodeService.verifyConfirmationCode(e.value).pipe(f(this.destroyRef)).subscribe({next:i=>this.onVerificationSuccess(t),error:i=>this.onVerificationError(i,t)})}onVerificationSuccess(e){e.disabled=!0,console.log("code verified successfully"),this.dialogRef.close(!0)}onVerificationError(e,t){console.log(e),this.isCodeValid.set(!1),t.disabled=!1}sendCode(){this.canSendCode.set(!1),this.emailConfirmationCodeService.sendConfirmationCode(this.credential).pipe(f(this.destroyRef)).subscribe({next:e=>this.onSentSuccess(),error:e=>this.onSentError(e)})}onSentError(e){console.log(e),this.canSendCode.set(!0)}onSentSuccess(){this.isCodeSent.set(!0),setTimeout(()=>this.canSendCode.set(!0),1e3*60),console.log("Code has been sent successfully to register email")}static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275cmp=v({type:r,selectors:[["app-email-code-verification"]],inputs:{isCodeSent:[1,"isCodeSent"],canSendCode:[1,"canSendCode"],isCodeValid:[1,"isCodeValid"]},outputs:{isCodeSent:"isCodeSentChange",canSendCode:"canSendCodeChange",isCodeValid:"isCodeValidChange"},standalone:!0,features:[b],decls:37,vars:4,consts:[["codeForm","ngForm"],["confirmationCode",""],["confirmButton",""],[3,"submit"],[1,"card"],[1,"card-header","bg-primary","text-light"],[1,"card-body"],[1,"card-text"],[1,"input-group"],[1,"input-group-text"],["type","text","id","confirmationCode","name","confirmationCode","required","","pattern","[0-9]{6,6}","maxlength","6","min","6","autocomplete","off","ngModel","",1,"form-control"],[1,"form-text","text-danger","text-center",3,"hidden"],[1,"d-inline-flex","gap-2","mt-4"],["mat-dialog-close","false",1,"btn","btn-outline-danger"],["cdkFocusInitial","",1,"btn","btn-primary",3,"click","disabled"],[1,"btn","btn-primary",3,"click","disabled"],[1,"mt-2"],[1,"text-success","small","fw-bold",3,"hidden"]],template:function(t,i){if(t&1){let p=h();o(0,"form",3,0),m("submit",function(){d(p);let x=u(23),V=u(32);return c(i.confirmCode(x,V))}),o(2,"div",4)(3,"div",5),n(4," Email Code Confirmation Required "),a(),o(5,"div",6)(6,"div",7)(7,"p"),n(8,"To complete verification, please follow these steps:"),a(),o(9,"ol")(10,"li"),n(11,"Click the "),o(12,"code"),n(13,"Send"),a(),n(14," button to receive a verification code in your registered email "),a(),o(15,"li"),n(16,"Check your email for the verification code"),a(),o(17,"li"),n(18,'Enter the code in the field below and click "Confirm" to complete the verification'),a()(),o(19,"div",8)(20,"span",9),n(21,"Code"),a(),T(22,"input",10,1),a(),o(24,"div",11),n(25," Code invalid. Please enter valid code. "),a()(),o(26,"div",12)(27,"button",13),n(28,"Cancel"),a(),o(29,"button",14),m("click",function(){return d(p),c(i.sendCode())}),n(30,"Send "),a(),o(31,"button",15,2),m("click",function(){d(p);let x=u(23),V=u(32);return c(i.confirmCode(x,V))}),n(33,"Confirm"),a()(),o(34,"div",16)(35,"p",17),n(36,"Code has been sent successfully to register email. If you haven't received, click Sent button again after 60 seconds."),a()()()()()}if(t&2){let p=u(1);l(24),C("hidden",i.isCodeValid()),l(5),C("disabled",!i.canSendCode()),l(2),C("disabled",p.invalid),l(4),C("hidden",!i.isCodeSent())}},dependencies:[X,Q,G,q,j,U,N,W,B,z,P,L],changeDetection:0})}}return r})();function ne(r,ie){if(r&1){let e=h();o(0,"div",4)(1,"button",5),m("click",function(){d(e);let i=D();return c(i.continueWithTotpVerification())}),n(2," Using Mobile Authenticator "),o(3,"mat-icon"),n(4,"screen_lock_portrait"),a()()()}}function re(r,ie){if(r&1){let e=h();o(0,"div",4)(1,"button",5),m("click",function(){d(e);let i=D();return c(i.continueWithEmailCodeVerification())}),n(2," Using Email Code "),o(3,"mat-icon",6),n(4,"mail_lock"),a()()()}}var Te=(()=>{class r{constructor(e,t,i){this.router=e,this.dialog=t,this.activatedRoute=i,this.destroyRef=s(g),this.mfaOptions=this.router.getCurrentNavigation()?.extras?.state}continueWithTotpVerification(){this.dialog.open(Y,{data:this.mfaOptions.credential,disableClose:!0}).afterClosed().pipe(f(this.destroyRef)).subscribe(t=>this.onCloseCallback(t))}continueWithEmailCodeVerification(){this.dialog.open(te,{data:this.mfaOptions.credential,disableClose:!0}).afterClosed().pipe(f(this.destroyRef)).subscribe(t=>this.onCloseCallback(t))}onCloseCallback(e){if(e===!0){let t=this.activatedRoute.snapshot.queryParams.redirectUrl??"/home";this.router.navigateByUrl(t).then(console.log)}}static{this.\u0275fac=function(t){return new(t||r)(S(I),S(K),S(O))}}static{this.\u0275cmp=v({type:r,selectors:[["app-display-mfa-options"]],standalone:!0,features:[b],decls:7,vars:2,consts:[[1,"container","m-auto","h-100","w-100","mt-4"],[1,"d-flex","flex-column","justify-content-center","align-items-center","align-content-between","m-auto"],[1,"p-2"],[1,"gradient-text"],[1,"mfa-option","m-2"],[1,"btn","btn-outline-primary","fw-bold","p-2","w-100","h-100","round","rounded-5","d-flex","align-items-center","justify-content-center",3,"click"],[1,"ms-2"]],template:function(t,i){t&1&&(o(0,"section",0)(1,"div",1)(2,"div",2)(3,"h5",3),n(4,"Select Multi-factor Authentication Type to verify your identity"),a()(),R(5,ne,5,0,"div",4)(6,re,5,0,"div",4),a()()),t&2&&(l(5),E(!(i.mfaOptions==null||i.mfaOptions.options==null)&&i.mfaOptions.options.includes("TOTP")?5:-1),l(),E(!(i.mfaOptions==null||i.mfaOptions.options==null)&&i.mfaOptions.options.includes("EMAIL_ADDRESS")?6:-1))},dependencies:[F],styles:[".mfa-option[_ngcontent-%COMP%]{width:80%;height:3rem}"],changeDetection:0})}}return r})();export{Te as DisplayMfaOptionsComponent};
