import{a as ee,b as te,c as ie,d as oe,e as ne,f as re}from"./chunk-2DDPXNUS.js";import"./chunk-2CESDIV6.js";import{b as Y}from"./chunk-EFL2PGN2.js";import{a as K,f as Q,g as X}from"./chunk-HMFONO7X.js";import"./chunk-JQXD7EH6.js";import"./chunk-LE5T557K.js";import{b as Z}from"./chunk-ER6NCYER.js";import"./chunk-KH7BRNI5.js";import"./chunk-22ADO4DZ.js";import"./chunk-VHYXY7OV.js";import{b as I,g as F,h as U,i as j,j as N,k as L,p as P,s as q,t as W,u as B}from"./chunk-YQ2IFANT.js";import{a as M}from"./chunk-UYEVJUVR.js";import{a as c}from"./chunk-WSECCEV3.js";import{a as z,b as G,d as H,g as $,k as J}from"./chunk-SADN45S5.js";import{c as b}from"./chunk-OXPTOEN6.js";import{a as O}from"./chunk-QCOWUISP.js";import{h as y}from"./chunk-WZV44MZJ.js";import"./chunk-P47HP3AW.js";import{a as k,c as A}from"./chunk-46BTBU6F.js";import{f as T}from"./chunk-TVRC5D5R.js";import"./chunk-6Z5N4UCC.js";import{Ba as g,Dc as a,Sb as u,Tb as p,Xb as w,Yb as n,Zb as r,_b as R,fd as v,gc as h,ka as D,lb as d,lc as C,oc as _,pa as l,va as m,wa as f,xb as S,yc as V}from"./chunk-LHMNFXGQ.js";var se=(()=>{let i=class i{constructor(){this.httpClient=l(T),this.authService=l(b)}sendConfirmationCode(t){let e=this.authService.getCurrentUserContext(),o=t?"Basic "+btoa(t.username+":"+t.password):`Bearer ${e.accessToken}`;return this.httpClient.post(M.journeyApi+"/sendEmailCode",{},{headers:{Authorization:o}})}verifyConfirmationCode(t){let e=this.authService.getCurrentUserContext();return this.httpClient.post(M.journeyApi+"/verifyEmailCode",{code:t},{headers:{Authorization:`Bearer ${e.accessToken}`}})}};i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=D({token:i,factory:i.\u0275fac,providedIn:"root"});let s=i;return s})();function fe(s,i){s&1&&(n(0,"p",10),a(1," Code invalid. Please enter a valid code. "),r())}function ue(s,i){s&1&&(n(0,"p",15),a(1," Code has been sent successfully to the registered email. If you haven't received it, click Send again after 60 seconds. "),r())}var le=(()=>{let i=class i{constructor(){this.destroyRef=l(g),this.emailConfirmationCodeService=l(se),this.loginService=l(Z),this.authService=l(b),this.dialogRef=l(ee),this.credential=l(te),this.isCodeSent=v(!1),this.canSendCode=v(!0),this.isCodeValid=v(!0)}confirmCode(t,e){this.isCodeValid.set(!0),t.validity.valid?this.verifyCode(e,t):this.isCodeValid.set(!1)}verifyCode(t,e){t.disabled=!0,this.credential?this.verifyCodeInUnauthenticatedContext(e,t):this.verifyCodeInAuthenticatedContext(e,t)}verifyCodeInUnauthenticatedContext(t,e){e.disabled=!0,this.loginService.mfa(t.value,"EMAIL_ADDRESS",this.credential).pipe(c(this.destroyRef)).subscribe({next:o=>{this.authService.getUserContextForSuccessfulLogin(o),this.onVerificationSuccess(e)},error:o=>this.onVerificationError(o,e)})}verifyCodeInAuthenticatedContext(t,e){this.emailConfirmationCodeService.verifyConfirmationCode(t.value).pipe(c(this.destroyRef)).subscribe({next:o=>this.onVerificationSuccess(e),error:o=>this.onVerificationError(o,e)})}onVerificationSuccess(t){t.disabled=!0,console.log("code verified successfully"),this.dialogRef.close(!0)}onVerificationError(t,e){console.log(t),this.isCodeValid.set(!1),e.disabled=!1}sendCode(){this.canSendCode.set(!1),this.emailConfirmationCodeService.sendConfirmationCode(this.credential).pipe(c(this.destroyRef)).subscribe({next:t=>this.onSentSuccess(),error:t=>this.onSentError(t)})}onSentError(t){console.log(t),this.canSendCode.set(!0)}onSentSuccess(){this.isCodeSent.set(!0),setTimeout(()=>this.canSendCode.set(!0),1e3*60),console.log("Code has been sent successfully to register email")}};i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=S({type:i,selectors:[["app-email-code-verification"]],inputs:{isCodeSent:[1,"isCodeSent"],canSendCode:[1,"canSendCode"],isCodeValid:[1,"isCodeValid"]},outputs:{isCodeSent:"isCodeSentChange",canSendCode:"canSendCodeChange",isCodeValid:"isCodeValidChange"},decls:34,vars:3,consts:[["codeForm","ngForm"],["confirmationCode",""],["confirmButton",""],[3,"submit"],[1,"bg-gradient-to-r","from-blue-500","to-blue-700","text-white","text-xl","font-semibold","!p-4","rounded-t-lg"],[1,"text-primary"],[1,"list-decimal","list-inside","text-base","mb-4"],[1,"px-1","rounded-sm","font-bold","italic","text-sm"],["appearance","fill",1,"w-full"],["matInput","","type","text","inputmode","numeric","id","confirmationCode","name","confirmationCode","required","","pattern","[0-9]{6,6}","maxlength","6","ngModel","","autocomplete","off",1,""],[1,"text-red-500","text-sm","text-center","mt-2"],[1,"flex","gap-2","mt-6","justify-center"],["mat-raised-button","","type","button","mat-dialog-close","false"],["mat-raised-button","","type","button",3,"click","disabled"],["mat-raised-button","","type","submit"],[1,"text-green-600","text-sm","font-bold","mt-4"]],template:function(e,o){if(e&1){let E=h();n(0,"form",3,0),C("submit",function(){m(E);let ce=V(23),me=V(31);return f(o.confirmCode(ce,me))}),n(2,"mat-card")(3,"mat-card-header",4)(4,"mat-card-title"),a(5,"Email Code Confirmation Required"),r()(),n(6,"mat-card-content",5)(7,"p"),a(8,"To complete verification, please follow below steps:"),r(),n(9,"ol",6)(10,"li"),a(11,"Click the "),n(12,"code",7),a(13,"Send"),r(),a(14," button to receive a verification code in your registered email. "),r(),n(15,"li"),a(16,"Check your email for the verification code."),r(),n(17,"li"),a(18,'Enter the code in the field below and click "Confirm" to complete the verification.'),r()(),n(19,"mat-form-field",8)(20,"mat-label"),a(21,"Code"),r(),R(22,"input",9,1),r(),u(24,fe,2,0,"p",10),n(25,"div",11)(26,"button",12),a(27,"Cancel"),r(),n(28,"button",13),C("click",function(){return m(E),f(o.sendCode())}),a(29,"Send"),r(),n(30,"button",14,2),a(32,"Confirm"),r()(),u(33,ue,2,0,"p",15),r()()()}e&2&&(d(24),p(o.isCodeValid()?-1:24),d(4),w("disabled",!o.canSendCode()),d(5),p(o.isCodeSent()?33:-1))},dependencies:[ne,oe,B,L,I,F,U,P,q,W,N,j,y,X,Q,K,J,z,H,$,G,Y],encapsulation:2,changeDetection:0});let s=i;return s})();function pe(s,i){if(s&1){let x=h();n(0,"div",4)(1,"button",5),C("click",function(){m(x);let e=_();return f(e.continueWithTotpVerification())}),a(2," Using Mobile Authenticator "),n(3,"mat-icon",6),a(4,"screen_lock_portrait"),r()()()}}function Ce(s,i){if(s&1){let x=h();n(0,"div",4)(1,"button",5),C("click",function(){m(x);let e=_();return f(e.continueWithEmailCodeVerification())}),a(2," Using Email Code "),n(3,"mat-icon",6),a(4,"mail_lock"),r()()()}}var Qe=(()=>{let i=class i{constructor(){this.router=l(A),this.dialog=l(ie),this.activatedRoute=l(k),this.destroyRef=l(g),this.mfaOptions=this.router.getCurrentNavigation()?.extras?.state}continueWithTotpVerification(){this.dialog.open(re,{data:this.mfaOptions.credential,disableClose:!0}).afterClosed().pipe(c(this.destroyRef)).subscribe(e=>this.onCloseCallback(e))}continueWithEmailCodeVerification(){this.dialog.open(le,{data:this.mfaOptions.credential,disableClose:!0}).afterClosed().pipe(c(this.destroyRef)).subscribe(e=>this.onCloseCallback(e))}onCloseCallback(t){if(t===!0){let e=this.activatedRoute.snapshot.queryParams.redirectUrl??"/home";this.router.navigateByUrl(e).then(console.log)}}};i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=S({type:i,selectors:[["app-display-mfa-options"]],decls:7,vars:2,consts:[[1,"container","mx-auto","h-full","w-full","mt-4"],[1,"flex","flex-col","items-center","justify-center","gap-2"],[1,"p-2"],[1,"text-lg","font-bold","text-primary"],[1,"w-full","px-4","text-center"],["mat-flat-button","","type","button",1,"flex","items-center","justify-center","md:w-1/2","w-full","p-3","text-sm","font-bold","rounded-full",3,"click"],[1,"ml-2"]],template:function(e,o){e&1&&(n(0,"section",0)(1,"div",1)(2,"div",2)(3,"h5",3),a(4," Select Multi-factor Authentication Type to verify your identity "),r()(),u(5,pe,5,0,"div",4),u(6,Ce,5,0,"div",4),r()()),e&2&&(d(5),p(!(o.mfaOptions==null||o.mfaOptions.options==null)&&o.mfaOptions.options.includes("TOTP")?5:-1),d(),p(!(o.mfaOptions==null||o.mfaOptions.options==null)&&o.mfaOptions.options.includes("EMAIL_ADDRESS")?6:-1))},dependencies:[O,y],styles:[".mfa-option[_ngcontent-%COMP%]{width:80%;height:3rem}"],changeDetection:0});let s=i;return s})();export{Qe as DisplayMfaOptionsComponent};
