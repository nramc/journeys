import{a as J}from"./chunk-H5QXDTGA.js";import{a as H}from"./chunk-ID2EJABW.js";import{c as G,g as B,h as O,i as j,j as R,k as W,s as D,v as Y,x as z}from"./chunk-ZDAO2INT.js";import{b as A}from"./chunk-SNVCUL6N.js";import{a as K}from"./chunk-IY2VFBTS.js";import"./chunk-QCRUDY7U.js";import{b as V}from"./chunk-4HPKFMYY.js";import{e as U,g as T,h as q}from"./chunk-MJ3Y34XA.js";import"./chunk-IV7S22EY.js";import"./chunk-MOYMDOXY.js";import"./chunk-WAAWWZ5Q.js";import{o as N}from"./chunk-ERNLTT6I.js";import{$b as I,Bb as S,Fa as f,Ga as p,Kb as v,Mb as m,Rb as w,Vb as t,Wb as n,Xb as g,ec as y,gc as k,kb as P,ob as d,pb as h,pc as b,qc as s,tc as x,ua as E,uc as L,vc as C,xc as F}from"./chunk-JNU3RU67.js";function Q(i,r){if(i&1&&g(0,"app-feedback-message",6),i&2){let _=k();m("message",_.feedbackMessage())}}function X(i,r){i&1&&(t(0,"div",7),g(1,"i",30),s(2," Identity Yourself to access secured resource..! "),n())}function Z(i,r){i&1&&(t(0,"div",8),g(1,"i",30),s(2," You have been successfully logged out! "),n())}function $(i,r){i&1&&(t(0,"div",9),g(1,"i",30),s(2," Identity Yourself to access more exciting features..! "),n())}function ee(i,r){i&1&&(t(0,"div"),s(1,"Username is required."),n())}function te(i,r){i&1&&(t(0,"div"),s(1,"Username must be at most 50 characters long."),n())}function ie(i,r){i&1&&(t(0,"div"),s(1,"Password is required."),n())}function ne(i,r){i&1&&(t(0,"div"),s(1,"Password must be at most 50 characters long."),n())}function re(i,r){i&1&&(t(0,"div",29),g(1,"mat-spinner"),n())}var be=(()=>{let r=class r{constructor(o,a,e,u){this.authService=o,this.loginService=a,this.router=e,this.activatedRoute=u,this.feedbackMessage=S({}),this.isLoading=S(!1),this.form=new M,this.messageBanner="",this.SIGNUP_PAGE_INFO=A,this.forgotPasswordAssistanceUrl="https://github.com/nramc/journeys/issues/new?assignees=&labels=bug&projects=&template=bug-report-form.yml&title=%5BBug%5D%3A+"}ngOnInit(){this.messageBanner=this.activatedRoute.snapshot.queryParams.q}login(o){if(o.valid){this.isLoading.set(!0);let a={username:this.form.userName,password:this.form.password};this.loginService.login(a).subscribe({next:e=>this.onLoginSuccess(a,e),error:e=>{o.resetForm(),this.onLoginFailed(e)}})}}onLoginSuccess(o,a){if(this.isLoading.set(!1),a.additionalFactorRequired){let e={credential:o,options:a.securityAttributes};this.router.navigate(["mfa"],{queryParams:this.activatedRoute.snapshot.queryParams,state:e}).then(console.log)}else{let e=this.authService.getUserContextForSuccessfulLogin(a);this.onLogOnSuccess(e)}}onLoginFailed(o){this.isLoading.set(!1),console.error(o),this.feedbackMessage.set({error:"Login failed. "+o.message})}onLogOnSuccess(o){this.isLoading.set(!1),this.feedbackMessage.set({success:"Login successful for "+o.name});let a=this.activatedRoute.snapshot.queryParams.redirectUrl??"/home";this.router.navigateByUrl(a).then(console.log)}loginAsGuest(){this.isLoading.set(!0),this.loginService.loginAsGuest().subscribe({next:o=>{let a=this.authService.getUserContextForSuccessfulLogin(o);this.onLogOnSuccess(a)},error:o=>this.onLoginFailed(o)})}};r.\u0275fac=function(a){return new(a||r)(h(V),h(K),h(T),h(U))},r.\u0275cmp=E({type:r,selectors:[["app-login"]],standalone:!0,features:[F],decls:44,vars:13,consts:[["loginForm","ngForm"],["username","ngModel"],["password","ngModel"],[1,"container","h-100","mt-3","mt-md-0"],[1,"row","d-flex","justify-content-center","align-items-center","h-100","m-auto"],[1,"col-12","col-md-6","mt-sm-0"],[3,"message"],["role","alert",1,"alert","alert-warning"],["role","alert",1,"alert","alert-success"],["role","alert",1,"alert","alert-primary"],[1,"card","login-card","text-white","border","border-2","border-primary","border-opacity-50",2,"border-radius","1rem"],[1,"card-body","p-5","text-center"],[3,"ngSubmit"],[1,"fw-bold","mb-2"],[1,"text-white-50","mb-5"],[1,"form-outline","form-white","mb-2"],["type","email","id","username","name","username","required","","placeholder","Username","autofocus","","autocomplete","username","maxlength","50",1,"form-control","form-control-lg",3,"ngModelChange","ngModel"],["for","username",1,"form-label","small"],["tabindex","-1",1,"text-light","ms-2",3,"routerLink"],[1,"form-text","text-danger",3,"hidden"],[4,"ngIf"],[1,"form-outline","form-white","mb-4"],["type","password","id","password","name","password","required","","maxlength","50","placeholder","Password","autocomplete","current-password",1,"form-control","form-control-lg",3,"ngModelChange","ngModel"],["for","password",1,"form-label","small"],["target","_blank","tabindex","-1",1,"text-light","ms-2",3,"href"],[1,"d-flex","flex-column","gap-1"],["type","submit",1,"btn","btn-outline-dark","btn-lg",3,"disabled"],[1,"text-light"],["type","button",1,"btn","btn-success","btn-lg",3,"click"],[1,"loading-shade"],[1,"bi","bi-info-circle","pe-none","me-2"]],template:function(a,e){if(a&1){let u=I();t(0,"div",3)(1,"div",4)(2,"div",5)(3,"div"),v(4,Q,1,1,"app-feedback-message",6)(5,X,3,0,"div",7)(6,Z,3,0,"div",8)(7,$,3,0,"div",9),n(),t(8,"div",10)(9,"div",11)(10,"form",12,0),y("ngSubmit",function(){f(u);let l=b(11);return p(e.login(l))}),t(12,"h2",13),s(13,"Login"),n(),t(14,"p",14),s(15,"Please Identify Yourself!"),n(),t(16,"div",15)(17,"input",16,1),C("ngModelChange",function(l){return f(u),L(e.form.userName,l)||(e.form.userName=l),p(l)}),n(),t(19,"label",17),s(20,"Don't have an account? "),t(21,"a",18),s(22,"Sign Up"),n()(),t(23,"div",19),v(24,ee,2,0,"div",20)(25,te,2,0,"div",20),n()(),t(26,"div",21)(27,"input",22,2),C("ngModelChange",function(l){return f(u),L(e.form.password,l)||(e.form.password=l),p(l)}),n(),t(29,"label",23),s(30,"Forgot Password? "),t(31,"a",24),s(32,"Contact Us"),n()(),t(33,"div",19),v(34,ie,2,0,"div",20)(35,ne,2,0,"div",20),n()(),t(36,"div",25)(37,"button",26),s(38,"Submit "),n(),t(39,"small",27),s(40,"or"),n(),t(41,"button",28),y("click",function(){return f(u),p(e.loginAsGuest())}),s(42,"Login as Guest"),n()()()()()()()(),v(43,re,2,0,"div",29)}if(a&2){let u=b(11),c=b(18),l=b(28);d(4),w(e.feedbackMessage().success||e.feedbackMessage().error?4:e.messageBanner==="unauthenticated"?5:e.messageBanner==="logoutSuccessful"?6:7),d(13),x("ngModel",e.form.userName),d(4),m("routerLink",e.SIGNUP_PAGE_INFO.path),d(2),m("hidden",c.valid||c.pristine),d(),m("ngIf",c.errors==null?null:c.errors.required),d(),m("ngIf",c.errors==null?null:c.errors.maxlength),d(2),x("ngModel",e.form.password),d(4),m("href",e.forgotPasswordAssistanceUrl,P),d(2),m("hidden",l.valid||l.pristine),d(),m("ngIf",l.errors==null?null:l.errors.required),d(),m("ngIf",l.errors==null?null:l.errors.maxlength),d(2),m("disabled",!u.form.valid||u.submitted),d(6),w(e.isLoading()?43:-1)}},dependencies:[z,W,G,B,O,D,Y,R,j,J,N,q,H],styles:[".login-card[_ngcontent-%COMP%]{background-image:linear-gradient(to right top,#fff,#e2ddfb,#c3bdf7,#a29df2,#7d7fed,#686fea,#4f5fe6,#2c4fe2,#2647df,#203fdc,#1a37d9,#152ed5)}"]});let i=r;return i})(),M=class{constructor(r="",_=""){this.userName=r,this.password=_}};export{be as LoginComponent};
